---
number: 20
title: "Android Permissions"
slug: "android-permissions"
level: "intermediate"
tags: ["permissions", "runtime-permissions", "security", "android"]
prerequisites: ["android-lifecycle-components"]
estimated_minutes: 80
contributors: []
diagrams: []
examples: []
canonical_id: "android-intermediate-20"
---



# Android Permissions

## Overview

Android permissions protect user privacy and system resources. This comprehensive guide covers runtime permissions (Android 6.0+), permission groups, requesting permissions, handling permission denials, special permissions, and best practices for implementing permissions in Android applications.

## Table of Contents

1. [What are Permissions?](#what-are-permissions)
2. [Permission Types](#permission-types)
3. [Runtime Permissions](#runtime-permissions)
4. [Requesting Permissions](#requesting-permissions)
5. [Permission Groups](#permission-groups)
6. [Handling Permission Denials](#handling-denials)
7. [Special Permissions](#special-permissions)
8. [Permissions in Compose](#permissions-compose)
9. [Best Practices](#best-practices)

## What are Permissions?

### Definition

**Permission**: System-level access control that restricts access to sensitive resources

**Purpose**: Protect user privacy and system resources

### Why Permissions?

**Protection**:
- **Privacy**: Protect user data (contacts, location, photos)
- **Security**: Prevent malicious apps from accessing sensitive resources
- **System**: Protect system resources (camera, microphone, network)

## Permission Types

### Normal Permissions

**Normal Permissions**: Automatically granted, no user interaction

**Examples**:
- `INTERNET`
- `ACCESS_NETWORK_STATE`
- `VIBRATE`

**Usage**: Declare in manifest, automatically granted

### Dangerous Permissions

**Dangerous Permissions**: Require runtime permission request

**Examples**:
- `CAMERA`
- `READ_CONTACTS`
- `ACCESS_FINE_LOCATION`
- `READ_EXTERNAL_STORAGE`

**Usage**: Declare in manifest + request at runtime

### Special Permissions

**Special Permissions**: Require special handling

**Examples**:
- `SYSTEM_ALERT_WINDOW` (Overlay)
- `WRITE_SETTINGS`
- `REQUEST_IGNORE_BATTERY_OPTIMIZATIONS`

**Usage**: Require special intents or settings

## Runtime Permissions

### Android 6.0+ (API 23+)

**Runtime Permissions**: Request dangerous permissions at runtime

**Process**:
1. Check if permission granted
2. If not, request permission
3. Handle user response
4. Use permission if granted

### Checking Permissions

```kotlin
fun checkPermission(context: Context, permission: String): Boolean {
    return ContextCompat.checkSelfPermission(
        context,
        permission
    ) == PackageManager.PERMISSION_GRANTED
}
```

### Requesting Permissions

```kotlin
class MainActivity : AppCompatActivity() {
    private val requestPermissionLauncher = registerForActivityResult(
        ActivityResultContracts.RequestPermission()
    ) { isGranted ->
        if (isGranted) {
            // Permission granted
            useCamera()
        } else {
            // Permission denied
            showPermissionDeniedMessage()
        }
    }
    
    fun requestCameraPermission() {
        when {
            ContextCompat.checkSelfPermission(
                this,
                Manifest.permission.CAMERA
            ) == PackageManager.PERMISSION_GRANTED -> {
                // Permission already granted
                useCamera()
            }
            else -> {
                // Request permission
                requestPermissionLauncher.launch(Manifest.permission.CAMERA)
            }
        }
    }
}
```

### Multiple Permissions

```kotlin
private val requestMultiplePermissionsLauncher = registerForActivityResult(
    ActivityResultContracts.RequestMultiplePermissions()
) { permissions ->
    permissions.entries.forEach { (permission, isGranted) ->
        when {
            isGranted -> {
                // Permission granted
                when (permission) {
                    Manifest.permission.CAMERA -> useCamera()
                    Manifest.permission.RECORD_AUDIO -> useMicrophone()
                }
            }
            else -> {
                // Permission denied
                handlePermissionDenied(permission)
            }
        }
    }
}

fun requestMultiplePermissions() {
    val permissionsToRequest = arrayOf(
        Manifest.permission.CAMERA,
        Manifest.permission.RECORD_AUDIO
    )
    
    val permissionsToRequestList = permissionsToRequest.filter {
        ContextCompat.checkSelfPermission(this, it) != 
            PackageManager.PERMISSION_GRANTED
    }
    
    if (permissionsToRequestList.isNotEmpty()) {
        requestMultiplePermissionsLauncher.launch(
            permissionsToRequestList.toTypedArray()
        )
    }
}
```

## Requesting Permissions

### Basic Request Flow

```kotlin
class PermissionHandler {
    fun requestPermission(
        activity: ComponentActivity,
        permission: String,
        onGranted: () -> Unit,
        onDenied: () -> Unit
    ) {
        val launcher = activity.registerForActivityResult(
            ActivityResultContracts.RequestPermission()
        ) { isGranted ->
            if (isGranted) {
                onGranted()
            } else {
                onDenied()
            }
        }
        
        when {
            ContextCompat.checkSelfPermission(
                activity,
                permission
            ) == PackageManager.PERMISSION_GRANTED -> {
                onGranted()
            }
            ActivityCompat.shouldShowRequestPermissionRationale(
                activity,
                permission
            ) -> {
                // Show rationale
                showRationaleDialog(activity) {
                    launcher.launch(permission)
                }
            }
            else -> {
                launcher.launch(permission)
            }
        }
    }
}
```

### Permission Request Helper

```kotlin
class PermissionHelper(
    private val activity: ComponentActivity
) {
    private val requestPermissionLauncher = activity.registerForActivityResult(
        ActivityResultContracts.RequestPermission()
    ) { isGranted ->
        permissionCallbacks[permission]?.invoke(isGranted)
    }
    
    private var permission: String = ""
    private val permissionCallbacks = mutableMapOf<String, (Boolean) -> Unit>()
    
    fun requestPermission(
        permission: String,
        onResult: (Boolean) -> Unit
    ) {
        this.permission = permission
        permissionCallbacks[permission] = onResult
        
        when {
            ContextCompat.checkSelfPermission(
                activity,
                permission
            ) == PackageManager.PERMISSION_GRANTED -> {
                onResult(true)
            }
            ActivityCompat.shouldShowRequestPermissionRationale(
                activity,
                permission
            ) -> {
                showRationale(permission) {
                    requestPermissionLauncher.launch(permission)
                }
            }
            else -> {
                requestPermissionLauncher.launch(permission)
            }
        }
    }
    
    private fun showRationale(
        permission: String,
        onContinue: () -> Unit
    ) {
        AlertDialog.Builder(activity)
            .setTitle("Permission Required")
            .setMessage(getRationaleMessage(permission))
            .setPositiveButton("Grant") { _, _ -> onContinue() }
            .setNegativeButton("Deny") { _, _ -> }
            .show()
    }
    
    private fun getRationaleMessage(permission: String): String {
        return when (permission) {
            Manifest.permission.CAMERA -> "Camera permission is required to take photos"
            Manifest.permission.ACCESS_FINE_LOCATION -> "Location permission is required for this feature"
            else -> "This permission is required for the app to function"
        }
    }
}
```

## Permission Groups

### Understanding Permission Groups

**Permission Groups**: Related permissions grouped together

**Examples**:
- **STORAGE**: `READ_EXTERNAL_STORAGE`, `WRITE_EXTERNAL_STORAGE`
- **LOCATION**: `ACCESS_FINE_LOCATION`, `ACCESS_COARSE_LOCATION`
- **CONTACTS**: `READ_CONTACTS`, `WRITE_CONTACTS`

### Requesting Permission Groups

```kotlin
fun requestLocationPermissions() {
    val permissions = arrayOf(
        Manifest.permission.ACCESS_FINE_LOCATION,
        Manifest.permission.ACCESS_COARSE_LOCATION
    )
    
    requestMultiplePermissionsLauncher.launch(permissions)
}
```

### Checking Permission Groups

```kotlin
fun hasLocationPermission(): Boolean {
    return ContextCompat.checkSelfPermission(
        this,
        Manifest.permission.ACCESS_FINE_LOCATION
    ) == PackageManager.PERMISSION_GRANTED ||
    ContextCompat.checkSelfPermission(
        this,
        Manifest.permission.ACCESS_COARSE_LOCATION
    ) == PackageManager.PERMISSION_GRANTED
}
```

## Handling Permission Denials

### Should Show Rationale

```kotlin
if (ActivityCompat.shouldShowRequestPermissionRationale(
        this,
        Manifest.permission.CAMERA
    )) {
    // User denied before, show explanation
    showRationaleDialog()
} else {
    // First time or permanently denied
    requestPermission()
}
```

### Permanently Denied

```kotlin
fun handlePermissionDenied(permission: String) {
    if (!ActivityCompat.shouldShowRequestPermissionRationale(
            this,
            permission
        ) && !isPermissionGranted(permission)
    ) {
        // Permanently denied, open settings
        openAppSettings()
    } else {
        // Show rationale
        showRationaleDialog()
    }
}

fun openAppSettings() {
    val intent = Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS).apply {
        data = Uri.fromParts("package", packageName, null)
    }
    startActivity(intent)
}
```

### Permission Denied Dialog

```kotlin
fun showPermissionDeniedDialog(permission: String) {
    AlertDialog.Builder(this)
        .setTitle("Permission Required")
        .setMessage("This feature requires $permission permission. Please grant it in settings.")
        .setPositiveButton("Open Settings") { _, _ ->
            openAppSettings()
        }
        .setNegativeButton("Cancel", null)
        .show()
}
```

## Special Permissions

### Overlay Permission (SYSTEM_ALERT_WINDOW)

```kotlin
fun requestOverlayPermission() {
    if (!Settings.canDrawOverlays(this)) {
        val intent = Intent(
            Settings.ACTION_MANAGE_OVERLAY_PERMISSION,
            Uri.parse("package:$packageName")
        )
        startActivity(intent)
    }
}

fun checkOverlayPermission(): Boolean {
    return Settings.canDrawOverlays(this)
}
```

### Write Settings Permission

```kotlin
fun requestWriteSettingsPermission() {
    if (!Settings.System.canWrite(this)) {
        val intent = Intent(Settings.ACTION_MANAGE_WRITE_SETTINGS).apply {
            data = Uri.parse("package:$packageName")
        }
        startActivity(intent)
    }
}
```

### Battery Optimization

```kotlin
fun requestBatteryOptimizationExemption() {
    val powerManager = getSystemService(Context.POWER_SERVICE) as PowerManager
    if (!powerManager.isIgnoringBatteryOptimizations(packageName)) {
        val intent = Intent(Settings.ACTION_REQUEST_IGNORE_BATTERY_OPTIMIZATIONS).apply {
            data = Uri.parse("package:$packageName")
        }
        startActivity(intent)
    }
}
```

## Permissions in Compose

### Accompanist Permissions

**Dependency**:
```kotlin
implementation("com.google.accompanist:accompanist-permissions:0.32.0")
```

**Usage**:
```kotlin
@Composable
fun CameraScreen() {
    val permissionState = rememberPermissionState(
        android.Manifest.permission.CAMERA
    )
    
    LaunchedEffect(Unit) {
        if (!permissionState.hasPermission) {
            permissionState.launchPermissionRequest()
        }
    }
    
    when {
        permissionState.hasPermission -> {
            CameraView()
        }
        permissionState.shouldShowRationale -> {
            RationaleScreen {
                permissionState.launchPermissionRequest()
            }
        }
        else -> {
            PermissionDeniedScreen {
                // Open settings
            }
        }
    }
}
```

### Multiple Permissions in Compose

```kotlin
@Composable
fun LocationScreen() {
    val permissions = listOf(
        android.Manifest.permission.ACCESS_FINE_LOCATION,
        android.Manifest.permission.ACCESS_COARSE_LOCATION
    )
    
    val permissionState = rememberMultiplePermissionsState(permissions)
    
    LaunchedEffect(Unit) {
        if (!permissionState.allPermissionsGranted) {
            permissionState.launchMultiplePermissionRequest()
        }
    }
    
    when {
        permissionState.allPermissionsGranted -> {
            LocationView()
        }
        permissionState.shouldShowRationale -> {
            RationaleScreen()
        }
        else -> {
            PermissionDeniedScreen()
        }
    }
}
```

## Best Practices

### Practice 1: Request When Needed

```kotlin
// GOOD: Request permission when feature is used
fun takePhoto() {
    if (hasCameraPermission()) {
        openCamera()
    } else {
        requestCameraPermission()
    }
}

// BAD: Request all permissions on app start
override fun onCreate() {
    requestAllPermissions() // Don't do this
}
```

### Practice 2: Explain Why

```kotlin
// GOOD: Show rationale before requesting
if (shouldShowRationale()) {
    showRationaleDialog {
        requestPermission()
    }
} else {
    requestPermission()
}
```

### Practice 3: Handle Denials Gracefully

```kotlin
// GOOD: Handle denial gracefully
fun handlePermissionDenied() {
    when {
        shouldShowRationale() -> showRationaleDialog()
        isPermanentlyDenied() -> openSettings()
        else -> showFeatureUnavailableMessage()
    }
}
```

### Practice 4: Check Before Using

```kotlin
// GOOD: Always check before using
fun useCamera() {
    if (hasCameraPermission()) {
        // Use camera
    } else {
        requestCameraPermission()
    }
}
```

### Practice 5: Use Permission Helper

```kotlin
// GOOD: Use helper class
class CameraHelper(private val activity: ComponentActivity) {
    private val permissionHelper = PermissionHelper(activity)
    
    fun takePhoto() {
        permissionHelper.requestPermission(
            Manifest.permission.CAMERA
        ) { granted ->
            if (granted) {
                openCamera()
            }
        }
    }
}
```

## Real-World Examples

### Complete Permission Manager

```kotlin
class PermissionManager(
    private val activity: ComponentActivity
) {
    private val requestPermissionLauncher = activity.registerForActivityResult(
        ActivityResultContracts.RequestPermission()
    ) { isGranted ->
        currentCallback?.invoke(isGranted)
    }
    
    private var currentPermission: String? = null
    private var currentCallback: ((Boolean) -> Unit)? = null
    
    fun requestPermission(
        permission: String,
        rationale: String? = null,
        onResult: (Boolean) -> Unit
    ) {
        currentPermission = permission
        currentCallback = onResult
        
        when {
            isPermissionGranted(permission) -> {
                onResult(true)
            }
            shouldShowRationale(permission) && rationale != null -> {
                showRationaleDialog(rationale) {
                    requestPermissionLauncher.launch(permission)
                }
            }
            else -> {
                requestPermissionLauncher.launch(permission)
            }
        }
    }
    
    fun requestMultiplePermissions(
        permissions: Array<String>,
        onResult: (Map<String, Boolean>) -> Unit
    ) {
        val launcher = activity.registerForActivityResult(
            ActivityResultContracts.RequestMultiplePermissions()
        ) { result ->
            onResult(result)
        }
        
        launcher.launch(permissions)
    }
    
    private fun isPermissionGranted(permission: String): Boolean {
        return ContextCompat.checkSelfPermission(
            activity,
            permission
        ) == PackageManager.PERMISSION_GRANTED
    }
    
    private fun shouldShowRationale(permission: String): Boolean {
        return ActivityCompat.shouldShowRequestPermissionRationale(
            activity,
            permission
        )
    }
    
    private fun showRationaleDialog(
        message: String,
        onContinue: () -> Unit
    ) {
        AlertDialog.Builder(activity)
            .setTitle("Permission Required")
            .setMessage(message)
            .setPositiveButton("Grant") { _, _ -> onContinue() }
            .setNegativeButton("Deny", null)
            .show()
    }
}
```

## Common Pitfalls

### Problem: Not Checking Permission Before Use

```kotlin
// BAD: Assume permission granted
fun useCamera() {
    camera.takePhoto() // May crash
}

// GOOD: Check first
fun useCamera() {
    if (hasCameraPermission()) {
        camera.takePhoto()
    } else {
        requestCameraPermission()
    }
}
```

### Problem: Requesting Too Early

```kotlin
// BAD: Request on app start
override fun onCreate() {
    requestAllPermissions()
}

// GOOD: Request when needed
fun onTakePhotoClick() {
    requestCameraPermission()
}
```

## Quiz

1. When should you request dangerous permissions?
   - **A)** On app start
   - **B)** When the feature is used
   - **C)** Never
   - **D)** Always

2. What happens if user denies permission permanently?
   - **A)** App crashes
   - **B)** Open app settings
   - **C)** Request again
   - **D)** Nothing

3. What is the difference between normal and dangerous permissions?
   - **A)** No difference
   - **B)** Dangerous permissions require runtime request
   - **C)** Normal permissions are more secure
   - **D)** Dangerous permissions are automatic

**Answers:**
1. **B** - Request permissions when the user tries to use a feature that requires them, not on app start
2. **B** - If permanently denied, guide users to app settings to grant permission manually
3. **B** - Dangerous permissions require runtime user approval, normal permissions are automatically granted

## Next Steps

- [Android Lifecycle Components](../beginners/05.%20Android%20Lifecycle%20Components.md) - Lifecycle awareness
- [Security & Authentication](./28.%20Security%20%26%20Authentication.md) - Security practices
- [Notifications & FCM](./29.%20Notifications%20%26%20FCM.md) - Notification permissions

