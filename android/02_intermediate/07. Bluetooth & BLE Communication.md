---
number: 7
title: "Bluetooth & BLE Communication"
slug: "bluetooth-ble-communication"
level: "intermediate"
tags: ["bluetooth", "ble", "wireless", "communication", "iot"]
prerequisites: []
estimated_minutes: 55
contributors: []
diagrams: []
examples: []
canonical_id: "android-intermediate-07"
---



# Bluetooth & BLE Communication

## Overview

Bluetooth Low Energy (BLE) and Classic Bluetooth enable Android apps to communicate with nearby devices. BLE is ideal for IoT devices, wearables, and low-power applications, while Classic Bluetooth is better for audio streaming and file transfer. This guide covers scanning, connecting, and communicating with Bluetooth devices.

## Deep Explanation

### Bluetooth vs BLE

**Classic Bluetooth:**
- Higher power consumption
- Better for audio streaming
- File transfer
- Range: ~10 meters

**BLE (Bluetooth Low Energy):**
- Low power consumption
- Ideal for IoT devices
- Periodic data transfer
- Range: ~30 meters

## Real Code Examples

### BLE Scanning

```kotlin
class BluetoothManager(private val context: Context) {
    private val bluetoothAdapter: BluetoothAdapter? by lazy {
        val bluetoothManager = context.getSystemService(Context.BLUETOOTH_SERVICE) as BluetoothManager
        bluetoothManager.adapter
    }
    
    private val scanCallback = object : ScanCallback() {
        override fun onScanResult(callbackType: Int, result: ScanResult) {
            val device = result.device
            val rssi = result.rssi
            // Process found device
            onDeviceFound(device, rssi)
        }
        
        override fun onScanFailed(errorCode: Int) {
            // Handle scan failure
        }
    }
    
    fun startScanning() {
        val scanner = bluetoothAdapter?.bluetoothLeScanner
        val scanFilter = ScanFilter.Builder()
            .setServiceUuid(ParcelUuid.fromString("0000180f-0000-1000-8000-00805f9b34fb"))
            .build()
        
        val scanSettings = ScanSettings.Builder()
            .setScanMode(ScanSettings.SCAN_MODE_LOW_LATENCY)
            .build()
        
        scanner?.startScan(listOf(scanFilter), scanSettings, scanCallback)
    }
    
    fun stopScanning() {
        bluetoothAdapter?.bluetoothLeScanner?.stopScan(scanCallback)
    }
}
```

### BLE Connection & Communication

```kotlin
class BLEDeviceManager(private val context: Context) {
    private var bluetoothGatt: BluetoothGatt? = null
    
    private val gattCallback = object : BluetoothGattCallback() {
        override fun onConnectionStateChange(gatt: BluetoothGatt, status: Int, newState: Int) {
            when (newState) {
                BluetoothProfile.STATE_CONNECTED -> {
                    gatt.discoverServices()
                }
                BluetoothProfile.STATE_DISCONNECTED -> {
                    // Handle disconnect
                }
            }
        }
        
        override fun onServicesDiscovered(gatt: BluetoothGatt, status: Int) {
            if (status == BluetoothGatt.GATT_SUCCESS) {
                val service = gatt.getService(UUID.fromString("0000180f-0000-1000-8000-00805f9b34fb"))
                val characteristic = service.getCharacteristic(UUID.fromString("00002a19-0000-1000-8000-00805f9b34fb"))
                gatt.readCharacteristic(characteristic)
            }
        }
        
        override fun onCharacteristicRead(
            gatt: BluetoothGatt,
            characteristic: BluetoothGattCharacteristic,
            status: Int
        ) {
            if (status == BluetoothGatt.GATT_SUCCESS) {
                val data = characteristic.value
                // Process data
            }
        }
    }
    
    fun connect(device: BluetoothDevice) {
        bluetoothGatt = device.connectGatt(context, false, gattCallback)
    }
    
    fun writeCharacteristic(characteristic: BluetoothGattCharacteristic, data: ByteArray) {
        characteristic.value = data
        bluetoothGatt?.writeCharacteristic(characteristic)
    }
}
```

### Classic Bluetooth

```kotlin
class ClassicBluetoothManager {
    private val bluetoothAdapter: BluetoothAdapter? = BluetoothAdapter.getDefaultAdapter()
    
    fun getPairedDevices(): Set<BluetoothDevice> {
        return bluetoothAdapter?.bondedDevices ?: emptySet()
    }
    
    fun connectToDevice(device: BluetoothDevice): BluetoothSocket? {
        val uuid = UUID.fromString("00001101-0000-1000-8000-00805F9B34FB")
        val socket = device.createRfcommSocketToServiceRecord(uuid)
        
        return try {
            socket.connect()
            socket
        } catch (e: IOException) {
            socket.close()
            null
        }
    }
    
    fun sendData(socket: BluetoothSocket, data: ByteArray) {
        socket.outputStream.write(data)
    }
    
    fun receiveData(socket: BluetoothSocket): ByteArray {
        val buffer = ByteArray(1024)
        val bytes = socket.inputStream.read(buffer)
        return buffer.copyOf(bytes)
    }
}
```

## Common Pitfalls

### Problem: Not requesting Bluetooth permissions

**BAD:**
```kotlin
// Crashes on Android 12+
bluetoothAdapter.bluetoothLeScanner.startScan(scanCallback)
```

**GOOD:**
```kotlin
if (hasBluetoothPermissions()) {
    bluetoothAdapter.bluetoothLeScanner.startScan(scanCallback)
} else {
    requestBluetoothPermissions()
}
```

## Quiz

1. What is BLE best suited for?
   - **A)** Audio streaming
   - **B)** Low-power IoT devices
   - **C)** File transfer
   - **D)** Video streaming

2. What callback is used for BLE connections?
   - **A)** BluetoothCallback
   - **B)** BluetoothGattCallback
   - **C)** ConnectionCallback
   - **D)** DeviceCallback

**Answers:**
1. **B** - BLE is designed for low-power applications like IoT devices
2. **B** - BluetoothGattCallback handles BLE connection events

## Next Steps

- [Socket Connections](./17.%20Socket%20Connections.md) - Network communication

