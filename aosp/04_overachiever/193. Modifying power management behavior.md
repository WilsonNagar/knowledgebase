---
number: 193
title: Modifying power management behavior
slug: modifying-power-management-behavior
level: overachiever
tags:
  - aosp
  - power-management
  - powermanagerservice
  - battery
  - customization
  - system-modification
prerequisites:
  - powermanagerservice
  - power-management
  - wakelocks
  - customizing-framework-services
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-overachiever-193
---

# Modifying power management behavior

## Overview

Modifying power management behavior refers to the process of customizing and extending the Android power management system to change power policies, adjust power-saving features, customize wake lock behavior, and implement device-specific power optimizations. Understanding how to modify power management behavior is essential for AOSP development, as it enables custom power policies, hardware-specific optimizations, battery life improvements, and system power customization. This guide provides a comprehensive overview of modifying power management behavior, power policy customization, PowerManagerService modification, kernel integration, framework integration, and best practices.

Think of modifying power management behavior like customizing a car's fuel management system: just as you might customize a car's fuel management to optimize for performance, economy, or specific driving conditions, modifying power management behavior allows you to customize how Android manages power consumption, optimizes battery life, and balances performance with power efficiency for specific device requirements or use cases.

## Deep Explanation

### What is Modifying Power Management Behavior?

Modifying power management behavior refers to the process of customizing and extending the Android power management system to change power policies, adjust power-saving features, customize wake lock behavior, and implement device-specific power optimizations.

**Key Characteristics:**
- **Policy Customization:** Customize power policies
- **Feature Adjustment:** Adjust power-saving features
- **Wake Lock Customization:** Customize wake lock behavior
- **Hardware Optimization:** Hardware-specific optimizations
- **System Integration:** Integrate with system

**Why Modify Power Management Behavior?**
- **Custom Policies:** Implement custom power policies
- **Hardware Optimization:** Optimize for specific hardware
- **Battery Life:** Improve battery life
- **Performance:** Balance performance and power
- **Device Requirements:** Meet device-specific requirements

### Power Policy Customization

#### Policy Modification

**Policy Modification:**
- Modify power state transitions
- Adjust power-saving thresholds
- Customize Doze mode behavior
- Change battery saver settings
- Implement custom policies

**Modification Example:**
```java
// Custom PowerManagerService
public class CustomPowerManagerService extends PowerManagerService {
    private CustomPowerPolicy mCustomPolicy;
    
    @Override
    public void systemReady() {
        super.systemReady();
        // Initialize custom policy
        mCustomPolicy = new CustomPowerPolicy();
        mCustomPolicy.initialize();
    }
    
    @Override
    protected void updatePowerStateLocked() {
        // Apply custom policy
        if (mCustomPolicy.shouldApply()) {
            mCustomPolicy.applyPowerState(this);
        } else {
            // Default behavior
            super.updatePowerStateLocked();
        }
    }
}
```

**Modification Characteristics:**
- Policy customization
- State transition control
- Threshold adjustment
- Feature configuration
- System integration

#### Threshold Adjustment

**Threshold Adjustment:**
- Adjust battery level thresholds
- Modify charging thresholds
- Change temperature thresholds
- Customize power-saving triggers
- Configure optimization levels

**Threshold Example:**
```java
// Custom thresholds
public class CustomPowerPolicy {
    private static final int CUSTOM_BATTERY_SAVER_THRESHOLD = 20; // 20%
    private static final int CUSTOM_DOZE_THRESHOLD = 5; // 5%
    
    public boolean shouldEnableBatterySaver(int batteryLevel) {
        // Custom threshold
        return batteryLevel <= CUSTOM_BATTERY_SAVER_THRESHOLD;
    }
    
    public boolean shouldEnterDoze(int batteryLevel) {
        // Custom doze threshold
        return batteryLevel <= CUSTOM_DOZE_THRESHOLD;
    }
}
```

**Threshold Characteristics:**
- Level-based configuration
- Trigger customization
- Policy integration
- System coordination
- User experience

### PowerManagerService Modification

#### Service Extension

**Service Extension:**
- Extend PowerManagerService
- Override power management methods
- Add custom functionality
- Integrate with framework
- Maintain compatibility

**Extension Example:**
```java
// Extended PowerManagerService
public class CustomPowerManagerService extends PowerManagerService {
    private CustomPowerFeature mCustomFeature;
    
    public CustomPowerManagerService(Context context) {
        super(context);
        mCustomFeature = new CustomPowerFeature();
    }
    
    @Override
    public void goToSleep(long eventTime, int reason, int flags) {
        // Custom pre-sleep logic
        mCustomFeature.onPreSleep(reason);
        
        // Call parent
        super.goToSleep(eventTime, reason, flags);
        
        // Custom post-sleep logic
        mCustomFeature.onPostSleep();
    }
    
    @Override
    public void wakeUp(long eventTime, String reason, String opPackageName,
                      int opUid) {
        // Custom pre-wake logic
        mCustomFeature.onPreWake(reason);
        
        // Call parent
        super.wakeUp(eventTime, reason, opPackageName, opUid);
        
        // Custom post-wake logic
        mCustomFeature.onPostWake();
    }
}
```

**Extension Characteristics:**
- Service subclassing
- Method overriding
- Custom functionality
- Framework integration
- Compatibility maintenance

#### Wake Lock Customization

**Wake Lock Customization:**
- Customize wake lock behavior
- Modify wake lock policies
- Add wake lock restrictions
- Implement custom wake lock types
- Control wake lock duration

**Customization Example:**
```java
// Custom wake lock handling
@Override
public void acquireWakeLock(IBinder lock, int flags, String tag,
                            String packageName, WorkSource ws) {
    // Custom validation
    if (mCustomPolicy.shouldRestrictWakeLock(tag, packageName)) {
        throw new SecurityException("Wake lock restricted: " + tag);
    }
    
    // Custom processing
    mCustomFeature.onWakeLockAcquire(tag, packageName);
    
    // Call parent
    super.acquireWakeLock(lock, flags, tag, packageName, ws);
}

@Override
public void releaseWakeLock(IBinder lock, int flags) {
    // Custom processing
    mCustomFeature.onWakeLockRelease(lock);
    
    // Call parent
    super.releaseWakeLock(lock, flags);
}
```

**Customization Characteristics:**
- Behavior modification
- Policy enforcement
- Restriction implementation
- Custom types
- Duration control

### Kernel Integration

#### Kernel Power Management

**Kernel Integration:**
- Coordinate with kernel power management
- Modify kernel power policies
- Adjust CPU frequency scaling
- Customize suspend/resume behavior
- Integrate with power drivers

**Integration Example:**
```java
// Kernel power coordination
private void applyKernelPowerPolicy() {
    // Write to kernel power interface
    FileUtils.stringToFile("/sys/power/state", "mem");
    
    // Adjust CPU governor
    FileUtils.stringToFile("/sys/devices/system/cpu/cpu0/cpufreq/scaling_governor",
                          "powersave");
    
    // Set power constraints
    FileUtils.stringToFile("/sys/power/pm_freeze_timeout", "5000");
}
```

**Integration Characteristics:**
- Kernel interface access
- Power state control
- CPU management
- Driver integration
- System coordination

#### Hardware Power Control

**Hardware Control:**
- Control hardware power states
- Manage peripheral power
- Adjust display power
- Control sensor power
- Optimize hardware usage

**Control Example:**
```java
// Hardware power control
private void controlHardwarePower() {
    // Display power
    setDisplayPowerState(Display.STATE_OFF);
    
    // Sensor power
    disableSensors();
    
    // Peripheral power
    setPeripheralPowerState(false);
    
    // Custom hardware
    controlCustomHardware(false);
}
```

**Control Characteristics:**
- Hardware state management
- Peripheral control
- Power optimization
- Resource management
- System coordination

### Framework Integration

#### System Service Integration

**Service Integration:**
- Integrate with SystemServer
- Coordinate with other services
- Handle service dependencies
- Manage service lifecycle
- System-wide coordination

**Integration Example:**
```java
// SystemServer integration
private void startOtherServices() {
    // Create custom PowerManagerService
    mPowerManagerService = new CustomPowerManagerService(mSystemContext);
    
    // Initialize
    mPowerManagerService.systemReady();
    
    // Register with ServiceManager
    ServiceManager.addService(Context.POWER_SERVICE, mPowerManagerService);
}
```

**Integration Characteristics:**
- SystemServer integration
- Service registration
- Lifecycle management
- Dependency handling
- System coordination

#### Application Integration

**Application Integration:**
- Expose custom APIs
- Provide power management interfaces
- Support application requests
- Handle permission checks
- Maintain compatibility

**Integration Example:**
```java
// Custom power API
public class CustomPowerManager {
    private IPowerManager mService;
    
    public void setCustomPowerMode(int mode) {
        try {
            mService.setCustomPowerMode(mode);
        } catch (RemoteException e) {
            throw new RuntimeException(e);
        }
    }
    
    public int getCustomPowerMode() {
        try {
            return mService.getCustomPowerMode();
        } catch (RemoteException e) {
            throw new RuntimeException(e);
        }
    }
}
```

**Integration Characteristics:**
- API exposure
- Interface provision
- Request handling
- Permission enforcement
- Compatibility

### Best Practices

#### Best Practices

**Best Practices:**
- Understand power management architecture
- Test thoroughly
- Balance performance and power
- Document changes
- Maintain compatibility

**Practice Guidelines:**
- **Architecture:** Understand power management architecture
- **Testing:** Test thoroughly
- **Balance:** Balance performance and power
- **Documentation:** Document changes
- **Compatibility:** Maintain compatibility

#### Common Modifications

**Common Modifications:**
- Battery saver customization
- Doze mode adjustment
- Wake lock policy changes
- CPU frequency scaling
- Display power management

**Modification Examples:**
- Custom battery saver thresholds
- Modified Doze mode behavior
- Wake lock restrictions
- CPU governor selection
- Display brightness control

## Key Takeaways

1. **Modifying power management behavior** refers to the process of customizing and extending the Android power management system to change power policies, adjust power-saving features, customize wake lock behavior, and implement device-specific power optimizations.

2. **Power policy customization** includes policy modification (modify power state transitions, adjust power-saving thresholds, customize Doze mode behavior, change battery saver settings, implement custom policies), threshold adjustment (adjust battery level thresholds, modify charging thresholds, change temperature thresholds, customize power-saving triggers, configure optimization levels), and customization characteristics.

3. **PowerManagerService modification** includes service extension (extend PowerManagerService, override power management methods, add custom functionality, integrate with framework, maintain compatibility), wake lock customization (customize wake lock behavior, modify wake lock policies, add wake lock restrictions, implement custom wake lock types, control wake lock duration), and modification characteristics.

4. **Kernel integration** includes kernel power management (coordinate with kernel power management, modify kernel power policies, adjust CPU frequency scaling, customize suspend/resume behavior, integrate with power drivers), hardware power control (control hardware power states, manage peripheral power, adjust display power, control sensor power, optimize hardware usage), and integration characteristics.

5. **Framework integration** includes system service integration (integrate with SystemServer, coordinate with other services, handle service dependencies, manage service lifecycle, system-wide coordination), application integration (expose custom APIs, provide power management interfaces, support application requests, handle permission checks, maintain compatibility), and integration characteristics.

6. **Best practices** include best practices (understand power management architecture, test thoroughly, balance performance and power, document changes, maintain compatibility), common modifications (battery saver customization, Doze mode adjustment, wake lock policy changes, CPU frequency scaling, display power management), and practice guidelines.

7. **Understanding how to modify power management behavior** is essential for AOSP development, enabling custom power policies, hardware-specific optimizations, battery life improvements, system power customization, and proper power management modification implementation.

## Related Topics

- **PowerManagerService:** PowerManagerService details
- **Power management:** Kernel power management details
- **Wakelocks:** Wake lock details
- **Customizing framework services:** Framework customization details

