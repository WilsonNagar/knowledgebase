---
number: 191
title: Creating custom permissions & system roles
slug: creating-custom-permissions-system-roles
level: overachiever
tags:
  - aosp
  - permissions
  - system-roles
  - custom-permissions
  - security
  - access-control
prerequisites:
  - permissions-system
  - permissions-service
  - manifest-permissions
  - android-security-model
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-overachiever-191
---

# Creating custom permissions & system roles

## Overview

Creating custom permissions and system roles refers to the process of defining new permissions and system roles in Android to control access to custom functionality, protect resources, and implement fine-grained access control. Understanding how to create custom permissions and system roles is essential for AOSP development, as it enables custom access control, resource protection, framework extension, and system customization. This guide provides a comprehensive overview of creating custom permissions and system roles, permission definition, system role creation, framework integration, enforcement mechanisms, and best practices.

Think of creating custom permissions and system roles like creating custom access cards for a building: just as you might create custom access cards with specific permissions (e.g., "server room access", "executive floor access"), creating custom permissions and system roles allows you to define specific access levels and capabilities for different components and users in the Android system. This provides fine-grained control over who can access what functionality.

## Deep Explanation

### What is Creating Custom Permissions & System Roles?

Creating custom permissions and system roles refers to the process of defining new permissions and system roles in Android to control access to custom functionality, protect resources, and implement fine-grained access control.

**Key Characteristics:**
- **Permission Definition:** Define custom permissions
- **System Role Creation:** Create system roles
- **Access Control:** Fine-grained access control
- **Resource Protection:** Protect custom resources
- **Framework Integration:** Integrate with framework

**Why Create Custom Permissions & System Roles?**
- **Custom Functionality:** Control access to custom features
- **Resource Protection:** Protect system resources
- **Security:** Implement security policies
- **Framework Extension:** Extend framework capabilities
- **System Customization:** Customize system behavior

### Custom Permission Creation

#### Permission Definition

**Permission Definition:**
- Define permission in AndroidManifest.xml
- Specify protection level
- Provide metadata
- Register with system
- Enforce in code

**Definition Format:**
```xml
<!-- In AndroidManifest.xml -->
<manifest>
    <!-- Define custom permission -->
    <permission
        android:name="com.example.CUSTOM_PERMISSION"
        android:protectionLevel="dangerous"
        android:label="@string/permission_label"
        android:description="@string/permission_description"
        android:permissionGroup="com.example.PERMISSION_GROUP"
        android:icon="@drawable/permission_icon" />
    
    <!-- Define permission group (optional) -->
    <permission-group
        android:name="com.example.PERMISSION_GROUP"
        android:label="@string/group_label"
        android:description="@string/group_description"
        android:icon="@drawable/group_icon" />
</manifest>
```

**Definition Attributes:**
- **name:** Permission name (required)
- **protectionLevel:** Protection level (required)
- **label:** User-visible label
- **description:** User-visible description
- **permissionGroup:** Permission group
- **icon:** Permission icon

**Definition Characteristics:**
- Manifest declaration
- Protection level specification
- Metadata provision
- System registration
- User visibility

#### Protection Levels

**Protection Levels:**
- **normal:** Auto-granted, low risk
- **dangerous:** Runtime request, high risk
- **signature:** Signature-based, system level
- **signature|privileged:** Signature OR privileged location
- **appop:** AppOps-based permission

**Protection Level Selection:**
```xml
<!-- Normal permission (auto-granted) -->
<permission
    android:name="com.example.NORMAL_PERMISSION"
    android:protectionLevel="normal" />

<!-- Dangerous permission (runtime request) -->
<permission
    android:name="com.example.DANGEROUS_PERMISSION"
    android:protectionLevel="dangerous" />

<!-- Signature permission (system level) -->
<permission
    android:name="com.example.SIGNATURE_PERMISSION"
    android:protectionLevel="signature" />

<!-- Signature or privileged -->
<permission
    android:name="com.example.PRIVILEGED_PERMISSION"
    android:protectionLevel="signature|privileged" />
```

**Protection Level Characteristics:**
- Risk-based classification
- Grant mechanism
- User interaction
- System integration
- Security enforcement

#### Permission Enforcement

**Permission Enforcement:**
- Check permission in code
- Enforce at API level
- Enforce at service level
- Handle permission denial
- Provide error messages

**Enforcement Example:**
```java
// Check permission before operation
public void performSecureOperation() {
    // Check permission
    if (checkSelfPermission(Manifest.permission.CUSTOM_PERMISSION)
            != PackageManager.PERMISSION_GRANTED) {
        // Permission not granted
        throw new SecurityException(
            "Permission required: " + Manifest.permission.CUSTOM_PERMISSION);
    }
    
    // Perform operation
    performOperation();
}

// Framework-level enforcement
public class CustomService extends SystemService {
    @Override
    public void onCustomOperation() {
        // Check permission
        enforcePermission(Manifest.permission.CUSTOM_PERMISSION);
        
        // Perform operation
        performCustomOperation();
    }
    
    private void enforcePermission(String permission) {
        int result = mContext.checkCallingPermission(permission);
        if (result != PackageManager.PERMISSION_GRANTED) {
            throw new SecurityException(
                "Permission denied: " + permission);
        }
    }
}
```

**Enforcement Characteristics:**
- Code-level checks
- API-level enforcement
- Service-level enforcement
- Error handling
- Security exceptions

### System Role Creation

#### System Role Definition

**System Role Definition:**
- Define system role in framework
- Specify role capabilities
- Configure role permissions
- Register with system
- Assign to components

**Role Definition:**
```xml
<!-- In framework configuration -->
<role
    name="com.example.CUSTOM_ROLE"
    label="@string/role_label"
    description="@string/role_description"
    icon="@drawable/role_icon">
    
    <!-- Role permissions -->
    <permission name="android.permission.INTERNET" />
    <permission name="com.example.CUSTOM_PERMISSION" />
    
    <!-- Role capabilities -->
    <capability name="custom_capability" />
</role>
```

**Role Characteristics:**
- Role definition
- Permission assignment
- Capability specification
- System registration
- Component assignment

#### Role Assignment

**Role Assignment:**
- Assign role to components
- Configure role behavior
- Manage role lifecycle
- Handle role changes
- Update role assignments

**Assignment Example:**
```java
// Assign role to component
public class RoleManager {
    public void assignRole(String packageName, String roleName) {
        // Assign role
        mRoleManager.addRoleHolderAsUser(roleName, packageName,
                                        UserHandle.getCallingUserId());
    }
    
    public void removeRole(String packageName, String roleName) {
        // Remove role
        mRoleManager.removeRoleHolderAsUser(roleName, packageName,
                                            UserHandle.getCallingUserId());
    }
    
    public boolean hasRole(String packageName, String roleName) {
        // Check role
        return mRoleManager.isRoleHeld(packageName, roleName);
    }
}
```

**Assignment Characteristics:**
- Dynamic assignment
- Component-based
- Lifecycle management
- State tracking
- System integration

### Framework Integration

#### Permission Registration

**Permission Registration:**
- Register with PackageManager
- Store in system database
- Make available to apps
- Integrate with permission UI
- Support permission requests

**Registration Process:**
```
1. Define permission in manifest
2. System reads manifest
3. Permission registered with PackageManager
4. Permission stored in system database
5. Permission available for use
```

**Registration Characteristics:**
- Automatic registration
- System database storage
- Framework integration
- UI integration
- Request support

#### System Service Integration

**Service Integration:**
- Integrate with PermissionManagerService
- Register with system services
- Handle permission checks
- Manage permission state
- Support permission operations

**Integration Example:**
```java
// Custom service with permission enforcement
public class CustomSystemService extends SystemService {
    private static final String CUSTOM_PERMISSION =
        "com.example.CUSTOM_PERMISSION";
    
    @Override
    public void onStart() {
        // Register service
        publishBinderService(Context.CUSTOM_SERVICE,
                            new CustomBinderService());
    }
    
    private class CustomBinderService extends ICustomService.Stub {
        @Override
        public void performOperation() {
            // Enforce permission
            enforcePermission(CUSTOM_PERMISSION);
            
            // Perform operation
            doOperation();
        }
        
        private void enforcePermission(String permission) {
            int result = mContext.checkCallingPermission(permission);
            if (result != PackageManager.PERMISSION_GRANTED) {
                throw new SecurityException(
                    "Permission denied: " + permission);
            }
        }
    }
}
```

**Integration Characteristics:**
- Service registration
- Permission enforcement
- Framework integration
- Security enforcement
- System integration

### Build System Integration

#### Framework Permission Definition

**Framework Permissions:**
- Define in framework manifest
- Include in system build
- Available to all apps
- System-level permissions
- Framework integration

**Framework Definition:**
```xml
<!-- In frameworks/base/core/res/AndroidManifest.xml -->
<manifest>
    <permission
        android:name="android.permission.CUSTOM_FRAMEWORK_PERMISSION"
        android:protectionLevel="signature"
        android:label="@string/framework_permission_label"
        android:description="@string/framework_permission_description" />
</manifest>
```

**Framework Characteristics:**
- System-level definition
- Framework integration
- Available system-wide
- Signature protection
- Framework manifest

#### Build Configuration

**Build Configuration:**
- Include in build system
- Package with framework
- Register at build time
- System integration
- Build system support

**Configuration Example:**
```python
# Android.bp
android_library {
    name: "framework-res",
    manifest: "AndroidManifest.xml",
    resource_dirs: ["res"],
    // ... other config
}
```

**Configuration Characteristics:**
- Build system integration
- Framework packaging
- System registration
- Build-time processing
- System availability

### Best Practices

#### Best Practices

**Best Practices:**
- Use appropriate protection levels
- Provide clear descriptions
- Document permission usage
- Test permission enforcement
- Follow security guidelines

**Practice Guidelines:**
- **Protection Levels:** Use appropriate protection levels
- **Descriptions:** Provide clear descriptions
- **Documentation:** Document permission usage
- **Testing:** Test permission enforcement
- **Security:** Follow security guidelines

#### Common Patterns

**Common Patterns:**
- Custom permission groups
- System role hierarchies
- Permission inheritance
- Dynamic permission assignment
- Permission delegation

**Pattern Examples:**
- Permission groups for related permissions
- Role hierarchies for access levels
- Permission inheritance from roles
- Dynamic role assignment
- Permission delegation patterns

## Key Takeaways

1. **Creating custom permissions and system roles** refers to the process of defining new permissions and system roles in Android to control access to custom functionality, protect resources, and implement fine-grained access control.

2. **Custom permission creation** includes permission definition (define permission in AndroidManifest.xml, specify protection level, provide metadata, register with system, enforce in code), protection levels (normal, dangerous, signature, signature|privileged, appop), permission enforcement (check permission in code, enforce at API level, enforce at service level, handle permission denial, provide error messages), and creation characteristics.

3. **System role creation** includes system role definition (define system role in framework, specify role capabilities, configure role permissions, register with system, assign to components), role assignment (assign role to components, configure role behavior, manage role lifecycle, handle role changes, update role assignments), and role characteristics.

4. **Framework integration** includes permission registration (register with PackageManager, store in system database, make available to apps, integrate with permission UI, support permission requests), system service integration (integrate with PermissionManagerService, register with system services, handle permission checks, manage permission state, support permission operations), and integration characteristics.

5. **Build system integration** includes framework permission definition (define in framework manifest, include in system build, available to all apps, system-level permissions, framework integration), build configuration (include in build system, package with framework, register at build time, system integration, build system support), and integration characteristics.

6. **Best practices** include best practices (use appropriate protection levels, provide clear descriptions, document permission usage, test permission enforcement, follow security guidelines), common patterns (custom permission groups, system role hierarchies, permission inheritance, dynamic permission assignment, permission delegation), and practice guidelines.

7. **Understanding how to create custom permissions and system roles** is essential for AOSP development, enabling custom access control, resource protection, framework extension, system customization, and proper permission and role implementation.

## Related Topics

- **Permissions system:** Permissions system details
- **Permissions service:** PermissionManagerService details
- **Manifest permissions:** Manifest permission details
- **Android Security Model:** Security model details

