---
number: 100
title: PowerManagerService
slug: powermanagerservice
level: intermediate
tags:
  - aosp
  - framework
  - power-manager
  - wake-locks
  - battery
  - system-services
prerequisites:
  - system-server-overview
  - wakelocks
  - power-management
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-intermediate-100
---

# PowerManagerService

## Overview

PowerManagerService is a critical system service responsible for managing device power states, wake locks, screen state, battery optimization, and power-saving features like Doze mode. Understanding PowerManagerService is essential for AOSP development, as it explains how power states are managed, how wake locks work, how screen state is controlled, how battery optimization is implemented, and how PowerManagerService coordinates with the kernel and other system services. This guide provides a comprehensive overview of PowerManagerService, architecture, power state management, wake lock management, screen control, battery optimization, and debugging.

Think of PowerManagerService like a building's power management system: just as a building's power system manages electricity usage (power states), controls lighting (screen state), manages backup power (wake locks), and implements energy-saving features (battery optimization), PowerManagerService manages device power consumption, controls screen on/off, manages wake locks to keep the device awake, and implements power-saving features to extend battery life.

## Deep Explanation

### What is PowerManagerService?

PowerManagerService is a core system service running in the SystemServer process that manages all aspects of device power management, including power states, wake locks, screen control, battery optimization, and power-saving features.

**Key Characteristics:**
- **Core Service:** Runs in SystemServer
- **Power State Management:** Manages device power states
- **Wake Lock Management:** Manages wake locks
- **Screen Control:** Controls screen on/off
- **Battery Optimization:** Implements power-saving features

**Why PowerManagerService?**
- **Centralized Management:** Single point for power management
- **Battery Life:** Extends battery life
- **User Experience:** Balances performance and power
- **System Coordination:** Coordinates power across system

### PowerManagerService Architecture

#### Service Location

**PowerManagerService Location:**
- Runs in `system_server` process
- Part of SystemServer
- Started early in boot sequence
- Registered with ServiceManager

**Service Registration:**
```java
// In SystemServer
PowerManagerService pms = new PowerManagerService(...);
ServiceManager.addService(Context.POWER_SERVICE, pms);
```

**Access from Apps:**
```java
// Apps access via PowerManager
PowerManager pm = getSystemService(PowerManager.class);
```

#### Internal Components

**PowerManagerService Components:**
- **WakeLockController:** Manages wake locks
- **DisplayPowerController:** Controls display power
- **BatteryController:** Monitors battery state
- **DozeController:** Manages Doze mode
- **SuspendBlocker:** Manages suspend blocking

### Power State Management

#### Power States

**Device Power States:**
- **AWAKE:** Device fully awake, screen on
- **DREAMING:** Screen saver active
- **DOZING:** Doze mode active
- **SUSPENDED:** Device suspended (deep sleep)

**State Transitions:**
```
AWAKE → DREAMING → DOZING → SUSPENDED
  ↑                                    ↓
  └────────────────────────────────────┘
```

#### State Management

**State Management Process:**
```
1. PowerManagerService monitors system state
2. Determines appropriate power state
3. Applies power state
4. Coordinates with kernel
5. Notifies other services
```

**State Factors:**
- Wake lock state
- Screen state
- User activity
- Battery level
- Charging state

### Wake Lock Management

#### Wake Lock Types

**Wake Lock Categories:**
- **PARTIAL_WAKE_LOCK:** CPU awake, screen off
- **SCREEN_BRIGHT_WAKE_LOCK:** Screen bright, CPU on
- **SCREEN_DIM_WAKE_LOCK:** Screen dim, CPU on
- **FULL_WAKE_LOCK:** Screen and keyboard on
- **ACQUIRE_CAUSES_WAKEUP:** Causes wakeup when acquired

**Wake Lock Characteristics:**
- Prevent system suspend
- Keep CPU/display awake
- Battery impact
- Timeout support

#### Wake Lock Lifecycle

**Acquisition:**
```
1. App/service requests wake lock
2. PowerManagerService validates request
3. PowerManagerService creates WakeLock
4. WakeLock prevents suspend
5. System stays awake
```

**Release:**
```
1. App/service releases wake lock
2. PowerManagerService removes WakeLock
3. If no other wake locks, system can suspend
4. Power saved
```

#### Wake Lock Tracking

**Wake Lock Management:**
- Track all active wake locks
- Monitor wake lock holders
- Enforce timeouts
- Detect leaked wake locks
- Battery impact analysis

**Wake Lock Information:**
- Holder (app/service)
- Type
- Tag (identifier)
- Acquire time
- Timeout

### Screen Control

#### Screen States

**Screen States:**
- **ON:** Screen fully on
- **OFF:** Screen off
- **DIM:** Screen dimmed
- **DOZE:** Doze mode (very dim)

**Screen State Transitions:**
```
ON → DIM → OFF → DOZE
  ↑                  ↓
  └──────────────────┘
```

#### Screen Control

**Screen Control Process:**
```
1. PowerManagerService receives screen request
2. Validates request
3. Determines target screen state
4. Coordinates with DisplayManager
5. Applies screen state
6. Updates system state
```

**Screen Control Factors:**
- User activity
- Wake locks
- Proximity sensor
- Power button
- System policy

#### Display Power Management

**Display Power States:**
- **ON:** Display fully powered
- **DOZE:** Display in doze mode
- **OFF:** Display powered off

**Power Management:**
- Automatic brightness
- Display timeout
- Proximity sensor control
- Power-saving modes

### Battery Optimization

#### Doze Mode

**What is Doze Mode?**
- Deep sleep mode
- Reduces power consumption
- Maintains connectivity
- App restrictions

**Doze Mode States:**
- **IDLE:** Device idle
- **IDLE_MAINTENANCE:** Maintenance window
- **DEEP:** Deep doze

**Doze Mode Behavior:**
- Network access restricted
- Wake locks ignored (mostly)
- Alarms deferred
- Sync deferred
- Location updates reduced

#### App Standby

**App Standby:**
- Reduces background activity
- Restricts network access
- Limits wake locks
- Battery optimization

**Standby Buckets:**
- **ACTIVE:** App in use
- **WORKING_SET:** Recently used
- **FREQUENT:** Frequently used
- **RARE:** Rarely used
- **NEVER:** Never optimized

#### Battery Saver Mode

**Battery Saver:**
- Reduces performance
- Limits background activity
- Reduces visual effects
- Extends battery life

**Battery Saver Features:**
- CPU throttling
- Background restrictions
- Visual effects reduced
- Network restrictions

### Power Policy

#### Policy Rules

**Power Policy:**
- Determines power state
- Enforces restrictions
- Balances performance and power
- User preferences

**Policy Factors:**
- Battery level
- Charging state
- User activity
- App behavior
- System load

#### Policy Enforcement

**Enforcement:**
- Wake lock restrictions
- Background restrictions
- Network restrictions
- CPU restrictions
- Display restrictions

### PowerManagerService Coordination

#### Kernel Coordination

**Kernel Interaction:**
- Wake lock management
- Suspend/resume coordination
- Power state transitions
- Hardware power control

**Kernel Interface:**
- `/sys/power/wake_lock`
- `/sys/power/wake_unlock`
- `/sys/power/state`
- Power management drivers

#### Service Coordination

**AMS Coordination:**
- Process priority management
- Background restrictions
- App standby coordination

**DisplayManager Coordination:**
- Screen state control
- Display power management
- Brightness control

**BatteryService Coordination:**
- Battery state monitoring
- Charging state
- Battery level

### Wake Lock API

#### Application API

**Acquiring Wake Lock:**
```java
PowerManager pm = getSystemService(PowerManager.class);
PowerManager.WakeLock wakeLock = pm.newWakeLock(
    PowerManager.PARTIAL_WAKE_LOCK,
    "MyApp::WakeLock"
);
wakeLock.acquire();
```

**Releasing Wake Lock:**
```java
wakeLock.release();
```

**Wake Lock with Timeout:**
```java
wakeLock.acquire(10 * 60 * 1000L); // 10 minutes
```

#### System API

**System Wake Locks:**
- System-level wake locks
- Framework wake locks
- Service wake locks
- Kernel wake locks

### Power Statistics

#### Battery Stats

**Battery Statistics:**
- Wake lock usage per app
- CPU time per app
- Network usage per app
- GPS usage per app
- Screen-on time

**Stats Collection:**
- Continuous monitoring
- Per-app tracking
- Aggregated statistics
- Historical data

#### Power Profiling

**Power Profiling:**
- Identify power consumers
- Analyze wake lock usage
- Track battery drain
- Optimize power usage

### Debugging PowerManagerService

#### Common Issues

**Development Issues:**
- Wake locks not working
- Screen not turning on/off
- Battery drain
- Doze mode issues
- Power policy problems

#### Debugging Tools

**dumpsys power:**
```bash
# Dump PowerManagerService state
adb shell dumpsys power

# Dump wake locks
adb shell dumpsys power | grep -A 20 "Wake Locks"

# Dump power state
adb shell dumpsys power | grep -A 10 "Power State"
```

**Battery Stats:**
```bash
# Dump battery stats
adb shell dumpsys batterystats

# Reset battery stats
adb shell dumpsys batterystats --reset
```

**Wake Lock Monitoring:**
```bash
# Monitor wake locks
adb shell dumpsys power | grep "Wake Locks"

# Check specific app
adb shell dumpsys power | grep "com.example.app"
```

#### PowerManagerService State Inspection

**Wake Lock List:**
```bash
# List active wake locks
adb shell dumpsys power | grep -A 30 "Wake Locks"

# Shows:
# - Wake lock holder
# - Wake lock type
# - Tag
# - Acquire time
```

**Power State:**
```bash
# Check power state
adb shell dumpsys power | grep "mWakefulness"

# Shows:
# - Current power state
# - Screen state
# - Battery state
```

## Key Takeaways

1. **PowerManagerService** is a core system service managing device power states, wake locks, screen control, battery optimization, and power-saving features.

2. **PowerManagerService architecture** includes WakeLockController (manages wake locks), DisplayPowerController (controls display), BatteryController (monitors battery), DozeController (manages Doze mode), and SuspendBlocker (manages suspend blocking).

3. **Power state management** involves device power states (AWAKE, DREAMING, DOZING, SUSPENDED), state transitions, and state management based on wake locks, screen state, and user activity.

4. **Wake lock management** includes wake lock types (PARTIAL, SCREEN_BRIGHT, SCREEN_DIM, FULL), wake lock lifecycle (acquisition and release), and wake lock tracking (monitoring and enforcement).

5. **Screen control** involves screen states (ON, OFF, DIM, DOZE), screen control process (coordination with DisplayManager), and display power management (automatic brightness, timeout, proximity control).

6. **Battery optimization** includes Doze mode (deep sleep with restrictions), App Standby (background restrictions), and Battery Saver mode (performance and background restrictions).

7. **Power policy** determines power state based on battery level, charging state, user activity, and app behavior, enforcing restrictions to balance performance and power.

8. **PowerManagerService coordination** with kernel (wake lock and suspend/resume), AMS (process priority), DisplayManager (screen control), and BatteryService (battery monitoring) enables proper power management.

9. **Understanding PowerManagerService** is essential for AOSP development, explaining how Android manages power, extends battery life, and balances performance with power consumption.

## Related Topics

- **System Server Overview:** How PowerManagerService fits into SystemServer
- **Wakelocks:** Detailed wake lock mechanism
- **Power management:** Kernel-level power management
- **Battery optimization:** Battery-saving features

