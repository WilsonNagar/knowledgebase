---
number: 55
title: HIDL (deprecated but still used)
slug: hidl-deprecated-but-still-used
level: intermediate
tags:
  - aosp
  - hidl
  - hal
  - hardware
  - interface
  - treble
  - deprecated
prerequisites:
  - binder-architecture
  - aidl
  - android-architecture-complete-overview
estimated_minutes: 85
contributors: []
diagrams: []
examples: []
canonical_id: aosp-intermediate-55
---

# HIDL (deprecated but still used)

## Overview

HIDL (Hardware Interface Definition Language) is Android's interface definition language for HAL (Hardware Abstraction Layer) interfaces, introduced with Project Treble in Android 8.0. While HIDL is deprecated in favor of AIDL HAL (Android 11+), it's still widely used in existing devices and HAL implementations. Understanding HIDL is essential for AOSP development, as many HALs still use HIDL, and it's important for maintaining and understanding existing hardware interfaces. This guide provides a comprehensive overview of HIDL, its purpose, syntax, code generation, transport mechanisms, and its role in Project Treble.

Think of HIDL like a bridge specification: just as a bridge specification defines how different parts of a bridge connect and communicate, HIDL defines how the Android framework and vendor HAL implementations connect and communicate. Even though newer bridges (AIDL HAL) use a better specification, many existing bridges (HALs) still use the HIDL specification, so understanding it is important for maintaining the existing infrastructure.

## Deep Explanation

### What is HIDL?

HIDL (Hardware Interface Definition Language) is a language for defining interfaces between the Android framework and vendor HAL implementations. It was introduced with Project Treble to enable framework and HAL updates independently.

**Key Characteristics:**
- **HAL Interfaces:** Defines hardware abstraction interfaces
- **Vendor Separation:** Separates framework from vendor code
- **Versioning:** Supports interface versioning
- **Transport:** Uses Binder or passthrough mode

**Why HIDL?**
- **Project Treble:** Enable independent framework/HAL updates
- **Vendor Isolation:** Separate vendor code from framework
- **Interface Stability:** Versioned interfaces for compatibility
- **HAL Modernization:** Modernize HAL interface definition

### HIDL vs AIDL HAL

#### HIDL (Android 8.0-10)

**Characteristics:**
- Introduced with Treble
- C++ focused
- HAL interfaces
- Binder or passthrough transport
- Deprecated in Android 11+

**Use Cases:**
- Legacy HAL implementations
- Existing vendor HALs
- Hardware interfaces
- System-vendor separation

#### AIDL HAL (Android 11+)

**Characteristics:**
- Modern replacement for HIDL
- Better performance
- Better tooling
- Recommended for new HALs
- Java/Kotlin and C++ support

**Migration:**
- New HALs should use AIDL
- Existing HIDL HALs can migrate
- Both can coexist
- Gradual transition

### HIDL Architecture

#### Project Treble Context

**Problem Before Treble:**
- Framework and HAL tightly coupled
- Framework updates required HAL updates
- Slow security updates
- Difficult to support new Android versions

**Solution with Treble:**
- Clear interface between framework and HAL
- Framework and HAL can update independently
- Faster security updates
- Easier Android version support

**HIDL's Role:**
- Defines stable interface contract
- Enables independent updates
- Provides versioning
- Separates framework and vendor

#### HIDL Layers

**Framework Side:**
- Android Framework
- HIDL client libraries
- Generated C++/Java code
- Uses HIDL interfaces

**Vendor Side:**
- Vendor HAL implementation
- HIDL server implementation
- Implements HIDL interfaces
- Hardware-specific code

**Interface Layer:**
- HIDL interface definition
- Versioned contract
- Transport mechanism
- Stable API

### HIDL Syntax

#### Basic HIDL File

**File Structure:**
```
package android.hardware.example@1.0;

interface IExample {
    // Methods
};
```

**Components:**
- **Package:** Namespace with version
- **Interface:** Interface name (starts with 'I')
- **Methods:** Interface methods

#### Package Declaration

**Package Format:**
```
package android.hardware.example@1.0;
```

**Components:**
- **Package Name:** `android.hardware.example`
- **Version:** `@1.0` (major.minor)
- **Full Name:** Includes version

**Versioning:**
- Major version: Breaking changes
- Minor version: Backward compatible additions
- Example: `@1.0`, `@1.1`, `@2.0`

#### Interface Declaration

**Basic Interface:**
```hidl
package android.hardware.example@1.0;

interface IExample {
    // Methods
    exampleMethod(int32_t param) generates (int32_t result);
};
```

**Method Syntax:**
- Method name
- Parameters: `(type name)`
- Return: `generates (type)`
- Can have multiple parameters

#### HIDL Data Types

**Primitive Types:**
- `bool` - Boolean
- `int8_t`, `int16_t`, `int32_t`, `int64_t` - Signed integers
- `uint8_t`, `uint16_t`, `uint32_t`, `uint64_t` - Unsigned integers
- `float` - 32-bit float
- `double` - 64-bit double

**String Types:**
- `string` - UTF-8 string
- `vec<uint8_t>` - Byte vector

**Complex Types:**
- `struct` - Structure types
- `enum` - Enumeration types
- `union` - Union types
- Interface types

**Example:**
```hidl
package android.hardware.example@1.0;

interface IExample {
    struct Data {
        int32_t id;
        string name;
        vec<uint8_t> data;
    };
    
    exampleMethod(Data input) generates (Data output);
};
```

### HIDL Code Generation

#### Generated Files

**For Interface `IExample.hal`:**
- C++ headers and implementation
- Java bindings (optional)
- Client and server code
- Transport code

**Generated Structure:**
```cpp
// IExample.h (generated)
namespace android::hardware::example::V1_0 {

class IExample : public ::android::hidl::base::V1_0::IBase {
public:
    // Interface methods
    virtual ::android::hardware::Return<int32_t> 
        exampleMethod(int32_t param) = 0;
};

} // namespace
```

#### Client Code Generation

**Client Interface:**
```cpp
// Generated client code
using android::hardware::example::V1_0::IExample;

// Get service
sp<IExample> service = IExample::getService();
if (service != nullptr) {
    service->exampleMethod(42, [](int32_t result) {
        // Handle result
    });
}
```

#### Server Implementation

**Server Base:**
```cpp
// Server implementation
class ExampleHal : public IExample {
public:
    Return<int32_t> exampleMethod(int32_t param) override {
        // Implementation
        return param * 2;
    }
};
```

### HIDL Transport

#### Transport Modes

**1. Binder Transport:**
- HAL runs in separate process
- Uses Binder IPC
- Better isolation
- Recommended for most HALs

**2. Passthrough Transport:**
- HAL runs in same process
- Direct function calls
- Lower overhead
- Legacy compatibility

#### Binder Transport

**Architecture:**
```
Framework Process          HAL Process
     │                          │
     │───Binder IPC────────────▶│
     │                          │
     │                          │
  Client                    Server
```

**Characteristics:**
- Process isolation
- Better security
- Independent updates
- Standard IPC

#### Passthrough Transport

**Architecture:**
```
Framework Process
     │
     │───Direct Call───▶
     │                  │
  Client            HAL Library
```

**Characteristics:**
- Same process
- Lower overhead
- Legacy support
- Less isolation

### HIDL Versioning

#### Version Management

**Version Format:**
- `@1.0` - Initial version
- `@1.1` - Minor update (backward compatible)
- `@2.0` - Major update (breaking changes)

**Versioning Rules:**
- Minor versions: Add methods, extend types
- Major versions: Breaking changes allowed
- Framework can use multiple versions
- Vendor implements specific version

#### Interface Evolution

**Minor Version Updates:**
```hidl
// Version 1.0
package android.hardware.example@1.0;
interface IExample {
    method1() generates (int32_t);
};

// Version 1.1 (backward compatible)
package android.hardware.example@1.1;
interface IExample {
    method1() generates (int32_t);
    method2() generates (string);  // New method
};
```

**Major Version Updates:**
```hidl
// Version 2.0 (breaking changes)
package android.hardware.example@2.0;
interface IExample {
    method1(int32_t param) generates (int32_t);  // Changed signature
    method3() generates (bool);  // New method
};
```

### HIDL Usage Patterns

#### HAL Implementation

**1. Define HIDL Interface:**
```hidl
package android.hardware.example@1.0;

interface IExample {
    exampleMethod(int32_t param) generates (int32_t result);
};
```

**2. Implement HAL:**
```cpp
class ExampleHal : public IExample {
public:
    Return<int32_t> exampleMethod(int32_t param) override {
        // Hardware-specific implementation
        return hardware_operation(param);
    }
};
```

**3. Register HAL:**
```cpp
// Register with HIDL service manager
registerAsService("default");
```

#### Framework Usage

**1. Get HAL Service:**
```cpp
sp<IExample> hal = IExample::getService();
```

**2. Call HAL Methods:**
```cpp
hal->exampleMethod(42, [](int32_t result) {
    // Handle result
});
```

### HIDL vs AIDL HAL Migration

#### Why Migrate to AIDL HAL

**AIDL HAL Advantages:**
- Better performance
- Better tooling
- Simpler syntax
- Java/Kotlin support
- Recommended for new HALs

**Migration Benefits:**
- Modern interface
- Better maintainability
- Improved performance
- Future-proof

#### Migration Path

**Gradual Migration:**
- New HALs use AIDL
- Existing HIDL HALs can migrate
- Both can coexist
- No forced migration

**Migration Steps:**
1. Define AIDL interface
2. Implement AIDL HAL
3. Update framework to use AIDL
4. Remove HIDL implementation

### Common HIDL Patterns

#### Callback Pattern

**Callback Interface:**
```hidl
package android.hardware.example@1.0;

interface IExampleCallback {
    onEvent(int32_t event);
};

interface IExample {
    registerCallback(IExampleCallback callback);
};
```

#### Async Operations

**Async Methods:**
```hidl
interface IExample {
    // Synchronous
    syncMethod(int32_t param) generates (int32_t result);
    
    // Async with callback
    asyncMethod(int32_t param);
};
```

### HIDL Best Practices

#### Interface Design

**Clear Naming:**
- Use descriptive interface names
- Follow naming conventions
- Document interfaces
- Version appropriately

**Method Design:**
- Keep methods focused
- Use appropriate types
- Handle errors properly
- Consider async patterns

#### Implementation

**Error Handling:**
- Return appropriate status codes
- Handle hardware errors
- Validate parameters
- Log errors appropriately

**Performance:**
- Minimize IPC overhead
- Use async when appropriate
- Optimize data structures
- Consider passthrough for performance

### HIDL Limitations

#### Known Limitations

**Deprecated:**
- HIDL is deprecated
- AIDL HAL is recommended
- No new features
- Maintenance mode

**Complexity:**
- More complex than AIDL
- C++ focused
- Less tooling support
- Steeper learning curve

### Debugging HIDL

#### Common Issues

**Service Not Found:**
- Check HAL registration
- Verify service name
- Check SELinux policies
- Review HAL implementation

**Version Mismatches:**
- Verify version compatibility
- Check interface versions
- Review version requirements
- Update if needed

**Transport Issues:**
- Check Binder configuration
- Verify passthrough setup
- Review process isolation
- Check permissions

## Key Takeaways

1. **HIDL is Android's Hardware Interface Definition Language** introduced with Project Treble to separate framework and vendor HAL code.

2. **HIDL enables independent updates** of framework and HAL, allowing faster security updates and easier Android version support.

3. **HIDL supports versioning** with major.minor version format, allowing interface evolution while maintaining compatibility.

4. **HIDL uses Binder or passthrough transport** for communication between framework and HAL processes.

5. **HIDL is deprecated in favor of AIDL HAL** (Android 11+), but is still widely used in existing devices and HAL implementations.

6. **HIDL interfaces define stable contracts** between Android framework and vendor HAL implementations.

7. **Understanding HIDL is important** for maintaining existing HALs, understanding Treble architecture, and migrating to AIDL HAL.

8. **HIDL provides the foundation** for Project Treble's goal of framework-vendor separation and independent updates.

## Related Topics

- **AIDL:** Modern replacement for HIDL in HAL interfaces
- **Binder architecture:** How HIDL uses Binder for transport
- **Hardware Abstraction Layer (HAL):** How HIDL defines HAL interfaces
- **Project Treble:** The initiative that introduced HIDL

