---
number: 53
title: ServiceManager
slug: servicemanager
level: intermediate
tags:
  - aosp
  - servicemanager
  - binder
  - services
  - registry
  - discovery
  - ipc
prerequisites:
  - binder-architecture
  - binder-ipc-basics
  - servicemanager-startup
estimated_minutes: 85
contributors: []
diagrams: []
examples: []
canonical_id: aosp-intermediate-53
---

# ServiceManager

## Overview

ServiceManager is Android's central service registry that maintains a mapping of service names to Binder tokens, enabling service discovery and registration throughout the Android system. Understanding ServiceManager is essential for AOSP development, as it's the foundation for how services are found, how clients discover services, and how the entire Binder IPC system is organized. This guide provides a comprehensive overview of ServiceManager's role, API, service registration and discovery, implementation details, and how it integrates with the Android system.

Think of ServiceManager like a phone directory or service directory: just as a phone directory maps names to phone numbers, ServiceManager maps service names (like "activity", "window", "package") to Binder tokens that clients can use to communicate with those services. Without ServiceManager, services would have no way to find each other, and the entire Android system would be unable to function.

## Deep Explanation

### What is ServiceManager?

ServiceManager is a native daemon process that acts as the central registry for all Binder services in Android. It's the first service to start during boot and provides the foundation for service discovery.

**Key Characteristics:**
- **Native Process:** Written in C/C++, runs as separate process
- **Early Startup:** Starts before System Server
- **Critical Service:** System cannot function without it
- **Service Registry:** Maintains name-to-token mapping
- **Singleton:** Only one ServiceManager process runs

**Core Responsibilities:**
1. **Service Registration:** Services register with a name
2. **Service Discovery:** Clients query by name to get Binder tokens
3. **Service Management:** Maintains the service registry
4. **Binder Foundation:** Provides foundation for Binder IPC

### Why ServiceManager is Needed

#### Service Discovery Problem

**Without ServiceManager:**
- Services don't know each other's Binder tokens
- No centralized way to discover services
- Clients can't find services they need
- System would be non-functional

**With ServiceManager:**
- Central registry of all services
- Services register with human-readable names
- Clients query by name
- System can function properly

#### Service Registration

**Registration Process:**
```
1. Service creates Binder object
2. Service calls ServiceManager.addService(name, binder)
3. ServiceManager stores mapping: name → token
4. Service is now discoverable
```

**Benefits:**
- Human-readable names
- Centralized registry
- Easy discovery
- System organization

### ServiceManager API

#### Core Operations

**1. addService(name, binder):**
- Register a service with ServiceManager
- Maps name to Binder token
- Makes service discoverable
- Returns success/failure

**2. getService(name):**
- Query ServiceManager by name
- Returns Binder token for service
- Returns null if not found
- Used by clients to discover services

**3. listServices():**
- List all registered services
- Returns array of service names
- Useful for debugging
- System introspection

#### API Usage

**Service Registration (C++):**
```cpp
// Service registers itself
sp<IServiceManager> sm = defaultServiceManager();
sm->addService(String16("my_service"), myBinder);
```

**Service Discovery (C++):**
```cpp
// Client discovers service
sp<IServiceManager> sm = defaultServiceManager();
sp<IBinder> binder = sm->getService(String16("my_service"));
if (binder != nullptr) {
    // Use service
}
```

**Service Registration (Java):**
```java
// Service registers itself
ServiceManager.addService("my_service", myBinder);
```

**Service Discovery (Java):**
```java
// Client discovers service
IBinder binder = ServiceManager.getService("my_service");
if (binder != null) {
    // Use service
}
```

### ServiceManager Implementation

#### Process Structure

**ServiceManager Process:**
- Runs as separate native process
- PID typically 1 (after init)
- Runs with system UID
- Critical system process

**Process Lifecycle:**
1. Started by init during early boot
2. Initializes Binder
3. Registers itself as "manager"
4. Waits for service registrations
5. Handles queries from clients

#### Internal Data Structures

**Service Registry:**
- Maps service names to Binder tokens
- Stored in memory
- Fast lookup (hash table or similar)
- Thread-safe access

**Registry Entry:**
```cpp
struct service_entry {
    String16 name;      // Service name
    sp<IBinder> binder; // Binder token
    // ... other metadata
};
```

#### Transaction Handling

**ServiceManager Transactions:**
- Handles specific transaction codes
- ADD_SERVICE_TRANSACTION
- CHECK_SERVICE_TRANSACTION
- LIST_SERVICES_TRANSACTION
- GET_SERVICE_TRANSACTION

**Transaction Processing:**
1. Receive transaction from client
2. Parse transaction code
3. Execute appropriate operation
4. Return result to client

### Service Registration

#### Registration Process

**Step-by-Step:**
```
1. Service creates Binder object (BBinder)
   ↓
2. Service gets ServiceManager reference
   ↓
3. Service calls addService(name, binder)
   ↓
4. ServiceManager validates request
   ↓
5. ServiceManager stores name → token mapping
   ↓
6. ServiceManager returns success
   ↓
7. Service is now registered and discoverable
```

#### Registration Requirements

**Permissions:**
- Service must have appropriate permissions
- System services can register
- Apps typically cannot register system services
- Security enforced

**Name Uniqueness:**
- Service names must be unique
- Duplicate registration may fail
- First registration wins
- Later registrations may replace (depending on policy)

#### Common Service Names

**System Services:**
- `activity` - ActivityManagerService
- `window` - WindowManagerService
- `package` - PackageManagerService
- `power` - PowerManagerService
- `alarm` - AlarmManagerService
- `audio` - AudioService
- `telephony` - TelephonyService

**Naming Convention:**
- Lowercase
- Descriptive
- Usually matches service class name
- System-wide known names

### Service Discovery

#### Discovery Process

**Step-by-Step:**
```
1. Client needs to use a service
   ↓
2. Client gets ServiceManager reference
   ↓
3. Client calls getService(name)
   ↓
4. ServiceManager looks up name in registry
   ↓
5. ServiceManager returns Binder token
   ↓
6. Client creates proxy (BpBinder) with token
   ↓
7. Client can now call service methods
```

#### Discovery Patterns

**Lazy Discovery:**
- Client queries when needed
- May cache result
- Handles service not available
- Retries if needed

**Early Discovery:**
- Client queries during initialization
- Caches Binder reference
- Uses cached reference
- Re-queries on failure

**Service Availability:**
- Service may not be registered yet
- Client should handle null return
- May need to wait/retry
- ServiceManager provides availability

### ServiceManager as a Service

#### Self-Registration

**ServiceManager Registration:**
- ServiceManager registers itself
- Name: "manager" or "servicemanager"
- Special Binder token
- Used to get ServiceManager reference

**Getting ServiceManager:**
```cpp
// Get ServiceManager reference
sp<IServiceManager> sm = defaultServiceManager();
// Internally calls getService("manager")
```

#### ServiceManager Interface

**IServiceManager Interface:**
- Defines ServiceManager operations
- addService(), getService(), listServices()
- Used by both services and clients
- AIDL-defined interface

### Integration with System

#### Boot Sequence

**ServiceManager Startup:**
1. Init starts ServiceManager
2. ServiceManager initializes
3. ServiceManager registers itself
4. System Server starts
5. System Server registers services
6. Services become available

**Service Registration Order:**
- ServiceManager first
- Core system services next
- Framework services
- Application services (if any)

#### System Server Integration

**System Server:**
- Registers most system services
- Uses ServiceManager.addService()
- Services registered during startup
- Order matters for dependencies

**Registration Example:**
```java
// In SystemServer
ServiceManager.addService(Context.ACTIVITY_SERVICE, 
                         activityManagerService);
ServiceManager.addService(Context.WINDOW_SERVICE, 
                         windowManagerService);
// ... more services
```

### Security and Permissions

#### Registration Permissions

**Who Can Register:**
- System services (System Server)
- Native services with permissions
- Apps typically cannot register system services
- Security enforced by ServiceManager

**Permission Checking:**
- ServiceManager checks caller UID
- Validates permissions
- Rejects unauthorized registrations
- Logs security violations

#### Access Control

**Service Access:**
- Clients can query any service name
- Service decides access control
- Service checks caller permissions
- ServiceManager doesn't enforce service-level permissions

### Service Lifecycle

#### Service Registration Lifecycle

**Registration:**
- Service registers during startup
- Registration is persistent (until process death)
- Service remains registered while process alive
- Can be re-registered if needed

**Service Death:**
- If service process dies, registration is lost
- ServiceManager detects process death
- Removes registration automatically
- Clients must handle service death

**Re-registration:**
- Service can re-register on restart
- May replace existing registration
- Clients may need to re-discover
- System handles gracefully

### Debugging ServiceManager

#### Viewing Registered Services

**List Services:**
```bash
# From shell
service list

# Or programmatically
ServiceManager.listServices()
```

**Service Information:**
- Service names
- Registration status
- Binder token information
- Process information

#### Common Issues

**Service Not Found:**
- Service not registered yet
- Service name misspelled
- Service process died
- Check service registration

**Registration Failure:**
- Permission denied
- Name already taken
- ServiceManager unavailable
- Check logs for errors

**Service Death:**
- Service process crashed
- Registration removed
- Clients get null reference
- Service may restart

### Best Practices

#### For Service Developers

**Registration:**
- Register early in startup
- Use consistent naming
- Handle registration failures
- Log registration success

**Service Design:**
- Design for discoverability
- Use clear service names
- Document service interface
- Handle client errors gracefully

#### For Client Developers

**Discovery:**
- Handle service not available
- Retry if needed
- Cache service references
- Handle service death

**Error Handling:**
- Check for null returns
- Handle service death
- Retry on failures
- Provide fallback behavior

## Key Takeaways

1. **ServiceManager is the central service registry** that maps service names to Binder tokens, enabling service discovery throughout Android.

2. **ServiceManager provides core operations** including addService() for registration, getService() for discovery, and listServices() for introspection.

3. **Services register with ServiceManager** using human-readable names, making them discoverable by clients throughout the system.

4. **Clients discover services** by querying ServiceManager by name, receiving Binder tokens that they use to communicate with services.

5. **ServiceManager is a native process** that starts early in boot, before System Server, and is critical for system operation.

6. **Service registration is persistent** while the service process is alive, but is automatically removed if the service process dies.

7. **ServiceManager enforces security** by checking permissions for service registration, though service-level access control is handled by services themselves.

8. **Understanding ServiceManager** is essential for AOSP development, system service implementation, and debugging service discovery issues.

## Related Topics

- **Binder architecture:** How ServiceManager fits into Binder architecture
- **ServiceManager Startup:** How ServiceManager starts during boot
- **Binder IPC Basics:** How services use Binder for IPC
- **System Server Overview:** How System Server registers services with ServiceManager

