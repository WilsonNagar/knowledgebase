---
number: 208
title: hprof analyzer (heap profiling)
slug: hprof-analyzer-heap-profiling
level: intermediate
tags:
  - aosp
  - hprof
  - heap-profiling
  - memory-profiling
  - debugging
  - development-tools
prerequisites:
  - android-architecture-complete-overview
  - debugging-native-crashes-tombstones
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-intermediate-208
---

# hprof analyzer (heap profiling)

## Overview

hprof (Heap Profiler) analyzer tools are used to analyze Java heap dumps and memory usage in Android applications and system processes. Understanding hprof analyzer is essential for AOSP development, as it explains how to capture heap dumps, how to analyze memory usage, how to identify memory leaks, how to profile heap allocations, and how hprof provides comprehensive heap analysis capabilities. This guide provides a comprehensive overview of hprof analyzer, heap dump capture, analysis tools, memory leak detection, heap profiling, and best practices.

Think of hprof analyzer like a memory inspector: just as an inspector examines a building to understand its structure, identify problems, and assess its condition, hprof analyzer examines the Java heap to understand memory structure, identify memory leaks, and assess memory usage, providing detailed insights into how memory is allocated and used.

## Deep Explanation

### What is hprof?

hprof (Heap Profiler) is a Java heap profiling format and tool that captures and analyzes Java heap dumps, providing detailed information about object allocations, memory usage, reference chains, and memory leaks in Java/Kotlin applications and system processes.

**Key Characteristics:**
- **Heap Dumps:** Captures heap snapshots
- **Java/Kotlin:** Works with Java/Kotlin code
- **Memory Analysis:** Analyzes memory usage
- **Leak Detection:** Identifies memory leaks
- **Reference Analysis:** Analyzes object references

**Why hprof?**
- **Memory Leaks:** Detect Java memory leaks
- **Memory Usage:** Understand memory usage
- **Object Analysis:** Analyze object allocations
- **Heap Profiling:** Profile heap usage
- **Development Tool:** Essential development tool

### hprof Format

#### Heap Dump Structure

**Heap Dump Contents:**
- Object instances
- Object classes
- Object references
- Thread information
- Stack traces

**Dump Structure:**
```
HEADER
RECORD_TYPE_1
RECORD_TYPE_2
...
RECORD_TYPE_N
```

**Structure Characteristics:**
- Binary format
- Record-based structure
- Object information
- Reference information
- Metadata

#### hprof File Format

**File Format:**
- Binary format
- Platform-independent
- Compressed or uncompressed
- Standard format
- Tool-compatible

**Format Characteristics:**
- Standardized format
- Tool compatibility
- Cross-platform
- Efficient storage
- Analysis support

### Capturing Heap Dumps

#### Using Android Studio

**Android Studio Capture:**
```
1. Open Android Studio Profiler
2. Select Memory profiler
3. Click "Dump Java heap"
4. Heap dump is captured
5. Analyze in Android Studio
```

**Capture Characteristics:**
- GUI-based capture
- Integrated tool
- Easy to use
- Immediate analysis
- Visual interface

#### Using ADB

**ADB Capture:**
```bash
# Trigger heap dump
adb shell am dumpheap <process_name> /sdcard/heap.hprof

# For system processes
adb shell am dumpheap system_server /sdcard/system_heap.hprof

# Pull heap dump
adb pull /sdcard/heap.hprof

# Analyze on host
```

**ADB Characteristics:**
- Command-line capture
- Remote capture
- Process-specific
- File-based
- Host analysis

#### Using DDMS

**DDMS Capture:**
```
1. Open DDMS
2. Select process
3. Click "Dump HPROF file"
4. Save heap dump
5. Analyze with MAT or other tools
```

**DDMS Characteristics:**
- Legacy tool
- GUI-based
- Process selection
- File export
- Tool integration

### hprof Analysis Tools

#### Android Studio Memory Profiler

**Memory Profiler:**
- Integrated in Android Studio
- Visual heap analysis
- Object instance view
- Reference chain view
- Leak detection

**Profiler Features:**
- Heap visualization
- Object browsing
- Reference analysis
- Leak detection
- Memory statistics

**Profiler Usage:**
```
1. Capture heap dump
2. View in Memory Profiler
3. Browse objects
4. Analyze references
5. Identify leaks
```

**Profiler Characteristics:**
- Integrated tool
- Visual interface
- Interactive analysis
- Leak detection
- Statistics display

#### Eclipse Memory Analyzer (MAT)

**MAT Overview:**
- Standalone tool
- Powerful analysis
- Multiple views
- Leak detection
- Report generation

**MAT Features:**
- Histogram view
- Dominator tree
- Object query language (OQL)
- Leak suspect reports
- Reference chain analysis

**MAT Usage:**
```bash
# Open MAT
# File â†’ Open Heap Dump
# Select hprof file
# Analyze
```

**MAT Characteristics:**
- Standalone tool
- Advanced analysis
- Multiple views
- Query language
- Report generation

#### jhat (Java Heap Analysis Tool)

**jhat Usage:**
```bash
# Analyze heap dump
jhat heap.hprof

# Start web server
# Access at http://localhost:7000

# Browse heap dump
# Analyze objects and references
```

**jhat Characteristics:**
- Command-line tool
- Web-based interface
- Object browsing
- Reference analysis
- Built-in tool

### Heap Analysis

#### Object Analysis

**Object Information:**
- Object instances
- Object classes
- Object sizes
- Object counts
- Object references

**Analysis Features:**
- Instance browsing
- Class statistics
- Size analysis
- Count analysis
- Reference tracking

**Analysis Usage:**
```
1. Open heap dump
2. Browse objects by class
3. View instance details
4. Analyze references
5. Identify issues
```

**Analysis Characteristics:**
- Object-level detail
- Class-level statistics
- Reference tracking
- Size analysis
- Count analysis

#### Memory Leak Detection

**Leak Detection:**
- Identify retained objects
- Analyze reference chains
- Find memory leaks
- Identify leak sources
- Quantify leak impact

**Detection Methods:**
- Dominator tree analysis
- Reference chain analysis
- Object retention analysis
- Leak suspect reports
- Pattern detection

**Detection Workflow:**
```
1. Capture heap dump
2. Analyze retained objects
3. Find reference chains
4. Identify leak sources
5. Fix leaks
```

**Detection Characteristics:**
- Automated detection
- Reference analysis
- Chain tracking
- Source identification
- Impact quantification

#### Reference Chain Analysis

**Reference Chains:**
- Object reference paths
- GC root paths
- Retention paths
- Leak paths
- Reference graphs

**Chain Analysis:**
- Path identification
- Root finding
- Chain visualization
- Path optimization
- Reference tracking

**Analysis Usage:**
```
1. Select object
2. View reference chain
3. Trace to GC root
4. Analyze path
5. Identify retention
```

**Analysis Characteristics:**
- Path visualization
- Root identification
- Chain tracking
- Retention analysis
- Reference graphs

### Heap Profiling

#### Allocation Tracking

**Allocation Tracking:**
- Track object allocations
- Record allocation sites
- Monitor allocation patterns
- Identify allocation hotspots
- Analyze allocation behavior

**Tracking Features:**
- Stack trace recording
- Allocation site tracking
- Pattern analysis
- Hotspot identification
- Behavior analysis

**Tracking Usage:**
```
1. Enable allocation tracking
2. Run application
3. Capture heap dump
4. Analyze allocations
5. Optimize allocations
```

**Tracking Characteristics:**
- Allocation monitoring
- Site tracking
- Pattern analysis
- Hotspot identification
- Behavior analysis

#### Memory Growth Analysis

**Growth Analysis:**
- Monitor heap growth
- Identify growth patterns
- Find growth sources
- Analyze growth trends
- Optimize growth

**Analysis Features:**
- Time-based analysis
- Growth pattern detection
- Source identification
- Trend analysis
- Optimization guidance

**Analysis Usage:**
```
1. Capture multiple dumps
2. Compare dumps
3. Identify growth
4. Analyze sources
5. Optimize
```

**Analysis Characteristics:**
- Comparative analysis
- Growth tracking
- Pattern detection
- Source identification
- Optimization guidance

### Best Practices

#### Best Practices

**Best Practices:**
- Capture dumps at appropriate times
- Use appropriate analysis tools
- Analyze systematically
- Focus on retained objects
- Verify fixes

**Practice Guidelines:**
- **Timing:** Capture dumps at appropriate times
- **Tools:** Use appropriate analysis tools
- **Analysis:** Analyze systematically
- **Focus:** Focus on retained objects
- **Verification:** Always verify fixes

#### Common Use Cases

**Common Use Cases:**
- Memory leak detection
- Memory usage analysis
- Object allocation profiling
- Reference chain analysis
- Memory optimization

**Use Case Examples:**
- Application memory debugging
- System service memory analysis
- Framework memory profiling
- Memory optimization
- Leak resolution

## Key Takeaways

1. **hprof (Heap Profiler) analyzer** tools are used to analyze Java heap dumps and memory usage in Android applications and system processes, providing detailed information about object allocations, memory usage, reference chains, and memory leaks.

2. **hprof format** includes heap dump structure (object instances, object classes, object references, thread information, stack traces), hprof file format (binary format, platform-independent, compressed or uncompressed, standard format, tool-compatible), and format characteristics.

3. **Capturing heap dumps** includes using Android Studio (GUI-based capture, integrated tool, easy to use, immediate analysis, visual interface), using ADB (command-line capture, remote capture, process-specific, file-based, host analysis), using DDMS (legacy tool, GUI-based, process selection, file export, tool integration), and capture characteristics.

4. **hprof analysis tools** include Android Studio Memory Profiler (integrated tool, visual interface, interactive analysis, leak detection, statistics display), Eclipse Memory Analyzer (MAT) (standalone tool, advanced analysis, multiple views, query language, report generation), jhat (Java Heap Analysis Tool) (command-line tool, web-based interface, object browsing, reference analysis, built-in tool), and tool characteristics.

5. **Heap analysis** includes object analysis (object-level detail, class-level statistics, reference tracking, size analysis, count analysis), memory leak detection (automated detection, reference analysis, chain tracking, source identification, impact quantification), reference chain analysis (path visualization, root identification, chain tracking, retention analysis, reference graphs), and analysis characteristics.

6. **Heap profiling** includes allocation tracking (allocation monitoring, site tracking, pattern analysis, hotspot identification, behavior analysis), memory growth analysis (comparative analysis, growth tracking, pattern detection, source identification, optimization guidance), and profiling characteristics.

7. **Best practices** include best practices (capture dumps at appropriate times, use appropriate analysis tools, analyze systematically, focus on retained objects, verify fixes), common use cases (memory leak detection, memory usage analysis, object allocation profiling, reference chain analysis, memory optimization), and practice guidelines.

8. **Understanding hprof analyzer** is essential for AOSP development, enabling heap dump analysis, memory leak detection, memory usage analysis, object allocation profiling, reference chain analysis, and proper heap profiling tool usage.

## Related Topics

- **Android Architecture - Complete Overview:** Architecture details
- **Debugging native crashes (tombstones):** Native crash debugging details

