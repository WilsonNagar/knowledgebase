---
number: 106
title: Broadcast system internals
slug: broadcast-system-internals
level: intermediate
tags:
  - aosp
  - framework
  - broadcast
  - broadcast-receiver
  - intent
  - system-components
prerequisites:
  - system-server-overview
  - activitymanagerservice-ams-internals
  - android-architecture-complete-overview
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-intermediate-106
---

# Broadcast system internals

## Overview

The Broadcast system is a core Android framework mechanism that enables system-wide event notifications and inter-component communication through broadcast intents. Understanding Broadcast system internals is essential for AOSP development, as it explains how broadcasts are sent, how broadcast receivers are registered and matched, how broadcasts are delivered, how the broadcast queue works, how broadcast permissions are enforced, and how the Broadcast system integrates with ActivityManagerService. This guide provides a comprehensive overview of Broadcast system internals, architecture, broadcast sending, receiver registration, broadcast delivery, queue management, and debugging.

Think of the Broadcast system like a public announcement system: just as a public announcement system allows messages to be broadcast to everyone who's listening (receivers), the Broadcast system allows intents to be broadcast to all registered receivers that match the broadcast criteria, enabling system-wide event notifications and inter-component communication.

## Deep Explanation

### What is the Broadcast System?

The Broadcast system is a core Android framework mechanism that enables system-wide event notifications and inter-component communication through broadcast intents, allowing components to send and receive system events and custom broadcasts.

**Key Characteristics:**
- **Event Notification:** System-wide event notifications
- **Inter-Component Communication:** Communication between components
- **Intent-Based:** Uses Intent mechanism
- **Asynchronous:** Asynchronous message delivery
- **Framework Integration:** Integrated with AMS

**Why Broadcast System?**
- **System Events:** Notify about system events
- **Loose Coupling:** Decoupled component communication
- **Event-Driven:** Event-driven architecture
- **System Integration:** System-wide notifications

### Broadcast System Architecture

#### System Components

**Broadcast System Components:**
- **BroadcastQueue:** Queue of pending broadcasts
- **BroadcastReceiver:** Component that receives broadcasts
- **IntentFilter:** Criteria for matching broadcasts
- **ActivityManagerService:** Manages broadcast delivery

**Component Flow:**
```
Broadcast Sender
    ↓
ActivityManagerService
    ↓
BroadcastQueue
    ↓
IntentFilter Matching
    ↓
BroadcastReceiver
```

#### AMS Integration

**AMS Role:**
- Manages broadcast queues
- Matches broadcasts to receivers
- Delivers broadcasts to receivers
- Enforces broadcast permissions
- Handles broadcast ordering

### Broadcast Types

#### Normal Broadcasts

**Normal Broadcasts:**
- Asynchronous delivery
- All receivers receive broadcast
- No ordering guarantees
- Faster delivery

**Characteristics:**
- Multiple receivers can run in parallel
- No dependencies between receivers
- Efficient for most use cases

#### Ordered Broadcasts

**Ordered Broadcasts:**
- Synchronous delivery
- Receivers processed in order
- Priority-based ordering
- Can abort broadcast

**Characteristics:**
- Receivers processed sequentially
- Priority determines order
- Receiver can abort broadcast
- Slower than normal broadcasts

#### Sticky Broadcasts

**Sticky Broadcasts:**
- Broadcast persists
- New receivers get last broadcast
- System broadcasts
- Deprecated in modern Android

**Characteristics:**
- Broadcast stored in system
- New receivers get last value
- Used for system state
- Legacy feature

### Broadcast Sending

#### Send Broadcast Process

**Normal Broadcast:**
```
1. App calls sendBroadcast(intent)
2. Framework makes Binder call to AMS
3. AMS receives broadcast
4. AMS matches receivers
5. AMS queues broadcast
6. AMS delivers to receivers
```

**Ordered Broadcast:**
```
1. App calls sendOrderedBroadcast(intent)
2. Framework makes Binder call to AMS
3. AMS receives broadcast
4. AMS matches receivers
5. AMS orders receivers by priority
6. AMS queues broadcast
7. AMS delivers sequentially
```

#### Broadcast Intent

**Intent Structure:**
- Action (required)
- Category (optional)
- Data (optional)
- Extras (optional)
- Component (optional, for explicit)

**Broadcast Intent Example:**
```java
Intent intent = new Intent(Intent.ACTION_BOOT_COMPLETED);
intent.putExtra("timestamp", System.currentTimeMillis());
sendBroadcast(intent);
```

### Receiver Registration

#### Manifest Registration

**Static Registration:**
- Registered in AndroidManifest.xml
- App doesn't need to be running
- System can start app
- Used for system broadcasts

**Manifest Example:**
```xml
<receiver
    android:name=".BootReceiver"
    android:enabled="true"
    android:exported="true">
    <intent-filter>
        <action android:name="android.intent.action.BOOT_COMPLETED" />
    </intent-filter>
</receiver>
```

#### Dynamic Registration

**Programmatic Registration:**
- Registered in code
- App must be running
- Must unregister
- Used for app-specific broadcasts

**Registration Example:**
```java
BroadcastReceiver receiver = new BroadcastReceiver() {
    @Override
    public void onReceive(Context context, Intent intent) {
        // Handle broadcast
    }
};

IntentFilter filter = new IntentFilter(Intent.ACTION_BATTERY_CHANGED);
registerReceiver(receiver, filter);

// Unregister
unregisterReceiver(receiver);
```

### IntentFilter Matching

#### Matching Process

**Matching Criteria:**
- **Action:** Intent action matches filter action
- **Category:** Intent categories match filter categories
- **Data:** Intent data matches filter data
- **Type:** Intent MIME type matches filter type

**Matching Flow:**
```
1. Broadcast intent received
2. AMS gets all registered receivers
3. For each receiver:
   - Get IntentFilter
   - Match action
   - Match category
   - Match data
   - Match type
4. If all match, receiver selected
5. Receiver added to delivery list
```

#### Matching Rules

**Action Matching:**
- Intent action must match filter action
- Wildcard actions supported
- Multiple actions in filter (OR)

**Category Matching:**
- Intent categories must match filter categories
- Default category (android.intent.category.DEFAULT)
- Multiple categories in filter (AND)

**Data Matching:**
- Intent data URI matches filter data
- MIME type matching
- Scheme, host, path matching

### Broadcast Delivery

#### Delivery Process

**Normal Broadcast Delivery:**
```
1. Broadcast queued
2. Receivers matched
3. For each receiver:
   - Create receiver process (if needed)
   - Deliver broadcast
   - Receiver.onReceive() called
4. Broadcast complete
```

**Ordered Broadcast Delivery:**
```
1. Broadcast queued
2. Receivers matched and ordered
3. For each receiver (in order):
   - Create receiver process (if needed)
   - Deliver broadcast
   - Receiver.onReceive() called
   - Wait for completion
   - Check if aborted
4. Broadcast complete or aborted
```

#### Receiver Execution

**Receiver Execution:**
- Runs on main thread (by default)
- 10-second timeout
- Should complete quickly
- Can start service for long work

**Execution Context:**
- Context provided
- Intent provided
- Limited time to execute
- Should not block

### Broadcast Queue

#### Queue Management

**Broadcast Queues:**
- **Foreground Queue:** High-priority broadcasts
- **Background Queue:** Normal broadcasts
- **Offload Queue:** Deferred broadcasts

**Queue Operations:**
- Enqueue broadcast
- Dequeue broadcast
- Process broadcasts
- Queue prioritization

#### Queue Processing

**Processing Flow:**
```
1. Broadcast enqueued
2. Queue processes broadcasts
3. Receivers matched
4. Broadcasts delivered
5. Queue continues processing
```

**Queue Priorities:**
- Foreground broadcasts first
- Background broadcasts next
- Offload broadcasts last

### Broadcast Permissions

#### Permission Enforcement

**Permission Types:**
- **Sender Permission:** Required to send broadcast
- **Receiver Permission:** Required to receive broadcast

**Permission Enforcement:**
```
1. Broadcast sent with permission
2. AMS checks sender permission
3. AMS matches receivers
4. AMS checks receiver permissions
5. Only receivers with permission receive
```

#### Permission Examples

**Sender Permission:**
```java
Intent intent = new Intent("CUSTOM_ACTION");
sendBroadcast(intent, "com.example.SEND_PERMISSION");
// Only apps with SEND_PERMISSION can send
```

**Receiver Permission:**
```xml
<receiver
    android:name=".MyReceiver"
    android:permission="com.example.RECEIVE_PERMISSION">
    <intent-filter>
        <action android:name="CUSTOM_ACTION" />
    </intent-filter>
</receiver>
```

### Broadcast System Integration

#### AMS Integration

**AMS Broadcast Management:**
- BroadcastQueue management
- Receiver matching
- Broadcast delivery
- Permission enforcement
- Process management

**AMS Components:**
- BroadcastQueue (foreground, background)
- BroadcastFilter (receiver registration)
- BroadcastRecord (broadcast information)

#### System Service Integration

**Service Integration:**
- System services send broadcasts
- System services register receivers
- Broadcast coordination
- System event notifications

### Broadcast Restrictions

#### Android 8.0+ Restrictions

**Implicit Broadcast Restrictions:**
- Most implicit broadcasts cannot be registered in manifest
- Must use dynamic registration
- Exceptions for system broadcasts

**Restricted Broadcasts:**
- Custom action broadcasts
- App-specific broadcasts
- Most implicit broadcasts

**Allowed Broadcasts:**
- System broadcasts (boot, network, etc.)
- Explicit broadcasts
- Local broadcasts

#### Background Execution Limits

**Background Restrictions:**
- Background receivers limited
- Must use foreground service
- JobScheduler preferred
- WorkManager preferred

### Broadcast Performance

#### Performance Considerations

**Performance Factors:**
- Number of receivers
- Receiver execution time
- Broadcast frequency
- Queue processing

**Optimization:**
- Limit receiver count
- Fast receiver execution
- Use local broadcasts when possible
- Avoid unnecessary broadcasts

### Debugging Broadcast System

#### Common Issues

**Development Issues:**
- Broadcast not received
- Receiver not registered
- Permission issues
- Matching problems
- Performance issues

#### Debugging Tools

**dumpsys activity broadcasts:**
```bash
# Dump broadcast state
adb shell dumpsys activity broadcasts

# List pending broadcasts
adb shell dumpsys activity broadcasts | grep -A 10 "Pending"

# List registered receivers
adb shell dumpsys activity broadcasts | grep -A 10 "Receiver"
```

**Logcat:**
```bash
# Filter broadcast logs
adb logcat | grep -E "Broadcast|BroadcastReceiver"

# Filter AMS broadcast logs
adb logcat | grep ActivityManager | grep broadcast
```

#### Broadcast State Inspection

**Pending Broadcasts:**
```bash
# List pending broadcasts
adb shell dumpsys activity broadcasts | grep -A 20 "Pending"

# Shows:
# - Broadcast action
# - Receivers
# - Queue
# - State
```

**Registered Receivers:**
```bash
# List registered receivers
adb shell dumpsys activity broadcasts | grep -A 15 "Receiver"

# Shows:
# - Receiver component
# - Intent filters
# - Permissions
# - State
```

## Key Takeaways

1. **Broadcast system** is a core Android framework mechanism enabling system-wide event notifications and inter-component communication through broadcast intents.

2. **Broadcast system architecture** includes BroadcastQueue (queue management), BroadcastReceiver (receives broadcasts), IntentFilter (matching criteria), and ActivityManagerService (delivery management).

3. **Broadcast types** include normal broadcasts (asynchronous, parallel), ordered broadcasts (synchronous, sequential, priority-based), and sticky broadcasts (persistent, deprecated).

4. **Broadcast sending** involves creating broadcast intent, calling sendBroadcast() or sendOrderedBroadcast(), AMS receiving and matching, and queuing for delivery.

5. **Receiver registration** includes manifest registration (static, app doesn't need to run), dynamic registration (programmatic, app must run), and IntentFilter matching (action, category, data, type).

6. **Broadcast delivery** involves matching receivers (IntentFilter matching), creating receiver processes (if needed), calling onReceive(), and handling execution (main thread, 10-second timeout).

7. **Broadcast queue** manages foreground queue (high-priority), background queue (normal), and offload queue (deferred), with queue processing and prioritization.

8. **Broadcast permissions** include sender permissions (required to send), receiver permissions (required to receive), and permission enforcement by AMS.

9. **Broadcast restrictions** in Android 8.0+ limit implicit broadcast registration in manifest, require dynamic registration for most broadcasts, and restrict background execution.

10. **Understanding Broadcast system internals** is essential for AOSP development, explaining how Android handles system-wide event notifications, inter-component communication, and broadcast delivery.

## Related Topics

- **System Server Overview:** How Broadcast system fits into system architecture
- **ActivityManagerService (AMS) internals:** How AMS manages broadcast delivery
- **PackageManagerService:** How receivers are discovered and registered
- **Android Architecture - Complete Overview:** How Broadcast system fits into overall architecture

