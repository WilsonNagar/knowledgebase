---
number: 102
title: DisplayManagerService
slug: displaymanagerservice
level: intermediate
tags:
  - aosp
  - framework
  - display-manager
  - display-management
  - multi-display
  - system-services
prerequisites:
  - system-server-overview
  - windowmanagerservice-wms
  - android-architecture-complete-overview
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-intermediate-102
---

# DisplayManagerService

## Overview

DisplayManagerService is a critical system service responsible for managing display devices, display configuration, display state, and multi-display support. Understanding DisplayManagerService is essential for AOSP development, as it explains how displays are discovered, how display configuration is managed, how display state is controlled, how multi-display is supported, and how DisplayManagerService coordinates with WindowManagerService and SurfaceFlinger. This guide provides a comprehensive overview of DisplayManagerService, architecture, display discovery, display configuration, display state management, multi-display support, and debugging.

Think of DisplayManagerService like a display coordinator: just as a display coordinator manages all displays (screens), handles display configuration (resolution, orientation), controls display state (on/off, brightness), and coordinates multiple displays (primary, secondary), DisplayManagerService manages all display devices, handles display configuration, controls display state, and supports multiple displays.

## Deep Explanation

### What is DisplayManagerService?

DisplayManagerService is a core system service running in the SystemServer process that manages all display-related functionality, including display discovery, display configuration, display state management, and multi-display support.

**Key Characteristics:**
- **Core Service:** Runs in SystemServer
- **Display Management:** Manages all displays
- **Configuration Management:** Handles display configuration
- **State Management:** Controls display state
- **Multi-Display Support:** Supports multiple displays

**Why DisplayManagerService?**
- **Centralized Management:** Single point for display management
- **Configuration Control:** Manages display configuration
- **State Coordination:** Coordinates display state
- **Multi-Display:** Enables multi-display support

### DisplayManagerService Architecture

#### Service Location

**DisplayManagerService Location:**
- Runs in `system_server` process
- Part of SystemServer
- Started early in boot sequence
- Registered with ServiceManager

**Service Registration:**
```java
// In SystemServer
DisplayManagerService dms = new DisplayManagerService(...);
ServiceManager.addService(Context.DISPLAY_SERVICE, dms);
```

**Access from Apps:**
```java
// Apps access via DisplayManager
DisplayManager dm = getSystemService(DisplayManager.class);
```

#### Internal Components

**DisplayManagerService Components:**
- **DisplayDeviceList:** List of display devices
- **DisplayConfiguration:** Display configuration management
- **DisplayStateController:** Controls display state
- **MultiDisplayController:** Manages multi-display
- **HALInterface:** Interfaces with display HAL

### Display Discovery

#### Display Enumeration

**Discovery Process:**
```
1. DisplayManagerService starts
2. DisplayManagerService queries display HAL
3. HAL returns display list
4. DisplayManagerService creates Display objects
5. DisplayManagerService registers displays
6. Displays available to system
```

**Display Information:**
- Display ID
- Display name
- Display type
- Display capabilities
- Display configuration

#### Display Types

**Display Categories:**
- **Internal Display:** Built-in display (phone/tablet screen)
- **External Display:** External display (HDMI, USB-C)
- **Virtual Display:** Software-created display
- **Overlay Display:** Overlay display

**Display Characteristics:**
- Physical vs virtual
- Primary vs secondary
- Built-in vs external
- Capabilities

### Display Configuration

#### Configuration Parameters

**Display Configuration:**
- **Resolution:** Width and height in pixels
- **Density:** DPI (dots per inch)
- **Refresh Rate:** Frames per second
- **Orientation:** Portrait, landscape, etc.
- **Color Mode:** Color space and gamut
- **HDR Support:** HDR capabilities

**Configuration Management:**
- Read current configuration
- Set new configuration
- Validate configuration
- Apply configuration

#### Configuration Changes

**Configuration Change Process:**
```
1. Configuration change requested
2. DisplayManagerService validates
3. DisplayManagerService applies configuration
4. DisplayManagerService notifies listeners
5. System updates display
```

**Change Triggers:**
- User settings
- App requests
- System policy
- Hardware changes

### Display State Management

#### Display States

**Display States:**
- **ON:** Display fully on
- **OFF:** Display off
- **DOZE:** Display in doze mode (very dim)
- **SUSPENDED:** Display suspended

**State Transitions:**
```
ON → DOZE → OFF → SUSPENDED
  ↑                        ↓
  └────────────────────────┘
```

#### State Control

**State Control Process:**
```
1. State change requested
2. DisplayManagerService validates
3. DisplayManagerService applies state
4. DisplayManagerService coordinates with PowerManager
5. Display state changes
```

**State Control Factors:**
- User activity
- Power state
- Proximity sensor
- System policy

### Multi-Display Support

#### Multiple Displays

**Display Types:**
- **Primary Display:** Main display (built-in)
- **Secondary Displays:** External displays
- **Virtual Displays:** Software displays
- **Overlay Displays:** Overlay displays

**Multi-Display Management:**
- Display enumeration
- Display assignment
- Display configuration per display
- Display state per display

#### Display Assignment

**Window Assignment:**
- Windows assigned to displays
- Each display has own window list
- Layout calculated per display
- Input routed per display

**Display Coordination:**
- DisplayManagerService manages all displays
- WindowManagerService uses display info
- SurfaceFlinger composites per display
- Input routed to appropriate display

### Display Configuration API

#### Application API

**Getting Display:**
```java
DisplayManager dm = getSystemService(DisplayManager.class);
Display[] displays = dm.getDisplays();
Display primaryDisplay = displays[0];
```

**Display Information:**
```java
DisplayMetrics metrics = new DisplayMetrics();
primaryDisplay.getMetrics(metrics);
int width = metrics.widthPixels;
int height = metrics.heightPixels;
float density = metrics.density;
```

**Display Configuration:**
```java
Display.Mode[] modes = primaryDisplay.getSupportedModes();
Display.Mode currentMode = primaryDisplay.getMode();
```

#### System API

**System Display Management:**
- Display discovery
- Configuration management
- State control
- Multi-display coordination

### Display Power Management

#### Power States

**Display Power States:**
- **ON:** Display fully powered
- **DOZE:** Display in doze mode
- **OFF:** Display powered off

**Power Management:**
- Automatic brightness
- Display timeout
- Proximity sensor control
- Power-saving modes

#### Brightness Control

**Brightness Management:**
- Manual brightness
- Automatic brightness
- Adaptive brightness
- Brightness limits

**Brightness Control:**
```
1. Brightness change requested
2. DisplayManagerService validates
3. DisplayManagerService applies brightness
4. Display brightness changes
```

### DisplayManagerService Coordination

#### WindowManager Coordination

**Window Coordination:**
- DisplayManagerService provides display info
- WindowManagerService uses display info
- Windows assigned to displays
- Layout calculated per display

**Coordination Flow:**
```
DisplayManagerService → Provides display info
WindowManagerService → Uses display info
WindowManagerService → Assigns windows to displays
WindowManagerService → Calculates layout per display
```

#### SurfaceFlinger Coordination

**Surface Coordination:**
- DisplayManagerService provides display configuration
- SurfaceFlinger uses display configuration
- Surfaces composited per display
- Display output per display

**Coordination Flow:**
```
DisplayManagerService → Provides display config
SurfaceFlinger → Uses display config
SurfaceFlinger → Composites per display
SurfaceFlinger → Outputs to display
```

#### PowerManager Coordination

**Power Coordination:**
- DisplayManagerService coordinates with PowerManager
- Display state affects power state
- Power state affects display state
- Screen on/off coordination

**Coordination Flow:**
```
PowerManager → Requests display state change
DisplayManagerService → Applies display state
DisplayManagerService → Notifies PowerManager
PowerManager → Updates power state
```

### Display Events

#### Display Event Types

**Event Types:**
- **Display Added:** New display connected
- **Display Removed:** Display disconnected
- **Display Changed:** Display configuration changed
- **Display State Changed:** Display state changed

**Event Handling:**
- Event generation
- Event distribution
- Listener notification
- System updates

#### Event Listeners

**Listener Registration:**
```java
DisplayManager.DisplayListener listener = new DisplayManager.DisplayListener() {
    @Override
    public void onDisplayAdded(int displayId) {
        // Handle display added
    }
    
    @Override
    public void onDisplayRemoved(int displayId) {
        // Handle display removed
    }
    
    @Override
    public void onDisplayChanged(int displayId) {
        // Handle display changed
    }
};

dm.registerDisplayListener(listener, handler);
```

### Virtual Displays

#### Virtual Display Creation

**Virtual Display:**
- Software-created display
- Not physical display
- Used for screen recording
- Used for presentation

**Creation Process:**
```
1. Virtual display creation requested
2. DisplayManagerService creates virtual display
3. DisplayManagerService assigns display ID
4. Virtual display available
5. Content can be rendered to virtual display
```

**Use Cases:**
- Screen recording
- Presentation mode
- Multi-window
- Testing

### Debugging DisplayManagerService

#### Common Issues

**Development Issues:**
- Display not detected
- Configuration not applied
- Display state issues
- Multi-display problems
- Brightness issues

#### Debugging Tools

**dumpsys display:**
```bash
# Dump DisplayManagerService state
adb shell dumpsys display

# List displays
adb shell dumpsys display | grep -A 10 "Display"

# Display configuration
adb shell dumpsys display | grep -A 20 "Configuration"
```

**Display Info:**
```bash
# Get display info
adb shell wm size
adb shell wm density
```

**Logcat:**
```bash
# Filter DisplayManagerService logs
adb logcat | grep DisplayManager

# Filter display events
adb logcat | grep DisplayEvent
```

#### DisplayManagerService State Inspection

**Display List:**
```bash
# List all displays
adb shell dumpsys display | grep -A 15 "Display"

# Shows:
# - Display ID
# - Display name
# - Display type
# - Display state
# - Configuration
```

**Display Configuration:**
```bash
# Display configuration
adb shell dumpsys display | grep -A 30 "Configuration"

# Shows:
# - Resolution
# - Density
# - Refresh rate
# - Orientation
# - Color mode
```

## Key Takeaways

1. **DisplayManagerService** is a core system service managing display devices, display configuration, display state, and multi-display support in Android.

2. **DisplayManagerService architecture** includes DisplayDeviceList (display enumeration), DisplayConfiguration (configuration management), DisplayStateController (state control), MultiDisplayController (multi-display management), and HALInterface (HAL coordination).

3. **Display discovery** involves display enumeration (querying HAL for displays), display information (ID, name, type, capabilities), and display types (internal, external, virtual, overlay).

4. **Display configuration** includes configuration parameters (resolution, density, refresh rate, orientation, color mode), configuration management (read, set, validate, apply), and configuration changes (triggers and process).

5. **Display state management** involves display states (ON, OFF, DOZE, SUSPENDED), state transitions, state control process, and state control factors (user activity, power state, proximity sensor).

6. **Multi-display support** includes multiple displays (primary, secondary, virtual, overlay), display assignment (windows to displays), and display coordination (DisplayManagerService, WindowManagerService, SurfaceFlinger).

7. **Display power management** includes display power states (ON, DOZE, OFF), brightness control (manual, automatic, adaptive), and power-saving modes.

8. **DisplayManagerService coordination** with WindowManagerService (display info for windows), SurfaceFlinger (display configuration for composition), and PowerManager (display state coordination) enables proper display management.

9. **Virtual displays** are software-created displays used for screen recording, presentation mode, and testing, created and managed by DisplayManagerService.

10. **Understanding DisplayManagerService** is essential for AOSP development, explaining how Android manages displays, handles display configuration, supports multiple displays, and coordinates display state with other system services.

## Related Topics

- **System Server Overview:** How DisplayManagerService fits into SystemServer
- **WindowManagerService (WMS):** How DisplayManagerService coordinates with WMS
- **PowerManagerService:** How DisplayManagerService coordinates with PowerManager
- **Android Architecture - Complete Overview:** How DisplayManagerService fits into overall architecture

