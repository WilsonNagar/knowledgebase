---
number: 107
title: Permissions service
slug: permissions-service
level: intermediate
tags:
  - aosp
  - framework
  - permissions
  - permission-manager
  - security
  - system-components
prerequisites:
  - system-server-overview
  - packagemanagerservice
  - android-architecture-complete-overview
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-intermediate-107
---

# Permissions service

## Overview

The Permissions service (PermissionManagerService) is a critical system service responsible for managing Android's permission system, including permission definitions, permission grants, permission checks, runtime permissions, and permission enforcement. Understanding the Permissions service is essential for AOSP development, as it explains how permissions are defined, how permissions are granted and revoked, how permission checks are performed, how runtime permissions work, and how the Permissions service coordinates with PackageManagerService and other system services. This guide provides a comprehensive overview of Permissions service, architecture, permission management, runtime permissions, permission enforcement, and debugging.

Think of the Permissions service like a security checkpoint: just as a security checkpoint controls access to restricted areas by checking credentials (permissions), the Permissions service controls access to protected resources by checking if apps have been granted the required permissions, enforcing security and privacy throughout the Android system.

## Deep Explanation

### What is the Permissions Service?

The Permissions service (PermissionManagerService) is a core system service running in the SystemServer process that manages Android's permission system, including permission definitions, permission grants, permission checks, runtime permissions, and permission enforcement.

**Key Characteristics:**
- **Core Service:** Runs in SystemServer
- **Permission Management:** Manages all permissions
- **Grant Management:** Manages permission grants
- **Enforcement:** Enforces permission checks
- **Security:** Provides security foundation

**Why Permissions Service?**
- **Centralized Management:** Single point for permission management
- **Security Enforcement:** Enforces security policies
- **Privacy Protection:** Protects user privacy
- **System Integration:** Integrated with system services

### Permissions Service Architecture

#### Service Location

**Permissions Service Location:**
- Runs in `system_server` process
- Part of SystemServer
- Started early in boot sequence
- Integrated with PackageManagerService

**Service Integration:**
- Closely integrated with PMS
- Shares permission data
- Coordinates permission operations
- Manages permission state

#### Internal Components

**Permissions Service Components:**
- **PermissionRegistry:** Registry of all permissions
- **GrantManager:** Manages permission grants
- **PermissionChecker:** Performs permission checks
- **RuntimePermissionManager:** Manages runtime permissions
- **PermissionPolicy:** Enforces permission policies

### Permission Types

#### Normal Permissions

**Normal Permissions:**
- Automatically granted at install time
- No user interaction required
- Low risk to privacy
- Cannot be revoked by user

**Examples:**
- `INTERNET`
- `ACCESS_NETWORK_STATE`
- `VIBRATE`
- `WAKE_LOCK`

#### Dangerous Permissions

**Dangerous Permissions:**
- Require runtime permission request
- User must approve
- High risk to privacy
- Can be revoked by user

**Examples:**
- `CAMERA`
- `READ_CONTACTS`
- `ACCESS_FINE_LOCATION`
- `READ_EXTERNAL_STORAGE`

#### Signature Permissions

**Signature Permissions:**
- Granted if app signed with same certificate
- System-level permissions
- Automatic grant
- Cannot be revoked

**Examples:**
- System permissions
- Framework permissions
- Platform permissions

#### Special Permissions

**Special Permissions:**
- Require special handling
- Settings-based permissions
- Overlay permissions
- System alert window

**Examples:**
- `SYSTEM_ALERT_WINDOW`
- `WRITE_SETTINGS`
- `REQUEST_IGNORE_BATTERY_OPTIMIZATIONS`

### Permission Management

#### Permission Registry

**Permission Registry:**
- Stores all permission definitions
- Loaded from system permissions
- Loaded from app permissions
- Maintains permission metadata

**Permission Information:**
- Permission name
- Protection level
- Permission group
- Description
- Label

#### Permission Groups

**Permission Groups:**
- Group related permissions
- User grants group, not individual
- Group-based UI
- Simplified user experience

**Common Groups:**
- **CALENDAR:** Calendar permissions
- **CAMERA:** Camera permission
- **CONTACTS:** Contacts permissions
- **LOCATION:** Location permissions
- **MICROPHONE:** Microphone permission
- **PHONE:** Phone permissions
- **SENSORS:** Sensor permissions
- **SMS:** SMS permissions
- **STORAGE:** Storage permissions

### Runtime Permissions

#### Runtime Permission Model

**Android 6.0+ (API 23+):**
- Dangerous permissions require runtime request
- User must approve at runtime
- Can be revoked by user
- Granular control

**Runtime Permission Flow:**
```
1. App requests dangerous permission
2. System checks if already granted
3. If not, show permission dialog
4. User approves/denies
5. Permission grant stored
6. App can use permission
```

#### Permission Request

**Request Process:**
```
1. App calls requestPermission()
2. Framework checks current state
3. If not granted, show dialog
4. User makes decision
5. Result delivered to app
6. Permission state updated
```

**Request Handling:**
- Permission dialog shown
- User decision recorded
- Result callback delivered
- Permission state persisted

### Permission Grants

#### Grant Storage

**Grant Storage:**
- Stored in `/data/system/packages.xml`
- Per-user permission grants
- Runtime permission grants
- Persistent across reboots

**Grant Information:**
- Package name
- Permission name
- Grant state (granted/denied)
- User ID
- Flags

#### Grant Management

**Grant Operations:**
- Grant permission
- Revoke permission
- Check grant state
- Update grant state

**Grant Process:**
```
1. Permission request received
2. User approves/denies
3. Grant state updated
4. Grant stored persistently
5. System services notified
```

### Permission Checks

#### Check Process

**Permission Check Flow:**
```
1. App tries to access protected resource
2. System service checks permission
3. Service queries PermissionManager
4. PermissionManager checks grant state
5. Access allowed or denied
```

**Check Implementation:**
```java
int result = checkPermission(permission, pid, uid);
if (result == PERMISSION_GRANTED) {
    // Access allowed
} else {
    // Access denied
}
```

#### Check Enforcement

**Enforcement Points:**
- System service calls
- Framework API calls
- Component access
- Resource access

**Enforcement:**
- Automatic enforcement
- Transparent to apps
- Consistent across system
- Security guaranteed

### Permission Enforcement

#### Enforcement Mechanism

**Enforcement Process:**
```
1. Protected operation requested
2. Permission check performed
3. Grant state verified
4. Access granted or denied
5. Result returned
```

**Enforcement Levels:**
- Framework level
- System service level
- Native level
- Kernel level

#### System Service Enforcement

**Service Enforcement:**
- Each service checks permissions
- Queries PermissionManager
- Enforces access control
- Returns appropriate errors

**Example:**
```java
// In CameraService
if (checkPermission(CAMERA, pid, uid) != PERMISSION_GRANTED) {
    throw new SecurityException("Camera permission required");
}
```

### Permission Policies

#### Policy Types

**Permission Policies:**
- Grant policies
- Revoke policies
- Check policies
- Enforcement policies

**Policy Enforcement:**
- System-wide policies
- Per-app policies
- User preferences
- System restrictions

#### App Standby

**App Standby Impact:**
- Background apps restricted
- Permissions less effective
- Battery optimization
- User control

**Standby Restrictions:**
- Background restrictions
- Permission limitations
- Resource restrictions
- Performance impact

### Permissions Service Coordination

#### PMS Coordination

**PackageManagerService Integration:**
- Permission definitions from packages
- Permission grants stored together
- Component resolution with permissions
- Package installation with permissions

**Coordination Flow:**
```
PMS → Installs package
PMS → Extracts permissions
PMS → Registers with PermissionManager
PermissionManager → Stores permission definitions
```

#### System Service Coordination

**Service Integration:**
- Services query permissions
- Services enforce permissions
- Permission state synchronization
- System-wide coordination

### Permission UI

#### Permission Dialogs

**Permission Dialog:**
- Shown for dangerous permissions
- User decision required
- Cannot be dismissed
- One-time or always

**Dialog Types:**
- One-time permission
- While-in-use permission
- Always permission
- Deny option

#### Settings Integration

**Settings UI:**
- Permission management
- Grant/revoke permissions
- Permission groups
- App permissions

**Settings Access:**
- Settings app
- App info screen
- Permission groups
- Individual permissions

### Debugging Permissions Service

#### Common Issues

**Development Issues:**
- Permission not granted
- Permission check fails
- Runtime permission issues
- Permission state problems

#### Debugging Tools

**dumpsys package permissions:**
```bash
# Dump permission state
adb shell dumpsys package permissions

# Dump specific package
adb shell dumpsys package com.example.app | grep -A 20 "permissions"

# List all permissions
adb shell dumpsys package permissions | grep -A 5 "Permission"
```

**Package Manager Commands:**
```bash
# Grant permission
adb shell pm grant com.example.app android.permission.CAMERA

# Revoke permission
adb shell pm revoke com.example.app android.permission.CAMERA

# List permissions
adb shell pm list permissions
```

**Logcat:**
```bash
# Filter permission logs
adb logcat | grep -E "Permission|PermissionManager"

# Filter permission checks
adb logcat | grep "checkPermission"
```

#### Permission State Inspection

**Package Permissions:**
```bash
# Check package permissions
adb shell dumpsys package com.example.app | grep -A 30 "permissions"

# Shows:
# - Permission name
# - Grant state
# - Flags
# - User ID
```

**System Permissions:**
```bash
# List system permissions
adb shell pm list permissions -s

# Shows:
# - Permission name
# - Protection level
# - Permission group
```

## Key Takeaways

1. **Permissions service** (PermissionManagerService) is a core system service managing Android's permission system, including permission definitions, grants, checks, runtime permissions, and enforcement.

2. **Permissions service architecture** includes PermissionRegistry (permission definitions), GrantManager (permission grants), PermissionChecker (permission checks), RuntimePermissionManager (runtime permissions), and PermissionPolicy (policy enforcement).

3. **Permission types** include normal permissions (automatic grant), dangerous permissions (runtime request), signature permissions (same signature), and special permissions (special handling).

4. **Permission management** involves permission registry (storing definitions), permission groups (grouping related permissions), and grant storage (persistent storage in packages.xml).

5. **Runtime permissions** (Android 6.0+) require runtime requests for dangerous permissions, user approval, and can be revoked, providing granular user control.

6. **Permission grants** are stored persistently in packages.xml, include per-user grants, and are managed through grant operations (grant, revoke, check).

7. **Permission checks** are performed at enforcement points (system services, framework APIs), query PermissionManager for grant state, and enforce access control consistently.

8. **Permission enforcement** occurs at multiple levels (framework, system service, native, kernel), with automatic enforcement and security guarantees.

9. **Permissions service coordination** with PackageManagerService (permission definitions, grants) and system services (permission queries, enforcement) enables proper permission management.

10. **Understanding Permissions service** is essential for AOSP development, explaining how Android manages permissions, enforces security, protects privacy, and provides runtime permission control.

## Related Topics

- **System Server Overview:** How Permissions service fits into system architecture
- **PackageManagerService:** How Permissions service coordinates with PMS
- **ActivityManagerService (AMS) internals):** How AMS uses permissions
- **Android Architecture - Complete Overview:** How Permissions service fits into overall architecture

