---
number: 101
title: SensorService
slug: sensorservice
level: intermediate
tags:
  - aosp
  - framework
  - sensors
  - sensor-service
  - sensor-framework
  - system-services
prerequisites:
  - system-server-overview
  - integrating-sensors-hal
  - android-architecture-complete-overview
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-intermediate-101
---

# SensorService

## Overview

SensorService is a critical system service responsible for managing sensor access, sensor data distribution, sensor event handling, and coordination with the Sensors HAL. Understanding SensorService is essential for AOSP development, as it explains how sensors are discovered, how sensor data is distributed to applications, how sensor events are handled, how sensor access is managed, and how SensorService coordinates with the Sensors HAL and applications. This guide provides a comprehensive overview of SensorService, architecture, sensor discovery, sensor data distribution, event handling, access management, and debugging.

Think of SensorService like a sensor data distribution hub: just as a distribution hub receives data from various sources (sensors), manages access (who can use which sensors), distributes data to consumers (applications), and handles data flow (event processing), SensorService receives sensor data from the Sensors HAL, manages sensor access, distributes sensor events to applications, and handles sensor event processing.

## Deep Explanation

### What is SensorService?

SensorService is a core system service running in the SystemServer process that manages all sensor-related functionality, including sensor discovery, sensor data distribution, sensor event handling, and sensor access management.

**Key Characteristics:**
- **Core Service:** Runs in SystemServer
- **Sensor Management:** Manages all sensors
- **Data Distribution:** Distributes sensor data to apps
- **Access Control:** Manages sensor access
- **HAL Coordination:** Coordinates with Sensors HAL

**Why SensorService?**
- **Centralized Management:** Single point for sensor management
- **Access Control:** Enforces sensor access policies
- **Data Distribution:** Efficient sensor data distribution
- **Resource Management:** Manages sensor resources

### SensorService Architecture

#### Service Location

**SensorService Location:**
- Runs in `system_server` process
- Part of SystemServer
- Started early in boot sequence
- Registered with ServiceManager

**Service Registration:**
```java
// In SystemServer
SensorService sensorService = new SensorService();
ServiceManager.addService(Context.SENSOR_SERVICE, sensorService);
```

**Access from Apps:**
```java
// Apps access via SensorManager
SensorManager sm = getSystemService(SensorManager.class);
```

#### Internal Components

**SensorService Components:**
- **SensorList:** List of available sensors
- **SensorEventQueue:** Queues sensor events
- **SensorAccessController:** Manages sensor access
- **SensorDataProcessor:** Processes sensor data
- **HALInterface:** Interfaces with Sensors HAL

### Sensor Discovery

#### Sensor Enumeration

**Discovery Process:**
```
1. SensorService starts
2. SensorService queries Sensors HAL
3. HAL returns sensor list
4. SensorService creates Sensor objects
5. SensorService registers sensors
6. Sensors available to apps
```

**Sensor Information:**
- Sensor type
- Sensor name
- Vendor
- Version
- Maximum range
- Resolution
- Power consumption
- Minimum delay

#### Sensor Types

**Motion Sensors:**
- Accelerometer
- Gyroscope
- Magnetometer
- Gravity
- Linear acceleration
- Rotation vector

**Environmental Sensors:**
- Ambient light
- Proximity
- Pressure
- Temperature
- Humidity

**Position Sensors:**
- Orientation (deprecated)
- GPS (separate service)

### Sensor Data Distribution

#### Event Queue

**Event Queue Structure:**
- Per-app event queues
- Sensor events queued
- FIFO ordering
- Size limits

**Queue Management:**
- Event queuing
- Queue size limits
- Overflow handling
- Event delivery

#### Event Distribution

**Distribution Process:**
```
1. SensorService receives event from HAL
2. SensorService processes event
3. SensorService determines target apps
4. SensorService queues events
5. SensorService delivers to apps
6. Apps receive events
```

**Distribution Factors:**
- App registration
- Sensor activation
- Event rate
- Queue capacity

### Sensor Event Handling

#### Event Processing

**Event Processing Flow:**
```
1. HAL generates sensor event
2. SensorService receives event
3. SensorService validates event
4. SensorService processes event
5. SensorService queues event
6. SensorService delivers to apps
```

**Event Processing:**
- Event validation
- Data conversion
- Timestamp handling
- Accuracy handling

#### Event Batching

**Batching Process:**
- Multiple events batched
- Reduces overhead
- Improves performance
- Maintains order

**Batching Benefits:**
- Reduced IPC overhead
- Better performance
- Lower power consumption
- Smoother data flow

### Sensor Access Management

#### Access Control

**Access Control:**
- Permission checks
- Sensor availability
- Rate limiting
- Resource management

**Access Policies:**
- Permission-based access
- Sensor availability
- Rate limits
- Background restrictions

#### Sensor Registration

**Registration Process:**
```
1. App requests sensor
2. SensorService checks permissions
3. SensorService validates request
4. SensorService creates SensorEventListener
5. SensorService registers listener
6. Sensor available to app
```

**Registration Information:**
- App package
- Sensor type
- Event rate
- Queue size
- Listener reference

### Sensor Activation

#### Activation Process

**Activation Flow:**
```
1. App requests sensor activation
2. SensorService validates request
3. SensorService checks sensor state
4. SensorService activates sensor in HAL
5. HAL starts sensor
6. Sensor begins generating events
```

**Activation Factors:**
- Sensor availability
- App permissions
- Sensor state
- Resource availability

#### Deactivation

**Deactivation Process:**
```
1. App requests deactivation
2. SensorService deactivates sensor
3. SensorService stops event delivery
4. HAL stops sensor
5. Sensor power saved
```

**Deactivation Triggers:**
- App unregistration
- App pause
- Sensor no longer needed
- System policy

### Sensor Configuration

#### Sampling Rate

**Sampling Rate Configuration:**
- App requests rate
- SensorService validates
- HAL configures sensor
- Events at requested rate

**Rate Options:**
- Fastest (0 delay)
- Game (20ms)
- UI (60ms)
- Normal (200ms)

#### Report Latency

**Report Latency:**
- Maximum delay before reporting
- Batching configuration
- Power optimization
- Performance trade-off

**Latency Configuration:**
- Immediate (0 delay)
- Batching enabled
- Power optimized
- Performance optimized

### SensorService Coordination

#### HAL Coordination

**HAL Interface:**
- Sensor discovery
- Sensor activation
- Event polling
- Configuration

**HAL Communication:**
```
SensorService → Query HAL for sensors
HAL → Return sensor list
SensorService → Activate sensor
HAL → Start sensor
HAL → Generate events
SensorService → Poll events
```

#### Application Coordination

**App Interface:**
- Sensor registration
- Event delivery
- Configuration
- Error handling

**App Communication:**
```
App → Register sensor listener
SensorService → Validate and register
SensorService → Deliver events
App → Process events
App → Unregister listener
```

### Sensor Power Management

#### Power Optimization

**Power Management:**
- Sensor activation control
- Rate limiting
- Batching optimization
- Background restrictions

**Optimization Strategies:**
- Deactivate unused sensors
- Reduce sampling rates
- Use batching
- Background restrictions

#### Wake-up Sensors

**Wake-up Sensors:**
- Can wake device from sleep
- Higher power consumption
- Used for important events
- Limited use

**Wake-up Sensor Types:**
- Significant motion
- Tilt detector
- Wake gesture
- Pick up

### Sensor Data Processing

#### Data Conversion

**Data Processing:**
- Raw data conversion
- Unit conversion
- Calibration
- Filtering

**Processing Steps:**
- Receive raw data
- Convert units
- Apply calibration
- Filter noise
- Deliver to apps

#### Sensor Fusion

**Sensor Fusion:**
- Combine multiple sensors
- Improve accuracy
- Reduce noise
- Better data quality

**Fusion Examples:**
- Rotation vector (gyro + accel + mag)
- Gravity (accel + gyro)
- Linear acceleration (accel - gravity)

### Debugging SensorService

#### Common Issues

**Development Issues:**
- Sensor not found
- No sensor data
- Events not delivered
- Permission issues
- Performance problems

#### Debugging Tools

**dumpsys sensorservice:**
```bash
# Dump SensorService state
adb shell dumpsys sensorservice

# List sensors
adb shell dumpsys sensorservice | grep -A 10 "Sensors"

# List active sensors
adb shell dumpsys sensorservice | grep -A 10 "Active"
```

**Sensor Testing:**
```bash
# Test sensor
adb shell sensor_test

# Monitor sensor events
adb shell getevent
```

**Logcat:**
```bash
# Filter SensorService logs
adb logcat | grep SensorService

# Filter sensor events
adb logcat | grep SensorEvent
```

#### SensorService State Inspection

**Sensor List:**
```bash
# List all sensors
adb shell dumpsys sensorservice | grep -A 5 "Sensor"

# Shows:
# - Sensor name
# - Sensor type
# - Vendor
# - Version
# - Capabilities
```

**Active Sensors:**
```bash
# List active sensors
adb shell dumpsys sensorservice | grep -A 10 "Active"

# Shows:
# - Active sensor
# - App using sensor
# - Sampling rate
# - Report latency
```

## Key Takeaways

1. **SensorService** is a core system service managing sensor discovery, sensor data distribution, sensor event handling, and sensor access management in Android.

2. **SensorService architecture** includes SensorList (sensor enumeration), SensorEventQueue (event queuing), SensorAccessController (access management), SensorDataProcessor (data processing), and HALInterface (HAL coordination).

3. **Sensor discovery** involves sensor enumeration (querying HAL for sensors), sensor information (type, name, capabilities), and sensor registration (making sensors available to apps).

4. **Sensor data distribution** includes event queues (per-app queues), event distribution (to registered apps), and distribution factors (registration, activation, rate).

5. **Sensor event handling** involves event processing (validation, conversion, queuing), event batching (multiple events together), and event delivery (to applications).

6. **Sensor access management** includes access control (permissions, availability, rate limiting), sensor registration (app registration process), and sensor activation (activating sensors in HAL).

7. **Sensor configuration** involves sampling rate (event frequency), report latency (batching delay), and power optimization (reducing power consumption).

8. **SensorService coordination** with Sensors HAL (sensor discovery, activation, event polling) and applications (registration, event delivery) enables proper sensor functionality.

9. **Sensor power management** includes power optimization (activation control, rate limiting), wake-up sensors (can wake device), and background restrictions (limiting background sensor use).

10. **Understanding SensorService** is essential for AOSP development, explaining how Android manages sensors, distributes sensor data, and provides sensor access to applications.

## Related Topics

- **System Server Overview:** How SensorService fits into SystemServer
- **Integrating sensors HAL:** How SensorService coordinates with Sensors HAL
- **Sensors HAL:** Hardware abstraction layer for sensors
- **Android Architecture - Complete Overview:** How SensorService fits into overall architecture

