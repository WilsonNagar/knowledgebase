---
number: 205
title: strace/ltrace (system call tracing)
slug: strace-ltrace-system-call-tracing
level: intermediate
tags:
  - aosp
  - strace
  - ltrace
  - system-call-tracing
  - debugging
  - development-tools
prerequisites:
  - android-architecture-complete-overview
  - debugging-native-crashes-tombstones
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-intermediate-205
---

# strace/ltrace (system call tracing)

## Overview

strace and ltrace are system call tracing tools that allow developers to monitor and debug system calls and library calls made by processes. Understanding strace/ltrace is essential for AOSP development, as it explains how to trace system calls, how to debug native processes, how to analyze system behavior, how to identify performance issues, and how these tools provide visibility into process execution. This guide provides a comprehensive overview of strace/ltrace, tool usage, system call tracing, library call tracing, debugging workflows, and best practices.

Think of strace/ltrace like a surveillance system for system calls: just as a surveillance system monitors activities and records what happens (who enters, when, what they do), strace/ltrace monitors system and library calls made by processes, recording what system calls are made, when they're made, what parameters are passed, and what results are returned, providing complete visibility into process behavior.

## Deep Explanation

### What are strace and ltrace?

strace and ltrace are command-line tools that trace system calls and library calls made by processes, providing detailed information about process execution, system interactions, and library usage.

**Key Characteristics:**
- **System Call Tracing:** strace traces system calls
- **Library Call Tracing:** ltrace traces library calls
- **Process Monitoring:** Monitors running processes
- **Debugging Tools:** Essential debugging tools
- **Performance Analysis:** Helps identify performance issues

**Why strace/ltrace?**
- **System Visibility:** Understand system call behavior
- **Debugging:** Debug native process issues
- **Performance:** Identify performance bottlenecks
- **Security:** Analyze security-related calls
- **Development:** Essential development tools

### strace (System Call Tracer)

#### strace Overview

**strace:**
- Traces system calls and signals
- Shows system call arguments
- Shows return values
- Shows execution time
- Linux/Android tool

**Tool Location:**
- Available on Linux systems
- Can be built for Android
- Command-line tool
- Requires appropriate permissions

#### strace Usage

**Basic Usage:**
```bash
# Trace system calls of a command
strace command

# Trace system calls of a running process
strace -p <pid>

# Trace with timestamps
strace -t command

# Trace with relative timestamps
strace -r command

# Trace with absolute timestamps
strace -tt command
```

**Usage Characteristics:**
- Command tracing
- Process attachment
- Timestamp options
- Output formatting
- Filtering options

#### strace Options

**Common Options:**
```bash
# Trace specific system calls
strace -e trace=open,read,write command

# Trace system calls with file operations
strace -e trace=file command

# Trace network system calls
strace -e trace=network command

# Trace process/thread operations
strace -e trace=process command

# Trace signal operations
strace -e trace=signal command

# Follow child processes
strace -f command

# Count system calls
strace -c command

# Save output to file
strace -o output.txt command

# Verbose output
strace -v command
```

**Option Characteristics:**
- System call filtering
- Process following
- Output formatting
- File output
- Verbose modes

#### strace Output

**Output Format:**
```
open("/path/to/file", O_RDONLY) = 3
read(3, "data", 1024) = 1024
write(1, "output", 6) = 6
close(3) = 0
```

**Output Elements:**
- System call name
- Arguments
- Return value
- Error information
- Timing information

**Output Characteristics:**
- Detailed information
- Argument values
- Return values
- Error codes
- Timing data

### ltrace (Library Call Tracer)

#### ltrace Overview

**ltrace:**
- Traces library calls
- Shows function calls
- Shows function arguments
- Shows return values
- Library-level tracing

**Tool Location:**
- Available on Linux systems
- Can be built for Android
- Command-line tool
- Requires appropriate permissions

#### ltrace Usage

**Basic Usage:**
```bash
# Trace library calls of a command
ltrace command

# Trace library calls of a running process
ltrace -p <pid>

# Trace with timestamps
ltrace -t command

# Trace specific library
ltrace -l libname.so command

# Trace specific function
ltrace -e function_name command
```

**Usage Characteristics:**
- Command tracing
- Process attachment
- Library filtering
- Function filtering
- Output formatting

#### ltrace Options

**Common Options:**
```bash
# Trace specific library
ltrace -l libc.so command

# Trace specific function
ltrace -e malloc,free command

# Follow child processes
ltrace -f command

# Count library calls
ltrace -c command

# Save output to file
ltrace -o output.txt command

# Verbose output
ltrace -v command
```

**Option Characteristics:**
- Library filtering
- Function filtering
- Process following
- Output formatting
- File output

#### ltrace Output

**Output Format:**
```
malloc(1024) = 0x12345678
strcpy(0x12345678, "string") = 0x12345678
printf("format", ...) = 10
free(0x12345678) = <void>
```

**Output Elements:**
- Function name
- Arguments
- Return value
- Library information
- Timing information

**Output Characteristics:**
- Function-level detail
- Argument values
- Return values
- Library information
- Timing data

### Using strace/ltrace on Android

#### Building for Android

**Building Tools:**
```bash
# strace is available in AOSP
# Build strace
m strace

# ltrace may need to be built separately
# Or use pre-built binaries
```

**Installation:**
```bash
# Push to device
adb push strace /data/local/tmp/
adb push ltrace /data/local/tmp/

# Make executable
adb shell chmod 755 /data/local/tmp/strace
adb shell chmod 755 /data/local/tmp/ltrace
```

**Installation Characteristics:**
- AOSP build support
- Manual installation
- Device deployment
- Permission setup
- Tool availability

#### Tracing Android Processes

**Tracing Native Processes:**
```bash
# Get process PID
PID=$(adb shell pidof -s process_name)

# Trace with strace
adb shell strace -p $PID

# Trace with ltrace
adb shell ltrace -p $PID

# Trace with output file
adb shell strace -o /sdcard/trace.txt -p $PID
```

**Tracing Characteristics:**
- Process identification
- Process attachment
- Output management
- File output
- Remote tracing

### Debugging Workflows

#### Debugging System Call Issues

**Debugging Workflow:**
```
1. Identify problematic process
2. Attach strace to process
3. Reproduce issue
4. Analyze system calls
5. Identify problematic calls
6. Fix issue
```

**Workflow Steps:**
```bash
# 1. Get process PID
PID=$(adb shell pidof -s com.example.app)

# 2. Start strace
adb shell strace -p $PID -o /sdcard/trace.txt

# 3. Reproduce issue
# ... perform actions ...

# 4. Stop strace
# Ctrl+C or kill strace process

# 5. Pull trace file
adb pull /sdcard/trace.txt

# 6. Analyze trace
cat trace.txt | grep -i error
```

**Workflow Characteristics:**
- Process identification
- Trace collection
- Issue reproduction
- Trace analysis
- Problem identification

#### Performance Analysis

**Performance Workflow:**
```
1. Identify slow process
2. Trace with timing
3. Analyze call frequency
4. Identify slow calls
5. Optimize slow calls
```

**Performance Steps:**
```bash
# 1. Trace with timing
adb shell strace -c -p $PID

# 2. Analyze output
# Shows time spent per system call

# 3. Trace specific calls
adb shell strace -e trace=open,read,write -T -p $PID
```

**Performance Characteristics:**
- Timing analysis
- Call frequency
- Slow call identification
- Optimization guidance
- Performance improvement

### Advanced Usage

#### Filtering and Analysis

**Filtering:**
```bash
# Filter by system call
strace -e trace=open,read,write command

# Filter by file
strace -e trace=file command

# Filter by process
strace -e trace=process command

# Filter by signal
strace -e trace=signal command
```

**Analysis:**
```bash
# Count calls
strace -c command

# Summary statistics
strace -c -S calls command

# Filter output
strace command 2>&1 | grep -i error
```

**Advanced Characteristics:**
- Call filtering
- Output filtering
- Statistical analysis
- Error detection
- Pattern matching

#### Combining with Other Tools

**Tool Combination:**
```bash
# strace + logcat
adb shell strace -p $PID &
adb logcat | grep process_name

# strace + dumpsys
adb shell strace -p $PID &
adb shell dumpsys | grep process_name

# strace + perf
strace -c command &
perf record command
```

**Combination Characteristics:**
- Multi-tool analysis
- Correlated data
- Comprehensive debugging
- Cross-tool insights
- Enhanced visibility

### Best Practices

#### Best Practices

**Best Practices:**
- Use appropriate filters
- Save output to files
- Use timestamps for analysis
- Combine with other tools
- Analyze systematically

**Practice Guidelines:**
- **Filters:** Use appropriate filters
- **Output:** Save output to files
- **Timestamps:** Use timestamps for analysis
- **Combination:** Combine with other tools
- **Analysis:** Analyze systematically

#### Common Use Cases

**Common Use Cases:**
- Debugging file access issues
- Analyzing network operations
- Identifying performance bottlenecks
- Security analysis
- System behavior understanding

**Use Case Examples:**
- File access debugging
- Network debugging
- Performance profiling
- Security auditing
- System analysis

## Key Takeaways

1. **strace and ltrace** are system call and library call tracing tools that allow developers to monitor and debug system calls and library calls made by processes, providing detailed information about process execution, system interactions, and library usage.

2. **strace (system call tracer)** includes strace overview (traces system calls and signals, shows system call arguments, shows return values, shows execution time, Linux/Android tool), strace usage (command tracing, process attachment, timestamp options, output formatting, filtering options), strace options (system call filtering, process following, output formatting, file output, verbose modes), strace output (detailed information, argument values, return values, error codes, timing data), and tracer characteristics.

3. **ltrace (library call tracer)** includes ltrace overview (traces library calls, shows function calls, shows function arguments, shows return values, library-level tracing), ltrace usage (command tracing, process attachment, library filtering, function filtering, output formatting), ltrace options (library filtering, function filtering, process following, output formatting, file output), ltrace output (function-level detail, argument values, return values, library information, timing data), and tracer characteristics.

4. **Using strace/ltrace on Android** includes building for Android (AOSP build support, manual installation, device deployment, permission setup, tool availability), tracing Android processes (process identification, process attachment, output management, file output, remote tracing), and Android usage characteristics.

5. **Debugging workflows** include debugging system call issues (process identification, trace collection, issue reproduction, trace analysis, problem identification), performance analysis (timing analysis, call frequency, slow call identification, optimization guidance, performance improvement), and workflow characteristics.

6. **Advanced usage** includes filtering and analysis (call filtering, output filtering, statistical analysis, error detection, pattern matching), combining with other tools (multi-tool analysis, correlated data, comprehensive debugging, cross-tool insights, enhanced visibility), and advanced characteristics.

7. **Best practices** include best practices (use appropriate filters, save output to files, use timestamps for analysis, combine with other tools, analyze systematically), common use cases (debugging file access issues, analyzing network operations, identifying performance bottlenecks, security analysis, system behavior understanding), and practice guidelines.

8. **Understanding strace/ltrace** is essential for AOSP development, enabling system call tracing, native process debugging, performance analysis, security auditing, system behavior understanding, and proper debugging tool usage.

## Related Topics

- **Android Architecture - Complete Overview:** Architecture details
- **Debugging native crashes (tombstones):** Native crash debugging details

