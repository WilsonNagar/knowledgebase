---
number: 104
title: View system internals
slug: view-system-internals
level: intermediate
tags:
  - aosp
  - framework
  - view-system
  - view-hierarchy
  - ui-rendering
  - system-components
prerequisites:
  - system-server-overview
  - windowmanagerservice-wms
  - android-architecture-complete-overview
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-intermediate-104
---

# View system internals

## Overview

The View system is the core UI framework in Android that provides the building blocks for creating user interfaces, including Views, ViewGroups, layouts, drawing, event handling, and rendering. Understanding View system internals is essential for AOSP development, as it explains how views are created, how view hierarchies are managed, how views are measured and laid out, how views are drawn, how input events are handled, and how the View system integrates with the rendering pipeline. This guide provides a comprehensive overview of View system internals, architecture, view lifecycle, measurement and layout, drawing, event handling, and rendering.

Think of the View system like a construction system: just as a construction system provides building blocks (Views), ways to organize them (ViewGroups), rules for placement (layout), and methods for assembly (drawing), the View system provides Views (UI components), ViewGroups (containers), layouts (organization rules), and drawing mechanisms (rendering) to build Android user interfaces.

## Deep Explanation

### What is the View System?

The View system is the core UI framework in Android that provides the fundamental building blocks for creating user interfaces, including Views (individual UI components), ViewGroups (containers that hold other views), layouts (rules for organizing views), and drawing mechanisms (rendering views to screen).

**Key Characteristics:**
- **UI Framework:** Core UI building blocks
- **Hierarchical:** Tree structure of views
- **Event-Driven:** Handles input events
- **Rendering:** Draws views to screen
- **Framework Integration:** Integrated with framework

**Why View System?**
- **UI Building Blocks:** Provides UI components
- **Consistent API:** Standardized UI API
- **Performance:** Optimized rendering
- **Flexibility:** Customizable and extensible

### View System Architecture

#### Core Components

**View System Components:**
- **View:** Base class for all UI components
- **ViewGroup:** Container for views
- **Layout:** Rules for organizing views
- **Canvas:** Drawing surface
- **Paint:** Drawing attributes

**Component Hierarchy:**
```
View (base class)
├── ViewGroup (container)
│   ├── LinearLayout
│   ├── RelativeLayout
│   ├── FrameLayout
│   └── ConstraintLayout
└── Individual Views
    ├── TextView
    ├── Button
    ├── ImageView
    └── ...
```

### View Lifecycle

#### View Creation

**View Creation Process:**
```
1. View constructor called
2. View attributes initialized
3. View state initialized
4. View ready for use
```

**View Initialization:**
- Constructor parameters
- Attribute initialization
- State setup
- Resource loading

#### View Attachment

**Attachment Process:**
```
1. View added to ViewGroup
2. View.attach() called
3. View gets parent reference
4. View gets window reference
5. View ready for rendering
```

**Attachment Information:**
- Parent ViewGroup
- Window reference
- Context reference
- Resources

#### View Detachment

**Detachment Process:**
```
1. View removed from ViewGroup
2. View.detach() called
3. View loses parent reference
4. View loses window reference
5. View cleanup
```

**Detachment Cleanup:**
- Remove references
- Cancel animations
- Release resources
- Cleanup listeners

### Measurement and Layout

#### Measure Phase

**Measure Process:**
```
1. View.measure() called
2. View.onMeasure() called
3. View calculates desired size
4. View.setMeasuredDimension() called
5. Child views measured (if ViewGroup)
```

**Measure Specifications:**
- **EXACTLY:** Exact size specified
- **AT_MOST:** Maximum size specified
- **UNSPECIFIED:** No size constraint

**Measure Example:**
```java
@Override
protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
    int width = MeasureSpec.getSize(widthMeasureSpec);
    int height = MeasureSpec.getSize(heightMeasureSpec);
    setMeasuredDimension(width, height);
}
```

#### Layout Phase

**Layout Process:**
```
1. View.layout() called
2. View.onLayout() called
3. View position set
4. Child views laid out (if ViewGroup)
```

**Layout Coordinates:**
- Left, top, right, bottom
- Relative to parent
- Absolute positions
- Bounds calculation

**Layout Example:**
```java
@Override
protected void onLayout(boolean changed, int l, int t, int r, int b) {
    // Position child views
    for (int i = 0; i < getChildCount(); i++) {
        View child = getChildAt(i);
        child.layout(childLeft, childTop, childRight, childBottom);
    }
}
```

### Drawing

#### Draw Phase

**Draw Process:**
```
1. View.draw() called
2. Background drawn
3. View.onDraw() called
4. Children drawn (if ViewGroup)
5. Foreground drawn
6. Scrollbars drawn
```

**Draw Order:**
1. Draw background
2. Save canvas layer
3. Draw view content (onDraw)
4. Draw children
5. Draw fade effect
6. Restore canvas layer
7. Draw scrollbars

#### Canvas Operations

**Canvas Drawing:**
- Draw shapes
- Draw text
- Draw bitmaps
- Draw paths
- Apply transformations

**Drawing Operations:**
```java
@Override
protected void onDraw(Canvas canvas) {
    super.onDraw(canvas);
    canvas.drawRect(rect, paint);
    canvas.drawText(text, x, y, paint);
    canvas.drawBitmap(bitmap, x, y, paint);
}
```

### View Hierarchy

#### Hierarchy Structure

**View Tree:**
```
Activity (Window)
└── DecorView (Root)
    └── LinearLayout
        ├── StatusBar (SystemUI)
        └── FrameLayout (Content)
            └── Your View Hierarchy
                ├── ViewGroup
                │   ├── View
                │   └── View
                └── View
```

**Hierarchy Traversal:**
- Parent to child
- Depth-first traversal
- Measure, layout, draw phases
- Event propagation

#### ViewGroup Management

**ViewGroup Operations:**
- Add child views
- Remove child views
- Measure children
- Layout children
- Draw children

**Child Management:**
```java
// Add child
viewGroup.addView(childView);

// Remove child
viewGroup.removeView(childView);

// Get child
View child = viewGroup.getChildAt(index);
```

### Event Handling

#### Input Event Flow

**Event Propagation:**
```
Activity.dispatchTouchEvent()
    ↓
ViewGroup.dispatchTouchEvent()
    ↓
ViewGroup.onInterceptTouchEvent()
    ↓
View.dispatchTouchEvent()
    ↓
View.onTouchEvent()
```

**Event Handling:**
- Event received at root
- Event propagated down
- View can intercept
- View can consume
- Event propagation stops if consumed

#### Touch Event Handling

**Touch Event Types:**
- **ACTION_DOWN:** Touch started
- **ACTION_MOVE:** Touch moved
- **ACTION_UP:** Touch ended
- **ACTION_CANCEL:** Touch cancelled

**Touch Event Processing:**
```java
@Override
public boolean onTouchEvent(MotionEvent event) {
    switch (event.getAction()) {
        case MotionEvent.ACTION_DOWN:
            // Handle touch down
            return true;
        case MotionEvent.ACTION_MOVE:
            // Handle touch move
            return true;
        case MotionEvent.ACTION_UP:
            // Handle touch up
            return true;
    }
    return super.onTouchEvent(event);
}
```

### View State

#### View States

**View State Types:**
- **Enabled/Disabled:** View enabled state
- **Focused/Unfocused:** Focus state
- **Pressed/Unpressed:** Press state
- **Selected/Unselected:** Selection state

**State Management:**
- State flags
- State changes
- State callbacks
- State restoration

#### State Persistence

**State Saving:**
- Save view state
- Save instance state
- Save to Bundle
- Restore on recreation

**State Restoration:**
- Restore view state
- Restore instance state
- Restore from Bundle
- Restore on recreation

### View Invalidation

#### Invalidation Process

**Invalidation Flow:**
```
1. View.invalidate() called
2. View marked as dirty
3. Parent invalidated
4. View hierarchy marked
5. Next frame: View redrawn
```

**Invalidation Types:**
- **Invalidate:** Redraw view
- **Invalidate(Rect):** Redraw region
- **RequestLayout:** Remeasure and relayout
- **PostInvalidate:** Invalidate from non-UI thread

#### Redraw Optimization

**Optimization Strategies:**
- Clip drawing to dirty regions
- Skip invisible views
- Cache drawing operations
- Hardware acceleration

### Hardware Acceleration

#### Hardware Rendering

**Hardware Acceleration:**
- GPU rendering
- Faster drawing
- Better performance
- Reduced CPU load

**Hardware Acceleration Process:**
```
1. View drawing commands
2. Recorded to display list
3. Display list optimized
4. Rendered on GPU
5. Composited by SurfaceFlinger
```

**Benefits:**
- Faster rendering
- Better performance
- Smoother animations
- Lower CPU usage

### View Animation

#### Animation Types

**Animation Categories:**
- **Property Animation:** Animate properties
- **View Animation:** Animate views
- **Layout Animation:** Animate layout changes
- **Transition Animation:** Animate transitions

**Animation Framework:**
- Animator framework
- Interpolators
- Value animators
- Object animators

#### Animation Processing

**Animation Flow:**
```
1. Animation started
2. Animation values updated
3. View invalidated
4. View redrawn
5. Animation continues
6. Animation completes
```

### View System Integration

#### Framework Integration

**Integration Points:**
- **WindowManagerService:** Window management
- **ActivityManagerService:** Activity coordination
- **InputManagerService:** Input event handling
- **SurfaceFlinger:** Rendering

**Integration Flow:**
```
View System
    ↓
WindowManagerService
    ↓
SurfaceFlinger
    ↓
Display
```

### Debugging View System

#### Common Issues

**Development Issues:**
- Views not visible
- Layout issues
- Performance problems
- Event handling issues
- Drawing problems

#### Debugging Tools

**Layout Inspector:**
- View hierarchy inspection
- View properties
- Layout debugging
- Performance analysis

**Hierarchy Viewer:**
- View tree visualization
- Layout analysis
- Performance profiling
- Debugging tools

**Logcat:**
```bash
# Filter View system logs
adb logcat | grep ViewRootImpl

# Filter layout logs
adb logcat | grep "onMeasure\|onLayout\|onDraw"
```

## Key Takeaways

1. **View system** is the core UI framework providing Views (UI components), ViewGroups (containers), layouts (organization rules), and drawing mechanisms (rendering) for Android user interfaces.

2. **View system architecture** includes View (base class), ViewGroup (container), Layout (organization rules), Canvas (drawing surface), and Paint (drawing attributes).

3. **View lifecycle** involves view creation (constructor, initialization), view attachment (added to hierarchy), and view detachment (removed from hierarchy, cleanup).

4. **Measurement and layout** include measure phase (calculating desired size with MeasureSpec), layout phase (positioning views with coordinates), and child management (measuring and laying out children).

5. **Drawing** involves draw phase (background, content, children, foreground), canvas operations (drawing shapes, text, bitmaps), and draw order (background → content → children → foreground).

6. **View hierarchy** is a tree structure with parent-child relationships, hierarchy traversal (measure, layout, draw), and ViewGroup management (add, remove, measure, layout children).

7. **Event handling** includes input event flow (propagation from root to target), touch event handling (ACTION_DOWN, MOVE, UP, CANCEL), and event consumption (stopping propagation).

8. **View state** includes state types (enabled, focused, pressed, selected), state management (flags, changes, callbacks), and state persistence (save/restore).

9. **View invalidation** triggers redraws (marking views as dirty), optimization (clip regions, skip invisible views), and hardware acceleration (GPU rendering for better performance).

10. **View animation** includes animation types (property, view, layout, transition), animation framework (Animator, interpolators), and animation processing (value updates, invalidation, redraw).

11. **Understanding View system internals** is essential for AOSP development, explaining how Android builds user interfaces, how views are measured and laid out, how views are drawn, and how the View system integrates with the rendering pipeline.

## Related Topics

- **System Server Overview:** How View system fits into system architecture
- **WindowManagerService (WMS):** How View system windows are managed
- **Handler/Looper deep dive:** How View system uses Handler/Looper for UI updates
- **Android Architecture - Complete Overview:** How View system fits into overall architecture

