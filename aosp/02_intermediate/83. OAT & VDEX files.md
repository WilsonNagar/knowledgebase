---
number: 83
title: OAT & VDEX files
slug: oat-vdex-files
level: intermediate
tags:
  - aosp
  - art
  - oat
  - vdex
  - file-formats
  - compilation
  - dex
prerequisites:
  - dex2oat
  - aot-jit-compilation
estimated_minutes: 85
contributors: []
diagrams: []
examples: []
canonical_id: aosp-intermediate-83
---

# OAT & VDEX files

## Overview

OAT (Optimized Android Type) and VDEX (Verified DEX) files are ART's compilation output formats that store compiled native code and verified DEX bytecode respectively. Understanding OAT and VDEX files is essential for AOSP development, as it explains how Android stores compiled code, how DEX verification is optimized, how these files are structured, and how they impact app installation, startup, and storage. This guide provides a comprehensive overview of OAT and VDEX files, their formats, structure, creation process, and usage.

Think of OAT and VDEX files like different storage formats for processed food: OAT files are like pre-cooked meals (compiled native code) that are ready to eat immediately but take time to prepare and use more storage space. VDEX files are like pre-verified ingredients (verified DEX) that skip the verification step when cooking, making the cooking process faster. Together, they optimize the app execution process.

## Deep Explanation

### What are OAT and VDEX Files?

OAT and VDEX files are ART's output formats from the compilation and verification process, storing compiled native code and verified DEX bytecode respectively.

**Key Characteristics:**
- **OAT:** Contains compiled native code
- **VDEX:** Contains verified DEX bytecode
- **Generated:** Created by dex2oat
- **Stored:** Per-app in app directories

**Why OAT and VDEX?**
- **Performance:** Native code execution
- **Optimization:** Pre-verified DEX
- **Startup Speed:** Faster app startup
- **Storage Efficiency:** Optimized storage

### OAT Files

#### What is an OAT File?

OAT (Optimized Android Type) file is an ELF (Executable and Linkable Format) file that contains compiled native code generated from DEX bytecode by dex2oat.

**Key Characteristics:**
- **Format:** ELF format
- **Content:** Native machine code
- **Size:** Typically 2-3x DEX size
- **Architecture:** CPU-specific

**Why OAT?**
- **Native Execution:** Direct CPU execution
- **Performance:** Fast execution
- **Optimization:** Pre-optimized code
- **Efficiency:** No interpretation needed

#### OAT File Structure

**OAT File Layout:**
```
┌─────────────────────────────────┐
│      ELF Header                  │
│  - Magic number                 │
│  - Architecture                 │
│  - Entry point                  │
├─────────────────────────────────┤
│      OAT Header                  │
│  - OAT version                  │
│  - DEX file checksum            │
│  - Instruction set              │
├─────────────────────────────────┤
│      DEX File (optional)        │
│  - Original DEX bytecode        │
│  - For fallback execution       │
├─────────────────────────────────┤
│      Native Code Sections       │
│  - Compiled method code         │
│  - Architecture-specific        │
│  - Optimized instructions      │
├─────────────────────────────────┤
│      OAT Classes                │
│  - Class metadata               │
│  - Method information           │
│  - Field information            │
├─────────────────────────────────┤
│      OAT Methods                │
│  - Method code pointers         │
│  - Method metadata              │
│  - Optimization info           │
└─────────────────────────────────┘
```

**Components:**
- **ELF Header:** Standard ELF format header
- **OAT Header:** OAT-specific metadata
- **DEX File:** Optional original DEX
- **Native Code:** Compiled method code
- **Metadata:** Class and method information

#### OAT File Format

**ELF Format:**
- Standard ELF executable format
- Architecture-specific
- Loadable by system
- Contains native code

**OAT-Specific:**
- OAT magic number
- OAT version
- DEX file information
- Class and method metadata

**File Extension:**
- `.oat` - OAT file
- `.odex` - Legacy name (Optimized DEX)
- Both refer to same format

#### OAT File Creation

**Creation Process:**
```
1. DEX file input
2. dex2oat compilation
3. Native code generation
4. Optimization passes
5. OAT file writing
6. File stored
```

**Creation Location:**
- `/data/app/<package>/oat/<arch>/base.odex`
- Architecture-specific directory
- Per-app storage
- Created during installation

**Creation Time:**
- During app installation
- During first launch
- Background compilation
- Build time (system apps)

### VDEX Files

#### What is a VDEX File?

VDEX (Verified DEX) file contains pre-verified DEX bytecode, allowing ART to skip DEX verification on subsequent loads, improving startup performance.

**Key Characteristics:**
- **Format:** VDEX format
- **Content:** Verified DEX bytecode
- **Purpose:** Skip verification
- **Android 8.0+:** Introduced in Oreo

**Why VDEX?**
- **Faster Startup:** Skip verification
- **Performance:** Reduced startup time
- **Efficiency:** Pre-verified DEX
- **Optimization:** Verification done once

#### VDEX File Structure

**VDEX File Layout:**
```
┌─────────────────────────────────┐
│      VDEX Header                 │
│  - Magic number                 │
│  - Version                      │
│  - DEX file count               │
│  - Checksums                    │
├─────────────────────────────────┤
│      Verified DEX 1              │
│  - Pre-verified bytecode        │
│  - Verification metadata        │
├─────────────────────────────────┤
│      Verified DEX 2 (if multi)   │
│  - Additional DEX files         │
└─────────────────────────────────┘
```

**Components:**
- **VDEX Header:** Metadata and checksums
- **Verified DEX:** Pre-verified bytecode
- **Multi-DEX Support:** Multiple DEX files

#### VDEX File Format

**VDEX Format:**
- Custom VDEX format
- Contains verified DEX
- Includes checksums
- Verification metadata

**File Extension:**
- `.vdex` - VDEX file
- Stored with OAT
- Created together

#### VDEX File Creation

**Creation Process:**
```
1. DEX file input
2. DEX verification
3. Verification metadata
4. VDEX file writing
5. File stored
```

**Creation Location:**
- `/data/app/<package>/oat/<arch>/base.vdex`
- Same directory as OAT
- Created with OAT
- Stored together

**Creation Time:**
- During app installation
- During first launch
- With OAT creation
- Build time (system apps)

### OAT and VDEX Together

#### File Relationship

**Together:**
- OAT and VDEX created together
- Stored in same directory
- Used together at runtime
- Complementary formats

**OAT File:**
- Contains compiled native code
- For execution
- Architecture-specific
- Larger size

**VDEX File:**
- Contains verified DEX
- For fast loading
- Skip verification
- Smaller size

#### Runtime Usage

**Loading Process:**
```
1. Load VDEX file
2. Skip DEX verification (already verified)
3. Load OAT file
4. Map native code
5. Execute native code
```

**Fallback:**
- If OAT missing: Use DEX from VDEX
- If VDEX missing: Verify DEX on load
- If both missing: Use original DEX
- Graceful degradation

### File Locations

#### User Apps

**Location:**
```
/data/app/<package>-<hash>/oat/<arch>/
├── base.odex  (OAT file)
└── base.vdex  (VDEX file)
```

**Structure:**
- Per-app directory
- Architecture-specific subdirectory
- OAT and VDEX together
- Created during installation

#### System Apps

**Location:**
```
/system/app/<app>/oat/<arch>/
├── <app>.odex  (OAT file)
└── <app>.vdex  (VDEX file)
```

**Structure:**
- System partition
- Pre-compiled during build
- Read-only
- Optimized for performance

### File Sizes

#### Size Comparison

**DEX File:**
- Original bytecode
- Smallest size
- Example: 5MB

**OAT File:**
- Compiled native code
- 2-3x DEX size
- Example: 12-15MB

**VDEX File:**
- Verified DEX
- Similar to DEX size
- Example: 5-6MB

**Total:**
- DEX: 5MB
- OAT: 12MB
- VDEX: 5MB
- Total: ~22MB (vs 5MB DEX)

#### Size Factors

**OAT Size:**
- Native code size
- Optimization level
- Architecture
- Compiler filter

**VDEX Size:**
- DEX size
- Verification metadata
- Multi-DEX support
- Checksums

### File Inspection

#### Inspecting OAT Files

**oatdump Tool:**
```bash
# Dump OAT file information
oatdump --oat-file=base.odex

# Dump specific class
oatdump --oat-file=base.odex --class=MyClass

# Dump method code
oatdump --oat-file=base.odex --method=MyClass.myMethod
```

**Information:**
- OAT header information
- Class and method metadata
- Native code locations
- Optimization information

#### Inspecting VDEX Files

**vdex Tool:**
```bash
# Dump VDEX file information
vdex --vdex-file=base.vdex

# Extract DEX from VDEX
vdex --vdex-file=base.vdex --output=extracted.dex
```

**Information:**
- VDEX header information
- DEX file information
- Verification metadata
- Checksums

### File Management

#### File Creation

**Automatic:**
- Created during installation
- Created during first launch
- Background compilation
- System-managed

**Manual:**
```bash
# Compile manually
dex2oat --dex-file=app.dex --oat-file=app.oat
```

#### File Deletion

**When Deleted:**
- App uninstallation
- Cache clearing
- System update
- Manual deletion

**Recreation:**
- Recreated on next launch
- Recompiled if needed
- Automatic process
- System-managed

### Performance Impact

#### Startup Performance

**With OAT/VDEX:**
- Fast startup
- No DEX verification
- Native code ready
- Optimized loading

**Without OAT/VDEX:**
- Slower startup
- DEX verification needed
- Interpretation or JIT
- Slower loading

#### Storage Impact

**Storage Usage:**
- OAT files: 2-3x DEX size
- VDEX files: Similar to DEX
- Total: ~3-4x DEX size
- Trade-off for performance

**Storage Optimization:**
- Compiler filters
- Size optimization
- Selective compilation
- Storage vs performance

## Key Takeaways

1. **OAT (Optimized Android Type) files** are ELF-format files containing compiled native code generated from DEX bytecode by dex2oat, providing fast native execution.

2. **VDEX (Verified DEX) files** contain pre-verified DEX bytecode, allowing ART to skip DEX verification on subsequent loads, improving startup performance.

3. **OAT file structure** includes ELF header, OAT header, optional DEX file, native code sections, and class/method metadata, stored in architecture-specific directories.

4. **VDEX file structure** includes VDEX header with checksums and verified DEX bytecode, supporting multi-DEX and created together with OAT files.

5. **OAT and VDEX files** are created together during app installation or first launch, stored in the same directory, and used together at runtime for optimal performance.

6. **File sizes** show OAT files are 2-3x DEX size (native code), VDEX files are similar to DEX size, with total storage being ~3-4x DEX size as a trade-off for performance.

7. **File inspection** uses tools like `oatdump` for OAT files and `vdex` for VDEX files to examine structure, metadata, and contents.

8. **Understanding OAT and VDEX files** is essential for AOSP development, explaining how Android stores compiled code, optimizes DEX verification, and impacts app installation, startup, and storage usage.

## Related Topics

- **dex2oat:** Compiler that creates OAT files
- **AOT & JIT compilation:** Compilation strategies that produce OAT files
- **ART boot image & dex pre-optimization:** Build-time OAT creation
- **Dalvik vs ART:** Runtime evolution and file format changes

