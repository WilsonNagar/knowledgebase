---
number: 197
title: mkbootimg & unpackbootimg
slug: mkbootimg-unpackbootimg
level: intermediate
tags:
  - aosp
  - boot-image
  - mkbootimg
  - unpackbootimg
  - boot-tools
  - build-tools
prerequisites:
  - boot-partitions
  - building-boot-img-system-img-manually
  - boot-process-overview
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-intermediate-197
---

# mkbootimg & unpackbootimg

## Overview

mkbootimg and unpackbootimg are essential tools for creating and extracting Android boot images. mkbootimg combines kernel, ramdisk, device tree, and other components into a bootable boot.img file, while unpackbootimg extracts these components from an existing boot.img. Understanding mkbootimg and unpackbootimg is essential for AOSP development, as it explains how boot images are created, how to extract boot image components, how to modify boot images, and how these tools integrate with the Android build system. This guide provides a comprehensive overview of mkbootimg and unpackbootimg, boot image creation, boot image extraction, tool usage, boot image modification, and best practices.

Think of mkbootimg and unpackbootimg like packaging and unpackaging tools: just as you might use a packaging tool to combine multiple items into a single package and an unpackaging tool to extract items from a package, mkbootimg combines kernel, ramdisk, and device tree into a boot.img package, while unpackbootimg extracts these components from the package for analysis or modification.

## Deep Explanation

### What are mkbootimg & unpackbootimg?

mkbootimg and unpackbootimg are command-line tools for creating and extracting Android boot images. mkbootimg creates boot.img files from kernel, ramdisk, and device tree components, while unpackbootimg extracts these components from existing boot.img files.

**Key Characteristics:**
- **Boot Image Creation:** mkbootimg creates boot images
- **Boot Image Extraction:** unpackbootimg extracts boot images
- **Component Management:** Manages boot image components
- **Build Integration:** Integrated with AOSP build system
- **Development Tools:** Essential development tools

**Why mkbootimg & unpackbootimg?**
- **Boot Image Creation:** Create bootable images
- **Component Extraction:** Extract and analyze components
- **Image Modification:** Modify boot images
- **Development:** Essential for development
- **Debugging:** Debug boot issues

### mkbootimg Tool

#### Tool Overview

**mkbootimg:**
- Creates Android boot images
- Combines kernel, ramdisk, device tree
- Sets boot image parameters
- Generates bootable boot.img
- Part of AOSP build tools

**Tool Location:**
- `system/core/mkbootimg/` in AOSP
- Built during AOSP build
- Available in `out/host/linux-x86/bin/`
- Command-line tool

#### Basic Usage

**Basic Command:**
```bash
mkbootimg \
    --kernel Image.gz \
    --ramdisk ramdisk.cpio.gz \
    --dtb device.dtb \
    --base 0x80000000 \
    --pagesize 4096 \
    --output boot.img
```

**Command Parameters:**
- `--kernel` - Kernel image path
- `--ramdisk` - Ramdisk image path
- `--dtb` - Device tree blob path
- `--base` - Base address
- `--pagesize` - Page size
- `--output` - Output boot.img path

**Usage Characteristics:**
- Parameter specification
- Component paths
- Address configuration
- Output generation
- Boot image creation

#### Advanced Parameters

**Advanced Parameters:**
- `--kernel_offset` - Kernel load address offset
- `--ramdisk_offset` - Ramdisk load address offset
- `--dtb_offset` - Device tree load address offset
- `--tags_offset` - Tags address offset
- `--cmdline` - Kernel command line
- `--header_version` - Boot image header version
- `--os_version` - OS version
- `--os_patch_level` - OS patch level

**Advanced Usage:**
```bash
mkbootimg \
    --kernel Image.gz \
    --ramdisk ramdisk.cpio.gz \
    --dtb device.dtb \
    --base 0x80000000 \
    --pagesize 4096 \
    --kernel_offset 0x00008000 \
    --ramdisk_offset 0x01000000 \
    --dtb_offset 0x01f00000 \
    --tags_offset 0x00000100 \
    --cmdline "console=ttyMSM0,115200,n8 androidboot.hardware=qcom" \
    --header_version 3 \
    --os_version 14.0.0 \
    --os_patch_level 2024-01 \
    --output boot.img
```

**Advanced Characteristics:**
- Address specification
- Command line configuration
- Version information
- Header version selection
- Complete configuration

### unpackbootimg Tool

#### Tool Overview

**unpackbootimg:**
- Extracts components from boot images
- Decompresses kernel and ramdisk
- Extracts device tree
- Shows boot image information
- Part of AOSP build tools

**Tool Location:**
- `system/core/mkbootimg/` in AOSP
- Built during AOSP build
- Available in `out/host/linux-x86/bin/`
- Command-line tool

#### Basic Usage

**Basic Command:**
```bash
unpackbootimg -i boot.img -o output/
```

**Command Parameters:**
- `-i` - Input boot.img path
- `-o` - Output directory
- `-p` - Page size (optional)
- `-b` - Base address (optional)

**Output Structure:**
```
output/
├── boot.img-base
├── boot.img-cmdline
├── boot.img-dtb
├── boot.img-kernel
├── boot.img-ramdisk.cpio.gz
├── boot.img-ramdisk_offset
├── boot.img-second
├── boot.img-second_offset
├── boot.img-tags_offset
└── boot.img-zImage
```

**Usage Characteristics:**
- Image extraction
- Component separation
- Information extraction
- File generation
- Analysis support

#### Output Files

**Output Files:**
- `boot.img-kernel` - Extracted kernel
- `boot.img-ramdisk.cpio.gz` - Extracted ramdisk
- `boot.img-dtb` - Extracted device tree
- `boot.img-base` - Base address
- `boot.img-cmdline` - Kernel command line
- `boot.img-*_offset` - Address offsets

**File Usage:**
```bash
# Extract boot image
unpackbootimg -i boot.img -o boot_unpacked/

# View kernel
file boot_unpacked/boot.img-kernel

# Extract ramdisk
cd boot_unpacked/
mkdir ramdisk
cd ramdisk
gunzip -c ../boot.img-ramdisk.cpio.gz | cpio -i

# View device tree
file boot_unpacked/boot.img-dtb
```

**File Characteristics:**
- Component extraction
- Information files
- Address information
- Command line extraction
- Analysis support

### Boot Image Creation Workflow

#### Component Preparation

**Component Preparation:**
- Build kernel image
- Create ramdisk
- Compile device tree
- Prepare other components
- Verify components

**Preparation Steps:**
```bash
# Build kernel
cd kernel/
make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- defconfig
make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu-
# Result: arch/arm64/boot/Image.gz

# Create ramdisk
mkdir ramdisk
# ... populate ramdisk ...
find ramdisk | cpio -o -H newc | gzip > ramdisk.cpio.gz

# Compile device tree
dtc -I dts -O dtb -o device.dtb device.dts
```

**Preparation Characteristics:**
- Kernel compilation
- Ramdisk creation
- Device tree compilation
- Component verification
- Preparation workflow

#### Image Creation

**Image Creation:**
- Use mkbootimg
- Specify all components
- Set addresses
- Configure parameters
- Generate boot.img

**Creation Process:**
```bash
# Create boot image
mkbootimg \
    --kernel arch/arm64/boot/Image.gz \
    --ramdisk ramdisk.cpio.gz \
    --dtb device.dtb \
    --base 0x80000000 \
    --pagesize 4096 \
    --kernel_offset 0x00008000 \
    --ramdisk_offset 0x01000000 \
    --dtb_offset 0x01f00000 \
    --tags_offset 0x00000100 \
    --cmdline "console=ttyMSM0,115200,n8" \
    --output boot.img

# Verify boot image
file boot.img
ls -lh boot.img
```

**Creation Characteristics:**
- Component combination
- Parameter configuration
- Address setting
- Image generation
- Verification

### Boot Image Modification

#### Modification Workflow

**Modification Workflow:**
- Extract boot image
- Modify components
- Recreate boot image
- Verify modifications
- Test boot image

**Workflow Steps:**
```bash
# Step 1: Extract boot image
unpackbootimg -i boot.img -o boot_unpacked/

# Step 2: Extract ramdisk
cd boot_unpacked/
mkdir ramdisk
cd ramdisk
gunzip -c ../boot.img-ramdisk.cpio.gz | cpio -i

# Step 3: Modify ramdisk
# ... make modifications ...
# Edit init.rc, add files, etc.

# Step 4: Repackage ramdisk
find . | cpio -o -H newc | gzip > ../ramdisk_new.cpio.gz
cd ../..

# Step 5: Recreate boot image
mkbootimg \
    --kernel boot_unpacked/boot.img-kernel \
    --ramdisk boot_unpacked/ramdisk_new.cpio.gz \
    --dtb boot_unpacked/boot.img-dtb \
    --base $(cat boot_unpacked/boot.img-base) \
    --pagesize 4096 \
    --kernel_offset 0x00008000 \
    --ramdisk_offset 0x01000000 \
    --dtb_offset 0x01f00000 \
    --tags_offset $(cat boot_unpacked/boot.img-tags_offset) \
    --cmdline "$(cat boot_unpacked/boot.img-cmdline)" \
    --output boot_modified.img
```

**Workflow Characteristics:**
- Extraction process
- Modification support
- Repackaging
- Image recreation
- Verification

#### Common Modifications

**Common Modifications:**
- Modify init scripts
- Add custom binaries
- Change kernel command line
- Update device tree
- Customize boot behavior

**Modification Examples:**
- Edit init.rc for custom startup
- Add custom binaries to ramdisk
- Modify kernel parameters
- Update device tree configuration
- Customize boot sequence

### Build System Integration

#### AOSP Build Integration

**Build Integration:**
- Integrated with Android build system
- Automatic boot image creation
- Build-time configuration
- Device-specific settings
- Build output generation

**Build Process:**
```makefile
# Android.bp example
android_boot_image {
    name: "boot",
    base: "kernel",
    ramdisk: "ramdisk",
    dtb: "device_tree",
    cmdline: "console=ttyMSM0,115200,n8",
}
```

**Integration Characteristics:**
- Build system integration
- Automatic generation
- Configuration support
- Device customization
- Build output

### Best Practices

#### Best Practices

**Best Practices:**
- Use correct addresses for device
- Verify components before creation
- Test boot images thoroughly
- Document modifications
- Follow device specifications

**Practice Guidelines:**
- **Addresses:** Use correct addresses for device
- **Verification:** Verify components before creation
- **Testing:** Test boot images thoroughly
- **Documentation:** Document modifications
- **Specifications:** Follow device specifications

#### Common Issues

**Common Issues:**
- Wrong addresses
- Incorrect page size
- Missing components
- Corrupted images
- Boot failures

**Issue Solutions:**
- Check device specifications
- Verify address values
- Ensure all components present
- Validate image format
- Test on device

## Key Takeaways

1. **mkbootimg and unpackbootimg** are essential tools for creating and extracting Android boot images, with mkbootimg combining components into boot.img and unpackbootimg extracting components from boot.img.

2. **mkbootimg tool** includes tool overview (creates Android boot images, combines kernel, ramdisk, device tree, sets boot image parameters, generates bootable boot.img), basic usage (kernel, ramdisk, dtb, base, pagesize, output parameters), advanced parameters (address offsets, command line, header version, OS version, patch level), and tool characteristics.

3. **unpackbootimg tool** includes tool overview (extracts components from boot images, decompresses kernel and ramdisk, extracts device tree, shows boot image information), basic usage (input boot.img, output directory, page size, base address), output files (kernel, ramdisk, device tree, base address, command line, offsets), and tool characteristics.

4. **Boot image creation workflow** includes component preparation (build kernel image, create ramdisk, compile device tree, prepare other components, verify components), image creation (use mkbootimg, specify all components, set addresses, configure parameters, generate boot.img), and workflow characteristics.

5. **Boot image modification** includes modification workflow (extract boot image, modify components, recreate boot image, verify modifications, test boot image), common modifications (modify init scripts, add custom binaries, change kernel command line, update device tree, customize boot behavior), and modification characteristics.

6. **Build system integration** includes AOSP build integration (integrated with Android build system, automatic boot image creation, build-time configuration, device-specific settings, build output generation), and integration characteristics.

7. **Best practices** include best practices (use correct addresses for device, verify components before creation, test boot images thoroughly, document modifications, follow device specifications), common issues (wrong addresses, incorrect page size, missing components, corrupted images, boot failures), and practice guidelines.

8. **Understanding mkbootimg and unpackbootimg** is essential for AOSP development, enabling boot image creation, component extraction, boot image modification, development workflows, and proper boot image management.

## Related Topics

- **Boot Partitions:** Boot partition details
- **Building boot.img, system.img manually:** Manual build details
- **Boot Process Overview:** Boot process details

