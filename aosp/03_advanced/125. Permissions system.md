---
number: 125
title: Permissions system
slug: permissions-system
level: advanced
tags:
  - aosp
  - framework
  - permissions
  - permissions-system
  - security
  - access-control
prerequisites:
  - android-architecture-complete-overview
  - system-server-overview
  - packagemanagerservice
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-125
---

# Permissions system

## Overview

The Android permissions system is a comprehensive access control mechanism that protects user privacy and system resources by restricting access to sensitive functionality. The permissions system defines permission types, manages permission grants, enforces permission checks, and provides a framework for apps to request and use permissions. Understanding the permissions system is essential for AOSP development, as it explains how permissions are defined, how the permission model works, how permissions are enforced, how permission types are categorized, and how the system protects resources. This guide provides a comprehensive overview of the permissions system, permission types, permission model, permission enforcement, permission lifecycle, and system integration.

Think of the permissions system like a building security system: just as a building security system controls access to different areas (permissions), requires credentials (permission grants), and enforces access rules (permission checks), the Android permissions system controls access to system resources, requires permission grants, and enforces access control throughout the system.

## Deep Explanation

### What is the Permissions System?

The Android permissions system is a comprehensive access control mechanism that protects user privacy and system resources by restricting access to sensitive functionality. The permissions system defines permission types, manages permission grants, enforces permission checks, and provides a framework for apps to request and use permissions.

**Key Characteristics:**
- **Access Control:** Controls access to resources
- **Privacy Protection:** Protects user privacy
- **Security Enforcement:** Enforces security policies
- **User Control:** User controls permission grants
- **System Integration:** Integrated throughout system

**Why Permissions System?**
- **Privacy:** Protects user data and privacy
- **Security:** Prevents unauthorized access
- **Resource Protection:** Protects system resources
- **User Control:** Gives users control over app access

### Permissions System Architecture

#### System Components

**Permissions System Components:**
- **Permission Definitions:** Permission declarations
- **Permission Registry:** Registry of all permissions
- **Permission Manager:** Manages permission grants
- **Permission Enforcer:** Enforces permission checks
- **Permission UI:** User interface for permissions

**System Integration:**
- Integrated with PackageManagerService
- Integrated with system services
- Integrated with framework APIs
- Integrated with native components

#### Permission Flow

**Permission Flow:**
```
App Declares Permission → System Registers Permission → 
App Requests Permission → User Grants/Denies → 
Permission State Stored → Permission Checked on Use → 
Access Granted/Denied
```

### Permission Types

#### Normal Permissions

**Normal Permissions:**
- Automatically granted at install time
- No user interaction required
- Low risk to privacy or security
- Cannot be revoked by user

**Characteristics:**
- **Auto-Grant:** Granted automatically
- **No UI:** No permission dialog
- **Low Risk:** Minimal privacy impact
- **Persistent:** Cannot be revoked

**Examples:**
- `INTERNET`
- `ACCESS_NETWORK_STATE`
- `VIBRATE`
- `WAKE_LOCK`
- `RECEIVE_BOOT_COMPLETED`

#### Dangerous Permissions

**Dangerous Permissions:**
- Require runtime permission request
- User must approve
- High risk to privacy or security
- Can be revoked by user

**Characteristics:**
- **Runtime Request:** Must request at runtime
- **User Approval:** User must approve
- **High Risk:** Significant privacy impact
- **Revocable:** Can be revoked by user

**Examples:**
- `CAMERA`
- `READ_CONTACTS`
- `ACCESS_FINE_LOCATION`
- `READ_EXTERNAL_STORAGE`
- `RECORD_AUDIO`

#### Signature Permissions

**Signature Permissions:**
- Granted if app signed with same certificate
- System-level permissions
- Automatic grant for matching signatures
- Cannot be revoked

**Characteristics:**
- **Signature-Based:** Based on app signature
- **System Level:** System permissions
- **Auto-Grant:** Automatic for matching signatures
- **Persistent:** Cannot be revoked

**Examples:**
- System framework permissions
- Platform permissions
- Vendor permissions

#### Signature|Privileged Permissions

**Signature|Privileged Permissions:**
- Granted if app signed with platform certificate OR
- App is in privileged directory
- System-level permissions
- Automatic grant

**Characteristics:**
- **Dual Criteria:** Signature OR privileged location
- **System Level:** System permissions
- **Auto-Grant:** Automatic grant
- **Restricted:** Limited to system apps

### Permission Model

#### Install-Time Permissions

**Install-Time Model (Pre-Android 6.0):**
- All permissions granted at install
- User sees all permissions during install
- User approves all or none
- No runtime control

**Model Characteristics:**
- **All or Nothing:** All permissions or none
- **Install Time:** Granted at install
- **No Runtime Control:** No runtime changes
- **Legacy:** Pre-Android 6.0

#### Runtime Permissions

**Runtime Permission Model (Android 6.0+):**
- Dangerous permissions require runtime request
- User approves/denies at runtime
- Granular control per permission
- Can revoke at any time

**Model Characteristics:**
- **Runtime Request:** Request when needed
- **Granular Control:** Per-permission control
- **User Control:** User can revoke
- **Modern:** Android 6.0+

### Permission Groups

#### Permission Group Concept

**Permission Groups:**
- Group related permissions
- User grants group, not individual permissions
- Simplified user experience
- Group-based UI

**Group Characteristics:**
- **Related Permissions:** Group similar permissions
- **Group Grant:** Grant entire group
- **UI Simplification:** Simpler permission UI
- **User Experience:** Better UX

#### Common Permission Groups

**Permission Groups:**
- **CALENDAR:** Calendar read/write
- **CAMERA:** Camera access
- **CONTACTS:** Contacts read/write
- **LOCATION:** Location access
- **MICROPHONE:** Microphone access
- **PHONE:** Phone calls, SMS
- **SENSORS:** Body sensors
- **SMS:** SMS read/send
- **STORAGE:** Storage read/write

**Group Example:**
```
CALENDAR Group:
├── READ_CALENDAR
└── WRITE_CALENDAR

User grants CALENDAR → Both permissions granted
```

### Permission Declaration

#### Manifest Declaration

**Manifest Declaration:**
- Permissions declared in AndroidManifest.xml
- Required for all permissions
- Defines permission requirements
- System reads at install time

**Declaration Format:**
```xml
<manifest>
    <!-- Declare permission requirement -->
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-permission android:name="android.permission.READ_CONTACTS" />
    
    <!-- Declare custom permission -->
    <permission
        android:name="com.example.CUSTOM_PERMISSION"
        android:protectionLevel="dangerous"
        android:label="Custom Permission"
        android:description="Custom permission description" />
</manifest>
```

#### Protection Levels

**Protection Levels:**
- **normal:** Normal permission
- **dangerous:** Dangerous permission
- **signature:** Signature permission
- **signature|privileged:** Signature or privileged

**Protection Level Definition:**
```xml
<permission
    android:name="com.example.PERMISSION"
    android:protectionLevel="dangerous" />
```

### Permission Enforcement

#### Enforcement Points

**Enforcement Points:**
- Framework API calls
- System service calls
- Component access (activities, services)
- Resource access (files, network)

**Enforcement Mechanism:**
- Automatic enforcement
- Transparent to apps
- Consistent across system
- Security guaranteed

#### Framework Enforcement

**Framework Enforcement:**
- Framework APIs check permissions
- Automatic permission checks
- Security exceptions on denial
- Transparent enforcement

**Enforcement Example:**
```java
// Framework API enforces permission
public void startActivity(Intent intent) {
    // Check permission
    if (checkPermission(requiredPermission) != GRANTED) {
        throw new SecurityException("Permission required");
    }
    // Proceed with operation
}
```

#### System Service Enforcement

**Service Enforcement:**
- System services check permissions
- Query PermissionManager
- Enforce access control
- Return appropriate errors

**Service Enforcement Example:**
```java
// System service enforces permission
public void openCamera(String cameraId) {
    // Check camera permission
    if (checkPermission(CAMERA) != GRANTED) {
        throw new SecurityException("Camera permission required");
    }
    // Open camera
}
```

### Permission Lifecycle

#### Permission Lifecycle Stages

**Lifecycle Stages:**
1. **Declaration:** Permission declared in manifest
2. **Registration:** System registers permission
3. **Request:** App requests permission (if dangerous)
4. **Grant/Deny:** User grants or denies
5. **Storage:** Permission state stored
6. **Check:** Permission checked on use
7. **Revocation:** User can revoke (dangerous)

#### Permission State

**Permission States:**
- **GRANTED:** Permission granted
- **DENIED:** Permission denied
- **NOT_REQUESTED:** Not yet requested
- **REVOKED:** Permission revoked

**State Management:**
- State stored persistently
- State per user
- State per package
- State can change

### Permission Storage

#### Storage Location

**Storage:**
- `/data/system/packages.xml` - Package and permission data
- `/data/system/users/<user-id>/runtime-permissions.xml` - Runtime permissions
- Database storage for permission grants

**Storage Format:**
- XML format
- Per-user storage
- Per-package storage
- Persistent across reboots

#### Permission Data

**Permission Data:**
- Package name
- Permission name
- Grant state
- User ID
- Flags
- Timestamp

### System Integration

#### PackageManager Integration

**PackageManager Integration:**
- PackageManager reads permissions from manifest
- Registers permissions with system
- Manages permission state
- Coordinates with PermissionManager

**Integration Flow:**
```
Package Install → PackageManager Reads Manifest → 
Permissions Registered → Permission State Initialized
```

#### System Service Integration

**Service Integration:**
- Services check permissions
- Query PermissionManager
- Enforce access control
- Coordinate with permission system

**Integration Example:**
```java
// Service checks permission
public void performOperation() {
    // Check permission
    int result = mPermissionManager.checkPermission(
        permission, pid, uid);
    
    if (result != PERMISSION_GRANTED) {
        throw new SecurityException("Permission denied");
    }
    
    // Perform operation
}
```

### Permission Policies

#### Policy Types

**Permission Policies:**
- Grant policies
- Revoke policies
- Check policies
- Enforcement policies

**Policy Enforcement:**
- System-wide policies
- Per-app policies
- User preferences
- System restrictions

#### App Standby Impact

**App Standby:**
- Background apps restricted
- Permission access limited
- Battery optimization
- Permission behavior changes

### Debugging Permissions System

#### Debugging Tools

**Debugging Tools:**
- Permission dumps
- Package dumps
- Permission logs
- State inspection

**Debugging Commands:**
```bash
# Dump permission state
adb shell dumpsys package permissions

# Dump package permissions
adb shell dumpsys package <package-name> | grep permission

# Check permission grants
adb shell pm list permissions -g

# Grant/revoke permissions
adb shell pm grant <package> <permission>
adb shell pm revoke <package> <permission>
```

#### Common Issues

**Common Issues:**
- Permission not granted
- Permission check fails
- Permission state incorrect
- Permission not declared

**Debugging Steps:**
1. Check permission declaration
2. Verify permission state
3. Check permission logs
4. Review permission dumps
5. Verify system integration

## Key Takeaways

1. **Permissions system** is a comprehensive access control mechanism that protects user privacy and system resources by restricting access to sensitive functionality.

2. **Permissions system architecture** includes system components (permission definitions, registry, manager, enforcer, UI), system integration (PackageManager, system services, framework APIs), and permission flow (declare, register, request, grant, check, enforce).

3. **Permission types** include normal permissions (auto-granted, low risk), dangerous permissions (runtime request, high risk), signature permissions (signature-based, system level), and signature|privileged permissions (signature OR privileged location).

4. **Permission model** includes install-time permissions (pre-Android 6.0, all at install), runtime permissions (Android 6.0+, runtime request, granular control), and model evolution (from install-time to runtime).

5. **Permission groups** include permission group concept (group related permissions, group grant, simplified UI), common permission groups (CALENDAR, CAMERA, CONTACTS, LOCATION, etc.), and group-based granting (user grants group, all permissions in group granted).

6. **Permission declaration** includes manifest declaration (declared in AndroidManifest.xml, defines requirements), protection levels (normal, dangerous, signature, signature|privileged), and permission definition (name, protection level, label, description).

7. **Permission enforcement** includes enforcement points (framework APIs, system services, component access, resource access), framework enforcement (automatic checks, security exceptions), system service enforcement (services check permissions, enforce access control), and enforcement mechanism (automatic, transparent, consistent, secure).

8. **Permission lifecycle** includes lifecycle stages (declaration, registration, request, grant/deny, storage, check, revocation), permission state (GRANTED, DENIED, NOT_REQUESTED, REVOKED), and state management (persistent storage, per-user, per-package).

9. **Permission storage** includes storage location (/data/system/packages.xml, runtime-permissions.xml), storage format (XML format, per-user, per-package), and permission data (package name, permission name, grant state, user ID, flags).

10. **Understanding permissions system** is essential for AOSP development, enabling access control, privacy protection, security enforcement, and proper system resource management.

## Related Topics

- **Permissions service:** PermissionManagerService implementation
- **Runtime permissions:** Runtime permission model details
- **PackageManagerService:** Package and permission management
- **Android Security Model:** Overall security architecture

