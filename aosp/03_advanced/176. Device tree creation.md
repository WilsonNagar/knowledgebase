---
number: 176
title: Device tree creation
slug: device-tree-creation
level: advanced
tags:
  - aosp
  - device-tree
  - dts
  - dtb
  - hardware
  - kernel
  - device-porting
prerequisites:
  - device-tree-dt-dtb-dtbo
  - device-vendor-directory-structure
  - build-system-structure
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-176
---

# Device tree creation

## Overview

Device tree creation refers to the process of creating Device Tree Source (DTS) files that describe the hardware configuration of an Android device, enabling the kernel to discover and configure hardware without hardcoded information. Understanding device tree creation is essential for AOSP development, as it explains how to create device trees, how to describe hardware, how to configure devices, how device trees are structured, and how device trees enable device porting and customization. This guide provides a comprehensive overview of device tree creation, DTS file structure, hardware description, device configuration, build integration, and device tree best practices.

Think of device tree creation like writing a hardware specification document: just as a specification document describes all the components, connections, and configurations of a system, a device tree describes all the hardware components, their addresses, interrupts, and configurations of an Android device. The kernel reads this specification at boot time to understand what hardware exists and how to configure it.

## Deep Explanation

### What is Device Tree Creation?

Device tree creation refers to the process of creating Device Tree Source (DTS) files that describe the hardware configuration of an Android device, enabling the kernel to discover and configure hardware without hardcoded information.

**Key Characteristics:**
- **Hardware Description:** Describes all hardware
- **Text Format:** Human-readable DTS format
- **Compiled Format:** Compiled to binary DTB
- **Boot-Time Configuration:** Used at boot time
- **Platform-Agnostic:** Enables one kernel for multiple devices

**Why Device Tree Creation?**
- **Device Porting:** Enable device porting
- **Hardware Configuration:** Configure hardware
- **Kernel Flexibility:** One kernel, many devices
- **Maintainability:** Easier hardware changes

### Device Tree Structure

#### Basic DTS Structure

**DTS File Format:**
```dts
/dts-v1/;

/ {
    compatible = "vendor,device";
    model = "Device Name";
    
    // Hardware nodes
    cpus { ... };
    memory@80000000 { ... };
    serial@12340000 { ... };
};
```

**Structure Characteristics:**
- Version declaration
- Root node
- Compatible string
- Hardware nodes
- Hierarchical structure

#### Node Organization

**Node Types:**
- **Root Node:** `/` - Top-level node
- **CPU Nodes:** `cpus` - CPU configuration
- **Memory Nodes:** `memory@` - Memory configuration
- **Device Nodes:** Device-specific nodes
- **Bus Nodes:** Bus controllers (I2C, SPI, etc.)

**Organization Characteristics:**
- Hierarchical organization
- Node naming conventions
- Address-based naming
- Logical grouping

### Hardware Description

#### CPU Configuration

**CPU Node:**
```dts
cpus {
    #address-cells = <2>;
    #size-cells = <0>;
    
    cpu@0 {
        device_type = "cpu";
        compatible = "arm,cortex-a53";
        reg = <0x0 0x0>;
        enable-method = "psci";
    };
    
    cpu@1 {
        device_type = "cpu";
        compatible = "arm,cortex-a53";
        reg = <0x0 0x1>;
        enable-method = "psci";
    };
};
```

**CPU Characteristics:**
- CPU count
- CPU type
- CPU addresses
- Enable method

#### Memory Configuration

**Memory Node:**
```dts
memory@80000000 {
    device_type = "memory";
    reg = <0x80000000 0x40000000>;  /* 1GB */
};

memory@c0000000 {
    device_type = "memory";
    reg = <0xc0000000 0x40000000>;  /* 1GB */
};
```

**Memory Characteristics:**
- Memory regions
- Memory addresses
- Memory sizes
- Memory layout

#### Peripheral Configuration

**Peripheral Nodes:**
```dts
serial@12340000 {
    compatible = "vendor,serial";
    reg = <0x12340000 0x1000>;
    interrupts = <0 10 4>;
    clocks = <&uart_clock>;
    status = "okay";
};

gpio@12350000 {
    compatible = "vendor,gpio";
    reg = <0x12350000 0x1000>;
    interrupts = <0 11 4>;
    gpio-controller;
    #gpio-cells = <2>;
};
```

**Peripheral Characteristics:**
- Register addresses
- Interrupt specifications
- Clock references
- Status configuration

### Device Configuration

#### Compatible Strings

**Compatible Property:**
```dts
compatible = "vendor,device-model", "vendor,platform", "generic-platform";
```

**Compatible Characteristics:**
- Device identification
- Driver matching
- Fallback compatibility
- Platform support

#### Device Properties

**Common Properties:**
```dts
device@address {
    compatible = "vendor,device";
    reg = <address size>;
    interrupts = <irq type level>;
    clocks = <&clock_ref>;
    status = "okay";
    pinctrl-names = "default";
    pinctrl-0 = <&pin_config>;
};
```

**Property Types:**
- **compatible:** Device compatibility
- **reg:** Register addresses
- **interrupts:** Interrupt specifications
- **clocks:** Clock references
- **status:** Device status
- **pinctrl:** Pin control

### Android-Specific Configuration

#### Android Properties

**Android Node:**
```dts
/ {
    android {
        fstab {
            compatible = "android,fstab";
            vendor {
                compatible = "android,vendor";
                dev = "/dev/block/by-name/vendor";
                type = "ext4";
                mnt_flags = "ro,barrier=1";
                fsmgr_flags = "wait";
            };
        };
    };
};
```

**Android Characteristics:**
- Fstab configuration
- Partition mounting
- Android-specific properties
- System integration

#### Boot Configuration

**Chosen Node:**
```dts
chosen {
    bootargs = "console=ttyMSM0,115200 androidboot.serialno=ABC123";
    stdout-path = "serial0:115200n8";
};
```

**Boot Characteristics:**
- Boot arguments
- Console configuration
- Serial output
- Boot parameters

### Build Integration

#### Build System Integration

**Android.bp Integration:**
```blueprint
cc_prebuilt_binary {
    name: "dtc",
    srcs: ["dtc"],
}

genrule {
    name: "device_dtb",
    srcs: ["device.dts"],
    out: ["device.dtb"],
    cmd: "$(location dtc) -I dts -O dtb -o $(out) $(in)",
    tools: ["dtc"],
}
```

**Integration Characteristics:**
- Build system integration
- DTS to DTB compilation
- Boot image packaging
- Build automation

#### Kernel Build Integration

**Kernel Integration:**
```makefile
# In kernel Makefile
dtbs: device.dtb

device.dtb: device.dts
    $(DTC) -I dts -O dtb -o $@ $<
```

**Integration Process:**
- Kernel build system
- DTS compilation
- DTB generation
- Boot image inclusion

### Device Tree Best Practices

#### Best Practices

**Best Practices:**
- Use standard properties
- Follow naming conventions
- Document hardware
- Test thoroughly
- Maintain compatibility

**Practice Guidelines:**
- **Standards:** Use standard properties
- **Naming:** Follow naming conventions
- **Documentation:** Document hardware
- **Testing:** Test thoroughly
- **Compatibility:** Maintain compatibility

## Key Takeaways

1. **Device tree creation** refers to the process of creating Device Tree Source (DTS) files that describe the hardware configuration of an Android device, enabling the kernel to discover and configure hardware.

2. **Device tree structure** includes basic DTS structure (version declaration, root node, compatible string, hardware nodes, hierarchical structure), node organization (root node, CPU nodes, memory nodes, device nodes, bus nodes), and structure characteristics.

3. **Hardware description** includes CPU configuration (CPU count, CPU type, CPU addresses, enable method), memory configuration (memory regions, memory addresses, memory sizes, memory layout), peripheral configuration (register addresses, interrupt specifications, clock references, status configuration), and hardware characteristics.

4. **Device configuration** includes compatible strings (device identification, driver matching, fallback compatibility, platform support), device properties (compatible, reg, interrupts, clocks, status, pinctrl), and configuration characteristics.

5. **Android-specific configuration** includes Android properties (fstab configuration, partition mounting, Android-specific properties, system integration), boot configuration (boot arguments, console configuration, serial output, boot parameters), and Android characteristics.

6. **Build integration** includes build system integration (build system integration, DTS to DTB compilation, boot image packaging, build automation), kernel build integration (kernel build system, DTS compilation, DTB generation, boot image inclusion), and integration characteristics.

7. **Understanding device tree creation** is essential for AOSP development, enabling device porting, hardware configuration, kernel flexibility, and proper device tree implementation.

## Related Topics

- **Device Tree (DT, DTB, DTBO):** Device tree details
- **device/ vendor/ directory structure:** Directory structure details
- **Building the kernel:** Kernel building details

