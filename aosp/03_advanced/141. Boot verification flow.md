---
number: 141
title: Boot verification flow
slug: boot-verification-flow
level: advanced
tags:
  - aosp
  - security
  - verified-boot
  - boot-verification
  - verification-flow
  - chain-of-trust
  - avb
prerequisites:
  - verified-boot-avb
  - bootloader-chain
  - boot-process-overview
  - android-verified-boot-2-0-avb
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-141
---

# Boot verification flow

## Overview

Boot verification flow is the step-by-step process by which Android verifies the integrity and authenticity of boot components during the boot sequence. The boot verification flow establishes a chain of trust from hardware to the operating system, where each component verifies the next before passing control. Understanding boot verification flow is essential for AOSP development, as it explains how verification occurs at each stage, how the chain of trust is maintained, how verification failures are handled, and how the complete verification process works from power-on to system startup. This guide provides a comprehensive overview of boot verification flow, verification stages, verification steps, failure handling, and verification integration.

Think of boot verification flow like a security checkpoint sequence: just as travelers must pass through multiple security checkpoints where each checkpoint verifies credentials before allowing passage to the next, the boot verification flow has multiple verification stages where each stage verifies the next component before allowing boot to continue.

## Deep Explanation

### What is Boot Verification Flow?

Boot verification flow is the step-by-step process by which Android verifies the integrity and authenticity of boot components during the boot sequence. The boot verification flow establishes a chain of trust from hardware to the operating system, where each component verifies the next before passing control.

**Key Characteristics:**
- **Sequential:** Verification occurs sequentially
- **Chain of Trust:** Maintains unbroken chain of trust
- **Cryptographic:** Uses cryptographic verification
- **Fail-Safe:** Halts boot on verification failure
- **Progressive:** Progressive verification stages

**Why Boot Verification Flow?**
- **Security:** Ensures boot security
- **Integrity:** Verifies component integrity
- **Authenticity:** Verifies component authenticity
- **Trust:** Establishes trust in boot process

### Complete Verification Flow

#### Stage 1: Boot ROM Verification

**Boot ROM Verification:**
- Device powers on
- Boot ROM executes (hardware)
- Boot ROM loads bootloader
- Boot ROM verifies bootloader signature
- If valid: Execute bootloader
- If invalid: Halt boot

**Verification Steps:**
```
1. Device powers on
2. Boot ROM executes
3. Boot ROM loads bootloader from storage
4. Boot ROM reads bootloader signature
5. Boot ROM verifies signature with public key
6. If valid: Execute bootloader
7. If invalid: Halt boot or enter recovery
```

**Verification Details:**
- **Signature Verification:** Cryptographic signature verification
- **Public Key:** Boot ROM contains public key
- **Private Key:** Bootloader signed with private key
- **Fail-Safe:** Boot halted on failure

#### Stage 2: Bootloader Verification

**Bootloader Verification:**
- Bootloader executes (verified by Boot ROM)
- Bootloader loads kernel and ramdisk
- Bootloader reads AVB footer
- Bootloader verifies AVB footer signature
- Bootloader checks rollback index
- Bootloader verifies partition content
- If valid: Load kernel and ramdisk
- If invalid: Halt boot

**Verification Steps:**
```
1. Bootloader executes
2. Bootloader loads kernel partition
3. Bootloader reads AVB footer
4. Bootloader verifies AVB footer signature
5. Bootloader checks rollback index
6. Bootloader extracts hash/hashtree
7. Bootloader verifies partition content
8. If valid: Load kernel and ramdisk
9. If invalid: Halt boot
```

**Verification Details:**
- **AVB Footer:** Contains verification metadata
- **Signature Verification:** Verify footer signature
- **Rollback Check:** Check rollback index
- **Content Verification:** Verify partition content

#### Stage 3: Kernel Verification

**Kernel Verification:**
- Kernel executes (verified by bootloader)
- Kernel mounts system partitions
- Kernel sets up dm-verity
- Kernel verifies partition integrity
- If valid: Continue boot
- If invalid: Halt boot or show error

**Verification Steps:**
```
1. Kernel executes
2. Kernel mounts system partition
3. Kernel sets up dm-verity
4. Kernel verifies hash tree
5. Runtime verification on read
6. If invalid: I/O error
```

**Verification Details:**
- **dm-verity:** Device mapper verity
- **Hash Tree:** Merkle tree verification
- **Runtime Verification:** Verification on read
- **Block-Level:** Block-level verification

### Verification Process Details

#### Cryptographic Verification

**Cryptographic Verification:**
- Uses cryptographic signatures
- Public/private key pairs
- Signature verification at each stage
- Prevents unauthorized modifications

**Verification Mechanism:**
- **Signing:** Components signed with private key
- **Verification:** Verified with public key
- **Integrity:** Ensures component integrity
- **Authenticity:** Verifies component authenticity

#### Hash Verification

**Hash Verification:**
- Uses cryptographic hashes
- Hash comparison for integrity
- Hash tree for large partitions
- Block-level verification

**Verification Mechanism:**
- **Hash Calculation:** Calculate hash of content
- **Hash Comparison:** Compare with stored hash
- **Hash Tree:** Merkle tree for large partitions
- **Block Verification:** Verify individual blocks

### Verification Failure Handling

#### Failure Detection

**Failure Detection:**
- Verification failures detected immediately
- Failures logged for debugging
- Failures prevent boot continuation
- Failures trigger recovery mode

**Failure Characteristics:**
- **Immediate:** Detected immediately
- **Logged:** Logged for debugging
- **Preventive:** Prevents boot continuation
- **Recovery:** Triggers recovery mode

#### Failure Responses

**Failure Responses:**
- **Halt Boot:** Boot process halted
- **Recovery Mode:** Enter recovery mode
- **Error Display:** Show error message
- **Logging:** Log failure details

**Response Options:**
- **Halt:** Stop boot process
- **Recovery:** Enter recovery mode
- **Error:** Display error to user
- **Log:** Log failure for debugging

### Verification Flow Diagram

#### Complete Flow

**Complete Verification Flow:**
```
Power On
   ↓
Boot ROM Executes
   ↓
Boot ROM Verifies Bootloader
   ├─ Signature Valid? → Yes → Continue
   └─ Signature Invalid? → No → Halt Boot
   ↓
Bootloader Executes
   ↓
Bootloader Verifies Kernel
   ├─ AVB Footer Valid? → Yes → Continue
   ├─ Rollback Index OK? → Yes → Continue
   ├─ Content Valid? → Yes → Continue
   └─ Any Invalid? → No → Halt Boot
   ↓
Kernel Executes
   ↓
Kernel Sets Up dm-verity
   ↓
Kernel Verifies System Partition
   ├─ Hash Tree Valid? → Yes → Continue
   └─ Hash Tree Invalid? → No → I/O Error
   ↓
Android System Starts
```

### Verification Timing

#### Verification Timing

**Verification Timing:**
- Verification occurs at each stage
- Verification before execution
- Verification during boot
- Runtime verification for partitions

**Timing Characteristics:**
- **Stage-Based:** Verification at each stage
- **Pre-Execution:** Verify before execution
- **Boot-Time:** Verification during boot
- **Runtime:** Runtime verification for partitions

### Verification Integration

#### AVB Integration

**AVB Integration:**
- Boot verification flow integrates with AVB
- AVB provides verification framework
- AVB footers contain verification data
- AVB enables standardized verification

**Integration Points:**
- **AVB Footer:** Contains verification metadata
- **AVB Descriptors:** Define verification method
- **AVB Hash Tree:** Enables block-level verification
- **AVB Rollback:** Provides rollback protection

#### Bootloader Integration

**Bootloader Integration:**
- Bootloader performs verification
- Bootloader reads AVB footers
- Bootloader verifies signatures
- Bootloader checks rollback indexes

**Integration Points:**
- **Footer Reading:** Read AVB footers
- **Signature Verification:** Verify signatures
- **Rollback Check:** Check rollback indexes
- **Content Verification:** Verify partition content

### Verification Modes

#### Enforcing Mode

**Enforcing Mode:**
- Verification enforced
- Boot halted on failure
- Production mode
- Maximum security

**Mode Characteristics:**
- **Enforced:** Verification enforced
- **Fail-Safe:** Boot halted on failure
- **Production:** Production mode
- **Security:** Maximum security

#### Permissive Mode

**Permissive Mode:**
- Verification logged but not enforced
- Boot continues on failure
- Development mode
- Debugging enabled

**Mode Characteristics:**
- **Logged:** Violations logged
- **Permissive:** Boot continues on failure
- **Development:** Development mode
- **Debugging:** Debugging enabled

### Verification Best Practices

#### Best Practices

**Best Practices:**
- Always verify all components
- Use cryptographic signatures
- Check rollback indexes
- Handle failures gracefully

**Practice Guidelines:**
- **Comprehensive:** Verify all components
- **Cryptographic:** Use cryptographic signatures
- **Rollback:** Check rollback indexes
- **Error Handling:** Handle failures gracefully

### Debugging Boot Verification

#### Debugging Tools

**Debugging Tools:**
- Boot logs
- AVB status commands
- Verification logs
- Error messages

**Debugging Commands:**
```bash
# Check AVB status
fastboot getvar vbmeta

# View boot logs
adb shell dmesg | grep avb

# Check verification status
adb shell getprop ro.boot.verifiedbootstate
```

#### Common Issues

**Common Issues:**
- Verification failures
- Signature verification failures
- Rollback index mismatches
- Missing AVB footers

**Debugging Steps:**
1. Check AVB status
2. Review boot logs
3. Verify AVB footers
4. Check rollback indexes
5. Verify signatures

## Key Takeaways

1. **Boot verification flow** is the step-by-step process by which Android verifies the integrity and authenticity of boot components during the boot sequence, establishing a chain of trust from hardware to the operating system.

2. **Complete verification flow** includes stage 1: Boot ROM verification (device powers on, Boot ROM executes, Boot ROM verifies bootloader signature), stage 2: Bootloader verification (bootloader executes, bootloader verifies kernel with AVB, bootloader checks rollback index), stage 3: Kernel verification (kernel executes, kernel sets up dm-verity, kernel verifies system partition), and verification steps.

3. **Verification process details** include cryptographic verification (uses cryptographic signatures, public/private key pairs, signature verification at each stage), hash verification (uses cryptographic hashes, hash comparison for integrity, hash tree for large partitions), and verification mechanisms.

4. **Verification failure handling** includes failure detection (verification failures detected immediately, failures logged for debugging, failures prevent boot continuation), failure responses (halt boot, recovery mode, error display, logging), and response options.

5. **Verification flow diagram** includes complete flow (Power On → Boot ROM → Bootloader → Kernel → Android System), verification at each stage, and flow characteristics.

6. **Verification timing** includes verification timing (verification occurs at each stage, verification before execution, verification during boot, runtime verification for partitions), timing characteristics, and timing details.

7. **Verification integration** includes AVB integration (boot verification flow integrates with AVB, AVB provides verification framework, AVB footers contain verification data), bootloader integration (bootloader performs verification, bootloader reads AVB footers, bootloader verifies signatures), and integration points.

8. **Verification modes** include enforcing mode (verification enforced, boot halted on failure, production mode), permissive mode (verification logged but not enforced, boot continues on failure, development mode), and mode characteristics.

9. **Understanding boot verification flow** is essential for AOSP development, enabling boot security understanding, verification process comprehension, failure handling, and proper boot verification flow implementation.

## Related Topics

- **Verified Boot (AVB):** Verified boot details
- **Bootloader chain:** Bootloader chain details
- **rollback index:** Rollback index details
- **dm-verity:** Device mapper verity

