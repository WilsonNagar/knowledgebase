---
number: 183
title: Signing ROM builds
slug: signing-rom-builds
level: advanced
tags:
  - aosp
  - rom
  - signing
  - certificates
  - security
  - build-signing
prerequisites:
  - ota-packages-creation
  - verified-boot-avb
  - build-system-structure
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-183
---

# Signing ROM builds

## Overview

Signing ROM builds refers to the process of cryptographically signing Android ROM images and packages to ensure their authenticity, integrity, and security. Understanding how to sign ROM builds is essential for AOSP development, as it explains how to create signing keys, how to sign ROM images, how to sign OTA packages, how signature verification works, and how signing ensures ROM security. This guide provides a comprehensive overview of signing ROM builds, signing keys, signing process, signature verification, key management, and signing best practices.

Think of signing ROM builds like notarizing important documents: just as a notary's signature verifies that a document is authentic and hasn't been tampered with, cryptographic signatures on ROM builds verify that the ROM is authentic, comes from a trusted source, and hasn't been modified. This prevents malicious or corrupted ROMs from being installed on devices.

## Deep Explanation

### What is Signing ROM Builds?

Signing ROM builds refers to the process of cryptographically signing Android ROM images and packages to ensure their authenticity, integrity, and security. Signing verifies that ROMs are from trusted sources and haven't been tampered with.

**Key Characteristics:**
- **Cryptographic Signing:** Digital signatures
- **Authenticity:** Verify source
- **Integrity:** Verify content
- **Security:** Prevent tampering
- **Verification:** Signature verification

**Why Sign ROM Builds?**
- **Security:** Ensure ROM security
- **Authenticity:** Verify ROM source
- **Integrity:** Verify ROM integrity
- **Trust:** Establish trust
- **Distribution:** Enable secure distribution

### Signing Keys

#### Key Types

**Signing Key Types:**
- **Test Keys:** Development keys
- **Release Keys:** Production keys
- **Platform Keys:** Platform signing
- **Shared Keys:** Shared components
- **Media Keys:** Media components

**Key Characteristics:**
- Public/private key pairs
- Cryptographic keys
- Key storage
- Key security
- Key management

#### Key Generation

**Key Generation:**
```bash
# Generate RSA key pair
openssl genrsa -out private_key.pem 2048

# Extract public key
openssl rsa -in private_key.pem -pubout -out public_key.pem

# Convert to Android format
openssl pkcs8 -topk8 -outform DER -in private_key.pem \
    -inform PEM -out private_key.pk8 -nocrypt

openssl req -new -x509 -key private_key.pem \
    -out certificate.pem -days 10000
```

**Generation Process:**
- Generate key pair
- Extract public key
- Convert to Android format
- Create certificate
- Store keys securely

### Signing Process

#### ROM Image Signing

**Image Signing:**
```bash
# Sign boot image with AVB
avbtool add_hash_footer \
    --image boot.img \
    --partition_name boot \
    --partition_size 67108864 \
    --key keys/test_key.pem \
    --algorithm SHA256_RSA2048

# Sign system image
avbtool add_hashtree_footer \
    --image system.img \
    --partition_name system \
    --partition_size 3221225472 \
    --key keys/test_key.pem \
    --algorithm SHA256_RSA2048
```

**Signing Characteristics:**
- AVB signing
- Hash/hashtree footer
- Partition signing
- Key-based signing
- Algorithm selection

#### OTA Package Signing

**OTA Signing:**
```bash
# Sign OTA package
java -jar signapk.jar \
    certificate.pem \
    private_key.pk8 \
    unsigned_ota.zip \
    signed_ota.zip
```

**Signing Process:**
```
1. Create OTA package
2. Sign with private key
3. Add signature to package
4. Verify signature
5. Distribute signed package
```

**Signing Characteristics:**
- Package signing
- Signature addition
- Integrity verification
- Distribution ready
- Security assurance

### Signature Verification

#### Verification Process

**Verification Steps:**
```
1. Extract signature from package
2. Calculate package hash
3. Decrypt signature with public key
4. Compare hash with decrypted signature
5. Accept if match, reject otherwise
```

**Verification Characteristics:**
- Signature extraction
- Hash calculation
- Public key verification
- Hash comparison
- Acceptance/rejection

#### Boot Verification

**Boot Verification:**
- Bootloader verifies signatures
- Kernel signature verification
- System partition verification
- Recovery signature verification
- Chain of trust

**Verification Flow:**
```
Boot ROM → Verifies Bootloader
Bootloader → Verifies Kernel
Kernel → Verifies System Partition
System → Verifies Recovery
```

### Key Management

#### Key Storage

**Key Storage:**
- Private keys: Secure storage
- Public keys: In bootloader/ROM
- Key protection: Encryption
- Key backup: Secure backup
- Key rotation: Key updates

**Storage Characteristics:**
- Secure private key storage
- Public key distribution
- Key protection
- Backup strategy
- Rotation planning

#### Key Security

**Security Measures:**
- Private key protection
- Key encryption
- Access control
- Key access control
- Security monitoring

**Security Characteristics:**
- Strong protection
- Encryption
- Access control
- Monitoring
- Security practices

### Build System Integration

#### Automatic Signing

**Build Integration:**
```makefile
# In BoardConfig.mk
PRODUCT_DEFAULT_DEV_CERTIFICATE := \
    build/target/product/security/testkey

# Or release key
PRODUCT_DEFAULT_DEV_CERTIFICATE := \
    vendor/keys/releasekey
```

**Integration Characteristics:**
- Build system integration
- Automatic signing
- Key configuration
- Signing automation
- Build output signing

#### Signing Configuration

**Configuration Methods:**
- Build system configuration
- Key path specification
- Algorithm selection
- Signing options
- Verification settings

**Configuration Characteristics:**
- Build configuration
- Key paths
- Algorithm settings
- Signing options
- Verification config

### Signing Best Practices

#### Best Practices

**Best Practices:**
- Use strong keys
- Protect private keys
- Use separate keys for production
- Test signing process
- Verify signatures

**Practice Guidelines:**
- **Keys:** Use strong keys
- **Protection:** Protect private keys
- **Separation:** Use separate keys for production
- **Testing:** Test signing process
- **Verification:** Verify signatures

## Key Takeaways

1. **Signing ROM builds** refers to the process of cryptographically signing Android ROM images and packages to ensure their authenticity, integrity, and security.

2. **Signing keys** include key types (test keys, release keys, platform keys, shared keys, media keys), key generation (generate key pair, extract public key, convert to Android format, create certificate, store keys securely), and key characteristics.

3. **Signing process** includes ROM image signing (AVB signing, hash/hashtree footer, partition signing, key-based signing, algorithm selection), OTA package signing (package signing, signature addition, integrity verification, distribution ready, security assurance), and signing characteristics.

4. **Signature verification** includes verification process (signature extraction, hash calculation, public key verification, hash comparison, acceptance/rejection), boot verification (bootloader verifies signatures, kernel signature verification, system partition verification, recovery signature verification, chain of trust), and verification characteristics.

5. **Key management** includes key storage (private keys secure storage, public keys in bootloader/ROM, key protection, key backup, key rotation), key security (private key protection, key encryption, key access control, security monitoring), and management characteristics.

6. **Build system integration** includes automatic signing (build system integration, automatic signing, key configuration, signing automation, build output signing), signing configuration (build configuration, key paths, algorithm settings, signing options, verification config), and integration characteristics.

7. **Understanding signing ROM builds** is essential for AOSP development, enabling ROM security, authenticity verification, integrity assurance, trust establishment, and proper ROM signing implementation.

## Related Topics

- **OTA packages creation:** OTA package details
- **Verified Boot (AVB):** AVB details
- **Boot verification flow:** Verification details

