---
number: 128
title: Manifest permissions
slug: manifest-permissions
level: advanced
tags:
  - aosp
  - framework
  - permissions
  - manifest
  - androidmanifest
  - permission-declaration
prerequisites:
  - permissions-system
  - packagemanagerservice
  - android-architecture-complete-overview
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-128
---

# Manifest permissions

## Overview

Manifest permissions refers to how permissions are declared and defined in the AndroidManifest.xml file, including permission declarations, permission definitions, protection levels, permission groups, and how the system processes manifest permissions. Understanding manifest permissions is essential for AOSP development, as it explains how permissions are declared in manifests, how permission definitions work, how protection levels are specified, how the system reads and processes manifest permissions, and how manifest permissions integrate with the permissions system. This guide provides a comprehensive overview of manifest permissions, permission declaration, permission definition, protection levels, permission processing, and system integration.

Think of manifest permissions like a building's access requirements list: just as a building might have a list of access requirements (permissions) that visitors must meet (declared in manifest), manifest permissions declare what permissions an app needs (uses-permission) and what permissions an app can grant to others (permission definition), defining the app's permission requirements and capabilities.

## Deep Explanation

### What are Manifest Permissions?

Manifest permissions refers to how permissions are declared and defined in the AndroidManifest.xml file. Apps declare permission requirements using `<uses-permission>` and can define custom permissions using `<permission>`. The system reads these declarations at install time and registers them with the permissions system.

**Key Characteristics:**
- **Manifest Declaration:** Declared in AndroidManifest.xml
- **Install-Time Processing:** Processed at install time
- **Permission Requirements:** Declares what permissions app needs
- **Custom Permissions:** Can define custom permissions
- **System Integration:** Integrated with permissions system

**Why Manifest Permissions?**
- **Declaration:** Declare permission requirements
- **Documentation:** Document permission needs
- **Custom Permissions:** Define app-specific permissions
- **System Integration:** System reads and processes

### Permission Declaration

#### Uses-Permission

**Uses-Permission:**
- Declares permission requirement
- App needs this permission
- System grants if appropriate
- Required for permission use

**Declaration Format:**
```xml
<manifest>
    <!-- Declare permission requirement -->
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-permission android:name="android.permission.READ_CONTACTS" />
    <uses-permission android:name="android.permission.INTERNET" />
</manifest>
```

**Declaration Characteristics:**
- **Permission Name:** Full permission name
- **Required:** App needs this permission
- **Install-Time:** Processed at install
- **System Processing:** System reads and processes

#### Permission Requirements

**Permission Requirements:**
- App must declare permissions it uses
- System validates declarations
- Permissions registered with system
- App can use declared permissions

**Requirement Types:**
- **Normal Permissions:** Auto-granted
- **Dangerous Permissions:** Runtime request
- **Signature Permissions:** Signature-based grant
- **Special Permissions:** Special handling

### Permission Definition

#### Custom Permission Definition

**Custom Permission:**
- App can define custom permissions
- Other apps can request
- Protection level specified
- Permission metadata provided

**Definition Format:**
```xml
<manifest>
    <!-- Define custom permission -->
    <permission
        android:name="com.example.CUSTOM_PERMISSION"
        android:protectionLevel="dangerous"
        android:label="Custom Permission"
        android:description="Custom permission description"
        android:permissionGroup="com.example.PERMISSION_GROUP"
        android:icon="@drawable/permission_icon" />
</manifest>
```

**Definition Attributes:**
- **name:** Permission name (required)
- **protectionLevel:** Protection level (required)
- **label:** User-visible label
- **description:** User-visible description
- **permissionGroup:** Permission group
- **icon:** Permission icon

#### Protection Levels

**Protection Levels:**
- **normal:** Normal permission
- **dangerous:** Dangerous permission
- **signature:** Signature permission
- **signature|privileged:** Signature or privileged

**Protection Level Definition:**
```xml
<permission
    android:name="com.example.PERMISSION"
    android:protectionLevel="dangerous" />
```

**Protection Level Characteristics:**
- **normal:** Auto-granted, low risk
- **dangerous:** Runtime request, high risk
- **signature:** Signature-based, system level
- **signature|privileged:** Signature OR privileged location

### Permission Processing

#### Install-Time Processing

**Processing Flow:**
```
1. Package installed
2. PackageManager reads AndroidManifest.xml
3. PackageManager extracts permissions
4. Permissions registered with system
5. Permission state initialized
6. App can use permissions
```

**Processing Steps:**
1. **Manifest Parsing:** Parse AndroidManifest.xml
2. **Permission Extraction:** Extract permission declarations
3. **Permission Registration:** Register with PermissionManager
4. **State Initialization:** Initialize permission state
5. **Grant Processing:** Process permission grants

#### Permission Registration

**Registration Process:**
- Permissions registered with PermissionManager
- Permission metadata stored
- Permission state initialized
- System ready for checks

**Registration Example:**
```java
// Permission registration
void registerPermissions(PackageInfo pkgInfo) {
    // Register uses-permission
    for (String permission : pkgInfo.requestedPermissions) {
        registerPermissionRequirement(pkgInfo.packageName, permission);
    }
    
    // Register custom permissions
    for (PermissionInfo permission : pkgInfo.permissions) {
        registerPermissionDefinition(permission);
    }
}
```

### Permission Groups

#### Permission Group Declaration

**Permission Group:**
- Groups related permissions
- Defined in manifest
- Used for UI organization
- Simplifies user experience

**Group Definition:**
```xml
<permission-group
    android:name="com.example.PERMISSION_GROUP"
    android:label="My Permission Group"
    android:description="Group description"
    android:icon="@drawable/group_icon" />
```

**Group Usage:**
```xml
<permission
    android:name="com.example.READ_DATA"
    android:permissionGroup="com.example.PERMISSION_GROUP"
    android:protectionLevel="dangerous" />
```

### System Permissions

#### System Permission Definition

**System Permissions:**
- Defined by system
- In framework manifest
- Available to all apps
- System-level permissions

**System Permission Location:**
- `frameworks/base/core/res/AndroidManifest.xml`
- System permission definitions
- Framework permissions
- Platform permissions

**System Permission Example:**
```xml
<!-- System permission definition -->
<permission
    android:name="android.permission.CAMERA"
    android:protectionLevel="dangerous"
    android:permissionGroup="android.permission-group.CAMERA"
    android:label="@string/permlab_camera"
    android:description="@string/permdesc_camera" />
```

### Permission Attributes

#### Permission Attributes

**Permission Attributes:**
- **name:** Permission name (required)
- **protectionLevel:** Protection level (required)
- **label:** User-visible label
- **description:** User-visible description
- **permissionGroup:** Permission group
- **icon:** Permission icon
- **priority:** Permission priority

**Attribute Usage:**
```xml
<permission
    android:name="com.example.PERMISSION"
    android:protectionLevel="dangerous"
    android:label="Permission Label"
    android:description="Permission Description"
    android:permissionGroup="com.example.GROUP"
    android:icon="@drawable/icon"
    android:priority="100" />
```

### Permission Processing Details

#### Manifest Parsing

**Manifest Parsing:**
- PackageManager parses manifest
- Extracts permission declarations
- Extracts permission definitions
- Validates permission syntax

**Parsing Process:**
```java
// Manifest parsing
void parseManifest(File manifestFile) {
    // Parse XML
    XmlResourceParser parser = getParser(manifestFile);
    
    // Extract permissions
    while (parser.next() != XmlPullParser.END_DOCUMENT) {
        if (parser.getName().equals("uses-permission")) {
            String permission = parser.getAttributeValue(null, "name");
            addPermissionRequirement(permission);
        } else if (parser.getName().equals("permission")) {
            PermissionInfo permission = parsePermission(parser);
            addPermissionDefinition(permission);
        }
    }
}
```

#### Permission Validation

**Permission Validation:**
- Validate permission names
- Validate protection levels
- Validate permission attributes
- Check permission conflicts

**Validation Process:**
```java
// Permission validation
boolean validatePermission(PermissionInfo permission) {
    // Validate name
    if (permission.name == null || permission.name.isEmpty()) {
        return false;
    }
    
    // Validate protection level
    if (!isValidProtectionLevel(permission.protectionLevel)) {
        return false;
    }
    
    // Check conflicts
    if (permissionExists(permission.name)) {
        return false; // Conflict
    }
    
    return true;
}
```

### Permission Inheritance

#### Permission Inheritance

**Inheritance:**
- Child components inherit permissions
- Activity inherits from application
- Service inherits from application
- Receiver inherits from application

**Inheritance Rules:**
- Application-level permissions apply to all components
- Component-level permissions override application
- System checks both levels
- Most restrictive applies

### Permission Best Practices

#### Declaration Best Practices

**Best Practices:**
- Declare only needed permissions
- Use appropriate protection levels
- Provide clear descriptions
- Group related permissions

**Good Practice:**
```xml
<!-- GOOD: Only declare needed permissions -->
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.INTERNET" />

<!-- BAD: Declare unnecessary permissions -->
<uses-permission android:name="android.permission.READ_CONTACTS" />
<!-- Not actually used -->
```

### System Integration

#### PackageManager Integration

**PackageManager Integration:**
- PackageManager reads manifest
- Extracts permissions
- Registers with PermissionManager
- Manages permission state

**Integration Flow:**
```
Package Install → PackageManager Reads Manifest → 
Extract Permissions → Register with PermissionManager → 
Initialize Permission State
```

#### PermissionManager Integration

**PermissionManager Integration:**
- PermissionManager receives permissions
- Stores permission definitions
- Manages permission state
- Coordinates with PackageManager

### Debugging Manifest Permissions

#### Debugging Tools

**Debugging Tools:**
- Manifest inspection
- Permission dumps
- Package dumps
- Permission logs

**Debugging Commands:**
```bash
# Dump package permissions
adb shell dumpsys package <package-name> | grep permission

# List declared permissions
adb shell dumpsys package <package-name> | grep "uses-permission"

# Check permission definitions
adb shell dumpsys package permissions | grep <permission-name>

# Inspect manifest
aapt dump permissions <apk-file>
```

#### Common Issues

**Common Issues:**
- Permission not declared
- Permission not granted
- Custom permission conflicts
- Protection level issues

**Debugging Steps:**
1. Check manifest declarations
2. Verify permission names
3. Check protection levels
4. Review permission dumps
5. Verify system registration

## Key Takeaways

1. **Manifest permissions** refers to how permissions are declared and defined in AndroidManifest.xml, including permission declarations, permission definitions, and system processing.

2. **Permission declaration** includes uses-permission (declares permission requirement, app needs permission, system grants if appropriate), permission requirements (app must declare permissions, system validates, permissions registered), and declaration format (full permission name, required, install-time processing).

3. **Permission definition** includes custom permission definition (app can define custom permissions, other apps can request, protection level specified), definition attributes (name, protectionLevel, label, description, permissionGroup, icon), and definition format.

4. **Protection levels** include protection levels (normal, dangerous, signature, signature|privileged), protection level definition (specified in manifest, determines grant behavior), and protection level characteristics (normal: auto-granted, dangerous: runtime request, signature: signature-based, signature|privileged: signature OR privileged).

5. **Permission processing** includes install-time processing (package installed, manifest parsed, permissions extracted, registered with system, state initialized), permission registration (registered with PermissionManager, metadata stored, state initialized), and processing flow.

6. **Permission groups** include permission group declaration (groups related permissions, defined in manifest, used for UI organization), group definition (name, label, description, icon), and group usage (permissions reference group).

7. **System permissions** include system permission definition (defined by system, in framework manifest, available to all apps), system permission location (frameworks/base/core/res/AndroidManifest.xml), and system permission examples.

8. **Permission attributes** include permission attributes (name, protectionLevel, label, description, permissionGroup, icon, priority), attribute usage (specify in manifest, provide metadata), and attribute characteristics.

9. **Permission processing details** include manifest parsing (PackageManager parses, extracts declarations and definitions, validates syntax), permission validation (validate names, protection levels, attributes, check conflicts), and processing implementation.

10. **Understanding manifest permissions** is essential for AOSP development, enabling proper permission declaration, custom permission definition, system integration, and correct permission processing.

## Related Topics

- **Permissions system:** Overall permissions system architecture
- **Permissions service:** PermissionManagerService implementation
- **PackageManagerService:** Package and permission management
- **Runtime permissions:** Runtime permission model

