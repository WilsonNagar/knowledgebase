---
number: 119
title: Telephony services
slug: telephony-services
level: advanced
tags:
  - aosp
  - framework
  - telephony
  - phone
  - calls
  - sms
  - telephony-framework
prerequisites:
  - system-server-overview
  - binder-ipc-basics
  - android-architecture-complete-overview
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-119
---

# Telephony services

## Overview

Telephony services are system services responsible for managing phone calls, SMS, cellular data, and telephony-related functionality in Android. Telephony services coordinate with the radio interface layer (RIL), manage call state, handle SMS operations, manage cellular network connectivity, and provide telephony information to applications. Understanding telephony services is essential for AOSP development, as it explains how phone calls are managed, how SMS is handled, how cellular connectivity works, how telephony state is tracked, and how the telephony framework operates. This guide provides a comprehensive overview of telephony services, architecture, call management, SMS management, cellular network management, telephony state tracking, and debugging.

Think of telephony services like a telephone exchange: just as a telephone exchange manages phone calls (call management), handles messages (SMS), manages connections (cellular network), and tracks system state (telephony state), telephony services manage phone calls, handle SMS, manage cellular connectivity, and track telephony state in Android.

## Deep Explanation

### What are Telephony Services?

Telephony services are system services responsible for managing phone calls, SMS, cellular data, and telephony-related functionality in Android. Telephony services coordinate with the radio interface layer (RIL), manage call state, handle SMS operations, and provide telephony information to applications.

**Key Characteristics:**
- **Call Management:** Manages phone calls
- **SMS Management:** Handles SMS operations
- **Cellular Network:** Manages cellular connectivity
- **State Tracking:** Tracks telephony state
- **RIL Coordination:** Coordinates with radio interface

**Why Telephony Services?**
- **Centralized Management:** Single point for telephony management
- **State Coordination:** Coordinates telephony state across system
- **RIL Abstraction:** Abstracts radio interface complexity
- **Application Interface:** Provides telephony APIs to apps

### Telephony Services Architecture

#### Service Organization

**Telephony Services:**
- **TelephonyRegistry:** Telephony state registry
- **PhoneService:** Phone call management
- **SmsService:** SMS management
- **TelephonyManager:** Telephony information provider

**Service Location:**
- Some services in SystemServer
- Some services in separate processes
- RIL in separate process
- Services coordinate via Binder

#### Service Processes

**Service Processes:**
```
SystemServer Process:
├── TelephonyRegistry
└── PhoneService

rild Process:
└── Radio Interface Layer (RIL)
```

### Call Management

#### Call State

**Call State:**
- **IDLE:** No active call
- **DIALING:** Dialing number
- **ALERTING:** Call alerting
- **INCOMING:** Incoming call
- **ACTIVE:** Call active
- **HOLDING:** Call on hold
- **DISCONNECTING:** Call disconnecting
- **DISCONNECTED:** Call disconnected

**Call State Management:**
```java
// Call state
enum CallState {
    IDLE,
    DIALING,
    ALERTING,
    INCOMING,
    ACTIVE,
    HOLDING,
    DISCONNECTING,
    DISCONNECTED
}

// Track call state
void trackCallState(Call call, CallState state) {
    mCallStates.put(call, state);
    notifyCallStateChange(call, state);
}
```

#### Call Operations

**Call Operations:**
- **Dial:** Initiate phone call
- **Answer:** Answer incoming call
- **Hangup:** End phone call
- **Hold:** Put call on hold
- **Resume:** Resume held call
- **Swap:** Swap between calls

**Call Operation Flow:**
```
1. App requests call operation
2. Telephony service receives request
3. Telephony service validates request
4. Telephony service sends to RIL
5. RIL communicates with modem
6. Modem executes operation
7. State updated
8. App notified
```

#### Call Management

**Call Management:**
- Track active calls
- Manage call state
- Handle call events
- Coordinate with RIL

**Call Management Example:**
```java
// Call management
class CallManager {
    private List<Call> mActiveCalls = new ArrayList<>();
    
    void dial(String number) {
        // Create call
        Call call = new Call(number);
        mActiveCalls.add(call);
        
        // Update state
        call.setState(CallState.DIALING);
        
        // Send to RIL
        ril.dial(number);
    }
    
    void answer(Call call) {
        // Update state
        call.setState(CallState.ACTIVE);
        
        // Send to RIL
        ril.answer();
    }
    
    void hangup(Call call) {
        // Update state
        call.setState(CallState.DISCONNECTING);
        
        // Send to RIL
        ril.hangup();
        
        // Remove call
        mActiveCalls.remove(call);
    }
}
```

### SMS Management

#### SMS Operations

**SMS Operations:**
- **Send SMS:** Send text message
- **Receive SMS:** Receive text message
- **Delete SMS:** Delete text message
- **Query SMS:** Query SMS messages

**SMS Operation Flow:**
```
1. App requests SMS operation
2. Telephony service receives request
3. Telephony service validates request
4. Telephony service sends to RIL
5. RIL communicates with modem
6. Modem executes operation
7. Result returned
8. App notified
```

#### SMS Sending

**SMS Sending:**
```java
// Send SMS
void sendSms(String destination, String message) {
    // Create SMS
    SmsMessage sms = new SmsMessage(destination, message);
    
    // Validate
    if (!validateSms(sms)) {
        return;
    }
    
    // Send to RIL
    ril.sendSms(sms);
    
    // Track SMS
    trackSms(sms);
}
```

#### SMS Receiving

**SMS Receiving:**
```java
// Receive SMS
void onSmsReceived(SmsMessage sms) {
    // Process SMS
    processSms(sms);
    
    // Store SMS
    storeSms(sms);
    
    // Notify apps
    notifySmsReceived(sms);
}
```

### Cellular Network Management

#### Network Registration

**Network Registration:**
- Register with cellular network
- Track registration state
- Handle registration changes
- Coordinate with ConnectivityService

**Registration States:**
- **NOT_REGISTERED:** Not registered
- **REGISTERING:** Registering
- **REGISTERED:** Registered
- **DENIED:** Registration denied

#### Network State

**Network State:**
- **NETWORK_STATE_UNKNOWN:** Unknown state
- **NETWORK_STATE_AVAILABLE:** Network available
- **NETWORK_STATE_CURRENT:** Current network
- **NETWORK_STATE_FORBIDDEN:** Network forbidden

**Network State Management:**
```java
// Network state
enum NetworkState {
    UNKNOWN,
    AVAILABLE,
    CURRENT,
    FORBIDDEN
}

// Track network state
void trackNetworkState(Network network, NetworkState state) {
    mNetworkStates.put(network, state);
    notifyNetworkStateChange(network, state);
}
```

### Telephony State Tracking

#### Telephony State

**Telephony State:**
- Call state
- Data connection state
- Service state
- Signal strength
- Network type

**State Tracking:**
```java
// Telephony state
class TelephonyState {
    CallState callState;
    DataConnectionState dataState;
    ServiceState serviceState;
    int signalStrength;
    int networkType;
}

// Track telephony state
void trackTelephonyState(TelephonyState state) {
    mTelephonyState = state;
    notifyTelephonyStateChange(state);
}
```

#### State Listeners

**State Listeners:**
- Apps register for state changes
- Listeners notified on state changes
- Multiple listeners supported
- State changes broadcast

**Listener Registration:**
```java
// Register state listener
TelephonyManager tm = (TelephonyManager) context.getSystemService(
    Context.TELEPHONY_SERVICE);

PhoneStateListener listener = new PhoneStateListener() {
    @Override
    public void onCallStateChanged(int state, String phoneNumber) {
        // Call state changed
    }
    
    @Override
    public void onDataConnectionStateChanged(int state) {
        // Data connection state changed
    }
    
    @Override
    public void onSignalStrengthChanged(int strength) {
        // Signal strength changed
    }
};

tm.listen(listener, PhoneStateListener.LISTEN_CALL_STATE |
                      PhoneStateListener.LISTEN_DATA_CONNECTION_STATE |
                      PhoneStateListener.LISTEN_SIGNAL_STRENGTHS);
```

### Radio Interface Layer (RIL)

#### RIL Overview

**RIL (Radio Interface Layer):**
- Abstraction layer for modem
- Communicates with cellular modem
- Handles radio commands
- Manages radio state

**RIL Responsibilities:**
- Send commands to modem
- Receive responses from modem
- Handle unsolicited responses
- Manage radio state

#### RIL Communication

**RIL Communication:**
- Commands sent to RIL
- RIL sends to modem
- Modem responds
- RIL notifies services

**Communication Flow:**
```
App → Telephony Service → RIL → Modem
                          ↓
App ← Telephony Service ← RIL ← Modem
```

### Telephony Information

#### Device Information

**Device Information:**
- Phone number
- IMEI (International Mobile Equipment Identity)
- IMSI (International Mobile Subscriber Identity)
- SIM card information
- Network operator information

**Information Retrieval:**
```java
// Get device information
TelephonyManager tm = (TelephonyManager) context.getSystemService(
    Context.TELEPHONY_SERVICE);

String phoneNumber = tm.getLine1Number();
String imei = tm.getDeviceId();
String imsi = tm.getSubscriberId();
String operator = tm.getNetworkOperatorName();
```

#### Network Information

**Network Information:**
- Network operator
- Network type
- Signal strength
- Roaming status
- Data connection state

**Network Information Retrieval:**
```java
// Get network information
String operator = tm.getNetworkOperatorName();
int networkType = tm.getNetworkType();
int signalStrength = tm.getSignalStrength();
boolean isRoaming = tm.isNetworkRoaming();
int dataState = tm.getDataState();
```

### Telephony Permissions

#### Required Permissions

**Telephony Permissions:**
- **READ_PHONE_STATE:** Read phone state
- **CALL_PHONE:** Make phone calls
- **SEND_SMS:** Send SMS
- **RECEIVE_SMS:** Receive SMS
- **READ_SMS:** Read SMS

**Permission Enforcement:**
```java
// Check permission
if (checkPermission(Manifest.permission.READ_PHONE_STATE)) {
    // Access phone state
    String phoneNumber = tm.getLine1Number();
} else {
    // Permission denied
    requestPermission(Manifest.permission.READ_PHONE_STATE);
}
```

### Debugging Telephony Services

#### Service Dumps

**Dump Telephony Service State:**
```bash
# Dump telephony service state
adb shell dumpsys telephony.registry

# Dump phone service state
adb shell dumpsys phone

# Dump SMS service state
adb shell dumpsys isms
```

#### Telephony Logs

**Telephony Service Logs:**
```bash
# Telephony service logs
adb logcat | grep TelephonyRegistry

# Phone service logs
adb logcat | grep PhoneService

# RIL logs
adb logcat | grep RIL
```

#### Common Issues

**Common Issues:**
- Calls not working
- SMS not sending/receiving
- Network not connecting
- State not updating

**Debugging Steps:**
1. Check telephony service logs
2. Verify RIL communication
3. Check telephony state
4. Review permissions
5. Check modem communication

## Key Takeaways

1. **Telephony services** are system services managing phone calls, SMS, cellular data, and telephony-related functionality, coordinating with RIL and providing telephony APIs.

2. **Telephony services architecture** includes service organization (TelephonyRegistry, PhoneService, SmsService, TelephonyManager), service location (SystemServer, separate processes), and service processes (SystemServer, rild).

3. **Call management** includes call state (IDLE, DIALING, ALERTING, INCOMING, ACTIVE, HOLDING, DISCONNECTING, DISCONNECTED), call operations (dial, answer, hangup, hold, resume, swap), and call management (track calls, manage state, handle events).

4. **SMS management** includes SMS operations (send, receive, delete, query), SMS sending (create SMS, validate, send to RIL), and SMS receiving (process SMS, store, notify apps).

5. **Cellular network management** includes network registration (register with network, track state), network state (UNKNOWN, AVAILABLE, CURRENT, FORBIDDEN), and network state management (track state, notify changes).

6. **Telephony state tracking** includes telephony state (call state, data state, service state, signal strength, network type), state listeners (apps register, listeners notified), and state tracking (track state, notify changes).

7. **Radio Interface Layer (RIL)** includes RIL overview (abstraction layer for modem), RIL communication (commands to modem, responses from modem), and RIL responsibilities (send commands, receive responses, manage state).

8. **Telephony information** includes device information (phone number, IMEI, IMSI, SIM info), network information (operator, network type, signal strength, roaming), and information retrieval (via TelephonyManager).

9. **Telephony permissions** include required permissions (READ_PHONE_STATE, CALL_PHONE, SEND_SMS, RECEIVE_SMS, READ_SMS), permission enforcement (check permissions, request if needed), and permission management.

10. **Understanding telephony services** is essential for AOSP development, enabling call management, SMS handling, cellular network management, and telephony state tracking.

## Related Topics

- **System Server Overview:** How system services are organized
- **ConnectivityService:** Network connectivity management
- **Binder IPC Basics:** How telephony services communicate
- **Service lifecycle:** How services go through lifecycle phases

