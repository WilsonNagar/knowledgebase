---
number: 164
title: Treble architecture
slug: treble-architecture
level: advanced
tags:
  - aosp
  - treble
  - architecture
  - system-vendor-separation
  - modularization
prerequisites:
  - android-architecture-complete-overview
  - binderized-services
  - vendor-interface-object
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-164
---

# Treble architecture

## Overview

Treble architecture refers to Project Treble, Android's modular architecture that separates the Android framework from vendor-specific implementations, enabling independent updates of the framework and vendor code. Treble architecture introduces clear interface boundaries between system and vendor, uses Binder IPC for communication, and enables faster Android updates and better vendor/system isolation. Understanding Treble architecture is essential for AOSP development, as it explains how system and vendor are separated, how interfaces are defined, how Binder IPC enables separation, how Treble enables framework updates, and how Treble architecture improves Android's modularity. This guide provides a comprehensive overview of Treble architecture, system/vendor separation, interface definitions, Binder IPC usage, update mechanisms, and Treble benefits.

Think of Treble architecture like a standardized electrical outlet system: just as electrical outlets provide a standard interface (Treble interfaces) that allows any device (vendor implementation) to plug into any outlet (framework) as long as it follows the standard (interface contract), Treble provides standard interfaces that allow any vendor implementation to work with any framework version as long as it follows the interface contract.

## Deep Explanation

### What is Treble Architecture?

Treble architecture refers to Project Treble, Android's modular architecture that separates the Android framework from vendor-specific implementations, enabling independent updates of the framework and vendor code. Treble introduces clear interface boundaries and standardized communication.

**Key Characteristics:**
- **System/Vendor Separation:** Clear separation of system and vendor
- **Interface-Based:** Interface-based communication
- **Binder IPC:** Binder IPC for communication
- **Independent Updates:** Framework and vendor can update independently
- **Modularity:** Improved system modularity

**Why Treble Architecture?**
- **Faster Updates:** Enable faster Android updates
- **Vendor Isolation:** Isolate vendor code from framework
- **Framework Updates:** Enable framework-only updates
- **Compatibility:** Better compatibility testing

### Project Treble Goals

#### Problem Before Treble

**Pre-Treble Issues:**
- Framework and HAL tightly coupled
- Framework updates required HAL updates
- Slow security updates
- Difficult to support new Android versions
- Vendor code mixed with framework

**Coupling Problems:**
- Framework changes broke vendor code
- Vendor changes broke framework
- Updates required coordination
- Slow update delivery
- Compatibility issues

#### Treble Solution

**Treble Solution:**
- Clear interface boundaries
- System/vendor separation
- Interface versioning
- Binder IPC communication
- Independent update paths

**Solution Benefits:**
- Framework can update independently
- Vendor can update independently
- Faster security updates
- Easier Android version support
- Better compatibility

### System/Vendor Separation

#### Partition Separation

**Partition Structure:**
- **System Partition:** Framework code
- **Vendor Partition:** Vendor code
- **Separate Mounts:** Separate filesystems
- **Isolation:** Process and file system isolation

**Partition Layout:**
```
/system          - Framework code
/vendor          - Vendor code
/system/lib      - Framework libraries
/vendor/lib      - Vendor libraries
```

#### Process Separation

**Process Separation:**
- Framework services in system process
- Vendor HALs in vendor processes
- Binder IPC communication
- Process isolation

**Process Architecture:**
```
[System Process]          [Vendor Process]
├── Framework Services    ├── Vendor HALs
└── System Services       └── Vendor Services
    (Binder IPC)              (Binder IPC)
```

### Interface Boundaries

#### HAL Interfaces

**HAL Interface Types:**
- **HIDL Interfaces:** HIDL-based interfaces (deprecated)
- **AIDL Interfaces:** AIDL-based interfaces (modern)
- **Versioned Interfaces:** Interface versioning
- **Stable Interfaces:** Stable API contracts

**Interface Characteristics:**
- Clear interface definitions
- Versioned interfaces
- Backward compatibility
- Forward compatibility (within limits)

#### Interface Definition

**HIDL Interface (Legacy):**
```cpp
// android.hardware.example@1.0::IExample
interface IExample {
    method1(int32_t param) generates (Result result);
    method2() generates (Status status);
};
```

**AIDL Interface (Modern):**
```aidl
// IExample.aidl
package android.hardware.example;
interface IExample {
    Result method1(int param);
    Status method2();
}
```

### Binder IPC Communication

#### Binderized HALs

**Binderized HALs:**
- HALs run in separate processes
- Binder IPC communication
- Vendor/system separation
- Treble compliance

**Binderization Benefits:**
- Process isolation
- Independent updates
- Better security
- Clear boundaries

#### Communication Flow

**Communication Flow:**
```
Framework Service
    │
    │ Binder IPC
    │
    ▼
HAL Interface (Proxy)
    │
    │ Binder Transaction
    │
    ▼
HAL Implementation (Stub)
    │
    │ Hardware Access
    │
    ▼
Hardware
```

### Treble Architecture Components

#### Framework Side

**Framework Components:**
- Android Framework
- Framework services
- HAL client libraries
- Interface proxies

**Framework Responsibilities:**
- Framework functionality
- Application APIs
- System services
- HAL client implementation

#### Vendor Side

**Vendor Components:**
- Vendor HAL implementations
- Vendor services
- Hardware-specific code
- Vendor libraries

**Vendor Responsibilities:**
- HAL implementation
- Hardware abstraction
- Vendor-specific features
- Hardware integration

### Interface Versioning

#### Version Management

**Version Management:**
- Interface versions
- Backward compatibility
- Version negotiation
- Deprecation handling

**Version Strategy:**
- Major versions: Breaking changes
- Minor versions: Additive changes
- Version negotiation
- Compatibility matrix

#### Compatibility

**Compatibility:**
- Framework-vendor compatibility
- Interface version compatibility
- Backward compatibility
- Forward compatibility

**Compatibility Testing:**
- VTS (Vendor Test Suite)
- Compatibility verification
- Interface testing
- Integration testing

### Update Mechanisms

#### Framework Updates

**Framework Updates:**
- Framework can update independently
- No vendor changes required
- Security updates
- Feature updates

**Update Process:**
```
1. Framework update available
2. Framework updates
3. Vendor interfaces remain compatible
4. System continues working
```

#### Vendor Updates

**Vendor Updates:**
- Vendor can update independently
- No framework changes required
- HAL updates
- Vendor feature updates

**Update Process:**
```
1. Vendor update available
2. Vendor updates
3. Framework interfaces remain compatible
4. System continues working
```

### Treble Benefits

#### Faster Updates

**Update Benefits:**
- Framework updates without vendor
- Vendor updates without framework
- Faster security patches
- Easier Android version upgrades

**Update Speed:**
- Reduced coordination needed
- Independent update paths
- Faster delivery
- Better update coverage

#### Better Isolation

**Isolation Benefits:**
- Process isolation
- File system isolation
- Security isolation
- Code isolation

**Isolation Characteristics:**
- Vendor code separate
- Framework code separate
- Clear boundaries
- Better security

### Treble Compliance

#### Compliance Requirements

**Compliance Requirements:**
- Binderized HALs
- Interface compliance
- VTS passing
- Manifest compliance

**Compliance Verification:**
- VTS testing
- Interface verification
- Manifest validation
- Compatibility checks

#### VTS Testing

**VTS (Vendor Test Suite):**
- Automated testing
- Interface compliance
- Compatibility verification
- Regression testing

**VTS Benefits:**
- Automated compliance checking
- Interface validation
- Compatibility verification
- Quality assurance

### Treble Architecture Best Practices

#### Best Practices

**Best Practices:**
- Use stable interfaces
- Follow interface contracts
- Maintain compatibility
- Test with VTS
- Document interfaces

**Practice Guidelines:**
- **Interfaces:** Use stable interfaces
- **Contracts:** Follow interface contracts
- **Compatibility:** Maintain compatibility
- **Testing:** Test with VTS
- **Documentation:** Document interfaces

## Key Takeaways

1. **Treble architecture** refers to Project Treble, Android's modular architecture that separates the Android framework from vendor-specific implementations, enabling independent updates of the framework and vendor code.

2. **Project Treble goals** include problem before Treble (framework and HAL tightly coupled, framework updates required HAL updates, slow security updates), Treble solution (clear interface boundaries, system/vendor separation, interface versioning, Binder IPC communication, independent update paths), and solution benefits.

3. **System/vendor separation** includes partition separation (system partition framework code, vendor partition vendor code, separate mounts, isolation), process separation (framework services in system process, vendor HALs in vendor processes, Binder IPC communication, process isolation), and separation architecture.

4. **Interface boundaries** include HAL interfaces (HIDL interfaces, AIDL interfaces, versioned interfaces, stable interfaces), interface definition (HIDL interface legacy, AIDL interface modern), and interface characteristics.

5. **Binder IPC communication** includes binderized HALs (HALs run in separate processes, Binder IPC communication, vendor/system separation, Treble compliance), communication flow (framework service, HAL interface proxy, Binder transaction, HAL implementation stub, hardware access), and communication architecture.

6. **Treble architecture components** include framework side (Android framework, framework services, HAL client libraries, interface proxies), vendor side (vendor HAL implementations, vendor services, hardware-specific code, vendor libraries), and component responsibilities.

7. **Interface versioning** includes version management (interface versions, backward compatibility, version negotiation, deprecation handling), compatibility (framework-vendor compatibility, interface version compatibility, backward compatibility, forward compatibility), and compatibility testing.

8. **Update mechanisms** include framework updates (framework can update independently, no vendor changes required, security updates, feature updates), vendor updates (vendor can update independently, no framework changes required, HAL updates, vendor feature updates), and update processes.

9. **Understanding Treble architecture** is essential for AOSP development, enabling faster updates, better isolation, framework updates, and proper Treble architecture implementation.

## Related Topics

- **System/vendor separation:** Separation details
- **VNDK:** Vendor NDK details
- **GSI (Generic System Image):** GSI details

