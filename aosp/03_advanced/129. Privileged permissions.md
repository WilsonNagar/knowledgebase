---
number: 129
title: Privileged permissions
slug: privileged-permissions
level: advanced
tags:
  - aosp
  - framework
  - permissions
  - privileged-permissions
  - signature-privileged
  - system-permissions
  - security
prerequisites:
  - permissions-system
  - manifest-permissions
  - packagemanagerservice
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-129
---

# Privileged permissions

## Overview

Privileged permissions are system-level permissions that are granted to apps based on either being signed with the platform certificate or being installed in a privileged directory. Privileged permissions provide elevated access to system resources and protected APIs, and are typically used by system apps and platform components. Understanding privileged permissions is essential for AOSP development, as it explains how privileged permissions work, how apps qualify for privileged permissions, how privileged directories work, how signature|privileged protection level functions, and how privileged permissions differ from other permission types. This guide provides a comprehensive overview of privileged permissions, privilege criteria, privileged directories, signature|privileged protection level, permission grants, and system integration.

Think of privileged permissions like VIP access: just as VIP access requires either a special membership (platform signature) or being in a VIP area (privileged directory), privileged permissions require either being signed with the platform certificate or being installed in a privileged system directory, providing elevated access to system resources.

## Deep Explanation

### What are Privileged Permissions?

Privileged permissions are system-level permissions with the `signature|privileged` protection level that are granted to apps based on either being signed with the platform certificate or being installed in a privileged directory. Privileged permissions provide elevated access to system resources and protected APIs.

**Key Characteristics:**
- **System-Level:** System-level permissions
- **Dual Criteria:** Signature OR privileged location
- **Elevated Access:** Access to protected resources
- **Automatic Grant:** Automatically granted if criteria met
- **Restricted:** Limited to system apps

**Why Privileged Permissions?**
- **System Access:** Enable system app functionality
- **Security:** Controlled access to sensitive resources
- **Flexibility:** Multiple ways to qualify
- **System Integration:** Enable system features

### Privilege Criteria

#### Signature Criterion

**Signature Criterion:**
- App signed with platform certificate
- Platform certificate is system certificate
- Automatic grant for matching signatures
- System-level access

**Signature Check:**
```java
// Check if app signed with platform certificate
boolean isPlatformSigned(PackageInfo pkgInfo) {
    Signature[] signatures = pkgInfo.signatures;
    Signature platformCert = getPlatformCertificate();
    
    for (Signature sig : signatures) {
        if (sig.equals(platformCert)) {
            return true;
        }
    }
    return false;
}
```

#### Privileged Directory Criterion

**Privileged Directory Criterion:**
- App installed in privileged directory
- Privileged directories are system directories
- Automatic grant for privileged apps
- System-level access

**Privileged Directories:**
- `/system/priv-app/` - Primary privileged directory
- `/system/app/` - System apps (legacy)
- `/vendor/priv-app/` - Vendor privileged apps
- `/product/priv-app/` - Product privileged apps

**Directory Check:**
```java
// Check if app in privileged directory
boolean isPrivilegedApp(PackageInfo pkgInfo) {
    String codePath = pkgInfo.applicationInfo.sourceDir;
    
    // Check privileged directories
    return codePath.startsWith("/system/priv-app/") ||
           codePath.startsWith("/vendor/priv-app/") ||
           codePath.startsWith("/product/priv-app/");
}
```

### Signature|Privileged Protection Level

#### Protection Level Definition

**Signature|Privileged:**
- Protection level: `signature|privileged`
- Dual criteria: Signature OR privileged
- System-level permission
- Automatic grant

**Protection Level:**
```xml
<permission
    android:name="android.permission.PRIVILEGED_PERMISSION"
    android:protectionLevel="signature|privileged" />
```

**Protection Level Characteristics:**
- **signature|privileged:** Signature OR privileged
- **System Level:** System-level permission
- **Auto-Grant:** Automatically granted
- **Restricted:** Limited to system apps

#### Grant Logic

**Grant Logic:**
```
If (app signed with platform certificate) OR
   (app in privileged directory):
    Grant permission
Else:
    Deny permission
```

**Grant Implementation:**
```java
// Check if app qualifies for privileged permission
boolean qualifiesForPrivilegedPermission(PackageInfo pkgInfo) {
    // Check signature
    if (isPlatformSigned(pkgInfo)) {
        return true;
    }
    
    // Check privileged directory
    if (isPrivilegedApp(pkgInfo)) {
        return true;
    }
    
    return false;
}
```

### Privileged Directories

#### System Privileged Directory

**/system/priv-app/:**
- Primary privileged directory
- System privileged apps
- Automatically granted privileged permissions
- Read-only partition

**Directory Characteristics:**
- **System Partition:** Part of system partition
- **Read-Only:** Read-only after boot
- **Privileged:** Apps here are privileged
- **System Apps:** System-level apps

#### Vendor Privileged Directory

**/vendor/priv-app/:**
- Vendor privileged directory
- Vendor-specific privileged apps
- Automatically granted privileged permissions
- Vendor partition

**Directory Characteristics:**
- **Vendor Partition:** Part of vendor partition
- **Vendor Apps:** Vendor-specific apps
- **Privileged:** Apps here are privileged
- **OEM Customization:** OEM-specific apps

#### Product Privileged Directory

**/product/priv-app/:**
- Product privileged directory
- Product-specific privileged apps
- Automatically granted privileged permissions
- Product partition

**Directory Characteristics:**
- **Product Partition:** Part of product partition
- **Product Apps:** Product-specific apps
- **Privileged:** Apps here are privileged
- **Product Customization:** Product-specific apps

### Permission Grant Process

#### Grant Process

**Grant Process:**
```
1. App installed
2. System checks app location
3. System checks app signature
4. If privileged OR platform-signed:
   - Grant privileged permissions
5. Permission state stored
6. App can use privileged permissions
```

**Grant Implementation:**
```java
// Grant privileged permissions
void grantPrivilegedPermissions(PackageInfo pkgInfo) {
    // Check if qualifies
    if (!qualifiesForPrivilegedPermission(pkgInfo)) {
        return;
    }
    
    // Grant all signature|privileged permissions
    for (PermissionInfo permission : getAllPrivilegedPermissions()) {
        if (pkgInfo.requestedPermissions.contains(permission.name)) {
            grantPermission(pkgInfo.packageName, permission.name);
        }
    }
}
```

### Privileged Permission Examples

#### System Permissions

**System Privileged Permissions:**
- `WRITE_SECURE_SETTINGS` - Write secure settings
- `MODIFY_PHONE_STATE` - Modify phone state
- `INSTALL_PACKAGES` - Install packages
- `DELETE_PACKAGES` - Delete packages
- `CLEAR_APP_USER_DATA` - Clear app data

**Permission Examples:**
```xml
<!-- System privileged permission -->
<permission
    android:name="android.permission.WRITE_SECURE_SETTINGS"
    android:protectionLevel="signature|privileged"
    android:label="@string/permlab_writeSecureSettings"
    android:description="@string/permdesc_writeSecureSettings" />
```

### Privileged App Characteristics

#### Privileged App Requirements

**Requirements:**
- Installed in privileged directory OR
- Signed with platform certificate
- System-level access
- Elevated privileges

**App Characteristics:**
- **System Apps:** System-level apps
- **Elevated Access:** Access to protected APIs
- **Privileged Permissions:** Automatically granted
- **System Integration:** Integrated with system

### Permission Enforcement

#### Enforcement for Privileged Permissions

**Enforcement:**
- System checks privilege criteria
- Permission granted if criteria met
- Access allowed if permission granted
- Consistent enforcement

**Enforcement Process:**
```
1. App requests privileged operation
2. System checks privileged permission
3. System verifies privilege criteria
4. If criteria met: Allow access
5. If criteria not met: Deny access
```

### Privileged vs Other Permissions

#### Comparison

**Privileged Permissions:**
- **Criteria:** Signature OR privileged directory
- **Level:** System level
- **Grant:** Automatic if criteria met
- **Access:** Elevated system access

**Signature Permissions:**
- **Criteria:** Signature only
- **Level:** System level
- **Grant:** Automatic if signature matches
- **Access:** System access

**Dangerous Permissions:**
- **Criteria:** User approval
- **Level:** App level
- **Grant:** Runtime request
- **Access:** Standard app access

### System Integration

#### PackageManager Integration

**PackageManager Integration:**
- PackageManager checks app location
- PackageManager checks app signature
- PackageManager grants privileged permissions
- Coordinates with PermissionManager

**Integration Flow:**
```
Package Install → Check Location → Check Signature → 
Grant Privileged Permissions → Register with PermissionManager
```

#### PermissionManager Integration

**PermissionManager Integration:**
- PermissionManager receives privileged permissions
- Stores permission grants
- Manages permission state
- Coordinates with PackageManager

### Privileged Directory Management

#### Directory Structure

**Directory Structure:**
```
/system/priv-app/
├── SystemUI/
│   └── SystemUI.apk
├── Settings/
│   └── Settings.apk
└── ...

/vendor/priv-app/
├── VendorApp/
│   └── VendorApp.apk
└── ...
```

#### App Installation

**Installation Process:**
- Apps placed in privileged directory
- During system build or OTA
- Directory permissions set
- Apps granted privileged permissions

### Security Considerations

#### Security Implications

**Security Considerations:**
- Privileged permissions provide elevated access
- Only system apps should have them
- Careful validation required
- Security risk if misused

**Best Practices:**
- Only grant to trusted apps
- Validate app location
- Validate app signature
- Monitor privileged permission usage

### Debugging Privileged Permissions

#### Debugging Tools

**Debugging Tools:**
- Permission dumps
- Package dumps
- Directory inspection
- Signature verification

**Debugging Commands:**
```bash
# Check app location
adb shell pm path <package-name>

# Check app signature
adb shell dumpsys package <package-name> | grep signature

# Check privileged permissions
adb shell dumpsys package <package-name> | grep "privileged"

# List privileged apps
adb shell pm list packages -s -3
```

#### Common Issues

**Common Issues:**
- Permission not granted
- App not recognized as privileged
- Signature mismatch
- Directory location incorrect

**Debugging Steps:**
1. Check app location
2. Verify app signature
3. Check permission grants
4. Review permission dumps
5. Verify system integration

## Key Takeaways

1. **Privileged permissions** are system-level permissions with `signature|privileged` protection level, granted to apps based on either platform signature or privileged directory location.

2. **Privilege criteria** include signature criterion (app signed with platform certificate, automatic grant), privileged directory criterion (app in privileged directory, automatic grant), and dual criteria (signature OR privileged directory).

3. **Signature|privileged protection level** includes protection level definition (signature|privileged, dual criteria, system level), grant logic (signature OR privileged directory, automatic grant), and protection level characteristics.

4. **Privileged directories** include system privileged directory (/system/priv-app/, primary directory), vendor privileged directory (/vendor/priv-app/, vendor apps), product privileged directory (/product/priv-app/, product apps), and directory characteristics (system partition, read-only, privileged apps).

5. **Permission grant process** includes grant process (app installed, check location/signature, grant if criteria met, store state), grant implementation (check qualifies, grant permissions, register with system), and grant logic.

6. **Privileged permission examples** include system permissions (WRITE_SECURE_SETTINGS, MODIFY_PHONE_STATE, INSTALL_PACKAGES, etc.), permission examples (system privileged permissions), and permission usage.

7. **Privileged app characteristics** include privileged app requirements (installed in privileged directory OR platform-signed, system-level access), app characteristics (system apps, elevated access, privileged permissions), and app classification.

8. **Permission enforcement** includes enforcement for privileged permissions (system checks criteria, grants if met, allows access), enforcement process (check permission, verify criteria, allow/deny), and enforcement consistency.

9. **Privileged vs other permissions** includes comparison (privileged: signature OR directory, signature: signature only, dangerous: user approval), permission types (different criteria, levels, grants, access), and permission classification.

10. **Understanding privileged permissions** is essential for AOSP development, enabling system-level access control, privileged app functionality, security enforcement, and proper system integration.

## Related Topics

- **Permissions system:** Overall permissions system architecture
- **Manifest permissions:** Permission declaration in manifest
- **PackageManagerService:** Package and permission management
- **Android Security Model:** Overall security architecture

