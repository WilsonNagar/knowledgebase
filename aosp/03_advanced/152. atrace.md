---
number: 152
title: atrace
slug: atrace
level: advanced
tags:
  - aosp
  - debugging
  - atrace
  - application-tracing
  - android-tracing
  - system-tracing
prerequisites:
  - android-architecture-complete-overview
  - systrace-perfetto
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-152
---

# atrace

## Overview

atrace is an Android application tracing tool that captures application-level events, system events, and framework events to provide detailed performance analysis and debugging capabilities. atrace is used to trace Android-specific events such as graphics rendering, view system operations, activity lifecycle, binder transactions, and other Android framework activities. Understanding atrace is essential for AOSP development, as it explains how to use atrace to trace application events, how to enable and configure atrace, how to analyze atrace output, how to use atrace for debugging, and how atrace provides application-level visibility. This guide provides a comprehensive overview of atrace, atrace categories, trace recording, trace analysis, and atrace usage.

Think of atrace like a detailed activity log for Android applications: just as an activity log records what activities were performed (when, by whom, duration), atrace records what Android framework operations were performed (when, by which component, duration), providing a detailed timeline of application and system behavior.

## Deep Explanation

### What is atrace?

atrace is an Android application tracing tool that captures application-level events, system events, and framework events to provide detailed performance analysis and debugging capabilities. atrace is specifically designed for Android and captures Android-specific events.

**Key Characteristics:**
- **Android-Specific:** Designed for Android
- **Application-Level:** Captures application events
- **Framework Events:** Captures framework events
- **System Events:** Captures system events
- **Performance Analysis:** Performance analysis tool

**Why atrace?**
- **Application Debugging:** Debug application behavior
- **Performance Analysis:** Analyze application performance
- **Framework Understanding:** Understand framework behavior
- **System Visibility:** Application-level visibility

### atrace Categories

#### Graphics Categories

**Graphics Categories:**
- **gfx:** Graphics rendering events
- **view:** View system operations
- **wm:** Window Manager operations
- **input:** Input event handling

**Graphics Tracing:**
```bash
# Trace graphics events
adb shell atrace -t 10 -b 32768 gfx view wm input
```

#### Application Categories

**Application Categories:**
- **app:** Application-level events
- **am:** Activity Manager events
- **sm:** Service Manager events
- **res:** Resource loading events

**Application Tracing:**
```bash
# Trace application events
adb shell atrace -t 10 -b 32768 app am sm res
```

#### System Categories

**System Categories:**
- **sched:** CPU scheduling
- **freq:** CPU frequency scaling
- **idle:** CPU idle states
- **irq:** Interrupt handling
- **power:** Power management

**System Tracing:**
```bash
# Trace system events
adb shell atrace -t 10 -b 32768 sched freq idle irq power
```

#### Runtime Categories

**Runtime Categories:**
- **dalvik:** Dalvik VM events (legacy)
- **art:** ART runtime events
- **bionic:** Bionic library events
- **rs:** RenderScript events

**Runtime Tracing:**
```bash
# Trace runtime events
adb shell atrace -t 10 -b 32768 art bionic rs
```

### atrace Usage

#### Basic Usage

**Basic atrace Usage:**
```bash
# Trace for 10 seconds
adb shell atrace -t 10 -b 32768 gfx view

# Trace and save to file
adb shell atrace -t 10 -b 32768 -o /sdcard/trace.txt gfx view

# Trace specific app
adb shell atrace -t 10 -b 32768 -a com.example.app gfx view
```

**Command Options:**
- **-t:** Trace duration (seconds)
- **-b:** Buffer size (KB)
- **-o:** Output file
- **-a:** Application package name
- **Categories:** Event categories to trace

#### Trace Recording

**Trace Recording Process:**
```
1. Start atrace with categories
2. Perform operation
3. Stop atrace
4. Retrieve trace file
5. Analyze trace
```

**Recording Example:**
```bash
# Start trace
adb shell atrace -t 10 -b 32768 -o /sdcard/trace.txt gfx view wm am

# Pull trace file
adb pull /sdcard/trace.txt

# View trace (or use systrace/perfetto)
python systrace.py --from-file=trace.txt
```

#### Multiple Categories

**Tracing Multiple Categories:**
```bash
# Trace multiple categories
adb shell atrace -t 10 -b 32768 gfx view wm am sm audio video camera hal res dalvik rs bionic power sched irq freq idle disk load sync workq memreclaim regulators binder_driver binder_lock
```

**Common Category Combinations:**
- **UI Performance:** `gfx view wm input`
- **Application Lifecycle:** `am sm app`
- **System Performance:** `sched freq idle power`
- **Complete Trace:** All categories

### atrace Output

#### Output Format

**Output Format:**
- Text-based format
- Compatible with systrace
- Can be viewed in Perfetto
- Event timeline

**Output Structure:**
```
TRACE:
# tracer: nop
#
#           TASK-PID   CPU#  TIMESTAMP  FUNCTION
#              | |       |       |         |
          <idle>-0     [000]  1234.567890: sched_switch: prev_comm=swapper/0 prev_pid=0 prev_prio=120 prev_state=R ==> next_comm=system_server next_pid=1234 next_prio=120
```

#### Trace Analysis

**Trace Analysis:**
- View in systrace
- View in Perfetto
- Analyze event timeline
- Identify bottlenecks

**Analysis Tools:**
```bash
# View with systrace
python systrace.py --from-file=trace.txt

# View with Perfetto
# Convert to Perfetto format or use Perfetto directly
```

### atrace Integration

#### Integration with systrace

**systrace Integration:**
- atrace output compatible with systrace
- Can be viewed in systrace UI
- Combined with kernel events
- Unified analysis

**Integration Example:**
```bash
# Record with atrace
adb shell atrace -t 10 -b 32768 -o /sdcard/trace.txt gfx view

# View with systrace
python systrace.py --from-file=/sdcard/trace.txt
```

#### Integration with Perfetto

**Perfetto Integration:**
- atrace events in Perfetto
- Better visualization
- Combined with ftrace
- Unified tracing

**Integration Example:**
```bash
# Perfetto uses atrace internally
adb shell perfetto -t 10s -o /data/misc/perfetto-traces/trace.pb \
  -c - <<EOF
data_sources: {
    config {
        name: "linux.ftrace"
        ftrace_config {
            atrace_categories: "gfx"
            atrace_categories: "view"
            atrace_categories: "wm"
            atrace_categories: "am"
        }
    }
}
EOF
```

### Application-Specific Tracing

#### Tracing Specific Applications

**Application Tracing:**
- Trace specific app package
- Filter by application
- Application-specific events
- Focused debugging

**Application Tracing Example:**
```bash
# Trace specific app
adb shell atrace -t 10 -b 32768 -a com.example.app gfx view am

# Trace app with all categories
adb shell atrace -t 10 -b 32768 -a com.example.app gfx view wm am sm audio video camera hal res dalvik rs bionic power sched irq freq idle disk load sync workq memreclaim regulators binder_driver binder_lock
```

### atrace Categories Details

#### Graphics Categories

**gfx (Graphics):**
- Frame rendering
- VSync events
- GPU operations
- Surface operations

**view (View System):**
- View drawing
- View layout
- View measure
- View invalidate

**wm (Window Manager):**
- Window creation
- Window updates
- Window focus
- Window layout

**input (Input):**
- Touch events
- Key events
- Input processing
- Input dispatch

#### Application Categories

**app (Application):**
- Application events
- Application lifecycle
- Application operations

**am (Activity Manager):**
- Activity lifecycle
- Activity transitions
- Activity stack operations
- Process management

**sm (Service Manager):**
- Service lifecycle
- Service binding
- Service operations

**res (Resources):**
- Resource loading
- Resource access
- Asset loading

#### System Categories

**sched (Scheduler):**
- CPU scheduling
- Thread switching
- CPU migration

**freq (Frequency):**
- CPU frequency changes
- Frequency scaling
- Performance states

**idle (Idle):**
- CPU idle states
- Idle transitions
- Power saving

**irq (Interrupts):**
- Interrupt handling
- Interrupt latency
- Interrupt processing

**power (Power):**
- Power management
- Power state changes
- Wake locks

### Debugging with atrace

#### Common Debugging Scenarios

**Scenario 1: Frame Drops**
```bash
# Trace graphics events
adb shell atrace -t 10 -b 32768 -o /sdcard/trace.txt gfx view wm

# Analyze in Perfetto
# Look for frame rendering > 16ms
# Check VSync alignment
```

**Scenario 2: Activity Lifecycle Issues**
```bash
# Trace activity manager events
adb shell atrace -t 10 -b 32768 -o /sdcard/trace.txt am app

# Analyze activity lifecycle
# Check activity transitions
# Verify lifecycle callbacks
```

**Scenario 3: Input Latency**
```bash
# Trace input events
adb shell atrace -t 10 -b 32768 -o /sdcard/trace.txt input view wm

# Analyze input processing
# Check input dispatch latency
# Verify touch event handling
```

### atrace Best Practices

#### Best Practices

**Best Practices:**
- Use specific categories
- Keep trace duration reasonable
- Use appropriate buffer size
- Analyze systematically
- Combine with other tools

**Practice Guidelines:**
- **Specific Categories:** Enable only needed categories
- **Reasonable Duration:** Keep traces short (10-30 seconds)
- **Buffer Size:** Use appropriate buffer size (32768 KB default)
- **Systematic Analysis:** Analyze traces systematically
- **Tool Combination:** Combine with systrace/perfetto

## Key Takeaways

1. **atrace** is an Android application tracing tool that captures application-level events, system events, and framework events to provide detailed performance analysis and debugging capabilities.

2. **atrace categories** include graphics categories (gfx, view, wm, input), application categories (app, am, sm, res), system categories (sched, freq, idle, irq, power), runtime categories (dalvik, art, bionic, rs), and category usage.

3. **atrace usage** includes basic usage (trace for duration, trace and save to file, trace specific app), trace recording (start atrace, perform operation, stop atrace, retrieve trace file), multiple categories (trace multiple categories, common category combinations), and usage examples.

4. **atrace output** includes output format (text-based format, compatible with systrace, can be viewed in Perfetto, event timeline), trace analysis (view in systrace, view in Perfetto, analyze event timeline, identify bottlenecks), and analysis tools.

5. **atrace integration** includes integration with systrace (atrace output compatible with systrace, can be viewed in systrace UI, combined with kernel events), integration with Perfetto (atrace events in Perfetto, better visualization, combined with ftrace), and integration examples.

6. **Application-specific tracing** includes tracing specific applications (trace specific app package, filter by application, application-specific events, focused debugging), and application tracing examples.

7. **atrace categories details** include graphics categories (gfx, view, wm, input), application categories (app, am, sm, res), system categories (sched, freq, idle, irq, power), and category details.

8. **Debugging with atrace** includes common debugging scenarios (frame drops, activity lifecycle issues, input latency), and debugging examples.

9. **Understanding atrace** is essential for AOSP development, enabling application debugging, performance analysis, framework understanding, and proper atrace usage.

## Related Topics

- **systrace & perfetto:** System tracing details
- **ftrace:** Kernel function tracing details
- **binder tracing:** Binder IPC tracing details

