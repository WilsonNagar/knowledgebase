---
number: 132
title: App sandbox
slug: app-sandbox
level: advanced
tags:
  - aosp
  - security
  - app-sandbox
  - sandboxing
  - isolation
  - application-isolation
prerequisites:
  - sandboxing
  - android-security-model
  - android-architecture-complete-overview
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-132
---

# App sandbox

## Overview

App sandbox is the isolated execution environment in which each Android application runs, providing isolation from other applications and the system through process isolation, file system isolation, UID/GID isolation, SELinux enforcement, and permission-based access control. The app sandbox ensures that each application can only access its own data and resources, and can only access system resources through explicit permissions. Understanding app sandbox is essential for AOSP development, as it explains how Android isolates applications, how the sandbox is created and enforced, how apps access resources within the sandbox, how inter-app communication is secured, and how the sandbox provides security and privacy protection. This guide provides a comprehensive overview of app sandbox, sandbox creation, sandbox components, resource access, sandbox enforcement, and security mechanisms.

Think of app sandbox like individual apartments in a building: just as each apartment (app sandbox) has its own space, locks, and boundaries that prevent residents from accessing each other's apartments, each Android application runs in its own sandbox with isolated space, access controls, and boundaries that prevent apps from accessing each other's data or resources.

## Deep Explanation

### What is App Sandbox?

App sandbox is the isolated execution environment in which each Android application runs, providing isolation from other applications and the system. The app sandbox ensures that each application can only access its own data and resources, and can only access system resources through explicit permissions.

**Key Characteristics:**
- **Isolated Environment:** Each app runs in isolated environment
- **Restricted Access:** Limited access to resources
- **Permission-Based:** Access via permissions
- **Secure Boundaries:** Secure sandbox boundaries
- **Privacy Protection:** Protects user data

**Why App Sandbox?**
- **Security:** Prevents unauthorized access
- **Privacy:** Protects user data
- **Stability:** Isolates app failures
- **Resource Management:** Controls resource usage

### Sandbox Creation

#### Sandbox Initialization

**Sandbox Initialization:**
- Created when app is installed
- UID/GID assigned to app
- File system directory created
- SELinux context assigned
- Permissions initialized

**Initialization Process:**
```
1. App installed
2. Unique UID assigned
3. File directory created: /data/data/<package>/
4. SELinux context assigned
5. Permissions initialized
6. Sandbox ready
```

#### UID Assignment

**UID Assignment:**
- Each app gets unique UID
- UID assigned at install time
- UID used for file ownership
- UID used for process identification

**UID Range:**
```
System apps: UID < 10000
User apps: UID >= 10000
Shared UIDs: Multiple apps can share UID
```

**UID Characteristics:**
- **Unique:** Each app has unique UID
- **Persistent:** UID persists across reboots
- **File Ownership:** Files owned by app UID
- **Process Identification:** Process identified by UID

### Sandbox Components

#### Process Isolation

**Process Isolation:**
- Each app runs in separate process
- Isolated memory space
- Isolated execution context
- Process-level security

**Process Characteristics:**
- **Separate Process:** Each app has own process
- **Isolated Memory:** Cannot access other app memory
- **Isolated Execution:** Independent execution
- **Process Security:** Process-level security

#### File System Isolation

**File System Isolation:**
- Each app has isolated directory
- App files in `/data/data/<package>/`
- File permissions enforce isolation
- Other apps cannot access

**File System Structure:**
```
/data/data/<package>/
├── files/          # App files
├── cache/          # Cache files
├── databases/      # SQLite databases
├── shared_prefs/   # Shared preferences
└── code_cache/     # Code cache
```

**File Permissions:**
```
Owner: UID <app-uid>
Group: GID <app-gid>
Permissions: 700 (owner read/write/execute only)
Other apps: Cannot access
```

#### UID/GID Isolation

**UID/GID Isolation:**
- Each app has unique UID
- File system access based on UID
- Process identification by UID
- Resource ownership by UID

**Isolation Mechanism:**
- Linux kernel enforces UID isolation
- File permissions based on UID
- Process ownership by UID
- Resource limits per UID

### Resource Access

#### File System Access

**File System Access:**
- App can access own files
- Cannot access other app files
- Shared storage requires permission
- External storage requires permission

**Access Rules:**
- **Own Files:** Full access to own files
- **Other App Files:** No access
- **Shared Storage:** Permission required
- **External Storage:** Permission required

#### Network Access

**Network Access:**
- Requires INTERNET permission
- Network security policies apply
- Cleartext restrictions
- Certificate pinning support

**Network Access Control:**
- **INTERNET Permission:** Required for network
- **Network Security Config:** Security policies
- **Cleartext Traffic:** Restricted by default
- **Certificate Pinning:** Supported

#### System Resource Access

**System Resource Access:**
- Permission-based access
- System services via Binder
- Hardware access via permissions
- System APIs via permissions

**Access Mechanism:**
- **Permissions:** Required for access
- **Binder IPC:** Secure communication
- **System Services:** Permission-based
- **Hardware:** Permission-based

### Sandbox Enforcement

#### Kernel-Level Enforcement

**Kernel-Level Enforcement:**
- Process isolation
- UID/GID isolation
- Memory protection
- System call filtering

**Enforcement Mechanisms:**
- **Process Isolation:** Kernel enforces
- **UID/GID:** Kernel enforces
- **Memory Protection:** Kernel enforces
- **System Calls:** Kernel filters

#### File System Enforcement

**File System Enforcement:**
- File permissions enforce isolation
- Directory access restrictions
- SELinux file contexts
- Access control lists

**Enforcement Mechanisms:**
- **File Permissions:** Linux permissions
- **Directory Isolation:** Directory permissions
- **SELinux Contexts:** File type enforcement
- **ACLs:** Access control lists

#### SELinux Enforcement

**SELinux Enforcement:**
- Mandatory access control
- Fine-grained permissions
- Policy-based enforcement
- Additional security layer

**Enforcement Mechanisms:**
- **MAC:** Mandatory access control
- **Policies:** Policy-based enforcement
- **Contexts:** Process and file contexts
- **Enforcement:** Kernel-level enforcement

### Sandbox Boundaries

#### Process Boundary

**Process Boundary:**
- Separate process per app
- Isolated memory space
- Isolated execution context
- Process-level security

**Boundary Characteristics:**
- **Separate Process:** Cannot access other processes
- **Isolated Memory:** Cannot access other memory
- **Isolated Execution:** Independent execution
- **Security Context:** Isolated security context

#### File System Boundary

**File System Boundary:**
- Isolated file directories
- File permission enforcement
- Directory access restrictions
- Shared storage boundaries

**Boundary Characteristics:**
- **Isolated Directories:** Cannot access other directories
- **File Permissions:** Enforce boundaries
- **Directory Access:** Restricted access
- **Shared Storage:** Permission-based access

#### Network Boundary

**Network Boundary:**
- Permission-based network access
- Network security policies
- Cleartext restrictions
- Certificate validation

**Boundary Characteristics:**
- **Permission-Based:** INTERNET permission required
- **Security Policies:** Network security config
- **Cleartext Restrictions:** Restricted by default
- **Certificate Validation:** Certificate pinning

### Inter-App Communication

#### Secure IPC

**Secure IPC:**
- Binder IPC with permissions
- Intent-based communication
- Content providers with permissions
- Secure message passing

**IPC Mechanisms:**
- **Binder:** Primary IPC mechanism
- **Intents:** Intent-based communication
- **Content Providers:** Data sharing
- **Messenger:** Message passing

#### IPC Security

**IPC Security:**
- Permission checks on IPC
- Binder security enforcement
- Intent filtering
- Content provider permissions

**Security Mechanisms:**
- **Permission Checks:** Required for IPC
- **Binder Security:** Binder security enforcement
- **Intent Filtering:** Intent security
- **Content Provider Permissions:** Provider permissions

### Sandbox Lifecycle

#### Sandbox Creation

**Sandbox Creation:**
- Created at app install
- UID/GID assigned
- File directory created
- SELinux context assigned

**Creation Process:**
```
1. App installed
2. UID/GID assigned
3. File directory created
4. SELinux context assigned
5. Permissions initialized
```

#### Sandbox Runtime

**Sandbox Runtime:**
- App runs in sandbox
- Sandbox boundaries enforced
- Resource access controlled
- Security maintained

**Runtime Characteristics:**
- **Isolation:** Maintained during runtime
- **Enforcement:** Boundaries enforced
- **Access Control:** Resource access controlled
- **Security:** Security maintained

#### Sandbox Destruction

**Sandbox Destruction:**
- Destroyed when app uninstalled
- Files removed
- UID released
- Resources cleaned up

**Destruction Process:**
```
1. App uninstalled
2. Files removed
3. UID released
4. Resources cleaned up
```

### Sandbox Benefits

#### Security Benefits

**Security Benefits:**
- Prevents unauthorized access
- Isolates app failures
- Prevents privilege escalation
- Protects system integrity

**Security Features:**
- **Isolation:** Apps isolated from each other
- **Access Control:** Permission-based access
- **Enforcement:** Multiple enforcement layers
- **Protection:** System and data protection

#### Privacy Benefits

**Privacy Benefits:**
- Protects user data
- Isolates app data
- Prevents data leakage
- User-controlled access

**Privacy Features:**
- **Data Isolation:** App data isolated
- **User Control:** User controls access
- **Data Protection:** Data protected
- **Privacy:** Privacy maintained

### Debugging App Sandbox

#### Debugging Tools

**Debugging Tools:**
- Process inspection
- File system inspection
- UID/GID inspection
- SELinux logs
- Permission dumps

**Debugging Commands:**
```bash
# Check app UID
adb shell dumpsys package <package-name> | grep userId

# Check file permissions
adb shell ls -la /data/data/<package-name>/

# Check SELinux context
adb shell ps -Z | grep <package-name>

# Check sandbox directory
adb shell ls -la /data/data/<package-name>/
```

#### Common Issues

**Common Issues:**
- File access denied
- Permission denied
- SELinux violations
- IPC communication failures
- Sandbox boundary violations

**Debugging Steps:**
1. Check app UID/GID
2. Verify file permissions
3. Review SELinux context
4. Check permissions
5. Verify sandbox boundaries
6. Review IPC security

## Key Takeaways

1. **App sandbox** is the isolated execution environment in which each Android application runs, providing isolation from other applications and the system.

2. **Sandbox creation** includes sandbox initialization (created at install, UID/GID assigned, file directory created, SELinux context assigned), initialization process, UID assignment (unique UID per app, assigned at install, used for file ownership and process identification), and UID characteristics.

3. **Sandbox components** include process isolation (separate process, isolated memory, isolated execution context), file system isolation (isolated directory, app files in /data/data/<package>/, file permissions enforce isolation), UID/GID isolation (unique UID, file system access based on UID, process identification by UID), and isolation mechanisms.

4. **Resource access** includes file system access (app can access own files, cannot access other app files, shared storage requires permission), network access (requires INTERNET permission, network security policies apply), system resource access (permission-based access, system services via Binder, hardware access via permissions), and access mechanisms.

5. **Sandbox enforcement** includes kernel-level enforcement (process isolation, UID/GID isolation, memory protection, system call filtering), file system enforcement (file permissions, directory access restrictions, SELinux file contexts), SELinux enforcement (mandatory access control, fine-grained permissions, policy-based enforcement), and enforcement mechanisms.

6. **Sandbox boundaries** include process boundary (separate process, isolated memory, isolated execution context), file system boundary (isolated directories, file permissions, directory access restrictions), network boundary (permission-based access, network security policies, cleartext restrictions), and boundary characteristics.

7. **Inter-app communication** includes secure IPC (Binder IPC with permissions, Intent-based communication, Content providers with permissions), IPC security (permission checks, Binder security enforcement, Intent filtering), IPC mechanisms, and IPC boundaries.

8. **Sandbox lifecycle** includes sandbox creation (created at install, UID/GID assigned, file directory created), sandbox runtime (app runs in sandbox, boundaries enforced, resource access controlled), sandbox destruction (destroyed at uninstall, files removed, UID released), and lifecycle characteristics.

9. **Sandbox benefits** include security benefits (prevents unauthorized access, isolates app failures, prevents privilege escalation), privacy benefits (protects user data, isolates app data, prevents data leakage), and benefit characteristics.

10. **Understanding app sandbox** is essential for AOSP development, enabling application isolation, security enforcement, privacy protection, and proper sandbox architecture implementation.

## Related Topics

- **Sandboxing:** General sandboxing concepts
- **Process isolation:** Process isolation mechanisms
- **Android Security Model:** Overall security architecture
- **SELinux (Mandatory Access Control):** SELinux details

