---
number: 121
title: Skia
slug: skia
level: advanced
tags:
  - aosp
  - graphics
  - skia
  - rendering
  - 2d-graphics
  - canvas
  - graphics-library
prerequisites:
  - view-system-internals
  - android-architecture-complete-overview
  - surfaceflinger-composition-engine
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-121
---

# Skia

## Overview

Skia is a 2D graphics library used by Android for rendering text, shapes, and images. Skia provides the Canvas API that Android applications use for drawing, handles software rendering, and can also use hardware acceleration through OpenGL ES. Understanding Skia is essential for AOSP development, as it explains how 2D graphics are rendered, how the Canvas API works, how text rendering is handled, how images are processed, and how Skia integrates with the Android graphics pipeline. This guide provides a comprehensive overview of Skia, architecture, Canvas API, rendering pipeline, text rendering, image processing, hardware acceleration, and debugging.

Think of Skia like a digital artist's toolkit: just as an artist uses brushes, paints, and canvases to create artwork, Skia provides drawing primitives, rendering operations, and canvas surfaces for creating graphics in Android applications.

## Deep Explanation

### What is Skia?

Skia is a 2D graphics library developed by Google and used by Android for rendering text, shapes, and images. Skia provides the Canvas API that Android applications use for drawing operations, handles both software and hardware-accelerated rendering, and is the foundation for Android's 2D graphics system.

**Key Characteristics:**
- **2D Graphics Library:** Renders 2D graphics
- **Canvas API:** Provides drawing API
- **Software Rendering:** CPU-based rendering
- **Hardware Acceleration:** GPU-based rendering via OpenGL ES
- **Cross-Platform:** Used in multiple platforms

**Why Skia?**
- **Efficient Rendering:** Optimized 2D graphics rendering
- **Rich API:** Comprehensive drawing operations
- **Hardware Acceleration:** GPU-accelerated rendering
- **Text Rendering:** High-quality text rendering

### Skia Architecture

#### Library Structure

**Skia Components:**
- **Canvas:** Drawing surface and operations
- **Paint:** Drawing style and attributes
- **Path:** Vector paths for shapes
- **Bitmap:** Image data
- **Text:** Text rendering
- **Effects:** Graphics effects

**Skia Location:**
- Native C++ library
- Part of Android framework
- Used by View system
- Can use hardware acceleration

#### Rendering Modes

**Rendering Modes:**
- **Software Rendering:** CPU-based rendering
- **Hardware Acceleration:** GPU-based rendering
- **Hybrid:** Combination of both

**Rendering Mode Selection:**
- Automatic selection based on context
- Hardware acceleration preferred
- Software fallback when needed

### Canvas API

#### Canvas Overview

**Canvas:**
- Drawing surface
- Provides drawing operations
- Manages drawing state
- Handles coordinate transformations

**Canvas Characteristics:**
- **Drawing Surface:** Where drawing occurs
- **Drawing Operations:** Methods for drawing
- **State Management:** Saves/restores state
- **Transformations:** Coordinate transformations

#### Drawing Operations

**Drawing Operations:**
- **drawRect():** Draw rectangle
- **drawCircle():** Draw circle
- **drawPath():** Draw path
- **drawText():** Draw text
- **drawBitmap():** Draw bitmap
- **drawLine():** Draw line

**Drawing Example:**
```java
// Canvas drawing
Canvas canvas = new Canvas(bitmap);

Paint paint = new Paint();
paint.setColor(Color.BLUE);
paint.setStyle(Paint.Style.FILL);

// Draw rectangle
canvas.drawRect(0, 0, 100, 100, paint);

// Draw circle
canvas.drawCircle(50, 50, 25, paint);

// Draw text
paint.setTextSize(20);
canvas.drawText("Hello", 10, 50, paint);
```

#### Canvas State

**Canvas State:**
- Current transformation matrix
- Clip region
- Drawing attributes (via Paint)

**State Management:**
```java
// Save state
int saveCount = canvas.save();

// Apply transformation
canvas.translate(10, 10);
canvas.rotate(45);

// Draw
canvas.drawRect(0, 0, 50, 50, paint);

// Restore state
canvas.restoreToCount(saveCount);
```

### Paint

#### Paint Overview

**Paint:**
- Drawing style and attributes
- Color, stroke width, style
- Text attributes
- Effects and filters

**Paint Characteristics:**
- **Color:** Drawing color
- **Style:** Fill, stroke, or both
- **Stroke Width:** Line width
- **Text Size:** Text size
- **Effects:** Shadows, blur, etc.

#### Paint Properties

**Paint Properties:**
```java
// Create paint
Paint paint = new Paint();

// Set color
paint.setColor(Color.BLUE);

// Set style
paint.setStyle(Paint.Style.FILL); // or STROKE, FILL_AND_STROKE

// Set stroke width
paint.setStrokeWidth(5.0f);

// Set text size
paint.setTextSize(24.0f);

// Set anti-aliasing
paint.setAntiAlias(true);

// Set effects
paint.setShadowLayer(10, 5, 5, Color.GRAY);
```

### Path

#### Path Overview

**Path:**
- Vector path for shapes
- Composed of lines and curves
- Can be filled or stroked
- Supports complex shapes

**Path Operations:**
- **moveTo():** Move to point
- **lineTo():** Draw line
- **quadTo():** Quadratic curve
- **cubicTo():** Cubic curve
- **close():** Close path

**Path Example:**
```java
// Create path
Path path = new Path();

// Draw triangle
path.moveTo(50, 0);
path.lineTo(0, 100);
path.lineTo(100, 100);
path.close();

// Draw path
canvas.drawPath(path, paint);
```

### Text Rendering

#### Text Rendering Overview

**Text Rendering:**
- High-quality text rendering
- Font support
- Text layout
- Text measurement

**Text Rendering Features:**
- **Font Support:** Multiple font formats
- **Text Layout:** Complex text layout
- **Text Measurement:** Measure text bounds
- **Text Effects:** Shadows, gradients, etc.

#### Text Drawing

**Text Drawing:**
```java
// Draw text
Paint paint = new Paint();
paint.setTextSize(24.0f);
paint.setColor(Color.BLACK);
paint.setAntiAlias(true);

// Draw text
canvas.drawText("Hello World", 10, 50, paint);

// Measure text
Rect bounds = new Rect();
paint.getTextBounds("Hello World", 0, 11, bounds);
float width = paint.measureText("Hello World");
```

#### Font Management

**Font Management:**
- Load fonts
- Create Typeface
- Use system fonts
- Custom fonts

**Font Example:**
```java
// Create typeface
Typeface typeface = Typeface.create("Arial", Typeface.BOLD);

// Set typeface
paint.setTypeface(typeface);

// Draw text
canvas.drawText("Hello", 10, 50, paint);
```

### Image Processing

#### Bitmap Operations

**Bitmap Operations:**
- Load bitmaps
- Draw bitmaps
- Transform bitmaps
- Process bitmaps

**Bitmap Drawing:**
```java
// Load bitmap
Bitmap bitmap = BitmapFactory.decodeResource(resources, R.drawable.image);

// Draw bitmap
canvas.drawBitmap(bitmap, 0, 0, paint);

// Draw scaled bitmap
Rect src = new Rect(0, 0, bitmap.getWidth(), bitmap.getHeight());
Rect dst = new Rect(0, 0, 200, 200);
canvas.drawBitmap(bitmap, src, dst, paint);
```

#### Image Effects

**Image Effects:**
- Color filters
- Blur effects
- Transformations
- Compositing

**Image Effects Example:**
```java
// Apply color filter
ColorMatrix colorMatrix = new ColorMatrix();
colorMatrix.setSaturation(0); // Grayscale
ColorMatrixColorFilter filter = new ColorMatrixColorFilter(colorMatrix);
paint.setColorFilter(filter);

// Draw with filter
canvas.drawBitmap(bitmap, 0, 0, paint);
```

### Hardware Acceleration

#### Hardware Acceleration Overview

**Hardware Acceleration:**
- GPU-accelerated rendering
- OpenGL ES backend
- Improved performance
- Reduced CPU usage

**Hardware Acceleration Benefits:**
- **Performance:** Faster rendering
- **Efficiency:** Reduced CPU usage
- **Smooth Animations:** Better animation performance
- **Complex Scenes:** Handle complex graphics

#### Hardware Acceleration Implementation

**Hardware Acceleration:**
- Skia can use OpenGL ES
- Automatic selection
- Fallback to software
- Optimized for GPU

**Hardware Acceleration Flow:**
```
Canvas Operation → Skia → OpenGL ES → GPU
```

### Skia Integration

#### View System Integration

**View System Integration:**
- View.onDraw() uses Canvas
- Canvas provided by Skia
- Hardware acceleration enabled
- Software fallback available

**Integration Flow:**
```
View.onDraw(Canvas) → Skia Canvas → Render → Surface
```

#### Surface Integration

**Surface Integration:**
- Canvas draws to Surface
- Surface provides buffer
- Skia renders to buffer
- Buffer sent to SurfaceFlinger

**Surface Drawing:**
```java
// Get surface
Surface surface = ...;

// Lock canvas
Canvas canvas = surface.lockCanvas(null);

// Draw
canvas.drawRect(0, 0, 100, 100, paint);

// Unlock and post
surface.unlockCanvasAndPost(canvas);
```

### Performance Optimization

#### Rendering Optimization

**Optimization Techniques:**
- Minimize drawing operations
- Use hardware acceleration
- Cache bitmaps
- Reduce overdraw

**Optimization Example:**
```java
// BAD: Redraw everything
void onDraw(Canvas canvas) {
    // Redraw all content every frame
    drawEverything(canvas);
}

// GOOD: Only draw what changed
void onDraw(Canvas canvas) {
    // Only draw dirty region
    if (mDirty) {
        drawDirtyRegion(canvas);
        mDirty = false;
    }
}
```

#### Memory Management

**Memory Management:**
- Efficient bitmap handling
- Reuse objects when possible
- Proper cleanup
- Memory pool management

### Debugging Skia

#### Skia Debugging

**Debugging Tools:**
- Canvas tracing
- Rendering logs
- Performance profiling
- Memory analysis

**Debugging Commands:**
```bash
# Enable canvas tracing
adb shell setprop debug.hwui.profile true

# View rendering logs
adb logcat | grep Skia

# Performance profiling
adb shell dumpsys gfxinfo
```

#### Common Issues

**Common Issues:**
- Slow rendering
- Memory issues
- Incorrect rendering
- Hardware acceleration problems

**Debugging Steps:**
1. Check rendering logs
2. Profile rendering performance
3. Verify hardware acceleration
4. Check memory usage
5. Review drawing operations

## Key Takeaways

1. **Skia** is a 2D graphics library used by Android for rendering text, shapes, and images, providing the Canvas API and supporting both software and hardware-accelerated rendering.

2. **Skia architecture** includes library structure (Canvas, Paint, Path, Bitmap, Text, Effects), rendering modes (software, hardware, hybrid), and Skia location (native C++ library, part of Android framework).

3. **Canvas API** includes canvas overview (drawing surface, drawing operations, state management), drawing operations (drawRect, drawCircle, drawPath, drawText, drawBitmap), and canvas state (transformation matrix, clip region, drawing attributes).

4. **Paint** includes paint overview (drawing style and attributes), paint properties (color, style, stroke width, text size, effects), and paint usage (set properties, use in drawing).

5. **Path** includes path overview (vector path for shapes), path operations (moveTo, lineTo, quadTo, cubicTo, close), and path usage (create complex shapes, fill or stroke).

6. **Text rendering** includes text rendering overview (high-quality text rendering, font support), text drawing (drawText, measureText), and font management (load fonts, create Typeface, use system/custom fonts).

7. **Image processing** includes bitmap operations (load, draw, transform, process bitmaps), image effects (color filters, blur, transformations, compositing), and bitmap usage.

8. **Hardware acceleration** includes hardware acceleration overview (GPU-accelerated rendering, OpenGL ES backend), hardware acceleration implementation (automatic selection, OpenGL ES backend), and hardware acceleration benefits (performance, efficiency, smooth animations).

9. **Skia integration** includes view system integration (View.onDraw uses Canvas, hardware acceleration), surface integration (Canvas draws to Surface, buffer management), and integration flow (View → Canvas → Skia → Surface).

10. **Understanding Skia** is essential for AOSP development, enabling efficient 2D graphics rendering, Canvas API usage, text rendering, image processing, and hardware-accelerated graphics.

## Related Topics

- **View system internals:** How views use Skia for rendering
- **SurfaceFlinger (composition engine):** How Skia output is composited
- **Graphics Pipeline Deep Dive:** Complete graphics pipeline
- **HWUI:** Hardware-accelerated UI rendering

