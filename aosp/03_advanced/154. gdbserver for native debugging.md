---
number: 154
title: gdbserver for native debugging
slug: gdbserver-for-native-debugging
level: advanced
tags:
  - aosp
  - debugging
  - gdbserver
  - gdb
  - native-debugging
  - remote-debugging
prerequisites:
  - android-architecture-complete-overview
  - logging-in-native-layers
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-154
---

# gdbserver for native debugging

## Overview

gdbserver is a remote debugging server that allows GDB (GNU Debugger) to debug native code running on Android devices over a network connection. gdbserver enables developers to debug native processes, set breakpoints, inspect variables, analyze stack traces, and step through native code execution. Understanding gdbserver is essential for AOSP development, as it explains how to set up gdbserver, how to attach to processes, how to debug native code, how to use GDB commands, and how gdbserver provides native debugging capabilities. This guide provides a comprehensive overview of gdbserver, setup and configuration, debugging workflows, GDB commands, and native debugging best practices.

Think of gdbserver like a remote control for debugging: just as a remote control allows you to control a device from a distance (change channels, adjust volume, power on/off), gdbserver allows you to control and debug a native process from your development machine (set breakpoints, inspect variables, step through code).

## Deep Explanation

### What is gdbserver?

gdbserver is a remote debugging server that allows GDB (GNU Debugger) to debug native code running on Android devices over a network connection. gdbserver runs on the Android device and communicates with GDB running on the development machine.

**Key Characteristics:**
- **Remote Debugging:** Remote debugging capability
- **Native Code:** Debugs native code
- **Network Connection:** Uses network connection
- **GDB Compatible:** Compatible with GDB
- **Process Debugging:** Debugs running processes

**Why gdbserver?**
- **Native Debugging:** Essential for native code debugging
- **Remote Access:** Debug on device from host
- **Full GDB Features:** Access to all GDB features
- **Process Inspection:** Inspect running processes

### gdbserver Setup

#### Installing gdbserver

**Installing gdbserver:**
- Pre-installed on some devices
- Available in AOSP builds
- Can be pushed to device
- Requires root for some operations

**Installation Methods:**
```bash
# Check if gdbserver exists
adb shell which gdbserver

# Push gdbserver to device
adb push gdbserver /data/local/tmp/

# Make executable
adb shell chmod 755 /data/local/tmp/gdbserver
```

#### gdbserver Location

**gdbserver Locations:**
- `/system/bin/gdbserver` - System location
- `/data/local/tmp/gdbserver` - Temporary location
- Vendor-specific locations
- Custom builds

**Finding gdbserver:**
```bash
# Find gdbserver
adb shell find /system -name gdbserver

# Check availability
adb shell ls -l /system/bin/gdbserver
```

### Starting gdbserver

#### Attach to Running Process

**Attach to Process:**
```bash
# Get process PID
adb shell pidof -s com.example.app

# Start gdbserver and attach
adb shell gdbserver :1234 --attach <pid>

# Or using TCP
adb shell gdbserver :1234 --attach <pid>
```

**Port Forwarding:**
```bash
# Forward port from device to host
adb forward tcp:1234 tcp:1234

# Connect GDB
gdb
(gdb) target remote :1234
```

#### Launch Process with gdbserver

**Launch Process:**
```bash
# Launch process with gdbserver
adb shell gdbserver :1234 /system/bin/my_process arg1 arg2

# Forward port
adb forward tcp:1234 tcp:1234

# Connect GDB
gdb
(gdb) target remote :1234
```

#### Using ADB Port Forwarding

**ADB Port Forwarding:**
```bash
# Forward port before starting gdbserver
adb forward tcp:1234 tcp:1234

# Start gdbserver
adb shell gdbserver :1234 --attach <pid>

# Connect GDB
gdb
(gdb) target remote :1234
```

### GDB Setup

#### Loading Symbols

**Loading Symbols:**
```gdb
# Load binary with symbols
(gdb) file /path/to/binary

# Load shared library symbols
(gdb) add-symbol-file /path/to/lib.so 0x<base_address>

# Set solib-search-path
(gdb) set solib-search-path /path/to/symbols:/another/path
```

#### Setting Up Source Paths

**Source Paths:**
```gdb
# Set source directory
(gdb) directory /path/to/source

# Add source directory
(gdb) directory /another/source/path

# Show source paths
(gdb) show directories
```

### GDB Commands

#### Basic Commands

**Basic Commands:**
```gdb
# Continue execution
(gdb) continue
(gdb) c

# Step into function
(gdb) step
(gdb) s

# Step over function
(gdb) next
(gdb) n

# Finish current function
(gdb) finish

# Interrupt execution
(gdb) interrupt
Ctrl+C
```

#### Breakpoint Commands

**Breakpoint Commands:**
```gdb
# Set breakpoint
(gdb) break function_name
(gdb) break file.c:123
(gdb) break *0x12345678

# List breakpoints
(gdb) info breakpoints

# Delete breakpoint
(gdb) delete 1
(gdb) delete

# Enable/disable breakpoint
(gdb) disable 1
(gdb) enable 1
```

#### Inspection Commands

**Inspection Commands:**
```gdb
# Print variable
(gdb) print variable_name
(gdb) p variable_name

# Print with format
(gdb) print/x variable_name  # hex
(gdb) print/d variable_name  # decimal
(gdb) print/t variable_name  # binary

# Print array
(gdb) print array[0]@10

# Print structure
(gdb) print *struct_ptr

# Inspect memory
(gdb) x/10x 0x12345678
(gdb) x/10i $pc
```

#### Stack Commands

**Stack Commands:**
```gdb
# Backtrace
(gdb) backtrace
(gdb) bt

# Frame information
(gdb) info frame

# Select frame
(gdb) frame 1
(gdb) f 1

# Up/down stack
(gdb) up
(gdb) down
```

### Debugging Workflows

#### Debugging Native Crash

**Crash Debugging:**
```bash
# 1. Get crash PID
adb shell pidof -s crashed_process

# 2. Start gdbserver
adb shell gdbserver :1234 --attach <pid>

# 3. Forward port
adb forward tcp:1234 tcp:1234

# 4. Connect GDB
gdb
(gdb) file /path/to/binary
(gdb) target remote :1234

# 5. Analyze crash
(gdb) bt
(gdb) info registers
(gdb) x/10i $pc
```

#### Debugging Running Process

**Running Process Debugging:**
```bash
# 1. Get process PID
PID=$(adb shell pidof -s com.example.app)

# 2. Start gdbserver
adb shell gdbserver :1234 --attach $PID

# 3. Forward port
adb forward tcp:1234 tcp:1234

# 4. Connect GDB
gdb
(gdb) file /path/to/binary
(gdb) set solib-search-path /path/to/symbols
(gdb) target remote :1234

# 5. Set breakpoints and debug
(gdb) break function_name
(gdb) continue
```

#### Debugging Native Library

**Library Debugging:**
```bash
# 1. Get process PID
PID=$(adb shell pidof -s com.example.app)

# 2. Start gdbserver
adb shell gdbserver :1234 --attach $PID

# 3. Forward port
adb forward tcp:1234 tcp:1234

# 4. Connect GDB
gdb
(gdb) file /path/to/app_binary
(gdb) set solib-search-path /path/to/lib_symbols
(gdb) target remote :1234

# 5. Load library symbols
(gdb) add-symbol-file /path/to/lib.so 0x<base_address>

# 6. Set breakpoint in library
(gdb) break lib_function
(gdb) continue
```

### Advanced GDB Features

#### Conditional Breakpoints

**Conditional Breakpoints:**
```gdb
# Set conditional breakpoint
(gdb) break function_name if variable == value
(gdb) break file.c:123 if count > 10

# Modify breakpoint condition
(gdb) condition 1 variable == value
```

#### Watchpoints

**Watchpoints:**
```gdb
# Watch variable
(gdb) watch variable_name

# Watch memory address
(gdb) watch *0x12345678

# Watch for write
(gdb) watch variable_name

# Watch for read/write
(gdb) rwatch variable_name
(gdb) awatch variable_name
```

#### Multi-Thread Debugging

**Thread Commands:**
```gdb
# List threads
(gdb) info threads

# Switch thread
(gdb) thread 2

# Apply command to all threads
(gdb) thread apply all bt

# Set thread-specific breakpoint
(gdb) break function_name thread 2
```

### Debugging Best Practices

#### Best Practices

**Best Practices:**
- Use debug builds with symbols
- Set up symbol paths correctly
- Use appropriate breakpoints
- Keep GDB session organized
- Save debugging sessions

**Practice Guidelines:**
- **Debug Builds:** Use debug builds with symbols
- **Symbol Paths:** Set up symbol paths correctly
- **Breakpoints:** Use appropriate breakpoints
- **Organization:** Keep GDB session organized
- **Sessions:** Save debugging sessions

### Common Issues

#### Symbol Issues

**Symbol Problems:**
- Missing symbols
- Wrong symbol paths
- Mismatched symbols
- Stripped binaries

**Solutions:**
```gdb
# Check symbols
(gdb) info functions
(gdb) info variables

# Verify symbol file
(gdb) file /path/to/binary
(gdb) info files

# Set symbol paths
(gdb) set solib-search-path /path/to/symbols
```

#### Connection Issues

**Connection Problems:**
- Port forwarding issues
- Network connectivity
- gdbserver not running
- Permission issues

**Solutions:**
```bash
# Check port forwarding
adb forward --list

# Restart port forwarding
adb forward --remove tcp:1234
adb forward tcp:1234 tcp:1234

# Check gdbserver
adb shell ps | grep gdbserver

# Restart gdbserver
adb shell killall gdbserver
adb shell gdbserver :1234 --attach <pid>
```

## Key Takeaways

1. **gdbserver** is a remote debugging server that allows GDB (GNU Debugger) to debug native code running on Android devices over a network connection.

2. **gdbserver setup** includes installing gdbserver (pre-installed on some devices, available in AOSP builds, can be pushed to device), gdbserver location (system location, temporary location, vendor-specific locations), and setup methods.

3. **Starting gdbserver** includes attach to running process (get process PID, start gdbserver and attach, port forwarding), launch process with gdbserver (launch process with gdbserver, forward port, connect GDB), using ADB port forwarding (forward port before starting gdbserver, start gdbserver, connect GDB), and starting methods.

4. **GDB setup** includes loading symbols (load binary with symbols, load shared library symbols, set solib-search-path), setting up source paths (set source directory, add source directory, show source paths), and setup methods.

5. **GDB commands** include basic commands (continue, step, next, finish, interrupt), breakpoint commands (set breakpoint, list breakpoints, delete breakpoint, enable/disable breakpoint), inspection commands (print variable, print with format, print array, print structure, inspect memory), stack commands (backtrace, frame information, select frame, up/down stack), and command usage.

6. **Debugging workflows** include debugging native crash (get crash PID, start gdbserver, forward port, connect GDB, analyze crash), debugging running process (get process PID, start gdbserver, forward port, connect GDB, set breakpoints and debug), debugging native library (get process PID, start gdbserver, forward port, connect GDB, load library symbols, set breakpoint in library), and workflow examples.

7. **Advanced GDB features** include conditional breakpoints (set conditional breakpoint, modify breakpoint condition), watchpoints (watch variable, watch memory address, watch for write, watch for read/write), multi-thread debugging (list threads, switch thread, apply command to all threads, set thread-specific breakpoint), and advanced features.

8. **Debugging best practices** include best practices (use debug builds with symbols, set up symbol paths correctly, use appropriate breakpoints, keep GDB session organized, save debugging sessions), practice guidelines, and implementation practices.

9. **Understanding gdbserver** is essential for AOSP development, enabling native debugging, remote access, full GDB features, and proper gdbserver usage.

## Related Topics

- **Debugging native crashes (tombstones):** Native crash debugging details
- **Logging in native layers:** Native logging details
- **AddressSanitizer, HWASan in Android:** Memory debugging tools

