---
number: 179
title: Adding features to frameworks/base
slug: adding-features-to-frameworks-base
level: advanced
tags:
  - aosp
  - frameworks
  - framework-customization
  - feature-addition
  - aosp-development
prerequisites:
  - customizing-framework-services
  - adding-new-system-apis
  - android-framework-internals
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-179
---

# Adding features to frameworks/base

## Overview

Adding features to frameworks/base refers to the process of extending the Android framework with new functionality, including new APIs, system services, framework components, and framework-level features. Understanding how to add features to frameworks/base is essential for AOSP development, as it explains how to extend the framework, how to add new APIs, how to integrate new features, how to maintain compatibility, and how to test framework additions. This guide provides a comprehensive overview of adding features to frameworks/base, feature design, API development, service integration, framework extension, and feature implementation best practices.

Think of adding features to frameworks/base like adding new capabilities to a building's infrastructure: just as you can add new electrical systems, plumbing, or HVAC features to a building's infrastructure, adding features to frameworks/base allows you to add new capabilities, APIs, and services to the Android framework infrastructure. These features become available to all applications and system components.

## Deep Explanation

### What is Adding Features to frameworks/base?

Adding features to frameworks/base refers to the process of extending the Android framework with new functionality, including new APIs, system services, framework components, and framework-level features that become available throughout the Android system.

**Key Characteristics:**
- **Framework Extension:** Extend framework capabilities
- **API Development:** Add new APIs
- **Service Integration:** Integrate with system services
- **System-Wide:** Available system-wide
- **Compatibility:** Maintain compatibility

**Why Add Features to frameworks/base?**
- **New Functionality:** Add new capabilities
- **System Integration:** Integrate with system
- **API Exposure:** Expose functionality via APIs
- **Framework Evolution:** Evolve framework
- **OEM Features:** Add OEM-specific features

### Feature Design

#### Feature Planning

**Planning Steps:**
- Define feature requirements
- Design feature architecture
- Plan API design
- Consider compatibility
- Plan integration

**Planning Characteristics:**
- Requirement analysis
- Architecture design
- API design
- Compatibility planning
- Integration planning

#### Architecture Design

**Design Considerations:**
- Feature location in framework
- Service integration
- API design
- Data structures
- Lifecycle management

**Design Process:**
```
1. Analyze requirements
2. Design architecture
3. Design APIs
4. Plan integration
5. Design data flow
```

### API Development

#### API Design

**API Design Principles:**
- Clear and intuitive
- Well-documented
- Backward compatible
- Efficient
- Secure

**API Design Process:**
```
1. Define API requirements
2. Design API interface
3. Design data structures
4. Document API
5. Review API design
```

#### API Implementation

**Implementation Steps:**
```java
// Define API interface
public interface IMyFeature {
    void doSomething(String param);
    Result getResult();
}

// Implement API
public class MyFeatureService extends IMyFeature.Stub {
    @Override
    public void doSomething(String param) {
        // Implementation
    }
    
    @Override
    public Result getResult() {
        // Implementation
        return result;
    }
}
```

**Implementation Characteristics:**
- Interface definition
- Service implementation
- Binder integration
- Error handling
- Security checks

### Service Integration

#### System Service Integration

**Integration Process:**
```java
// In SystemServer
public class SystemServer {
    private MyFeatureService mMyFeatureService;
    
    private void startBootstrapServices() {
        // Create service
        mMyFeatureService = new MyFeatureService(context);
        
        // Register service
        ServiceManager.addService(Context.MY_FEATURE_SERVICE, 
                                 mMyFeatureService);
    }
}
```

**Integration Characteristics:**
- Service creation
- Service registration
- Lifecycle management
- System integration
- Service availability

#### Framework Integration

**Framework Integration:**
- Add framework classes
- Extend existing classes
- Add framework APIs
- Integrate with components
- Update framework manifest

**Integration Methods:**
- Class addition
- Class extension
- API addition
- Component integration
- Manifest updates

### Framework Extension

#### New Framework Classes

**Class Development:**
```java
// New framework class
public class MyFeatureManager {
    private IMyFeature mService;
    
    public MyFeatureManager(Context context) {
        mService = IMyFeature.Stub.asInterface(
            ServiceManager.getService(Context.MY_FEATURE_SERVICE));
    }
    
    public void doSomething(String param) {
        try {
            mService.doSomething(param);
        } catch (RemoteException e) {
            // Handle error
        }
    }
}
```

**Class Characteristics:**
- Framework class structure
- Service binding
- API exposure
- Error handling
- Lifecycle management

#### Framework API Addition

**API Addition:**
```java
// In framework/base/core/java/android/
public class MyFeature {
    public static void doSomething(Context context, String param) {
        MyFeatureManager manager = 
            context.getSystemService(MyFeatureManager.class);
        manager.doSomething(param);
    }
}
```

**API Characteristics:**
- Public API
- Framework integration
- Service access
- Error handling
- Documentation

### Build System Integration

#### Android.bp Configuration

**Module Definition:**
```blueprint
android_library {
    name: "framework-myfeature",
    srcs: [
        "core/java/android/myfeature/**/*.java",
    ],
    libs: [
        "framework",
    ],
    sdk_version: "current",
}
```

**Build Characteristics:**
- Module definition
- Source organization
- Dependency management
- SDK version
- Build integration

#### Build Integration

**Integration Steps:**
- Add module to build
- Configure dependencies
- Update framework build
- Test build
- Verify integration

**Integration Characteristics:**
- Build system integration
- Dependency configuration
- Framework build updates
- Build testing
- Integration verification

### Feature Implementation

#### Implementation Steps

**Implementation Flow:**
```
1. Design feature
2. Implement core functionality
3. Add APIs
4. Integrate with services
5. Add framework classes
6. Update build system
7. Test feature
8. Document feature
```

**Implementation Characteristics:**
- Design-driven development
- Incremental implementation
- Service integration
- Framework integration
- Testing and documentation

#### Testing

**Testing Requirements:**
- Unit tests
- Integration tests
- API tests
- Compatibility tests
- Performance tests

**Testing Approach:**
- Test core functionality
- Test API usage
- Test service integration
- Test framework integration
- Test compatibility

### Compatibility Considerations

#### Backward Compatibility

**Compatibility Requirements:**
- Maintain existing APIs
- Don't break existing behavior
- Add new APIs carefully
- Version management
- Deprecation handling

**Compatibility Methods:**
- API versioning
- Deprecation strategy
- Backward compatibility
- Migration paths
- Documentation

#### Framework Compatibility

**Framework Compatibility:**
- Maintain framework contracts
- Follow framework patterns
- Use framework APIs
- Test with framework
- Maintain stability

**Compatibility Characteristics:**
- Contract maintenance
- Pattern adherence
- API usage
- Framework testing
- Stability assurance

### Feature Best Practices

#### Best Practices

**Best Practices:**
- Design carefully
- Follow framework patterns
- Maintain compatibility
- Test thoroughly
- Document completely

**Practice Guidelines:**
- **Design:** Design carefully
- **Patterns:** Follow framework patterns
- **Compatibility:** Maintain compatibility
- **Testing:** Test thoroughly
- **Documentation:** Document completely

## Key Takeaways

1. **Adding features to frameworks/base** refers to the process of extending the Android framework with new functionality, including new APIs, system services, framework components, and framework-level features.

2. **Feature design** includes feature planning (define feature requirements, design feature architecture, plan API design, consider compatibility, plan integration), architecture design (feature location in framework, service integration, API design, data structures, lifecycle management), and design characteristics.

3. **API development** includes API design (clear and intuitive, well-documented, backward compatible, efficient, secure), API implementation (interface definition, service implementation, Binder integration, error handling, security checks), and development characteristics.

4. **Service integration** includes system service integration (service creation, service registration, lifecycle management, system integration, service availability), framework integration (add framework classes, extend existing classes, add framework APIs, integrate with components, update framework manifest), and integration characteristics.

5. **Framework extension** includes new framework classes (framework class structure, service binding, API exposure, error handling, lifecycle management), framework API addition (public API, framework integration, service access, error handling, documentation), and extension characteristics.

6. **Build system integration** includes Android.bp configuration (module definition, source organization, dependency management, SDK version, build integration), build integration (build system integration, dependency configuration, framework build updates, build testing, integration verification), and integration characteristics.

7. **Feature implementation** includes implementation steps (design feature, implement core functionality, add APIs, integrate with services, add framework classes, update build system, test feature, document feature), testing (unit tests, integration tests, API tests, compatibility tests, performance tests), and implementation characteristics.

8. **Compatibility considerations** include backward compatibility (maintain existing APIs, don't break existing behavior, add new APIs carefully, version management, deprecation handling), framework compatibility (maintain framework contracts, follow framework patterns, use framework APIs, test with framework, maintain stability), and compatibility characteristics.

9. **Understanding adding features to frameworks/base** is essential for AOSP development, enabling new functionality, system integration, API exposure, framework evolution, and proper feature implementation.

## Related Topics

- **Customizing framework services:** Framework service customization details
- **Adding new system APIs:** System API addition details
- **Android Framework Internals:** Framework internals details

