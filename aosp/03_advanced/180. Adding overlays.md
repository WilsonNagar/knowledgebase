---
number: 180
title: Adding overlays
slug: adding-overlays
level: advanced
tags:
  - aosp
  - overlays
  - resource-overlays
  - framework-overlays
  - customization
prerequisites:
  - customizing-systemui-oem-customizations
  - device-vendor-directory-structure
  - android-architecture-complete-overview
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-180
---

# Adding overlays

## Overview

Adding overlays refers to the process of creating resource overlays that override or extend resources from target packages, enabling customization of system apps and framework without modifying the original source code. Understanding how to add overlays is essential for AOSP development, as it explains how to customize resources, how to override system resources, how to add custom resources, how overlays work, and how overlays enable OEM customization. This guide provides a comprehensive overview of adding overlays, overlay structure, overlay creation, overlay configuration, overlay priority, and overlay best practices.

Think of adding overlays like applying a custom skin or theme to software: just as you can change the appearance of software by applying a theme without modifying the original code, overlays allow you to change the appearance and resources of Android apps and the framework without modifying the original source code. The overlay acts as a "layer" on top of the original resources, replacing or extending them.

## Deep Explanation

### What is Adding Overlays?

Adding overlays refers to the process of creating resource overlays that override or extend resources from target packages, enabling customization of system apps and framework without modifying the original source code.

**Key Characteristics:**
- **Resource Override:** Override target package resources
- **Non-Invasive:** No source code modification
- **Customization:** Enable customization
- **Priority-Based:** Priority-based selection
- **Package-Specific:** Target specific packages

**Why Add Overlays?**
- **Customization:** Customize without code changes
- **OEM Branding:** OEM-specific branding
- **Theming:** Theme support
- **Resource Modification:** Modify resources easily
- **Maintainability:** Easier to maintain

### Overlay Structure

#### Overlay Package Structure

**Overlay Package:**
```
overlay-package/
├── AndroidManifest.xml
└── res/
    ├── layout/
    ├── drawable/
    ├── values/
    └── ...
```

**Structure Characteristics:**
- Standard APK structure
- AndroidManifest.xml required
- Resource directories
- Overlay configuration
- Package format

#### AndroidManifest.xml Configuration

**Manifest Configuration:**
```xml
<manifest package="com.vendor.overlay.systemui"
          xmlns:android="http://schemas.android.com/apk/res/android">
    
    <overlay
        android:targetPackage="com.android.systemui"
        android:priority="1000"
        android:isStatic="true" />
    
    <application android:hasCode="false" />
</manifest>
```

**Manifest Properties:**
- `targetPackage` - Target package to overlay
- `priority` - Overlay priority
- `isStatic` - Static overlay (system partition)
- `hasCode` - Usually false for overlays

### Overlay Creation

#### Creating Overlay Package

**Creation Steps:**
```
1. Create overlay package directory
2. Create AndroidManifest.xml
3. Create resource directories
4. Add overlay resources
5. Configure overlay
6. Build overlay package
```

**Creation Process:**
- Package structure creation
- Manifest configuration
- Resource addition
- Overlay configuration
- Build and integration

#### Resource Override

**Resource Override:**
```xml
<!-- Original: SystemUI/res/values/colors.xml -->
<color name="status_bar_background">#000000</color>

<!-- Overlay: overlay/res/values/colors.xml -->
<color name="status_bar_background">#FF0000</color>
```

**Override Characteristics:**
- Same resource name
- Same resource type
- Override at runtime
- Priority-based selection
- Resource merging

### Overlay Types

#### Static Overlays

**Static Overlays:**
- Installed in system partition
- Always active
- High priority
- System-level customization
- OEM customizations

**Static Characteristics:**
- System partition location
- Always enabled
- High priority
- System integration
- Persistent

#### Runtime Overlays

**Runtime Overlays:**
- Can be enabled/disabled
- User or system controlled
- Dynamic activation
- Testing and development
- Flexible customization

**Runtime Characteristics:**
- Dynamic activation
- Enable/disable capability
- User control
- Development support
- Flexible usage

### Overlay Priority

#### Priority System

**Priority Levels:**
- Higher priority = higher precedence
- Multiple overlays can be active
- Priority determines selection
- Conflicts resolved by priority
- Priority-based merging

**Priority Configuration:**
```xml
<overlay
    android:targetPackage="com.android.systemui"
    android:priority="1000" />
```

**Priority Characteristics:**
- Numeric priority value
- Higher value = higher priority
- Priority-based selection
- Conflict resolution
- Merging order

#### Overlay Conflicts

**Conflict Resolution:**
- Higher priority wins
- Resource merging
- Last overlay applied
- Priority-based selection
- Conflict handling

**Resolution Process:**
- Identify conflicts
- Check priorities
- Select highest priority
- Apply overlay
- Merge resources

### Resource Override Examples

#### Color Override

**Color Override:**
```xml
<!-- Overlay: res/values/colors.xml -->
<resources>
    <color name="status_bar_background">#FF0000</color>
    <color name="status_bar_icon_color">#FFFFFF</color>
</resources>
```

**Override Characteristics:**
- Color resource override
- Visual customization
- Brand-specific colors
- Theme support
- Easy customization

#### Layout Override

**Layout Override:**
```xml
<!-- Overlay: res/layout/status_bar.xml -->
<!-- Custom layout replacing original -->
<LinearLayout ...>
    <!-- Custom layout content -->
</LinearLayout>
```

**Override Characteristics:**
- Layout replacement
- UI customization
- Structure modification
- Visual changes
- Layout flexibility

#### String Override

**String Override:**
```xml
<!-- Overlay: res/values/strings.xml -->
<resources>
    <string name="app_name">Custom Name</string>
</resources>
```

**Override Characteristics:**
- Text customization
- Localization support
- Brand-specific text
- Easy text changes
- No code modification

### Overlay Integration

#### Build System Integration

**Android.bp Integration:**
```blueprint
android_app {
    name: "SystemUIOverlay",
    manifest: "AndroidManifest.xml",
    resource_dirs: ["res"],
    sdk_version: "current",
    static_libs: [],
}
```

**Integration Characteristics:**
- Build system integration
- Package building
- Resource compilation
- Overlay packaging
- System integration

#### Installation

**Installation Methods:**
- System partition installation
- Vendor partition installation
- Product partition installation
- Runtime installation (development)

**Installation Process:**
```
1. Build overlay package
2. Install to appropriate partition
3. Configure overlay
4. Activate overlay
5. Verify overlay
```

### Overlay Management

#### Overlay Activation

**Activation Methods:**
- Static overlays (always active)
- Runtime activation
- Package manager
- Overlay manager service
- System properties

**Activation Process:**
- Overlay installation
- Overlay registration
- Overlay activation
- Resource loading
- Overlay application

#### Overlay Verification

**Verification Methods:**
```bash
# List overlays
adb shell pm list packages | grep overlay

# Check overlay status
adb shell cmd overlay list

# Enable/disable overlay
adb shell cmd overlay enable <package>
adb shell cmd overlay disable <package>
```

**Verification Characteristics:**
- Overlay listing
- Status checking
- Enable/disable control
- Verification tools
- Management commands

### Overlay Best Practices

#### Best Practices

**Best Practices:**
- Use appropriate priority
- Organize resources properly
- Test overlays thoroughly
- Document overlays
- Maintain compatibility

**Practice Guidelines:**
- **Priority:** Use appropriate priority
- **Organization:** Organize resources properly
- **Testing:** Test overlays thoroughly
- **Documentation:** Document overlays
- **Compatibility:** Maintain compatibility

## Key Takeaways

1. **Adding overlays** refers to the process of creating resource overlays that override or extend resources from target packages, enabling customization without modifying source code.

2. **Overlay structure** includes overlay package structure (standard APK structure, AndroidManifest.xml required, resource directories, overlay configuration, package format), AndroidManifest.xml configuration (targetPackage, priority, isStatic, hasCode), and structure characteristics.

3. **Overlay creation** includes creating overlay package (package structure creation, manifest configuration, resource addition, overlay configuration, build and integration), resource override (same resource name, same resource type, override at runtime, priority-based selection, resource merging), and creation characteristics.

4. **Overlay types** include static overlays (installed in system partition, always active, high priority, system-level customization, OEM customizations), runtime overlays (can be enabled/disabled, user or system controlled, dynamic activation, testing and development, flexible customization), and type characteristics.

5. **Overlay priority** includes priority system (higher priority = higher precedence, multiple overlays can be active, priority determines selection, conflicts resolved by priority, priority-based merging), overlay conflicts (higher priority wins, resource merging, last overlay applied, priority-based selection, conflict handling), and priority characteristics.

6. **Resource override examples** include color override (color resource override, visual customization, brand-specific colors, theme support, easy customization), layout override (layout replacement, UI customization, structure modification, visual changes, layout flexibility), string override (text customization, localization support, brand-specific text, easy text changes, no code modification), and override examples.

7. **Overlay integration** includes build system integration (build system integration, package building, resource compilation, overlay packaging, system integration), installation (system partition installation, vendor partition installation, product partition installation, runtime installation), and integration characteristics.

8. **Overlay management** includes overlay activation (static overlays always active, runtime activation, package manager, overlay manager service, system properties), overlay verification (overlay listing, status checking, enable/disable control, verification tools, management commands), and management characteristics.

9. **Understanding adding overlays** is essential for AOSP development, enabling customization, OEM branding, theming, resource modification, and proper overlay implementation.

## Related Topics

- **Customizing SystemUI (OEM customizations):** SystemUI customization details
- **device/ vendor/ directory structure:** Directory structure details
- **Resource overlays:** Overlay system details

