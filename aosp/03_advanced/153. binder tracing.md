---
number: 153
title: binder tracing
slug: binder-tracing
level: advanced
tags:
  - aosp
  - debugging
  - binder-tracing
  - binder-ipc
  - ipc-tracing
  - system-tracing
prerequisites:
  - binder-ipc-basics
  - binder-architecture
  - systrace-perfetto
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-153
---

# binder tracing

## Overview

binder tracing is a debugging technique that captures and analyzes Binder IPC transactions, providing detailed information about inter-process communication, transaction flow, performance characteristics, and debugging data. binder tracing allows developers to understand how processes communicate via Binder, identify IPC bottlenecks, debug transaction issues, and analyze Binder performance. Understanding binder tracing is essential for AOSP development, as it explains how to enable binder tracing, how to capture binder transactions, how to analyze binder traces, how to use binder tracing for debugging, and how binder tracing provides IPC visibility. This guide provides a comprehensive overview of binder tracing, tracing methods, trace analysis, performance debugging, and binder tracing best practices.

Think of binder tracing like a network packet sniffer for IPC: just as a packet sniffer captures network packets to analyze network communication (source, destination, data, timing), binder tracing captures Binder transactions to analyze IPC communication (source process, target process, transaction data, timing).

## Deep Explanation

### What is binder tracing?

binder tracing is a debugging technique that captures and analyzes Binder IPC transactions, providing detailed information about inter-process communication, transaction flow, performance characteristics, and debugging data. binder tracing enables developers to understand and debug Binder IPC behavior.

**Key Characteristics:**
- **IPC Visibility:** Provides IPC visibility
- **Transaction Capture:** Captures Binder transactions
- **Performance Analysis:** Performance analysis tool
- **Debugging:** Essential debugging tool
- **Detailed Information:** Detailed transaction information

**Why binder tracing?**
- **IPC Debugging:** Debug IPC issues
- **Performance Analysis:** Analyze IPC performance
- **Transaction Flow:** Understand transaction flow
- **Bottleneck Identification:** Identify IPC bottlenecks

### Binder Tracing Methods

#### Property-Based Tracing

**Property-Based Tracing:**
- Enable via system property
- Global binder tracing
- Simple to enable
- System-wide tracing

**Enabling Property Tracing:**
```bash
# Enable binder tracing
adb shell setprop debug.binder.trace 1

# Disable binder tracing
adb shell setprop debug.binder.trace 0

# Check tracing status
adb shell getprop debug.binder.trace
```

#### Perfetto Integration

**Perfetto Integration:**
- Binder events in Perfetto
- Unified tracing
- Better visualization
- Combined with other events

**Enabling in Perfetto:**
```bash
# Record trace with binder events
adb shell perfetto -t 10s -o /data/misc/perfetto-traces/trace.pb \
  -c - <<EOF
data_sources: {
    config {
        name: "linux.ftrace"
        ftrace_config {
            ftrace_events: "binder/binder_transaction"
            ftrace_events: "binder/binder_transaction_received"
            ftrace_events: "binder/binder_set_priority"
        }
    }
}
EOF
```

#### atrace Integration

**atrace Integration:**
- Binder categories in atrace
- Application-level tracing
- Combined with other categories
- Simple usage

**Enabling in atrace:**
```bash
# Trace binder events
adb shell atrace -t 10 -b 32768 binder_driver binder_lock

# Trace with other categories
adb shell atrace -t 10 -b 32768 gfx view binder_driver binder_lock
```

### Binder Trace Events

#### Transaction Events

**Transaction Events:**
- **binder_transaction:** Transaction sent
- **binder_transaction_received:** Transaction received
- **binder_transaction_complete:** Transaction completed
- **binder_transaction_failed:** Transaction failed

**Event Information:**
- Source process
- Target process
- Transaction code
- Transaction data size
- Transaction duration
- Transaction result

#### Priority Events

**Priority Events:**
- **binder_set_priority:** Priority change
- Priority adjustments
- Thread priority changes
- Process priority changes

#### Lock Events

**Lock Events:**
- **binder_lock:** Lock acquired
- **binder_unlock:** Lock released
- Lock contention
- Deadlock detection

### Trace Analysis

#### Transaction Flow Analysis

**Transaction Flow:**
```
1. Client process calls service
2. Binder transaction sent
3. Transaction received by server
4. Server processes transaction
5. Response sent back
6. Client receives response
```

**Flow Analysis:**
- Identify transaction path
- Track transaction flow
- Identify bottlenecks
- Measure transaction latency

#### Performance Analysis

**Performance Metrics:**
- Transaction duration
- Transaction frequency
- Transaction size
- Transaction latency
- Queue depth

**Performance Indicators:**
- High transaction latency
- Frequent transactions
- Large transaction sizes
- Queue buildup
- Transaction failures

#### Bottleneck Identification

**Common Bottlenecks:**
- Slow server processing
- High transaction frequency
- Large transaction data
- Lock contention
- Process blocking

**Bottleneck Analysis:**
- Identify slow transactions
- Check transaction frequency
- Analyze transaction sizes
- Review lock contention
- Check process blocking

### Binder Tracing in Perfetto

#### Viewing Binder Events

**Perfetto UI:**
- Binder transaction tracks
- Transaction timeline
- Transaction details
- Performance metrics

**Viewing Transactions:**
1. Open trace in Perfetto UI
2. Find Binder tracks
3. View transaction timeline
4. Analyze transaction details
5. Identify issues

#### Transaction Details

**Transaction Information:**
- Source process/thread
- Target process/thread
- Transaction code
- Transaction data
- Transaction duration
- Transaction result

**Transaction View:**
- Timeline view
- Process view
- Thread view
- Call stack view

### Debugging with Binder Tracing

#### Common Debugging Scenarios

**Scenario 1: Slow IPC Calls**
```bash
# Enable binder tracing
adb shell setprop debug.binder.trace 1

# Record trace
adb shell perfetto -t 10s -o /data/misc/perfetto-traces/trace.pb \
  -c - <<EOF
data_sources: {
    config {
        name: "linux.ftrace"
        ftrace_config {
            ftrace_events: "binder/binder_transaction"
            ftrace_events: "binder/binder_transaction_received"
        }
    }
}
EOF

# Analyze in Perfetto
# Look for long transaction durations
# Check transaction frequency
# Identify slow transactions
```

**Scenario 2: Transaction Failures**
```bash
# Enable binder tracing
adb shell setprop debug.binder.trace 1

# Record trace
adb shell perfetto -t 10s -o /data/misc/perfetto-traces/trace.pb \
  -c - <<EOF
data_sources: {
    config {
        name: "linux.ftrace"
        ftrace_config {
            ftrace_events: "binder/binder_transaction"
            ftrace_events: "binder/binder_transaction_failed"
        }
    }
}
EOF

# Analyze in Perfetto
# Look for failed transactions
# Check error codes
# Identify failure causes
```

**Scenario 3: Lock Contention**
```bash
# Enable binder tracing
adb shell setprop debug.binder.trace 1

# Record trace with lock events
adb shell atrace -t 10 -b 32768 binder_lock

# Analyze lock contention
# Check lock acquisition patterns
# Identify deadlocks
# Review lock duration
```

### Binder Statistics

#### dumpsys binder

**Binder Statistics:**
```bash
# Dump binder state
adb shell dumpsys binder

# Dump specific process
adb shell dumpsys binder | grep <process_name>

# Dump transaction statistics
adb shell dumpsys binder | grep -A 20 "Transaction stats"
```

**Statistics Information:**
- Transaction counts
- Object counts
- Reference counts
- Memory usage
- Process information

#### /proc/binder

**Proc Filesystem:**
```bash
# Binder statistics
adb shell cat /proc/binder/stats

# Binder state
adb shell cat /proc/binder/state

# Binder transactions
adb shell cat /proc/binder/transactions
```

**Information:**
- Transaction statistics
- Object statistics
- Process statistics
- Memory statistics

### Binder Tracing Best Practices

#### Best Practices

**Best Practices:**
- Enable tracing when needed
- Use appropriate tracing method
- Keep trace duration reasonable
- Analyze systematically
- Combine with other tools

**Practice Guidelines:**
- **When Needed:** Enable tracing when debugging IPC issues
- **Appropriate Method:** Use appropriate tracing method (Perfetto recommended)
- **Reasonable Duration:** Keep trace duration short (10-30 seconds)
- **Systematic Analysis:** Analyze traces systematically
- **Tool Combination:** Combine with dumpsys and logcat

### Advanced Binder Tracing

#### Custom Binder Events

**Custom Events:**
- Add custom trace points
- Application-specific events
- Performance markers
- Debug markers

**Custom Event Example:**
```cpp
// In Binder service code
#include <cutils/trace.h>

ATRACE_BEGIN("MyService::doSomething");
// ... service code ...
ATRACE_END();
```

#### Transaction Filtering

**Transaction Filtering:**
- Filter by process
- Filter by transaction code
- Filter by duration
- Focus on specific transactions

**Filtering in Perfetto:**
- Use search box
- Filter by process/thread
- Filter by time range
- Focus on specific events

## Key Takeaways

1. **binder tracing** is a debugging technique that captures and analyzes Binder IPC transactions, providing detailed information about inter-process communication, transaction flow, performance characteristics, and debugging data.

2. **Binder tracing methods** include property-based tracing (enable via system property, global binder tracing, simple to enable), Perfetto integration (binder events in Perfetto, unified tracing, better visualization), atrace integration (binder categories in atrace, application-level tracing, combined with other categories), and tracing methods.

3. **Binder trace events** include transaction events (binder_transaction, binder_transaction_received, binder_transaction_complete, binder_transaction_failed), priority events (binder_set_priority, priority adjustments), lock events (binder_lock, binder_unlock, lock contention), and event information.

4. **Trace analysis** includes transaction flow analysis (identify transaction path, track transaction flow, identify bottlenecks, measure transaction latency), performance analysis (transaction duration, transaction frequency, transaction size, transaction latency, queue depth), bottleneck identification (slow server processing, high transaction frequency, large transaction data, lock contention, process blocking), and analysis techniques.

5. **Binder tracing in Perfetto** includes viewing binder events (binder transaction tracks, transaction timeline, transaction details, performance metrics), transaction details (source process/thread, target process/thread, transaction code, transaction data, transaction duration, transaction result), and viewing methods.

6. **Debugging with binder tracing** includes common debugging scenarios (slow IPC calls, transaction failures, lock contention), and debugging examples.

7. **Binder statistics** include dumpsys binder (dump binder state, dump specific process, dump transaction statistics), /proc/binder (binder statistics, binder state, binder transactions), and statistics information.

8. **Binder tracing best practices** include best practices (enable tracing when needed, use appropriate tracing method, keep trace duration reasonable, analyze systematically, combine with other tools), practice guidelines, and implementation practices.

9. **Understanding binder tracing** is essential for AOSP development, enabling IPC debugging, performance analysis, transaction flow understanding, and proper binder tracing usage.

## Related Topics

- **Binder IPC Basics:** Binder IPC details
- **Binder architecture:** Binder architecture details
- **systrace & perfetto:** System tracing details

