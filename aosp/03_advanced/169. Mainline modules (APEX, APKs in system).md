---
number: 169
title: 'Mainline modules (APEX, APKs in system)'
slug: mainline-modules-apex-apks-in-system
level: advanced
tags:
  - aosp
  - mainline
  - apex
  - apks
  - modules
  - play-system-updates
prerequisites:
  - modular-system-components
  - treble-architecture
  - android-architecture-complete-overview
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-169
---

# Mainline modules (APEX, APKs in system)

## Overview

Mainline modules refer to system components that can be updated independently through Google Play System Updates, including APEX packages and system APKs. Mainline modules enable faster security updates, independent component updates, and better system modularity without requiring full system updates. Understanding mainline modules is essential for AOSP development, as it explains how system components are modularized, how APEX packages work, how system APKs are updated, how Play System Updates deliver updates, and how mainline modules improve system updateability. This guide provides a comprehensive overview of mainline modules, APEX modules, system APK modules, Play System Updates, module updates, and mainline benefits.

Think of mainline modules like app updates on your phone: just as you can update individual apps through the app store without updating the entire operating system, mainline modules allow you to update individual system components (like security patches, media codecs, or network components) through Play System Updates without requiring a full Android system update. This enables faster delivery of critical updates and improvements.

## Deep Explanation

### What are Mainline Modules?

Mainline modules refer to system components that can be updated independently through Google Play System Updates, including APEX packages and system APKs. Mainline modules enable independent component updates.

**Key Characteristics:**
- **Updatable:** Can be updated independently
- **Modular:** System components as modules
- **Play Updates:** Updated via Play System Updates
- **Versioned:** Versioned modules
- **Critical:** Critical system components

**Why Mainline Modules?**
- **Faster Updates:** Faster security and feature updates
- **Independent Updates:** Update components independently
- **Better Security:** Faster security patches
- **Modularity:** Better system modularity

### APEX Modules

#### APEX Overview

**APEX (Android Pony EXpress):**
- Package format for system components
- Updatable system modules
- Versioned packages
- Pre-installation verification

**APEX Characteristics:**
- System component packages
- Can be updated via Play System Updates
- Versioned modules
- Verified before installation

#### APEX Package Structure

**APEX Package:**
```
apex_payload.img    - Mountable image
apex_manifest.pb   - Package manifest
AndroidManifest.xml - APK-style manifest
```

**Package Contents:**
- Native libraries
- Native binaries
- Configuration files
- Metadata

#### APEX Module Types

**APEX Module Categories:**
- **Media Modules:** Media codecs, media framework
- **Runtime Modules:** ART runtime components
- **Network Modules:** Network stack components
- **Security Modules:** Security components
- **Framework Modules:** Framework components

**Module Examples:**
- `com.android.media`
- `com.android.runtime`
- `com.android.networkstack`
- `com.android.cellbroadcast`

### System APK Modules

#### System APK Overview

**System APKs:**
- System applications as modules
- Updatable system apps
- APK package format
- Play System Updates

**APK Characteristics:**
- APK package format
- System application modules
- Can be updated independently
- Versioned modules

#### System APK Types

**APK Module Categories:**
- **Settings Modules:**** Settings app components
- **SystemUI Modules:** SystemUI components
- **Framework Modules:** Framework APKs
- **Service Modules:** System service APKs

**Module Examples:**
- Settings app updates
- SystemUI updates
- Framework APK updates
- Service APK updates

### Play System Updates

#### Update Mechanism

**Play System Updates:**
- Google Play delivers updates
- Independent of Android version
- Component-level updates
- Automatic or manual updates

**Update Process:**
```
1. Google releases module update
2. Play Store downloads update
3. Device verifies update
4. Update installs
5. Module activates
```

#### Update Delivery

**Update Delivery Methods:**
- Automatic updates (default)
- Manual updates (user-initiated)
- Background updates
- Foreground updates

**Delivery Characteristics:**
- Over-the-air delivery
- No reboot required (usually)
- Component-level updates
- Version management

### Module Installation

#### APEX Installation

**APEX Installation Process:**
```
1. Download APEX package
2. Verify package signature
3. Verify package integrity
4. Pre-installation checks
5. Install APEX
6. Mount APEX
7. Activate module
```

**Installation Characteristics:**
- Signature verification
- Integrity verification
- Pre-installation checks
- Mount-based activation

#### APK Installation

**APK Installation Process:**
```
1. Download APK package
2. Verify package signature
3. Install APK
4. Register components
5. Activate module
```

**Installation Characteristics:**
- Signature verification
- Component registration
- System integration
- Activation process

### Module Updates

#### Update Process

**Update Flow:**
```
1. New module version available
2. Download update
3. Verify update
4. Install update
5. Replace old version
6. Activate new version
```

**Update Characteristics:**
- Version-based updates
- Update verification
- Replacement process
- Activation required

#### Update Verification

**Verification Steps:**
- Signature verification
- Integrity verification
- Version compatibility
- Dependency checking

**Verification Requirements:**
- Valid signature
- Intact package
- Compatible version
- Satisfied dependencies

### Module Versioning

#### Version Management

**Version Strategy:**
- Semantic versioning
- Version compatibility
- Backward compatibility
- Version negotiation

**Version Characteristics:**
- Versioned modules
- Compatibility rules
- Version requirements
- Version negotiation

#### Compatibility

**Compatibility Rules:**
- Interface compatibility
- Version compatibility
- Dependency compatibility
- System compatibility

**Compatibility Characteristics:**
- Interface contracts
- Version requirements
- Dependency rules
- System requirements

### Module Lifecycle

#### Module States

**Module States:**
- **INSTALLED:** Module installed
- **ACTIVE:** Module active
- **INACTIVE:** Module inactive
- **UPDATING:** Module updating

**State Transitions:**
```
INSTALLED → ACTIVE
ACTIVE → UPDATING → ACTIVE
ACTIVE → INACTIVE
```

#### Module Activation

**Activation Process:**
- Module installed
- Dependencies satisfied
- System ready
- Module activated

**Activation Characteristics:**
- Dependency checking
- System readiness
- Activation process
- State management

### Mainline Benefits

#### Faster Updates

**Update Benefits:**
- Faster security patches
- Component-level updates
- No full system update
- Reduced update time

**Benefit Details:**
- Critical updates faster
- Component updates
- Selective updates
- Faster delivery

#### Better Security

**Security Benefits:**
- Faster security patches
- Critical fixes quickly
- Security improvements
- Vulnerability fixes

**Security Characteristics:**
- Rapid security updates
- Critical fix delivery
- Security improvements
- Vulnerability mitigation

#### Modularity

**Modularity Benefits:**
- Independent components
- Component-level management
- Flexible architecture
- Better organization

**Modularity Characteristics:**
- Component independence
- Individual management
- Architecture flexibility
- Better organization

### Module Management

#### Module Discovery

**Discovery Methods:**
- System queries modules
- Module registry
- Version checking
- Availability checking

**Discovery Characteristics:**
- Runtime discovery
- Module registry
- Version information
- Availability status

#### Module Monitoring

**Monitoring:**
- Module status
- Version tracking
- Update availability
- Health monitoring

**Monitoring Characteristics:**
- Status tracking
- Version monitoring
- Update detection
- Health checks

### Mainline Best Practices

#### Best Practices

**Best Practices:**
- Design modules carefully
- Maintain compatibility
- Version modules properly
- Test updates thoroughly
- Document module interfaces

**Practice Guidelines:**
- **Design:** Design modules carefully
- **Compatibility:** Maintain compatibility
- **Versioning:** Version modules properly
- **Testing:** Test updates thoroughly
- **Documentation:** Document module interfaces

## Key Takeaways

1. **Mainline modules** refer to system components that can be updated independently through Google Play System Updates, including APEX packages and system APKs.

2. **APEX modules** include APEX overview (package format for system components, updatable system modules, versioned packages, pre-installation verification), APEX package structure (apex_payload.img, apex_manifest.pb, AndroidManifest.xml), APEX module types (media modules, runtime modules, network modules, security modules, framework modules), and APEX characteristics.

3. **System APK modules** include system APK overview (system applications as modules, updatable system apps, APK package format, Play System Updates), system APK types (settings modules, SystemUI modules, framework modules, service modules), and APK characteristics.

4. **Play System Updates** include update mechanism (Google Play delivers updates, independent of Android version, component-level updates, automatic or manual updates), update delivery (automatic updates, manual updates, background updates, foreground updates), and update process.

5. **Module installation** includes APEX installation (download APEX package, verify package signature, verify package integrity, pre-installation checks, install APEX, mount APEX, activate module), APK installation (download APK package, verify package signature, install APK, register components, activate module), and installation characteristics.

6. **Module updates** include update process (new module version available, download update, verify update, install update, replace old version, activate new version), update verification (signature verification, integrity verification, version compatibility, dependency checking), and update characteristics.

7. **Module versioning** includes version management (semantic versioning, version compatibility, backward compatibility, version negotiation), compatibility (interface compatibility, version compatibility, dependency compatibility, system compatibility), and versioning characteristics.

8. **Module lifecycle** includes module states (INSTALLED, ACTIVE, INACTIVE, UPDATING), module activation (module installed, dependencies satisfied, system ready, module activated), and lifecycle processes.

9. **Understanding mainline modules** is essential for AOSP development, enabling faster updates, better security, improved modularity, and proper mainline module implementation.

## Related Topics

- **Modular system components:** Modular components details
- **APEX package structure:** APEX details
- **Updating system components via Play System Updates:** Update process details

