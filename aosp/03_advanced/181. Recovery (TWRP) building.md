---
number: 181
title: Recovery (TWRP) building
slug: recovery-twrp-building
level: advanced
tags:
  - aosp
  - recovery
  - twrp
  - custom-recovery
  - recovery-building
  - rom-development
prerequisites:
  - building-boot-img-system-img-manually
  - device-tree-creation
  - build-system-structure
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-181
---

# Recovery (TWRP) building

## Overview

Recovery (TWRP) building refers to the process of building TWRP (Team Win Recovery Project), a custom recovery image that provides advanced recovery functionality for Android devices, including backup, restore, file management, and custom ROM installation. Understanding how to build TWRP recovery is essential for AOSP development, as it explains how to create custom recovery images, how to configure recovery for devices, how recovery works, and how recovery enables advanced device management. This guide provides a comprehensive overview of TWRP recovery building, recovery structure, build configuration, device configuration, recovery features, and recovery building best practices.

Think of TWRP recovery like a specialized maintenance mode for your device: just as a computer has a recovery mode or safe mode for troubleshooting and maintenance, TWRP recovery provides a specialized environment for backing up your device, installing custom ROMs, managing files, and performing system maintenance without booting into the normal Android system.

## Deep Explanation

### What is TWRP Recovery Building?

TWRP recovery building refers to the process of building TWRP (Team Win Recovery Project), a custom recovery image that provides advanced recovery functionality for Android devices, including backup, restore, file management, and custom ROM installation.

**Key Characteristics:**
- **Custom Recovery:** Custom recovery implementation
- **Advanced Features:** Backup, restore, file management
- **ROM Installation:** Custom ROM installation support
- **Device-Specific:** Configured for specific devices
- **Recovery Image:** Bootable recovery image

**Why Build TWRP Recovery?**
- **Device Management:** Advanced device management
- **ROM Development:** Enable ROM development
- **Backup/Restore:** Backup and restore functionality
- **Customization:** Device customization support
- **Development:** Development and testing support

### TWRP Recovery Overview

#### Recovery Purpose

**Recovery Functions:**
- System backup and restore
- Custom ROM installation
- File system management
- Partition management
- ADB access
- Terminal access

**Recovery Characteristics:**
- Bootable recovery environment
- Touch-based interface
- Advanced functionality
- Device-specific
- Customizable

#### TWRP Features

**TWRP Features:**
- Touch-based interface
- Backup and restore
- File manager
- Terminal emulator
- ADB support
- Custom ROM installation
- Partition management

**Feature Characteristics:**
- User-friendly interface
- Advanced functionality
- Development tools
- Customization support
- Recovery operations

### Recovery Structure

#### Recovery Image Structure

**Recovery Image:**
```
recovery.img
├── Recovery kernel
├── Recovery ramdisk
├── Recovery binaries
└── Recovery resources
```

**Structure Characteristics:**
- Kernel image
- Ramdisk with recovery
- Recovery binaries
- UI resources
- Configuration files

#### Recovery Components

**Recovery Components:**
- **Recovery Kernel:** Kernel for recovery
- **Recovery Ramdisk:** Recovery environment
- **Recovery Binary:** Main recovery program
- **UI Components:** Touch interface
- **Tools:** Recovery tools

**Component Characteristics:**
- Kernel support
- Recovery environment
- Main program
- User interface
- Utility tools

### Build Configuration

#### Device Configuration

**Device Setup:**
- Device tree configuration
- Recovery-specific config
- Partition configuration
- Display configuration
- Input configuration

**Configuration Files:**
```
device/<vendor>/<device>/
├── BoardConfig.mk
├── recovery.fstab
└── recovery config
```

**Configuration Characteristics:**
- Device-specific config
- Partition mapping
- Display settings
- Input settings
- Recovery settings

#### Build System Integration

**Build Integration:**
```makefile
# In BoardConfig.mk
TARGET_RECOVERY_FSTAB := device/<vendor>/<device>/recovery.fstab
BOARD_HAS_NO_SELECT_BUTTON := true
BOARD_TOUCH_RECOVERY := true
```

**Integration Characteristics:**
- Build system integration
- Configuration files
- Build rules
- Device configuration
- Recovery build

### Recovery Building Process

#### Build Steps

**Build Process:**
```
1. Configure device
2. Set up recovery source
3. Configure recovery
4. Build recovery image
5. Test recovery
6. Flash recovery
```

**Process Characteristics:**
- Device configuration
- Source setup
- Recovery configuration
- Image building
- Testing and flashing

#### Build Commands

**Build Commands:**
```bash
# Build recovery
source build/envsetup.sh
lunch <device>-<variant>
make recoveryimage

# Or build TWRP specifically
cd bootable/recovery-twrp
mka recoveryimage
```

**Command Characteristics:**
- Standard build commands
- TWRP-specific builds
- Recovery image output
- Build verification
- Image packaging

### Device Configuration

#### Recovery FSTAB

**FSTAB Configuration:**
```
# recovery.fstab
/system          ext4    /dev/block/bootdevice/by-name/system
/vendor          ext4    /dev/block/bootdevice/by-name/vendor
/data            ext4    /dev/block/bootdevice/by-name/userdata
/cache           ext4    /dev/block/bootdevice/by-name/cache
```

**FSTAB Characteristics:**
- Partition mapping
- File system types
- Mount points
- Block devices
- Recovery access

#### Display Configuration

**Display Setup:**
- Screen resolution
- Touch configuration
- Display drivers
- Input handling
- UI scaling

**Display Characteristics:**
- Resolution settings
- Touch support
- Driver configuration
- Input handling
- UI configuration

### Recovery Features

#### Backup and Restore

**Backup Features:**
- Full system backup
- Partition backup
- Selective backup
- Backup compression
- Backup verification

**Backup Process:**
- Select partitions
- Create backup
- Compress backup
- Verify backup
- Store backup

#### ROM Installation

**Installation Features:**
- ZIP installation
- OTA installation
- Custom ROM support
- Signature verification
- Installation logs

**Installation Process:**
- Select ROM package
- Verify signature
- Install ROM
- Wipe if needed
- Reboot system

### Recovery Building Best Practices

#### Best Practices

**Best Practices:**
- Test thoroughly
- Configure correctly
- Document configuration
- Test on device
- Maintain compatibility

**Practice Guidelines:**
- **Testing:** Test thoroughly
- **Configuration:** Configure correctly
- **Documentation:** Document configuration
- **Device Testing:** Test on device
- **Compatibility:** Maintain compatibility

## Key Takeaways

1. **TWRP recovery building** refers to the process of building TWRP (Team Win Recovery Project), a custom recovery image that provides advanced recovery functionality for Android devices.

2. **TWRP recovery overview** includes recovery purpose (system backup and restore, custom ROM installation, file system management, partition management, ADB access, terminal access), TWRP features (touch-based interface, backup and restore, file manager, terminal emulator, ADB support, custom ROM installation, partition management), and recovery characteristics.

3. **Recovery structure** includes recovery image structure (recovery kernel, recovery ramdisk, recovery binaries, recovery resources), recovery components (recovery kernel, recovery ramdisk, recovery binary, UI components, tools), and structure characteristics.

4. **Build configuration** includes device configuration (device tree configuration, recovery-specific config, partition configuration, display configuration, input configuration), build system integration (build system integration, configuration files, build rules, device configuration, recovery build), and configuration characteristics.

5. **Recovery building process** includes build steps (configure device, set up recovery source, configure recovery, build recovery image, test recovery, flash recovery), build commands (standard build commands, TWRP-specific builds, recovery image output, build verification, image packaging), and process characteristics.

6. **Device configuration** includes recovery FSTAB (partition mapping, file system types, mount points, block devices, recovery access), display configuration (screen resolution, touch configuration, display drivers, input handling, UI scaling), and configuration characteristics.

7. **Recovery features** include backup and restore (full system backup, partition backup, selective backup, backup compression, backup verification), ROM installation (ZIP installation, OTA installation, custom ROM support, signature verification, installation logs), and feature characteristics.

8. **Understanding TWRP recovery building** is essential for AOSP development, enabling device management, ROM development, backup/restore functionality, customization support, and proper recovery implementation.

## Related Topics

- **Building boot.img, system.img manually:** Image building details
- **Device tree creation:** Device tree details
- **OTA packages creation:** OTA details

