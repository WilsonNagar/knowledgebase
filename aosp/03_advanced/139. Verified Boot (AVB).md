---
number: 139
title: Verified Boot (AVB)
slug: verified-boot-avb
level: advanced
tags:
  - aosp
  - security
  - verified-boot
  - avb
  - android-verified-boot
  - boot-verification
  - chain-of-trust
prerequisites:
  - android-verified-boot-2-0-avb
  - boot-process-overview
  - android-partitions
estimated_minutes: 95
contributors: []
diagrams: []
examples: []
canonical_id: aosp-advanced-139
---

# Verified Boot (AVB)

## Overview

Verified Boot (AVB - Android Verified Boot) is a security mechanism that ensures the integrity and authenticity of the Android boot process by establishing a chain of trust from hardware to the operating system. AVB verifies that each component in the boot sequence has not been tampered with, using cryptographic signatures and hash verification. Understanding Verified Boot (AVB) is essential for AOSP development, as it explains how Android verifies boot components, how the chain of trust works, how AVB prevents tampering, how rollback protection works, and how AVB integrates with the boot process. This guide provides a comprehensive overview of Verified Boot (AVB), AVB architecture, chain of trust, verification process, rollback protection, and AVB integration.

Think of Verified Boot (AVB) like a security checkpoint system: just as security checkpoints verify identity and credentials at each stage before allowing passage, AVB verifies the cryptographic signatures and integrity of each boot component before allowing it to execute, creating an unbroken chain of trust from hardware to software.

## Deep Explanation

### What is Verified Boot (AVB)?

Verified Boot (AVB - Android Verified Boot) is a security mechanism that ensures the integrity and authenticity of the Android boot process by establishing a chain of trust from hardware to the operating system. AVB verifies that each component in the boot sequence has not been tampered with, using cryptographic signatures and hash verification.

**Key Characteristics:**
- **Chain of Trust:** Unbroken chain from hardware to software
- **Cryptographic Verification:** Uses signatures and hashes
- **Tamper Detection:** Detects unauthorized modifications
- **Rollback Protection:** Prevents version downgrades
- **Fail-Safe:** Halts boot if verification fails

**Why Verified Boot (AVB)?**
- **Security:** Prevents rootkits and bootkits
- **Integrity:** Ensures system integrity
- **Authenticity:** Verifies component authenticity
- **Trust:** Establishes trust in boot process

### AVB Architecture

#### AVB Components

**AVB Components:**
- **AVB Footer:** Metadata appended to partitions
- **AVB Descriptors:** Describe verification method
- **AVB Hash Tree:** Merkle tree for verification
- **Rollback Index:** Prevents version rollback
- **AVB Keys:** Cryptographic keys for signing

**Component Roles:**
- **AVB Footer:** Contains verification metadata
- **AVB Descriptors:** Define how to verify partition
- **AVB Hash Tree:** Enables block-level verification
- **Rollback Index:** Prevents downgrade attacks
- **AVB Keys:** Used for signature verification

#### AVB Verification Flow

**AVB Verification Flow:**
```
1. Bootloader loads partition
   ↓
2. Bootloader reads AVB footer
   ↓
3. Bootloader verifies AVB footer signature
   ↓
4. Bootloader checks rollback index
   ↓
5. Bootloader extracts hash/hashtree
   ↓
6. Bootloader verifies partition content
   ↓
7. If valid: Boot continues
   ↓
8. If invalid: Boot halted
```

**Verification Steps:**
- **Load Partition:** Bootloader loads partition
- **Read Footer:** Read AVB footer metadata
- **Verify Signature:** Verify footer signature
- **Check Rollback:** Check rollback index
- **Verify Content:** Verify partition content
- **Continue/Halt:** Continue if valid, halt if invalid

### Chain of Trust

#### Chain of Trust Concept

**Chain of Trust:**
- Unbroken chain from hardware to software
- Each component verifies the next
- Root of trust in hardware
- Cryptographic verification at each stage

**Chain Structure:**
```
Boot ROM (Hardware - Root of Trust)
   ↓ (verifies)
Bootloader (Verified by Boot ROM)
   ↓ (verifies)
Kernel + Ramdisk (Verified by Bootloader)
   ↓ (verifies)
System Partition (Verified by Kernel/dm-verity)
   ↓
Android System Running
```

#### Root of Trust

**Root of Trust:**
- Boot ROM is root of trust
- Hard-coded in processor
- Contains public keys
- Cannot be modified
- Most trusted component

**Root of Trust Characteristics:**
- **Hardware-Based:** Implemented in hardware
- **Immutable:** Cannot be modified
- **Trusted:** Most trusted component
- **Key Storage:** Contains verification keys

### Verification Process

#### Bootloader Verification

**Bootloader Verification:**
- Boot ROM verifies bootloader
- Uses cryptographic signatures
- Checks bootloader integrity
- Prevents unauthorized bootloaders

**Verification Process:**
```
1. Boot ROM loads bootloader
2. Boot ROM reads bootloader signature
3. Boot ROM verifies signature with public key
4. If valid: Execute bootloader
5. If invalid: Halt boot
```

#### Kernel Verification

**Kernel Verification:**
- Bootloader verifies kernel
- Uses AVB verification
- Checks kernel integrity
- Prevents unauthorized kernels

**Verification Process:**
```
1. Bootloader loads kernel partition
2. Bootloader reads AVB footer
3. Bootloader verifies AVB footer signature
4. Bootloader verifies kernel content
5. If valid: Load kernel
6. If invalid: Halt boot
```

#### System Partition Verification

**System Partition Verification:**
- Kernel verifies system partition
- Uses dm-verity for runtime verification
- Hash tree verification
- Transparent to applications

**Verification Process:**
```
1. Kernel mounts system partition
2. Kernel sets up dm-verity
3. Kernel verifies hash tree
4. Runtime verification on read
5. If invalid: I/O error
```

### AVB Descriptors

#### Hash Descriptor

**Hash Descriptor:**
- For small partitions (boot, dtbo)
- Contains hash of entire partition
- Simple verification
- Fast verification

**Hash Descriptor Structure:**
```
Hash Descriptor:
├── Partition name
├── Hash algorithm
├── Hash value
└── Rollback index
```

#### Hashtree Descriptor

**Hashtree Descriptor:**
- For large partitions (system, vendor)
- Contains Merkle tree root hash
- Block-level verification
- Used with dm-verity

**Hashtree Descriptor Structure:**
```
Hashtree Descriptor:
├── Partition name
├── Hash algorithm
├── Tree root hash
├── Tree size
└── Rollback index
```

### Rollback Protection

#### Rollback Index Concept

**Rollback Index:**
- Prevents version downgrades
- Stored per partition
- Incremented with each update
- Compared against stored value

**Rollback Protection:**
- **Prevents Downgrades:** Prevents installing older versions
- **Security Updates:** Ensures security updates are applied
- **Version Control:** Tracks partition versions
- **Attack Prevention:** Prevents rollback attacks

#### Rollback Index Storage

**Rollback Index Storage:**
- Stored in secure hardware (when available)
- Or in persistent storage
- Per-partition index
- Protected from modification

**Storage Characteristics:**
- **Secure Storage:** Stored in secure hardware
- **Persistent:** Persists across reboots
- **Per-Partition:** Each partition has own index
- **Protected:** Protected from modification

### AVB Integration

#### Boot Process Integration

**Boot Process Integration:**
- AVB integrated into boot process
- Verification at each stage
- Fail-safe behavior
- Transparent to users

**Integration Points:**
- **Boot ROM:** Verifies bootloader
- **Bootloader:** Verifies kernel
- **Kernel:** Verifies system partitions
- **Runtime:** dm-verity verifies at runtime

#### Build System Integration

**Build System Integration:**
- AVB integrated into build system
- `avbtool` for image management
- Automatic footer generation
- Policy configuration

**Build Integration:**
- **avbtool:** Tool for AVB operations
- **Footer Generation:** Automatic footer creation
- **Policy Configuration:** Configurable verification policies
- **Image Signing:** Automatic image signing

### AVB Modes

#### Verification Modes

**AVB Verification Modes:**
- **Enforcing:** Verification enforced (production)
- **Permissive:** Verification logged but not enforced (development)
- **Disabled:** Verification disabled (not recommended)

**Mode Characteristics:**
- **Enforcing:** Security enforced, boot halted on failure
- **Permissive:** Violations logged but allowed
- **Disabled:** No verification (security risk)

### AVB Benefits

#### Security Benefits

**Security Benefits:**
- Prevents rootkits and bootkits
- Protects against firmware attacks
- Ensures system integrity
- Prevents unauthorized modifications

**Security Features:**
- **Tamper Detection:** Detects modifications
- **Authenticity:** Verifies component authenticity
- **Integrity:** Ensures component integrity
- **Rollback Protection:** Prevents downgrades

#### Trust Benefits

**Trust Benefits:**
- Users can trust device integrity
- Protects against supply chain attacks
- Ensures updates are legitimate
- Maintains device security posture

### Debugging Verified Boot

#### Debugging Tools

**Debugging Tools:**
- `avbtool` - AVB image management
- `fastboot getvar` - Check AVB status
- Boot logs - View verification messages
- `dm-verity` status - Check runtime verification

**Debugging Commands:**
```bash
# Check AVB status
fastboot getvar vbmeta

# Verify AVB footer
avbtool verify_image --image boot.img

# Check dm-verity status
adb shell dmesg | grep dm-verity
```

#### Common Issues

**Common Issues:**
- Verification failures
- Rollback index mismatches
- Missing AVB footers
- Signature verification failures

**Debugging Steps:**
1. Check AVB status
2. Verify AVB footers
3. Check rollback indexes
4. Review boot logs
5. Verify signatures

## Key Takeaways

1. **Verified Boot (AVB)** is a security mechanism that ensures the integrity and authenticity of the Android boot process by establishing a chain of trust from hardware to the operating system.

2. **AVB architecture** includes AVB components (AVB footer, AVB descriptors, AVB hash tree, rollback index, AVB keys), AVB verification flow (load partition, read footer, verify signature, check rollback, verify content), and component roles.

3. **Chain of trust** includes chain of trust concept (unbroken chain from hardware to software, each component verifies the next, root of trust in hardware), chain structure (Boot ROM → Bootloader → Kernel → System), root of trust (Boot ROM is root of trust, hard-coded in processor, contains public keys, cannot be modified), and root of trust characteristics.

4. **Verification process** includes bootloader verification (Boot ROM verifies bootloader, uses cryptographic signatures, checks bootloader integrity), kernel verification (bootloader verifies kernel, uses AVB verification, checks kernel integrity), system partition verification (kernel verifies system partition, uses dm-verity for runtime verification, hash tree verification), and verification processes.

5. **AVB descriptors** include hash descriptor (for small partitions, contains hash of entire partition, simple verification), hashtree descriptor (for large partitions, contains Merkle tree root hash, block-level verification), and descriptor structures.

6. **Rollback protection** includes rollback index concept (prevents version downgrades, stored per partition, incremented with each update), rollback protection (prevents downgrades, ensures security updates, tracks partition versions), rollback index storage (stored in secure hardware, persistent, per-partition index, protected from modification), and storage characteristics.

7. **AVB integration** includes boot process integration (AVB integrated into boot process, verification at each stage, fail-safe behavior), build system integration (AVB integrated into build system, avbtool for image management, automatic footer generation), and integration points.

8. **AVB modes** include verification modes (enforcing, permissive, disabled), mode characteristics (enforcing: security enforced, permissive: violations logged, disabled: no verification), and mode usage.

9. **Understanding Verified Boot (AVB)** is essential for AOSP development, enabling boot security, integrity verification, tamper detection, and proper AVB architecture implementation.

## Related Topics

- **Android Verified Boot 2.0 (AVB):** AVB 2.0 details
- **Bootloader chain:** Bootloader chain of trust
- **Boot verification flow:** Boot verification process
- **dm-verity:** Device mapper verity

