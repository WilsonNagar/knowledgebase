---
number: 25
title: Soong Build System
slug: soong-build-system
level: beginner
tags:
  - aosp
  - build-system
  - soong
  - android.bp
  - blueprint
  - ninja
  - modern
prerequisites:
  - build-system-structure
  - make-based-build-system
estimated_minutes: 90
contributors: []
diagrams: []
examples: []
canonical_id: aosp-beginner-25
---

# Soong Build System

## Overview

Soong is Android's modern build system, introduced in Android 7.0 to replace the Make-based system. Written in Go, Soong provides faster builds, better parallelization, and easier maintenance compared to Make. Understanding Soong is essential for modern AOSP development, as it's the preferred build system for new code and the direction Android is moving toward. This guide provides a comprehensive overview of Soong, its architecture, how it works, and how to use it.

Think of Soong like a modern, automated factory compared to the traditional Make-based workshop: while the workshop (Make) relies on manual recipes and sequential processing, the modern factory (Soong) uses automated assembly lines, parallel processing, and intelligent scheduling to produce the same products much faster and more efficiently.

## Deep Explanation

### What is Soong?

Soong is Android's build system written in Go that processes Android.bp files (written in Blueprint language) and generates Ninja build files for execution. It was designed to address the limitations of the Make-based system and provide a modern, scalable build framework.

**Key Characteristics:**
- **Written in Go:** Modern, concurrent language
- **Blueprint Language:** Simple, declarative build descriptions
- **Ninja Backend:** Fast, low-level build executor
- **Parallel by Design:** Built for parallel execution
- **Type-Safe:** Compile-time checking of build descriptions

**Why Soong?**
- **Performance:** Faster builds than Make
- **Scalability:** Handles large projects better
- **Maintainability:** Easier to understand and modify
- **Modern:** Uses modern software engineering practices

**Current Status:**
- Primary build system for new code
- Gradually replacing Make
- Actively developed and improved
- Future direction for Android builds

### Soong Architecture

Soong consists of several components that work together:

#### 1. Blueprint Parser

**Purpose:**
Parses Android.bp files written in Blueprint language.

**Functionality:**
- Reads Android.bp files
- Parses Blueprint syntax
- Validates syntax
- Builds abstract syntax tree

**Implementation:**
- Written in Go
- Handles Blueprint language
- Provides error messages
- Supports incremental parsing

#### 2. Soong Builder

**Purpose:**
Processes parsed build descriptions and generates build plans.

**Functionality:**
- Resolves dependencies
- Builds dependency graph
- Validates build rules
- Generates Ninja files

**Implementation:**
- Core Soong logic
- Module type handlers
- Dependency resolution
- Build graph construction

#### 3. Ninja Generator

**Purpose:**
Generates Ninja build files from Soong's build graph.

**Functionality:**
- Converts build graph to Ninja format
- Generates build.ninja file
- Optimizes build order
- Handles parallel execution

**Implementation:**
- Ninja file format generation
- Build rule translation
- Dependency expression
- Output file management

#### 4. Module Types

**Purpose:**
Defines different types of buildable modules.

**Module Types:**
- `cc_library` - C/C++ libraries
- `cc_binary` - C/C++ executables
- `java_library` - Java libraries
- `android_app` - Android applications
- And many more...

**Functionality:**
- Each type has specific rules
- Handles compilation differently
- Produces appropriate outputs
- Manages dependencies

### Soong vs Make

#### Performance Comparison

**Build Speed:**
- **Soong:** Faster builds (2-3x improvement)
- **Make:** Slower, especially for large projects
- **Soong:** Better parallelization
- **Make:** Limited parallelization

**Why Soong is Faster:**
- Better dependency analysis
- More efficient graph traversal
- Optimized Ninja backend
- Reduced overhead

#### Syntax Comparison

**Make (Android.mk):**
```makefile
LOCAL_PATH := $(call my-dir)
include $(CLEAR_VARS)
LOCAL_MODULE := mylib
LOCAL_SRC_FILES := file1.c file2.c
include $(BUILD_SHARED_LIBRARY)
```

**Soong (Android.bp):**
```blueprint
cc_library {
    name: "mylib",
    srcs: ["file1.c", "file2.c"],
    shared_libs: ["liblog"],
}
```

**Soong Advantages:**
- Simpler syntax
- More readable
- Less boilerplate
- Type-safe

#### Maintainability

**Soong:**
- Easier to understand
- Better error messages
- Type checking
- Modern tooling

**Make:**
- Complex syntax
- Harder to debug
- Limited tooling
- Legacy system

### Android.bp Files

#### File Structure

Android.bp files use Blueprint language syntax:

**Basic Structure:**
```blueprint
cc_library {
    name: "mylib",
    srcs: ["src/file1.c", "src/file2.c"],
    shared_libs: ["liblog", "libutils"],
    cflags: ["-Wall", "-Werror"],
}
```

**Key Elements:**
- **Module Type:** `cc_library`, `android_app`, etc.
- **Properties:** `name`, `srcs`, `dependencies`, etc.
- **Values:** Strings, lists, booleans, etc.

#### Module Types

**C/C++ Modules:**
- `cc_library` - Shared or static library
- `cc_library_static` - Static library
- `cc_library_shared` - Shared library
- `cc_binary` - Executable
- `cc_object` - Object file

**Java Modules:**
- `java_library` - Java library (JAR)
- `java_library_static` - Static Java library
- `android_app` - Android application
- `android_library` - Android library

**Other Modules:**
- `filegroup` - Group of files
- `prebuilt_*` - Prebuilt binaries/libraries
- `genrule` - Custom build rules

#### Common Properties

**Source Files:**
- `srcs` - Source files to compile
- `exclude_srcs` - Files to exclude
- `generated_srcs` - Generated source files

**Dependencies:**
- `shared_libs` - Shared library dependencies
- `static_libs` - Static library dependencies
- `header_libs` - Header-only dependencies
- `whole_static_libs` - Whole archive linking

**Compilation:**
- `cflags` - C compilation flags
- `cppflags` - C++ compilation flags
- `ldflags` - Linker flags
- `include_dirs` - Include directories

**Other:**
- `name` - Module name (required)
- `visibility` - Who can use this module
- `vendor` - Vendor-specific module
- `proprietary` - Proprietary code

### Soong Build Process

#### Phase 1: Parsing

**1. File Discovery:**
- Soong scans source tree
- Finds all Android.bp files
- Reads file contents
- Tracks file locations

**2. Blueprint Parsing:**
- Parses each Android.bp file
- Validates syntax
- Builds parse tree
- Reports errors

**3. Module Extraction:**
- Extracts module definitions
- Identifies module types
- Collects properties
- Builds module list

#### Phase 2: Analysis

**1. Dependency Resolution:**
- Resolves module dependencies
- Validates dependency names
- Checks dependency types
- Builds dependency graph

**2. Validation:**
- Validates module properties
- Checks required properties
- Validates property types
- Reports errors

**3. Graph Construction:**
- Builds complete dependency graph
- Identifies build order
- Detects circular dependencies
- Optimizes graph

#### Phase 3: Generation

**1. Ninja File Generation:**
- Converts build graph to Ninja
- Generates build rules
- Creates build.ninja file
- Optimizes build order

**2. Build Plan:**
- Determines what to build
- Orders build execution
- Plans parallel execution
- Optimizes resource usage

#### Phase 4: Execution

**1. Ninja Execution:**
- Ninja reads build.ninja
- Executes build commands
- Manages parallel jobs
- Tracks build progress

**2. Build Output:**
- Compiles source files
- Links libraries
- Packages components
- Generates artifacts

### Soong Module Examples

#### Example 1: C/C++ Library

```blueprint
cc_library {
    name: "libmymodule",
    srcs: [
        "src/file1.c",
        "src/file2.cpp",
    ],
    shared_libs: [
        "liblog",
        "libutils",
    ],
    static_libs: [
        "libmystatic",
    ],
    cflags: [
        "-Wall",
        "-Werror",
    ],
    cppflags: [
        "-std=c++11",
    ],
    include_dirs: [
        "include",
    ],
    export_include_dirs: [
        "include",
    ],
}
```

**What This Does:**
- Builds shared library `libmymodule.so`
- Compiles C and C++ sources
- Links against shared and static libraries
- Sets compilation flags
- Exports include directories

#### Example 2: Android Application

```blueprint
android_app {
    name: "MyApp",
    srcs: [
        "src/**/*.java",
    ],
    resource_dirs: [
        "res",
    ],
    manifest: "AndroidManifest.xml",
    static_libs: [
        "android-support-v4",
    ],
    platform_apis: true,
    certificate: "platform",
    privileged: true,
}
```

**What This Does:**
- Builds Android app APK
- Compiles Java sources
- Includes resources
- Links against libraries
- Signs with platform certificate

#### Example 3: Executable

```blueprint
cc_binary {
    name: "mytool",
    srcs: [
        "main.c",
        "utils.c",
    ],
    shared_libs: [
        "liblog",
        "libcutils",
    ],
    cflags: [
        "-Wall",
    ],
}
```

**What This Does:**
- Builds executable `mytool`
- Compiles C sources
- Links against system libraries
- Produces binary executable

### Soong Features

#### Incremental Builds

**How It Works:**
- Tracks file changes
- Only rebuilds affected modules
- Efficient dependency tracking
- Fast iteration cycles

**Benefits:**
- Faster development
- Saves compilation time
- Quick testing
- Efficient workflow

#### Parallel Builds

**How It Works:**
- Analyzes dependency graph
- Identifies independent modules
- Builds in parallel
- Utilizes all CPU cores

**Benefits:**
- Faster overall builds
- Better resource utilization
- Scalable performance
- Reduced build time

#### Dependency Management

**How It Works:**
- Automatic dependency resolution
- Validates dependencies
- Handles transitive dependencies
- Prevents circular dependencies

**Benefits:**
- Correct build order
- No manual dependency management
- Prevents build errors
- Ensures consistency

#### Type Safety

**How It Works:**
- Compile-time type checking
- Validates property types
- Checks module types
- Reports type errors

**Benefits:**
- Catches errors early
- Prevents runtime issues
- Better error messages
- More reliable builds

### Soong Tools

#### soong_ui

**Purpose:**
Main Soong user interface and build executor.

**Usage:**
```bash
source build/envsetup.sh
lunch <device>-<variant>
m  # or make
```

**What It Does:**
- Coordinates Make and Soong
- Executes build process
- Manages build state
- Provides build interface

#### bp2build

**Purpose:**
Converts Android.bp to Bazel BUILD files (experimental).

**Usage:**
```bash
bp2build
```

**What It Does:**
- Converts Blueprint to Bazel
- Generates BUILD files
- Enables Bazel builds
- Experimental feature

#### soong_docs

**Purpose:**
Generates documentation from Soong module definitions.

**Usage:**
```bash
soong_docs
```

**What It Does:**
- Extracts module documentation
- Generates reference docs
- Documents module types
- Provides build reference

### Soong Integration with Make

#### Hybrid System

**Current State:**
- Soong and Make coexist
- Soong handles new modules
- Make handles legacy modules
- Both systems integrated

**Integration:**
- Make can call Soong
- Soong can call Make
- Shared build outputs
- Unified build interface

#### Migration Path

**From Make to Soong:**
1. Convert Android.mk to Android.bp
2. Test build
3. Verify functionality
4. Remove Android.mk

**Migration Status:**
- Ongoing process
- New code uses Soong
- Legacy code uses Make
- Gradual transition

### Soong Best Practices

#### Writing Android.bp Files

**Best Practices:**
- Use clear module names
- Organize source files clearly
- Declare all dependencies
- Use appropriate module types

**Common Patterns:**
- Group related sources
- Use lists for multiple items
- Export necessary headers
- Set proper visibility

#### Module Organization

**Structure:**
- One module per Android.bp (usually)
- Clear module boundaries
- Logical grouping
- Consistent naming

**Naming:**
- Descriptive module names
- Follow naming conventions
- Avoid conflicts
- Be consistent

#### Dependency Management

**Best Practices:**
- Declare all dependencies
- Use correct dependency types
- Avoid circular dependencies
- Keep dependencies minimal

**Common Issues:**
- Missing dependencies
- Wrong dependency types
- Circular dependencies
- Unnecessary dependencies

### Debugging Soong Builds

#### Common Issues

**Build Failures:**
- Syntax errors in Android.bp
- Missing dependencies
- Invalid module types
- Type mismatches

**Debugging:**
- Check Android.bp syntax
- Verify dependencies
- Check module types
- Review error messages

#### Build Logs

**Understanding Logs:**
- Soong outputs detailed logs
- Shows parsing errors
- Displays dependency issues
- Provides helpful messages

**Useful Commands:**
```bash
m showcommands  # Show build commands
m -j1           # Single-threaded build
m nothing       # Dry run
```

### Soong Performance

#### Optimization Strategies

**Build Performance:**
- Use incremental builds
- Enable parallel builds
- Optimize dependencies
- Use ccache for C/C++

**Development Workflow:**
- Build only what changed
- Use module-specific builds
- Cache build artifacts
- Optimize build configuration

#### Performance Metrics

**Typical Improvements:**
- 2-3x faster than Make
- Better parallelization
- Faster dependency resolution
- Reduced build overhead

## Key Takeaways

1. **Soong is Android's modern build system** written in Go, designed to replace Make with better performance and maintainability.

2. **Soong uses Blueprint language** in Android.bp files to describe builds, providing simpler syntax than Make.

3. **Soong generates Ninja files** for execution, leveraging Ninja's fast, parallel build capabilities.

4. **Soong provides significant performance improvements** over Make, with 2-3x faster builds and better parallelization.

5. **Soong offers type safety** with compile-time checking of build descriptions, preventing common errors.

6. **Soong and Make coexist** in current Android builds, with Soong handling new code and Make handling legacy code.

7. **Understanding Soong is essential** for modern AOSP development, as it's the preferred build system for new code.

8. **Soong is actively developed** and represents the future direction of Android's build system.

## Related Topics

- **Build System Structure:** The overall architecture that includes Soong
- **Make-Based Build System:** The legacy system that Soong is replacing
- **Blueprint Language Fundamentals:** The language used in Android.bp files
- **Understanding Android.bp Files:** How to write build descriptions in Soong

