---
number: 16
title: Init Language Syntax
slug: init-language-syntax
level: beginner
tags:
  - aosp
  - init
  - init-language
  - syntax
  - init-rc
  - boot-scripts
prerequisites:
  - init-system-in-android
  - init-rc-and-init-scripts
estimated_minutes: 120
contributors: []
diagrams: []
examples: []
canonical_id: aosp-beginner-16
---

# Init Language Syntax

## Overview

The init language is a declarative, domain-specific language used to write init scripts that configure the Android system during boot and runtime. It provides a simple but powerful syntax for defining actions, services, imports, and system configuration. Understanding the init language syntax is essential for AOSP development, as it's the primary way to configure system initialization, service management, and runtime behavior.

Think of the init language as a "configuration DSL" (Domain-Specific Language) - similar to how HTML describes web pages or YAML describes configuration, the init language describes how Android should boot and run. It's not a general-purpose programming language; it's specifically designed for system initialization tasks.

## Deep Explanation

### Language Characteristics

The init language is:

**Declarative:**
- You describe what you want, not how to achieve it
- Init handles the execution details
- Focus on configuration, not implementation

**Event-Driven:**
- Actions execute based on triggers (events)
- Properties, boot phases, and service states trigger actions
- Reactive rather than procedural

**Simple:**
- Limited set of commands and options
- No loops, conditionals, or complex logic
- Easy to read and understand

**Domain-Specific:**
- Designed specifically for system initialization
- Not suitable for general programming
- Optimized for boot-time configuration

### Basic Syntax Rules

#### Comments

Comments start with `#` and continue to the end of the line:

```
# This is a comment
service myservice /system/bin/myservice
    class main  # This is also a comment
```

#### Whitespace

- Spaces and tabs are used for indentation
- Indentation is significant for service options
- Blank lines are ignored

#### Case Sensitivity

- Keywords are case-sensitive
- Service names are case-sensitive
- Property names are case-sensitive
- File paths are case-sensitive

#### Line Continuation

Long lines can be continued using backslash:

```
service myservice /system/bin/myservice \
    --arg1 value1 \
    --arg2 value2
```

### Actions

Actions define what to do when certain events (triggers) occur.

#### Action Syntax

```
on <trigger>
    <command>
    <command>
    ...
```

**Structure:**
- `on` keyword followed by trigger name
- Commands are indented (typically 4 spaces)
- Multiple commands execute in order
- Actions are cumulative (multiple actions with same trigger all execute)

#### Example Actions

```
on early-init
    mkdir /dev 0755
    mount tmpfs tmpfs /dev
    setenforce 0

on init
    mount ext4 /dev/block/system /system ro
    symlink /system/bin /bin

on late-init
    trigger post-fs
    class_start main
```

### Triggers

Triggers are events that cause actions to execute. There are several types of triggers.

#### Boot-Time Triggers

These triggers fire during specific boot phases:

**early-init:**
- Very early in boot process
- Before most initialization
- Used for critical setup

```
on early-init
    mkdir /dev 0755
    mount tmpfs tmpfs /dev
    load_policy /sepolicy
```

**init:**
- Main initialization phase
- After early-init
- Used for mounting partitions, creating device nodes

```
on init
    mount ext4 /dev/block/system /system ro
    mknod /dev/null c 1 3
```

**late-init:**
- After main initialization
- Before services start
- Used for final setup and service startup

```
on late-init
    trigger post-fs
    trigger post-fs-data
    class_start main
```

**early-fs:**
- Before filesystem operations
- Used for filesystem preparation

**fs:**
- During filesystem operations
- Used for mounting filesystems

**post-fs:**
- After filesystems are mounted
- Before /data is available
- Used for system partition setup

**post-fs-data:**
- After /data partition is mounted
- Used for data partition setup

**boot:**
- After boot completes
- Used for post-boot actions

#### Property Triggers

Property triggers fire when properties change to specific values:

**Basic Property Trigger:**
```
on property:property.name=value
    start myservice
```

**Wildcard Property Trigger:**
```
on property:property.name=*
    # Triggers when property is set to any value
    start myservice
```

**Multiple Property Conditions:**
```
on property:prop1=value1 && property:prop2=value2
    # Both conditions must be true
    start myservice

on property:prop1=value1 || property:prop2=value2
    # Either condition can be true
    start myservice
```

**Common Property Triggers:**
```
on property:sys.boot_completed=1
    # System finished booting
    class_start late_start

on property:ro.debuggable=1
    # Device is debuggable
    start adbd

on property:init.svc.zygote=running
    # Zygote service started
    start dependent_service
```

#### Service State Triggers

Triggers based on service state changes:

```
on property:init.svc.<service_name>=running
    # Service started
    start dependent_service

on property:init.svc.<service_name>=stopped
    # Service stopped
    stop dependent_service
```

#### Custom Triggers

You can define and trigger custom events:

```
# Define custom trigger
on custom_trigger
    start myservice
    setprop my.property value

# Trigger it from another action
on late-init
    trigger custom_trigger
```

### Commands

Commands are the building blocks of actions. They perform specific operations.

#### File System Commands

**mkdir:**
Create a directory.

```
mkdir <path> [mode] [owner] [group]
```

Examples:
```
mkdir /dev 0755
mkdir /data/myapp 0755 system system
mkdir /cache 0770
```

**mount:**
Mount a filesystem.

```
mount <type> <device> <dir> [flags]
```

Examples:
```
mount tmpfs tmpfs /dev
mount ext4 /dev/block/system /system ro
mount ext4 /dev/block/data /data noatime,nosuid,nodev
```

Common mount flags:
- `ro` - Read-only
- `rw` - Read-write
- `noatime` - Don't update access times
- `nosuid` - Ignore setuid bits
- `nodev` - Don't interpret device files
- `wait` - Wait for device to be ready
- `check` - Check filesystem on mount
- `avb=name` - Android Verified Boot metadata

**umount:**
Unmount a filesystem.

```
umount <path>
```

Example:
```
umount /mnt/tmp
```

**symlink:**
Create a symbolic link.

```
symlink <target> <link_name>
```

Examples:
```
symlink /system/bin /bin
symlink /system/etc /etc
symlink /vendor/lib /lib
```

**rm:**
Remove a file or directory.

```
rm <path>
```

Example:
```
rm /data/temp_file
```

**rmdir:**
Remove an empty directory.

```
rmdir <path>
```

Example:
```
rmdir /data/empty_dir
```

**chmod:**
Change file permissions.

```
chmod <mode> <path>
```

Example:
```
chmod 0755 /system/bin/myapp
```

**chown:**
Change file ownership.

```
chown <owner> <group> <path>
```

Example:
```
chown system system /data/myapp
```

**restorecon:**
Restore SELinux context.

```
restorecon <path>
restorecon_recursive <path>
```

Examples:
```
restorecon /system/bin/app
restorecon_recursive /system
```

#### Device Node Commands

**mknod:**
Create a device node.

```
mknod <path> <type> <major> <minor> [permissions] [owner] [group]
```

Types:
- `c` - Character device
- `b` - Block device

Examples:
```
mknod /dev/null c 1 3
mknod /dev/zero c 1 5
mknod /dev/random c 1 8
mknod /dev/urandom c 1 9
mknod /dev/console c 5 1
```

#### Property Commands

**setprop:**
Set a system property.

```
setprop <name> <value>
```

Examples:
```
setprop sys.boot_completed 1
setprop debug.sf.showupdates 1
setprop persist.sys.timezone America/New_York
```

**getprop:**
Get a system property (used in conditions, not as command).

Note: `getprop` is typically used in shell scripts, not init scripts directly.

#### Service Management Commands

**start:**
Start a service.

```
start <service_name>
```

Example:
```
start zygote
start servicemanager
```

**stop:**
Stop a service.

```
stop <service_name>
```

Example:
```
stop myservice
```

**restart:**
Restart a service.

```
restart <service_name>
```

Example:
```
restart zygote
```

**class_start:**
Start all services in a class.

```
class_start <class_name>
```

Example:
```
class_start main
class_start core
```

**class_stop:**
Stop all services in a class.

```
class_stop <class_name>
```

Example:
```
class_stop late_start
```

**class_reset:**
Stop and restart all services in a class.

```
class_reset <class_name>
```

Example:
```
class_reset main
```

#### Trigger Commands

**trigger:**
Trigger an action block.

```
trigger <trigger_name>
```

Example:
```
on late-init
    trigger post-fs
    trigger post-fs-data
    trigger load_system_props_action
```

#### Wait Commands

**wait:**
Wait for a file or device to exist.

```
wait <path> [timeout]
```

Examples:
```
wait /dev/block/bootdevice
wait /sys/class/android_usb/android0/enable 5
```

#### Write Commands

**write:**
Write data to a file.

```
write <path> <value>
```

Examples:
```
write /proc/sys/kernel/panic_on_oops 1
write /sys/class/leds/led:rgb_blue/brightness 255
write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor performance
```

#### Copy Commands

**copy:**
Copy a file.

```
copy <src> <dst>
```

Example:
```
copy /system/etc/default.prop /default.prop
```

#### Load Commands

**load_policy:**
Load SELinux policy.

```
load_policy <policy_file>
```

Example:
```
load_policy /sepolicy
```

**load_properties:**
Load properties from a file.

```
load_properties <property_file>
```

Example:
```
load_properties /system/build.prop
load_properties /vendor/build.prop
```

#### Import Commands

**import:**
Import another init script.

```
import <script_path>
```

Examples:
```
import /system/etc/init/hw/init.${ro.hardware}.rc
import /init.usb.rc
import /vendor/etc/init/hw/init.${ro.hardware}.rc
```

#### SELinux Commands

**setenforce:**
Set SELinux enforcement mode.

```
setenforce <0|1>
```

- `0` - Permissive mode (logs violations, doesn't block)
- `1` - Enforcing mode (blocks violations)

Example:
```
setenforce 0  # Start permissive during boot
# ... load policy and set contexts ...
setenforce 1  # Switch to enforcing
```

**setsebool:**
Set SELinux boolean.

```
setsebool <name> <0|1>
```

Example:
```
setsebool allow_external_storage 1
```

#### Exec Commands

**exec:**
Execute a command (blocking).

```
exec [seclabel [user [group]]] -- <command> [arguments]
```

Example:
```
exec /system/bin/setup_script.sh
```

**exec_start:**
Execute a command (non-blocking).

```
exec_start <command> [arguments]
```

Example:
```
exec_start /system/bin/background_task.sh
```

### Services

Services define long-running processes that init manages.

#### Service Syntax

```
service <name> <path> [arguments]
    <option>
    <option>
    ...
```

**Structure:**
- `service` keyword
- Service name (unique identifier)
- Executable path
- Optional arguments
- Options (indented)

#### Service Options

**class:**
Service class for grouping services.

```
class <class_name>
```

Classes:
- `core` - Critical system services
- `main` - Normal system services
- `late_start` - Services that start later
- `charger` - Charger mode services

Example:
```
service zygote /system/bin/app_process64
    class main
```

**user:**
Run service as specific user.

```
user <username>
```

Example:
```
service myservice /system/bin/myservice
    user system
```

**group:**
Run service with specific groups.

```
group <group1> [group2] ...
```

Example:
```
service myservice /system/bin/myservice
    group system audio
```

**oneshot:**
Service exits after starting (don't restart).

```
oneshot
```

Example:
```
service setup_script /system/bin/setup.sh
    class main
    oneshot
```

**disabled:**
Don't start automatically (start manually).

```
disabled
```

Example:
```
service adbd /system/bin/adbd
    class core
    disabled
```

**critical:**
Critical service - if it exits, reboot device.

```
critical
```

Example:
```
service servicemanager /system/bin/servicemanager
    class core
    critical
```

**socket:**
Create a Unix domain socket.

```
socket <name> <type> <perm> [user] [group]
```

Types:
- `stream` - Stream socket (TCP-like)
- `dgram` - Datagram socket (UDP-like)
- `seqpacket` - Sequenced packet socket

Example:
```
service zygote /system/bin/app_process64
    socket zygote stream 660 root system
```

**writepid:**
Write process ID to file(s).

```
writepid <file1> [file2] ...
```

Example:
```
service zygote /system/bin/app_process64
    writepid /dev/cpuset/foreground/tasks /dev/stune/foreground/tasks
```

**priority:**
Set process priority (nice value).

```
priority <nice_value>
```

Nice values: -20 (highest priority) to 19 (lowest priority)

Example:
```
service zygote /system/bin/app_process64
    priority -20
```

**ioprio:**
Set I/O priority.

```
ioprio <class> <level>
```

Classes: `rt` (real-time), `be` (best-effort), `idle`

Example:
```
service audioserver /system/bin/audioserver
    ioprio rt 4
```

**seclabel:**
Set SELinux security context.

```
seclabel <context>
```

Example:
```
service adbd /system/bin/adbd
    seclabel u:r:adbd:s0
```

**setenv:**
Set environment variable.

```
setenv <name> <value>
```

Example:
```
service myservice /system/bin/myservice
    setenv MY_VAR value
```

**shutdown:**
Shutdown behavior.

```
shutdown <critical|wait>
```

Example:
```
service critical_service /system/bin/critical
    shutdown critical
```

**keycodes:**
Trigger service on keycode.

```
keycodes <keycode1> [keycode2] ...
```

Example:
```
service recovery /system/bin/recovery
    keycodes 114 115 116
```

**onrestart:**
Commands to run when service restarts.

```
onrestart <command>
```

Example:
```
service zygote /system/bin/app_process64
    onrestart restart audioserver
    onrestart restart cameraserver
    onrestart write /sys/power/state on
```

**console:**
Service needs console.

```
console
```

Example:
```
service shell /system/bin/sh
    console
```

**file:**
Open file descriptors.

```
file <path> <mode>
```

Modes: `r` (read), `w` (write), `rw` (read-write)

Example:
```
service myservice /system/bin/myservice
    file /dev/input/event0 r
```

**capabilities:**
Set Linux capabilities.

```
capabilities <cap1> [cap2] ...
```

Example:
```
service myservice /system/bin/myservice
    capabilities CAP_NET_BIND_SERVICE
```

### Property Expansion

Properties can be expanded in init scripts using `${property.name}` syntax.

#### Basic Expansion

```
import /system/etc/init/hw/init.${ro.hardware}.rc
```

If `ro.hardware` is `qcom`, this expands to:
```
import /system/etc/init/hw/init.qcom.rc
```

#### Default Values

Properties can have default values:

```
${property.name:default_value}
```

Example:
```
import /system/etc/init/hw/init.${ro.hardware:unknown}.rc
```

#### Common Property Expansions

```
# Hardware-specific imports
import /system/etc/init/hw/init.${ro.hardware}.rc

# Architecture-specific Zygote
import /system/etc/init/zygote/zygote${ro.zygote}.rc

# Device-specific configuration
import /vendor/etc/init/hw/init.${ro.product.device}.rc
```

### Complete Service Example

Here's a complete example showing all major service options:

```
service zygote /system/bin/app_process64 -Xzygote /system/bin --zygote --start-system-server
    class main
    priority -20
    user root
    group root readproc
    socket zygote stream 660 root system
    socket usap_pool_primary stream 660 root system
    onrestart write /sys/power/state on
    onrestart restart audioserver
    onrestart restart cameraserver
    onrestart restart media
    onrestart restart netd
    onrestart restart wificond
    writepid /dev/cpuset/foreground/tasks /dev/stune/foreground/tasks
    seclabel u:r:zygote:s0
```

### Complete Action Example

Here's a complete example showing various commands:

```
on early-init
    # Create directories
    mkdir /dev 0755
    mkdir /proc 0755
    mkdir /sys 0755
    mkdir /system 0755
    mkdir /data 0755
    mkdir /vendor 0755
    
    # Mount filesystems
    mount tmpfs tmpfs /dev mode=0755
    mount proc proc /proc
    mount sysfs sysfs /sys
    
    # Create device nodes
    mknod /dev/null c 1 3
    mknod /dev/zero c 1 5
    mknod /dev/random c 1 8
    mknod /dev/urandom c 1 9
    mknod /dev/console c 5 1
    
    # Initialize SELinux
    setenforce 0
    load_policy /sepolicy
    
    # Restore SELinux contexts
    restorecon_recursive /system
    restorecon_recursive /vendor
    restorecon_recursive /data
    
    # Set SELinux to enforcing
    setenforce 1

on init
    # Wait for block device
    wait /dev/block/bootdevice
    
    # Mount partitions
    mount ext4 /dev/block/bootdevice /system ro wait,avb=vbmeta_system
    mount ext4 /dev/block/bootdevice /vendor ro wait,avb=vbmeta_vendor
    mount ext4 /dev/block/bootdevice /product ro wait,avb=vbmeta_product
    mount ext4 /dev/block/bootdevice /data noatime,nosuid,nodev,noauto_da_alloc wait,check,formattable
    
    # Create symlinks
    symlink /system/bin /bin
    symlink /system/etc /etc
    symlink /vendor/lib /lib
    
    # Initialize property system
    property_init
    load_properties /system/build.prop
    load_properties /vendor/build.prop
    
    # Import hardware-specific scripts
    import /system/etc/init/hw/init.${ro.hardware}.rc
    import /vendor/etc/init/hw/init.${ro.hardware}.rc

on late-init
    # Trigger post-mount actions
    trigger early-fs
    trigger fs
    trigger post-fs
    trigger post-fs-data
    
    # Load properties
    trigger load_system_props_action
    trigger load_persist_props_action
    
    # Start services
    trigger zygote-start
    class_start core
    class_start main

on property:sys.boot_completed=1
    # Boot completed
    class_start late_start
    setprop sys.boot_ready 1
```

### Syntax Validation

Init validates syntax during parsing. Common syntax errors:

**Missing Indentation:**
```
# BAD
on init
mount ext4 /dev/block/system /system ro

# GOOD
on init
    mount ext4 /dev/block/system /system ro
```

**Invalid Trigger:**
```
# BAD
on invalid_trigger
    start myservice

# GOOD
on init
    start myservice
```

**Missing Service Name:**
```
# BAD
service /system/bin/myservice
    class main

# GOOD
service myservice /system/bin/myservice
    class main
```

**Invalid Option:**
```
# BAD
service myservice /system/bin/myservice
    invalid_option value

# GOOD
service myservice /system/bin/myservice
    class main
```

### Best Practices

#### 1. Use Appropriate Commands

**Good:**
```
on init
    wait /dev/block/bootdevice
    mount ext4 /dev/block/system /system ro wait
```

**Bad:**
```
on init
    mount ext4 /dev/block/system /system ro
    # May fail if device not ready
```

#### 2. Proper Indentation

**Good:**
```
on init
    mount ext4 /dev/block/system /system ro
    symlink /system/bin /bin
```

**Bad:**
```
on init
mount ext4 /dev/block/system /system ro
symlink /system/bin /bin
```

#### 3. Clear Service Definitions

**Good:**
```
service audio_hal /vendor/bin/audio_hal
    class main
    user audio
    group audio
```

**Bad:**
```
service hal /vendor/bin/hal
    class main
```

#### 4. Use Property Triggers

**Good:**
```
on property:sys.boot_completed=1
    start myservice
```

**Bad:**
```
# Starting in late-init may be too early
on late-init
    start myservice
```

#### 5. Handle Dependencies

**Good:**
```
on property:init.svc.prerequisite=running
    start dependent_service
```

**Bad:**
```
# No dependency management
on late-init
    start dependent_service
```

## Edge Cases and Pitfalls

### Pitfall 1: Property Expansion Timing

**Problem:**
Using `${property}` before property is set results in empty string.

**Solution:**
Ensure properties are set before use, or use default values:
```
import /system/etc/init/hw/init.${ro.hardware:default}.rc
```

### Pitfall 2: Service Name Conflicts

**Problem:**
Multiple services with same name - later one wins silently.

**Solution:**
Use unique service names and coordinate between scripts.

### Pitfall 3: Blocking Operations

**Problem:**
Blocking operations in init scripts delay boot.

**Solution:**
Use `wait` for devices, avoid `sleep`, use triggers for sequencing.

### Pitfall 4: Missing Error Handling

**Problem:**
Mounts or operations fail silently.

**Solution:**
Use `wait` option for mounts, check logs for errors.

## References and Further Reading

- [AOSP Init Source Code](https://cs.android.com/android/platform/superproject/+/master:system/core/init/)
- [Init Language Parser](https://cs.android.com/android/platform/superproject/+/master:system/core/init/parser.cpp)
- [Init Language Documentation](https://source.android.com/docs/core/architecture/init)
- [Init Script Examples](https://cs.android.com/android/platform/superproject/+/master:system/core/rootdir/)

## Quiz

### Question 1
What keyword is used to define an action block in init scripts?

**A)** `action`  
**B)** `on`  
**C)** `trigger`  
**D)** `do`

**Answer: B** - Actions are defined using the `on` keyword followed by a trigger name.

### Question 2
Which service option prevents a service from automatically starting?

**A)** `oneshot`  
**B)** `disabled`  
**C)** `manual`  
**D)** `nolaunch`

**Answer: B** - The `disabled` option prevents a service from starting automatically. It must be started manually using the `start` command.

### Question 3
What is the syntax for a property trigger that fires when a property is set to any value?

**A)** `on property:name=*`  
**B)** `on property:name`  
**C)** `on property:name=any`  
**D)** `on property:name=`

**Answer: A** - The wildcard `*` matches any value, so `on property:name=*` triggers when the property is set to any value.

### Question 4
Which command creates a symbolic link?

**A)** `link`  
**B)** `symlink`  
**C)** `ln`  
**D)** `create_link`

**Answer: B** - The `symlink` command creates a symbolic link: `symlink <target> <link_name>`.

### Question 5
What happens if a service with the `critical` option exits?

**A)** It restarts automatically  
**B)** The device reboots  
**C)** An error is logged  
**D)** Nothing happens

**Answer: B** - Services marked as `critical` cause the device to reboot if they exit, as they are considered essential for system operation.

## Related Topics

- [Init System in Android](./04.%20Init%20System%20in%20Android.md)
- [Init.rc and Init Scripts](./15.%20Init.rc%20and%20Init%20Scripts.md)
- [Boot Process Overview](./03.%20Boot%20Process%20Overview.md)
- [System Properties](./05.%20System%20Properties.md)

