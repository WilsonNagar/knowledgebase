---
number: 30
title: lunch & lunch combos
slug: lunch-lunch-combos
level: beginner
tags:
  - aosp
  - lunch
  - build
  - configuration
  - product
  - variant
  - setup
prerequisites:
  - aosp-repo-structure
  - build-variants-product-flavors
estimated_minutes: 70
contributors: []
diagrams: []
examples: []
canonical_id: aosp-beginner-30
---

# lunch & lunch combos

## Overview

The `lunch` command is a critical tool in AOSP development that configures the build environment for a specific device and build variant. It sets up all the necessary environment variables, loads device configurations, and prepares the system for building. Understanding `lunch` and lunch combos is essential for AOSP development, as it's the first step in building Android for any device. This guide provides a comprehensive overview of the `lunch` command, how it works, and how to use lunch combos effectively.

Think of `lunch` like ordering at a restaurant: you tell the waiter (lunch command) what you want (device and variant), and they bring you a complete meal (configured build environment) with all the right ingredients (environment variables, configurations, and settings) prepared exactly as you specified. Just as you can't cook without ingredients, you can't build Android without running `lunch` first.

## Deep Explanation

### What is lunch?

`lunch` is a shell function (not a standalone command) that configures the Android build environment for a specific device and build variant combination. It's defined in `build/envsetup.sh` and is essential for setting up builds.

**Key Characteristics:**
- **Shell Function:** Defined in envsetup.sh
- **Configuration Tool:** Sets up build environment
- **Device-Specific:** Configures for specific device
- **Variant-Specific:** Sets build variant

**Why lunch?**
- **Configuration:** Sets up build environment
- **Convenience:** Single command for setup
- **Consistency:** Ensures correct configuration
- **Required:** Must run before building

### lunch Command Usage

#### Basic Usage

**Command Format:**
```bash
lunch <product>-<variant>
```

**Examples:**
```bash
lunch aosp_arm-eng        # Generic ARM engineering build
lunch aosp_arm-user       # Generic ARM user build
lunch aosp_arm-userdebug  # Generic ARM userdebug build
```

**Interactive Mode:**
```bash
lunch
# Shows menu of available combos
# Select by number or name
```

#### What lunch Does

**1. Parses Arguments:**
- Extracts product name
- Extracts variant name
- Validates combination
- Checks availability

**2. Sets Environment Variables:**
- `TARGET_PRODUCT` - Product name
- `TARGET_BUILD_VARIANT` - Build variant
- `TARGET_ARCH` - Target architecture
- Many other variables

**3. Loads Configuration:**
- Loads product makefile
- Loads board configuration
- Sets build options
- Configures toolchain

**4. Prepares Environment:**
- Sets up paths
- Configures build system
- Prepares for build
- Validates setup

### Lunch Combos

#### What are Lunch Combos?

Lunch combos are predefined combinations of products and variants that can be selected via the `lunch` command. They're defined in product makefiles and device configurations.

**Format:**
- `<product>-<variant>`
- Product name
- Build variant
- Combined with hyphen

**Examples:**
- `aosp_arm-eng` - Generic ARM engineering
- `aosp_x86-user` - Generic x86 user
- `sdk_phone_arm64-userdebug` - SDK phone userdebug

#### Product Names

**Generic Products:**
- `aosp_arm` - Generic ARM
- `aosp_arm64` - Generic ARM64
- `aosp_x86` - Generic x86
- `aosp_x86_64` - Generic x86_64

**Device-Specific:**
- `<vendor>_<device>` - Device-specific
- Example: `samsung_galaxy-userdebug`
- Example: `google_pixel-eng`

**SDK Products:**
- `sdk_phone_arm64` - SDK phone
- `sdk_phone_x86` - SDK phone x86
- `sdk` - Generic SDK

#### Variant Names

**Available Variants:**
- `eng` - Engineering
- `userdebug` - Userdebug
- `user` - User

**Variant Selection:**
- Choose based on use case
- Development → eng
- Testing → userdebug
- Production → user

### Environment Setup

#### Before lunch

**Required Steps:**
```bash
# 1. Navigate to AOSP root
cd /path/to/aosp

# 2. Source envsetup.sh
source build/envsetup.sh
```

**What envsetup.sh Does:**
- Defines shell functions
- Sets up build tools
- Configures environment
- Makes lunch available

#### After lunch

**Environment Ready:**
- Build variables set
- Configuration loaded
- Ready to build
- Can run `m` or `make`

**Verification:**
```bash
# Check environment variables
echo $TARGET_PRODUCT
echo $TARGET_BUILD_VARIANT
echo $TARGET_ARCH
```

### lunch Interactive Mode

#### Using Interactive Mode

**Command:**
```bash
lunch
```

**Output:**
```
You're building on Linux

Lunch menu... pick a combo:
     1. aosp_arm-eng
     2. aosp_arm64-eng
     3. aosp_x86-eng
     4. aosp_x86_64-eng
     5. aosp_arm-userdebug
     6. aosp_arm64-userdebug
     7. aosp_x86-userdebug
     8. aosp_x86_64-userdebug
     9. aosp_arm-user
    10. aosp_arm64-user
    11. aosp_x86-user
    12. aosp_x86_64-user
    13. sdk_phone_arm64-eng
    14. sdk_phone_arm64-userdebug
    15. sdk_phone_arm64-user
    ...

Which would you like? [aosp_arm-eng]
```

**Selection:**
- Enter number
- Or type combo name
- Or press Enter for default

#### Menu Organization

**Menu Structure:**
- Grouped by product
- Variants listed together
- Numbered for selection
- Default highlighted

**Finding Combos:**
- Scroll through menu
- Search for device name
- Look for variant
- Check device directory

### Product Configuration

#### Product Definition

**Location:**
- `device/<vendor>/<device>/AndroidProducts.mk`
- `build/target/product/`
- Product makefiles

**Product Makefile:**
```makefile
PRODUCT_NAME := mydevice
PRODUCT_DEVICE := mydevice
PRODUCT_BRAND := vendor
PRODUCT_MODEL := My Device
```

**Product Registration:**
```makefile
# AndroidProducts.mk
PRODUCT_MAKEFILES := \
    $(LOCAL_DIR)/mydevice.mk
```

#### Product Properties

**Common Properties:**
- `PRODUCT_NAME` - Product name
- `PRODUCT_DEVICE` - Device name
- `PRODUCT_BRAND` - Brand name
- `PRODUCT_MODEL` - Model name

**Build Properties:**
- `PRODUCT_PACKAGES` - Apps to include
- `PRODUCT_PROPERTY_OVERRIDES` - System properties
- `PRODUCT_COPY_FILES` - Files to copy

### Environment Variables Set by lunch

#### Key Variables

**TARGET_PRODUCT:**
- Product name
- Example: `aosp_arm`
- Used throughout build

**TARGET_BUILD_VARIANT:**
- Build variant
- Example: `eng`, `user`, `userdebug`
- Controls build features

**TARGET_ARCH:**
- Target architecture
- Example: `arm`, `arm64`, `x86`
- Determines toolchain

**TARGET_ARCH_VARIANT:**
- Architecture variant
- Example: `armv7-a-neon`
- Fine-tunes architecture

#### Other Variables

**Build Variables:**
- `TARGET_BUILD_TYPE` - Release or debug
- `TARGET_BUILD_APPS` - Apps to build
- `TARGET_GCC_VERSION` - GCC version

**Path Variables:**
- `ANDROID_BUILD_TOP` - AOSP root
- `ANDROID_PRODUCT_OUT` - Output directory
- `OUT_DIR` - Build output

### Common lunch Scenarios

#### Generic Builds

**ARM Build:**
```bash
lunch aosp_arm-eng
```

**x86 Build:**
```bash
lunch aosp_x86-eng
```

**ARM64 Build:**
```bash
lunch aosp_arm64-eng
```

#### Device-Specific Builds

**Device Build:**
```bash
lunch vendor_device-eng
```

**Example:**
```bash
lunch google_pixel-eng
lunch samsung_galaxy-userdebug
```

#### SDK Builds

**SDK Build:**
```bash
lunch sdk_phone_arm64-eng
```

**Purpose:**
- SDK development
- Emulator builds
- Testing
- Development

### lunch vs Other Commands

#### lunch vs choosecombo

**lunch:**
- Modern command
- Interactive menu
- Recommended
- User-friendly

**choosecombo:**
- Legacy command
- Still supported
- Less user-friendly
- Being phased out

#### lunch vs tapas

**lunch:**
- Full system build
- All components
- Complete Android
- Standard builds

**tapas:**
- Selective build
- Choose apps to build
- Partial builds
- Development tool

### Troubleshooting lunch

#### Common Issues

**"Command not found":**
```bash
# Solution: Source envsetup.sh first
source build/envsetup.sh
```

**"Product not found":**
```bash
# Solution: Check product name
# List available products
lunch  # Shows menu
```

**"Invalid combo":**
```bash
# Solution: Check format
# Use: product-variant
# Example: aosp_arm-eng
```

#### Verification

**Check Configuration:**
```bash
# After lunch, verify:
echo $TARGET_PRODUCT
echo $TARGET_BUILD_VARIANT
echo $TARGET_ARCH
```

**Check Build Readiness:**
```bash
# Try dry run
m nothing
```

### Best Practices

#### Using lunch

**Always Source First:**
```bash
source build/envsetup.sh
lunch <product>-<variant>
```

**Verify Configuration:**
- Check environment variables
- Verify product name
- Confirm variant
- Test build readiness

**Document Your Setup:**
- Note product name
- Record variant
- Document any customizations
- Keep track of changes

#### Choosing Combos

**Development:**
- Use `eng` variant
- Full debugging
- All tools available

**Testing:**
- Use `userdebug` variant
- Closer to production
- Some debugging

**Production:**
- Use `user` variant
- Optimized
- Secure

### lunch in Build Scripts

#### Automation

**In Scripts:**
```bash
#!/bin/bash
source build/envsetup.sh
lunch aosp_arm-eng
m -j8
```

**CI/CD:**
- Automate lunch
- Set environment
- Run builds
- Consistent setup

#### Non-Interactive

**Non-Interactive Mode:**
```bash
# Set directly
export TARGET_PRODUCT=aosp_arm
export TARGET_BUILD_VARIANT=eng
source build/envsetup.sh
```

**Scripts:**
- Can set variables directly
- Bypass interactive menu
- Useful for automation

## Key Takeaways

1. **lunch is a shell function** that configures the Android build environment for a specific device and build variant.

2. **lunch format** is `<product>-<variant>` where product is the device/product name and variant is eng/user/userdebug.

3. **lunch sets environment variables** like `TARGET_PRODUCT`, `TARGET_BUILD_VARIANT`, and `TARGET_ARCH` that control the build.

4. **lunch interactive mode** shows a menu of available combos, making it easy to select the desired configuration.

5. **Product configuration** is defined in product makefiles and determines what features and apps are included in the build.

6. **lunch must be run** after sourcing `envsetup.sh` and before building, as it sets up the entire build environment.

7. **Common lunch combos** include generic builds (aosp_arm-eng) and device-specific builds (vendor_device-variant).

8. **Understanding lunch** is essential for AOSP development, as it's the first step in configuring and building Android.

## Related Topics

- **AOSP Repo Structure:** How the repo structure relates to product definitions
- **Build Variants & Product Flavors:** How variants and products are configured
- **Build System Structure:** How lunch integrates with the build system
- **device/ vendor/ directory structure:** Where product configurations are defined

