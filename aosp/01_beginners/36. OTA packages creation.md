---
number: 36
title: OTA packages creation
slug: ota-packages-creation
level: beginner
tags:
  - aosp
  - ota
  - update
  - package
  - creation
  - build
  - system-update
prerequisites:
  - building-boot-img-system-img-manually
  - build-system-structure
  - android-partitions
estimated_minutes: 85
contributors: []
diagrams: []
examples: []
canonical_id: aosp-beginner-36
---

# OTA packages creation

## Overview

OTA (Over-The-Air) packages are update packages that allow Android devices to receive system updates wirelessly. Understanding how to create OTA packages is essential for AOSP development, as it enables distributing updates, testing system changes, and understanding how Android updates work. This guide provides a comprehensive overview of OTA package creation, the tools involved, package formats, and the update process.

Think of OTA packages like software update installers: just as you download and install software updates on your computer, OTA packages allow Android devices to download and install system updates. The OTA package contains all the necessary files and instructions to update the device from one Android version to another, or to apply patches and fixes.

## Deep Explanation

### What are OTA Packages?

OTA packages are ZIP files containing system updates that can be installed on Android devices to update the system, apply patches, or upgrade to a new Android version. They're the standard mechanism for distributing Android updates.

**Key Characteristics:**
- **ZIP Format:** Standard ZIP file format
- **Signed:** Cryptographically signed for security
- **Incremental or Full:** Can be incremental or complete updates
- **Installable:** Can be installed via recovery or system

**Why OTA Packages?**
- **Updates:** Distribute system updates
- **Patches:** Apply security patches
- **Upgrades:** Upgrade Android versions
- **Distribution:** Easy distribution mechanism

### OTA Package Types

#### Full OTA Packages

**What They Contain:**
- Complete system images
- All partitions
- Full system update
- Complete replacement

**Characteristics:**
- Larger file size
- Complete update
- Can update from any version
- More reliable

**Use Cases:**
- Major version upgrades
- Complete system updates
- Factory reset scenarios
- Initial device setup

#### Incremental OTA Packages

**What They Contain:**
- Only changed files
- Binary patches
- Delta updates
- Minimal changes

**Characteristics:**
- Smaller file size
- Faster downloads
- Requires base version
- More efficient

**Use Cases:**
- Minor updates
- Security patches
- Bug fixes
- Regular updates

### OTA Package Structure

#### ZIP File Structure

**Standard Structure:**
```
ota_package.zip
├── META-INF/
│   ├── com/
│   │   └── android/
│   │       ├── metadata
│   │       ├── otacert
│   │       └── ...
│   └── MANIFEST.MF
├── system.new.dat
├── system.patch.dat
├── boot.img
├── recovery.img
└── ...
```

**Key Components:**
- **META-INF/:** Metadata and signatures
- **system.new.dat:** New system image (sparse)
- **system.patch.dat:** Patch data (incremental)
- **boot.img:** Boot image
- **recovery.img:** Recovery image

#### Metadata Files

**metadata File:**
- Package information
- Version numbers
- Device compatibility
- Update instructions

**otacert:**
- OTA signing certificate
- Security verification
- Package authenticity
- Update authorization

### Creating OTA Packages

#### Using Build System

**Standard Method:**
```bash
# Build OTA package
source build/envsetup.sh
lunch <device>-<variant>
m otapackage
```

**Output:**
- Creates OTA package
- Located in `out/target/product/<device>/`
- File: `ota-<timestamp>.zip`
- Ready for distribution

**Process:**
1. Builds system images
2. Packages into OTA format
3. Signs package
4. Creates OTA ZIP

#### Manual Creation

**Step 1: Prepare Images**
```bash
# Ensure images are built
m systemimage
m bootimage
m recoveryimage
```

**Step 2: Create OTA Package**
```bash
# Use ota_from_target_files
./build/tools/releasetools/ota_from_target_files \
    -k <signing_key> \
    target_files.zip \
    ota_package.zip
```

**Step 3: Sign Package**
```bash
# Sign with release key
java -jar signapk.jar \
    -w release.x509.pem release.pk8 \
    unsigned.zip \
    signed.zip
```

### OTA Package Tools

#### ota_from_target_files

**Purpose:**
Creates OTA packages from target files.

**Usage:**
```bash
ota_from_target_files [options] target_files.zip ota.zip
```

**Key Options:**
- `-k` - Signing key
- `-i` - Incremental from previous
- `-v` - Verbose output
- `-w` - Wipe user data

**Function:**
- Reads target files
- Creates OTA package
- Signs package
- Outputs OTA ZIP

#### target_files Package

**What It Is:**
Intermediate package containing all build outputs.

**Contents:**
- System images
- Boot images
- Recovery images
- Metadata
- Build information

**Creation:**
```bash
m target-files-package
```

**Location:**
- `out/target/product/<device>/obj/PACKAGING/target_files_intermediates/`
- Used for OTA creation
- Contains all images

#### signapk

**Purpose:**
Signs APK and OTA packages.

**Usage:**
```bash
java -jar signapk.jar \
    certificate.pem private_key.pk8 \
    input.zip output.zip
```

**Function:**
- Signs ZIP packages
- Adds signature
- Verifies integrity
- Required for installation

### OTA Package Creation Process

#### Full OTA Creation

**Step 1: Build System**
```bash
# Build complete system
source build/envsetup.sh
lunch <device>-<variant>
m -j8
```

**Step 2: Create Target Files**
```bash
# Create target files package
m target-files-package
```

**Step 3: Generate OTA**
```bash
# Create OTA package
./build/tools/releasetools/ota_from_target_files \
    -k build/target/product/security/testkey \
    target_files.zip \
    ota_full.zip
```

**Step 4: Verify**
```bash
# Verify package
unzip -l ota_full.zip
```

#### Incremental OTA Creation

**Step 1: Build Base System**
```bash
# Build base version
m -j8
m target-files-package
# Save as base_target_files.zip
```

**Step 2: Build Updated System**
```bash
# Make changes and rebuild
# ... make changes ...
m -j8
m target-files-package
# Save as new_target_files.zip
```

**Step 3: Create Incremental**
```bash
# Create incremental OTA
./build/tools/releasetools/ota_from_target_files \
    -k <signing_key> \
    -i base_target_files.zip \
    new_target_files.zip \
    ota_incremental.zip
```

### OTA Package Signing

#### Signing Keys

**Test Keys:**
- Default development keys
- `build/target/product/security/`
- For testing only
- Not for production

**Release Keys:**
- Production signing keys
- Securely stored
- Required for distribution
- Device-specific

**Key Types:**
- `testkey` - Default test key
- `platform` - Platform key
- `shared` - Shared key
- `media` - Media key

#### Signing Process

**Automatic Signing:**
- Build system signs automatically
- Uses configured keys
- Adds signature to package
- Verifies before distribution

**Manual Signing:**
```bash
# Sign manually
java -jar signapk.jar \
    release.x509.pem release.pk8 \
    unsigned.zip \
    signed.zip
```

### OTA Package Installation

#### Installation Methods

**Recovery Mode:**
- Boot to recovery
- Select "Apply update"
- Choose OTA package
- Install update

**ADB Sideload:**
```bash
# Sideload OTA
adb sideload ota_package.zip
```

**System Update:**
- Automatic OTA updates
- System downloads package
- Prompts user to install
- Reboots to install

#### Installation Process

**Recovery Installation:**
1. Boot to recovery
2. Verify package signature
3. Check compatibility
4. Apply updates
5. Reboot system

**Verification:**
- Signature verification
- Version compatibility
- Device compatibility
- Package integrity

### OTA Package Contents

#### System Images

**system.new.dat:**
- New system partition image
- Sparse format
- Complete system
- Replaces old system

**system.patch.dat:**
- Incremental patch (if incremental)
- Binary patches
- Only changes
- Applied to base

#### Boot Images

**boot.img:**
- New boot image
- Updated kernel
- New ramdisk
- Boot components

**recovery.img:**
- Recovery image
- Recovery system
- Update tools
- Recovery environment

#### Metadata

**META-INF/metadata:**
- Package metadata
- Version information
- Device requirements
- Update instructions

**META-INF/com/android/otacert:**
- OTA certificate
- Package signature
- Security verification
- Update authorization

### OTA Package Verification

#### Signature Verification

**Process:**
1. Extract certificate
2. Verify signature
3. Check certificate chain
4. Validate authorization

**Security:**
- Prevents tampering
- Ensures authenticity
- Authorizes updates
- Protects devices

#### Compatibility Checks

**Version Checks:**
- Base version required
- Target version
- Version compatibility
- Upgrade path

**Device Checks:**
- Device compatibility
- Hardware requirements
- Partition sizes
- System requirements

### OTA Package Best Practices

#### Package Creation

**Best Practices:**
- Always sign packages
- Test before distribution
- Verify compatibility
- Include metadata

**Testing:**
- Test on target device
- Verify installation
- Check functionality
- Validate updates

#### Distribution

**Security:**
- Use release keys
- Secure key storage
- Verify signatures
- Protect keys

**Compatibility:**
- Check device compatibility
- Verify version requirements
- Test upgrade paths
- Validate updates

### Troubleshooting OTA Packages

#### Common Issues

**Signature Errors:**
- Wrong signing key
- Corrupted signature
- Key mismatch
- Check keys

**Compatibility Issues:**
- Version mismatch
- Device incompatibility
- Missing requirements
- Check metadata

**Installation Failures:**
- Corrupted package
- Insufficient space
- Partition issues
- Verify package

#### Debugging

**Check Package:**
```bash
# List contents
unzip -l ota_package.zip

# Extract and inspect
unzip ota_package.zip
```

**Verify Signature:**
```bash
# Check signature
unzip -p ota_package.zip META-INF/com/android/otacert
```

**Test Installation:**
- Use test device
- Verify installation
- Check logs
- Debug issues

## Key Takeaways

1. **OTA packages are ZIP files** containing system updates that can be installed on Android devices wirelessly.

2. **OTA packages come in two types:** full packages (complete system) and incremental packages (only changes).

3. **OTA packages are created** using `ota_from_target_files` tool from target files packages generated during build.

4. **OTA packages must be signed** with cryptographic keys to ensure security and authenticity.

5. **Full OTA packages** contain complete system images and can update from any version.

6. **Incremental OTA packages** contain only changed files and require a specific base version.

7. **OTA packages are installed** via recovery mode, ADB sideload, or automatic system updates.

8. **Understanding OTA package creation** is essential for distributing Android updates, testing system changes, and maintaining Android devices.

## Related Topics

- **Building boot.img, system.img manually:** Understanding the images that go into OTA packages
- **Build System Structure:** How OTA packages are created during the build process
- **Android Partitions:** Understanding the partitions that OTA packages update
- **Android Verified Boot (AVB):** How OTA packages are verified during installation

