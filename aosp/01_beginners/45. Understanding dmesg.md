---
number: 45
title: Understanding dmesg
slug: understanding-dmesg
level: beginner
tags:
  - aosp
  - kernel
  - dmesg
  - logging
  - debugging
  - kernel-messages
  - diagnostics
prerequisites:
  - kernel-modules
  - boot-process-overview
  - building-the-kernel
estimated_minutes: 70
contributors: []
diagrams: []
examples: []
canonical_id: aosp-beginner-45
---

# Understanding dmesg

## Overview

dmesg (display message) is a command and kernel facility for viewing kernel ring buffer messages. Understanding dmesg is essential for AOSP development, as it provides access to kernel logs, boot messages, driver initialization, hardware detection, and system diagnostics. This guide provides a comprehensive overview of dmesg, how it works, how to use it, log levels, and how to interpret kernel messages for debugging and system analysis.

Think of dmesg like a flight data recorder (black box) for the kernel: just as an airplane's black box records everything that happens during flight, dmesg records kernel messages from boot time onwards, including hardware detection, driver loading, errors, warnings, and system events. It's your window into what the kernel is doing, what hardware it's finding, and what problems it's encountering.

## Deep Explanation

### What is dmesg?

dmesg is both a command-line utility and a kernel facility that displays messages from the kernel ring buffer. These messages include boot-time information, hardware detection, driver initialization, errors, warnings, and system events.

**Key Characteristics:**
- **Kernel Messages:** Messages from kernel code
- **Ring Buffer:** Circular buffer of messages
- **Boot to Present:** Messages from boot onwards
- **Real-Time:** Can view as system runs

**Why dmesg?**
- **Debugging:** Diagnose kernel issues
- **Hardware:** See hardware detection
- **Boot Analysis:** Understand boot sequence
- **System Monitoring:** Monitor kernel activity

### Kernel Logging System

#### printk() Function

**Kernel Logging:**
```c
printk(KERN_INFO "Device initialized\n");
printk(KERN_ERR "Error occurred: %d\n", error_code);
printk(KERN_DEBUG "Debug message\n");
```

**Log Levels:**
- `KERN_EMERG` (0) - Emergency
- `KERN_ALERT` (1) - Alert
- `KERN_CRIT` (2) - Critical
- `KERN_ERR` (3) - Error
- `KERN_WARNING` (4) - Warning
- `KERN_NOTICE` (5) - Notice
- `KERN_INFO` (6) - Info
- `KERN_DEBUG` (7) - Debug

#### Kernel Ring Buffer

**Ring Buffer Structure:**
- Circular buffer in kernel memory
- Fixed size (configurable)
- Overwrites oldest messages when full
- Accessible via `/dev/kmsg` or `dmesg`

**Buffer Size:**
- Default: 64KB-1MB (kernel configurable)
- Can be increased for more history
- Trade-off: More memory vs more history

**Message Storage:**
- Timestamp
- Log level
- Source (subsystem, driver)
- Message text

### Using dmesg Command

#### Basic Usage

**View All Messages:**
```bash
dmesg
```

**View Last N Lines:**
```bash
dmesg | tail -n 50
```

**Follow Messages (Real-Time):**
```bash
dmesg -w
# Or
tail -f /dev/kmsg
```

**Clear Buffer:**
```bash
dmesg -C
# Requires appropriate permissions
```

#### Filtering Messages

**By Log Level:**
```bash
dmesg -l err      # Errors only
dmesg -l warn     # Warnings
dmesg -l info     # Info messages
dmesg -l debug    # Debug messages
```

**By Facility:**
```bash
dmesg -f kern     # Kernel messages
dmesg -f user     # User space messages
dmesg -f daemon   # Daemon messages
```

**By Keyword:**
```bash
dmesg | grep -i error
dmesg | grep -i "device"
dmesg | grep -i "driver"
```

**By Time:**
```bash
dmesg -T          # Human-readable timestamps
dmesg --since "5 minutes ago"
dmesg --since "2024-01-01 10:00:00"
```

#### Advanced Options

**Human-Readable Timestamps:**
```bash
dmesg -T
# Shows: [Mon Jan 15 10:30:45 2024] message
```

**Raw Format:**
```bash
dmesg -r
# Raw format with log levels
```

**Decode Facility and Level:**
```bash
dmesg -x
# Shows facility and level codes
```

**Color Output:**
```bash
dmesg --color=always
# Color-coded by log level
```

### Understanding Kernel Messages

#### Message Format

**Standard Format:**
```
[timestamp] subsystem: message
```

**Example:**
```
[    0.123456] Linux version 5.10.123
[    0.234567] CPU: ARMv8 Processor
[    0.345678] Memory: 4GB available
[    1.456789] usb 1-1: new device detected
[    2.567890] EXT4-fs: mounted filesystem
```

**With Log Level:**
```
<6>[    0.123456] INFO: System initialized
<4>[    1.234567] WARNING: Low memory
<3>[    2.345678] ERROR: Device failed
```

#### Common Message Types

**Boot Messages:**
```
[    0.000000] Booting Linux
[    0.123456] Linux version 5.10.123
[    0.234567] Command line: console=ttyMSM0,115200
[    0.345678] CPU: ARMv8 Processor
[    0.456789] Memory: 4GB
```

**Hardware Detection:**
```
[    1.123456] usb 1-1: new device detected
[    1.234567] input: Touchscreen detected
[    1.345678] mmc0: new SD card inserted
[    1.456789] Bluetooth: adapter found
```

**Driver Initialization:**
```
[    2.123456] usb-storage: USB Mass Storage driver
[    2.234567] EXT4-fs: driver loaded
[    2.345678] Network: Ethernet driver initialized
[    2.456789] Graphics: GPU driver loaded
```

**Errors and Warnings:**
```
[    3.123456] WARNING: Low memory
[    3.234567] ERROR: Device initialization failed
[    3.345678] CRITICAL: Kernel panic
[    3.456789] ALERT: Hardware failure
```

### Log Levels Explained

#### Emergency (0)

**KERN_EMERG:**
- System is unusable
- Immediate attention required
- Usually indicates crash or panic
- Example: Kernel panic

#### Alert (1)

**KERN_ALERT:**
- Action must be taken immediately
- Critical system condition
- Example: Hardware failure

#### Critical (2)

**KERN_CRIT:**
- Critical conditions
- System may be unstable
- Example: Driver crash

#### Error (3)

**KERN_ERR:**
- Error conditions
- Operation failed
- Example: Device initialization failed

#### Warning (4)

**KERN_WARNING:**
- Warning messages
- Something unusual happened
- System still functional
- Example: Low memory warning

#### Notice (5)

**KERN_NOTICE:**
- Normal but significant condition
- Important events
- Example: Device connected

#### Info (6)

**KERN_INFO:**
- Informational messages
- Normal operation
- Example: Driver loaded

#### Debug (7)

**KERN_DEBUG:**
- Debug-level messages
- Detailed information
- Usually disabled in production
- Example: Function entry/exit

### Android-Specific Messages

#### Android Kernel Messages

**Binder:**
```
[    1.123456] binder: driver initialized
[    1.234567] binder: 1:1 transaction
```

**ashmem:**
```
[    1.345678] ashmem: initialized
[    1.456789] ashmem: shared memory created
```

**ION:**
```
[    1.567890] ion: heap system initialized
[    1.678901] ion: buffer allocated
```

**SELinux:**
```
[    2.123456] SELinux: initialized
[    2.234567] SELinux: policy loaded
[    2.345678] SELinux: enforcing mode
```

**Wakelocks:**
```
[    2.456789] wakelock: system_wake_lock acquired
[    2.567890] wakelock: system_wake_lock released
```

#### Android Boot Messages

**Early Boot:**
```
[    0.000000] Android kernel booting
[    0.123456] Command line: androidboot.serialno=ABC123
[    0.234567] Android: hardware=pixel
```

**Init Process:**
```
[    1.123456] init: starting
[    1.234567] init: loading SELinux policy
[    1.345678] init: mounting filesystems
```

**System Services:**
```
[    2.123456] init: starting Zygote
[    2.234567] init: starting System Server
[    2.345678] init: boot complete
```

### Interpreting dmesg Output

#### Boot Sequence Analysis

**Early Boot:**
```
[    0.000000] Booting Linux
[    0.123456] CPU initialization
[    0.234567] Memory setup
[    0.345678] Device tree loaded
```

**Hardware Detection:**
```
[    1.123456] USB controller initialized
[    1.234567] Storage device detected
[    1.345678] Network adapter found
```

**Driver Loading:**
```
[    2.123456] Driver module loaded
[    2.234567] Device registered
[    2.345678] Hardware ready
```

#### Error Analysis

**Device Errors:**
```
[    3.123456] ERROR: Device /dev/sda failed to initialize
[    3.234567] WARNING: Retrying device initialization
[    3.345678] ERROR: Device initialization failed after 3 retries
```

**Memory Issues:**
```
[    4.123456] WARNING: Low memory (10% free)
[    4.234567] Out of memory: kill process
[    4.345678] Memory allocation failed
```

**Driver Problems:**
```
[    5.123456] ERROR: Driver module not found
[    5.234567] WARNING: Driver version mismatch
[    5.345678] ERROR: Driver initialization failed
```

### dmesg vs Other Logging

#### dmesg vs logcat

**dmesg:**
- Kernel messages
- Low-level system
- Hardware and drivers
- Boot-time information

**logcat:**
- User-space messages
- Android framework
- Applications
- Runtime logs

**Usage:**
```bash
# Kernel messages
dmesg

# Android logs
adb logcat

# Both
dmesg && adb logcat
```

#### dmesg vs /proc/kmsg

**dmesg:**
- Command-line utility
- Reads from ring buffer
- Shows historical messages
- Can clear buffer

**/proc/kmsg:**
- File interface
- Real-time stream
- Doesn't show history
- Used by log daemons

**Usage:**
```bash
# Historical messages
dmesg

# Real-time stream
tail -f /proc/kmsg
```

### Practical Use Cases

#### Debugging Boot Issues

**Boot Hangs:**
```bash
# Check last messages before hang
dmesg | tail -n 100

# Look for errors
dmesg | grep -i error

# Check hardware detection
dmesg | grep -i "detected\|found"
```

**Slow Boot:**
```bash
# Check boot timing
dmesg -T | head -n 50

# Find slow operations
dmesg | grep -i "timeout\|slow"
```

#### Hardware Troubleshooting

**Device Not Detected:**
```bash
# Check if device detected
dmesg | grep -i "device\|usb\|pci"

# Check driver loading
dmesg | grep -i "driver\|module"
```

**Hardware Errors:**
```bash
# Find hardware errors
dmesg | grep -i "error\|fail\|timeout"

# Check specific device
dmesg | grep -i "sda\|eth0\|wlan"
```

#### Driver Issues

**Driver Loading:**
```bash
# Check driver messages
dmesg | grep -i "driver\|module"

# Find driver errors
dmesg | grep -i "driver.*error\|module.*fail"
```

**Driver Compatibility:**
```bash
# Check version info
dmesg | grep -i "version\|compat"
```

### Best Practices

#### Reading dmesg

**Start from Boot:**
- Read from beginning for boot issues
- Check early messages for initialization
- Look for hardware detection

**Filter Effectively:**
- Use grep for specific issues
- Filter by log level
- Search by keyword

**Use Timestamps:**
- Enable timestamps for timing analysis
- Compare boot times
- Track event sequence

#### Saving dmesg

**Save to File:**
```bash
dmesg > dmesg.log
dmesg -T > dmesg_timestamped.log
```

**Save Boot Messages:**
```bash
# Early in boot process
dmesg > /data/dmesg_boot.log
```

**Regular Collection:**
- Save dmesg periodically
- Archive for analysis
- Compare across boots

### Configuration

#### Kernel Log Level

**Current Log Level:**
```bash
cat /proc/sys/kernel/printk
# Output: 7 4 1 7
# Format: current default minimum boot-time-default
```

**Set Log Level:**
```bash
# Enable all messages
echo 7 > /proc/sys/kernel/printk

# Disable debug messages
echo 6 > /proc/sys/kernel/printk
```

**Boot Argument:**
```
loglevel=7    # Enable all messages
quiet         # Reduce messages
```

#### Ring Buffer Size

**Check Buffer Size:**
```bash
dmesg -s 8192  # If supported
```

**Kernel Configuration:**
- `CONFIG_LOG_BUF_SHIFT` - Buffer size
- Larger = more history
- Trade-off: memory usage

## Key Takeaways

1. **dmesg displays kernel ring buffer messages** including boot information, hardware detection, driver initialization, and system events.

2. **Kernel messages are generated by printk()** with different log levels from emergency (0) to debug (7).

3. **dmesg can filter messages** by log level, facility, keyword, or time, and can show real-time messages with `-w` flag.

4. **Message format includes timestamp, log level, and message text**, making it easy to understand system events chronologically.

5. **Android-specific messages** include Binder, ashmem, ION, SELinux, and wakelock information.

6. **dmesg is essential for debugging** boot issues, hardware problems, driver failures, and system errors.

7. **dmesg differs from logcat** in that it shows kernel-level messages while logcat shows user-space Android logs.

8. **Understanding dmesg** is crucial for kernel debugging, hardware troubleshooting, boot analysis, and AOSP development.

## Related Topics

- **Kernel modules:** How module loading appears in dmesg
- **Kernel boot arguments:** How boot arguments affect kernel messages
- **Boot Process Overview:** How boot messages appear in dmesg
- **Building the kernel:** How kernel configuration affects logging

