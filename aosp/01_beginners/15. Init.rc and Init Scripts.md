---
number: 15
title: Init.rc and Init Scripts
slug: init-rc-and-init-scripts
level: beginner
tags:
  - aosp
  - init
  - init-rc
  - boot
  - system-initialization
  - scripts
prerequisites:
  - init-system-in-android
  - boot-process-overview
estimated_minutes: 90
contributors: []
diagrams: []
examples: []
canonical_id: aosp-beginner-15
---

# Init.rc and Init Scripts

## Overview

Init scripts (`.rc` files) are configuration files written in the init language that define how the Android system initializes during boot. They specify which services to start, when to start them, what actions to perform, and how the system should be configured. Understanding init scripts is crucial for AOSP development, as they control the entire boot sequence and system behavior.

Think of init scripts as the "recipe book" for Android boot - just as a recipe tells you what ingredients to use, when to add them, and how to combine them, init scripts tell the system what services to start, when to start them, and how to configure them. Without these scripts, the system wouldn't know what to do after the kernel boots.

## Deep Explanation

### What are Init Scripts?

Init scripts are text files written in a special declarative language that init understands. They define:

- **Actions:** Commands to execute when certain events occur
- **Services:** Long-running processes to start and manage
- **Imports:** Other script files to load
- **Triggers:** Events that cause actions to execute

**Key Characteristics:**
- **Declarative:** You describe what you want, not how to do it
- **Event-driven:** Actions execute based on triggers
- **Hierarchical:** Scripts can import and override other scripts
- **System-wide:** Control the entire Android system

### Init Script Locations

Init loads scripts from multiple locations in a specific order. Understanding this order is crucial because later scripts can override earlier ones.

#### Primary Script Locations

**1. Ramdisk Init Scripts:**
- `/init.rc` - Main init script (in ramdisk, loaded first)
- `/init.<device>.rc` - Device-specific init script
- `/init.<vendor>.rc` - Vendor-specific init script
- `/init.usb.rc` - USB-related initialization
- `/init.zygote32.rc` or `/init.zygote64.rc` - Zygote configuration

**2. System Partition Scripts:**
- `/system/etc/init/` - System init scripts
- All `.rc` files in this directory are loaded
- Examples: `hwservicemanager.rc`, `vndservicemanager.rc`

**3. Vendor Partition Scripts:**
- `/vendor/etc/init/` - Vendor init scripts
- OEM-specific services and configurations
- Examples: `vendor-specific-service.rc`

**4. ODM Partition Scripts:**
- `/odm/etc/init/` - ODM (Original Design Manufacturer) scripts
- Device-specific customizations
- Less common, used by some manufacturers

**5. Product Partition Scripts:**
- `/product/etc/init/` - Product-specific scripts
- Product variant configurations

**6. System Ext Partition Scripts:**
- `/system_ext/etc/init/` - System extension scripts
- Additional system services

#### Script Loading Order

Init loads scripts in this specific order:

```
1. /init.rc (from ramdisk)
2. /init.<device>.rc (from ramdisk)
3. /init.<vendor>.rc (from ramdisk)
4. /init.usb.rc (from ramdisk)
5. /system/etc/init/*.rc (alphabetically)
6. /vendor/etc/init/*.rc (alphabetically)
7. /odm/etc/init/*.rc (alphabetically)
8. /product/etc/init/*.rc (alphabetically)
9. /system_ext/etc/init/*.rc (alphabetically)
```

**Important Notes:**
- Scripts in the same directory are loaded alphabetically
- Later scripts can override earlier ones
- Services defined later replace services with the same name
- Actions are cumulative (all actions with the same trigger execute)

### Main Init Script (/init.rc)

The main init script is the foundation of the Android boot process. It's typically located in the ramdisk and is the first script loaded.

#### Structure of /init.rc

A typical `/init.rc` file contains:

**1. Early Initialization:**
```
on early-init
    # Critical early setup
    mkdir /dev
    mkdir /proc
    mkdir /sys
    mount tmpfs tmpfs /dev
    mount proc proc /proc
    mount sysfs sysfs /sys
```

**2. Main Initialization:**
```
on init
    # Mount partitions
    mount ext4 /dev/block/system /system ro
    mount ext4 /dev/block/vendor /vendor ro
    
    # Create device nodes
    mknod /dev/null c 1 3
    mknod /dev/zero c 1 5
    
    # Set up symlinks
    symlink /system/bin /bin
```

**3. Service Definitions:**
```
service servicemanager /system/bin/servicemanager
    class core
    user system
    group system
    onrestart restart zygote
```

**4. Late Initialization:**
```
on late-init
    trigger post-fs
    trigger post-fs-data
    trigger load_system_props_action
    trigger zygote-start
```

**5. Property Triggers:**
```
on property:sys.boot_completed=1
    # Boot completed actions
    start bootanim
```

#### Real-World /init.rc Example

Here's a simplified example of what a real `/init.rc` might look like:

```
# Android init script

# Early initialization - critical setup
on early-init
    # Create essential directories
    mkdir /dev 0755
    mkdir /proc 0755
    mkdir /sys 0755
    mkdir /system 0755
    mkdir /data 0755
    mkdir /vendor 0755
    
    # Mount essential filesystems
    mount tmpfs tmpfs /dev mode=0755
    mount proc proc /proc
    mount sysfs sysfs /sys
    
    # Initialize SELinux
    setenforce 0  # Start permissive
    load_policy /sepolicy

# Main initialization
on init
    # Wait for block device
    wait /dev/block/bootdevice
    
    # Mount system partitions
    mount ext4 /dev/block/system /system ro wait,avb
    mount ext4 /dev/block/vendor /vendor ro wait,avb
    mount ext4 /dev/block/product /product ro wait,avb
    
    # Create device nodes
    mknod /dev/null c 1 3
    mknod /dev/zero c 1 5
    mknod /dev/random c 1 8
    mknod /dev/urandom c 1 9
    
    # Set up symlinks
    symlink /system/bin /bin
    symlink /system/etc /etc
    
    # Initialize property system
    property_init

# Import additional scripts
import /system/etc/init/hw/init.${ro.hardware}.rc
import /vendor/etc/init/hw/init.${ro.hardware}.rc

# Service definitions
service servicemanager /system/bin/servicemanager
    class core
    user system
    group system
    critical
    onrestart restart healthd
    onrestart restart zygote
    onrestart restart audioserver
    onrestart restart media

# Late initialization
on late-init
    trigger early-fs
    trigger fs
    trigger post-fs
    trigger post-fs-data
    trigger load_system_props_action
    trigger load_persist_props_action
    trigger zygote-start

# Boot completion
on property:sys.boot_completed=1
    class_start late_start
```

### Service-Specific Init Scripts

Many services have their own init scripts in `/system/etc/init/` or `/vendor/etc/init/`. These scripts are modular and easier to maintain.

#### Structure of Service Scripts

A typical service init script contains:

```
# Service definition
service servicename /system/bin/service_binary
    class main
    user system
    group system
    socket servicename stream 660 system system
    onrestart restart dependent_service

# Actions for this service
on property:some.property=value
    start servicename
```

#### Example: Zygote Init Script

```
# /system/etc/init/zygote/zygote64.rc

service zygote /system/bin/app_process64 -Xzygote /system/bin --zygote --start-system-server
    class main
    priority -20
    user root
    group root readproc
    socket zygote stream 660 root system
    socket usap_pool_primary stream 660 root system
    onrestart write /sys/power/state on
    onrestart restart audioserver
    onrestart restart cameraserver
    onrestart restart media
    onrestart restart netd
    onrestart restart wificond
    writepid /dev/cpuset/foreground/tasks /dev/stune/foreground/tasks
```

#### Example: Audio Service Init Script

```
# /system/etc/init/audioserver.rc

service audioserver /system/bin/audioserver
    class main
    user audioserver
    # media uid - see get_media_uid()
    group audio camera drmrpc inet media mediadrm net_bt net_bt_admin net_bw_acct
    ioprio rt 4
    writepid /dev/cpuset/foreground/tasks /dev/stune/foreground/tasks
    onrestart restart vendor.audio-hal-2-0
    onrestart restart vendor.audio-hal-4-0-msd
```

### Device-Specific Init Scripts

Device manufacturers often create device-specific init scripts to configure hardware and device-specific services.

#### Device Init Script Location

- `/init.<device>.rc` - In ramdisk
- `/vendor/etc/init/hw/init.<ro.hardware>.rc` - Vendor partition

#### Example: Device-Specific Configuration

```
# /vendor/etc/init/hw/init.qcom.rc (for Qualcomm devices)

on early-init
    # Device-specific early setup
    write /proc/sys/kernel/sched_boost 1
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor performance

on init
    # Device-specific mounts
    mount ext4 /dev/block/bootdevice /vendor ro wait,avb=vbmeta_vendor
    
    # Device-specific device nodes
    mknod /dev/msm_camera c 1 0

service vendor-specific-service /vendor/bin/vendor_service
    class main
    user system
    group system
```

### Import Mechanism

Init scripts can import other scripts using the `import` statement. This allows modular organization and conditional loading.

#### Basic Import

```
import /system/etc/init/hw/init.${ro.hardware}.rc
```

This imports a script based on the `ro.hardware` property value.

#### Conditional Imports

```
# Import based on property
import /system/etc/init/hw/init.${ro.hardware}.rc

# Import USB configuration
import /init.usb.rc

# Import Zygote configuration based on architecture
import /system/etc/init/zygote/zygote${ro.zygote}.rc
```

#### Import Order

Imports are processed when encountered:
1. Scripts are parsed in order
2. When `import` is encountered, that script is loaded immediately
3. Imported scripts are parsed completely before continuing
4. Later imports can override earlier definitions

### Init Script Organization

Modern Android uses a modular approach to init scripts:

**System Scripts (`/system/etc/init/`):**
- One script per service or feature
- Named after the service (e.g., `servicemanager.rc`)
- Contains service definition and related actions

**Vendor Scripts (`/vendor/etc/init/`):**
- Vendor-specific services
- Hardware-specific configurations
- OEM customizations

**Benefits of Modular Organization:**
- Easier to maintain
- Clear separation of concerns
- Can update individual services
- Easier to debug
- Better for code reviews

### Script Parsing and Execution

#### Parsing Phase

When init starts:

1. **Load main script:** `/init.rc` from ramdisk
2. **Parse actions:** Extract all `on <trigger>` blocks
3. **Parse services:** Extract all `service` definitions
4. **Process imports:** Load and parse imported scripts
5. **Build dependency graph:** Determine service dependencies
6. **Validate syntax:** Check for errors

#### Execution Phase

After parsing:

1. **Early-init trigger:** Execute `on early-init` actions
2. **Init trigger:** Execute `on init` actions
3. **Mount partitions:** Mount all filesystems
4. **Load properties:** Load property files
5. **Late-init trigger:** Execute `on late-init` actions
6. **Start services:** Start service classes
7. **Runtime:** Handle property changes and service restarts

### Common Init Script Patterns

#### Pattern 1: Conditional Service Start

```
service myservice /system/bin/myservice
    class main
    disabled  # Don't start automatically

# Start when property is set
on property:sys.enable_myservice=1
    start myservice
```

#### Pattern 2: Service Dependency

```
service dependent_service /system/bin/dependent
    class main
    # Starts after prerequisite_service

# Start dependent service after prerequisite
on property:init.svc.prerequisite_service=running
    start dependent_service
```

#### Pattern 3: Property-Based Configuration

```
# Set property based on condition
on property:ro.debuggable=1
    setprop sys.adb.enable 1
    start adbd

on property:ro.debuggable=0
    setprop sys.adb.enable 0
    stop adbd
```

#### Pattern 4: Boot Phase Actions

```
on early-init
    # Critical setup
    mkdir /dev 0755
    mount tmpfs tmpfs /dev

on init
    # Main initialization
    mount ext4 /dev/block/system /system ro

on late-init
    # Final setup
    trigger post-fs
    class_start main
```

### Debugging Init Scripts

#### Viewing Loaded Scripts

To see which scripts are loaded:

```bash
# Check init logs
adb logcat -s init

# View init process information
adb shell ps -A | grep init

# Check service status
adb shell getprop | grep init.svc
```

#### Common Issues

**1. Script Not Loading:**
- Check file location and permissions
- Verify file extension is `.rc`
- Check for syntax errors in logs

**2. Service Not Starting:**
- Verify service definition syntax
- Check executable path exists
- Review service class and dependencies
- Check SELinux contexts

**3. Actions Not Executing:**
- Verify trigger name is correct
- Check if trigger is actually fired
- Review action syntax
- Check for errors in logs

#### Syntax Validation

Init validates script syntax during parsing. Common errors:

- **Missing quotes:** String values need quotes in some contexts
- **Invalid trigger name:** Trigger must be a known boot phase or property
- **Service name conflicts:** Duplicate service names (later one wins)
- **Invalid option:** Unknown service option

### Best Practices

#### 1. Modular Organization

**Good:**
```
# /system/etc/init/myservice.rc
service myservice /system/bin/myservice
    class main
```

**Bad:**
```
# Everything in /init.rc
service myservice /system/bin/myservice
service anotherservice /system/bin/another
# ... hundreds of services
```

#### 2. Clear Naming

**Good:**
```
service audio_hal_service /vendor/bin/audio_hal
```

**Bad:**
```
service hal /vendor/bin/hal
```

#### 3. Proper Dependencies

**Good:**
```
service dependent /system/bin/dependent
    class main

on property:init.svc.prerequisite=running
    start dependent
```

**Bad:**
```
# No dependency management - may start too early
service dependent /system/bin/dependent
    class main
```

#### 4. Error Handling

**Good:**
```
on init
    wait /dev/block/bootdevice
    mount ext4 /dev/block/system /system ro wait
```

**Bad:**
```
on init
    mount ext4 /dev/block/system /system ro
    # May fail if device not ready
```

#### 5. Documentation

**Good:**
```
# Audio HAL service
# Provides audio hardware abstraction
service audio_hal /vendor/bin/audio_hal
    class main
```

**Bad:**
```
service audio_hal /vendor/bin/audio_hal
    class main
    # No explanation
```

### Edge Cases and Pitfalls

#### Pitfall 1: Script Loading Order

**Problem:**
Scripts load in alphabetical order within directories. If Service A depends on Service B, but A's script loads before B's script, the dependency might not be recognized.

**Solution:**
Use explicit property-based triggers or ensure proper service class ordering.

#### Pitfall 2: Overriding Services

**Problem:**
A vendor script defines a service, then a system script defines the same service. The later one wins, potentially breaking vendor functionality.

**Solution:**
Use unique service names or coordinate between system and vendor scripts.

#### Pitfall 3: Import Loops

**Problem:**
Script A imports B, B imports C, C imports A - creates infinite loop.

**Solution:**
Init detects and prevents import loops, but avoid circular dependencies in design.

#### Pitfall 4: Property Expansion

**Problem:**
Using `${property}` before property is set results in empty string.

**Solution:**
Ensure properties are set before use, or use default values.

### Real-World Examples

#### Example 1: Complete Service Script

```
# /system/etc/init/example-service.rc

# Service definition
service example_service /system/bin/example_service
    class main
    user system
    group system
    socket example_service stream 660 system system
    onrestart restart dependent_service
    writepid /dev/cpuset/foreground/tasks

# Start service on boot
on property:sys.boot_completed=1
    start example_service

# Stop service when property changes
on property:sys.example.enable=0
    stop example_service

# Restart service when property changes
on property:sys.example.enable=1
    restart example_service
```

#### Example 2: Multi-Phase Initialization

```
# /vendor/etc/init/hw/init.device.rc

on early-init
    # Device-specific early setup
    write /proc/sys/kernel/panic_on_oops 1
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor performance

on init
    # Device-specific mounts
    wait /dev/block/bootdevice
    mount ext4 /dev/block/bootdevice /vendor ro wait,avb=vbmeta_vendor
    
    # Device-specific configuration
    write /sys/class/leds/led:rgb_blue/brightness 0

on late-init
    # Start device-specific services
    start device_specific_service
    trigger device_ready
```

#### Example 3: Conditional Service Based on Hardware

```
# /vendor/etc/init/hw/init.${ro.hardware}.rc

# Service for specific hardware variant
service hardware_service /vendor/bin/hardware_service
    class main
    disabled

# Start based on hardware property
on property:ro.hardware=qcom
    start hardware_service

on property:ro.hardware=mediatek
    # Different service for MediaTek
    start mediatek_service
```

## References and Further Reading

- [AOSP Init Source Code](https://cs.android.com/android/platform/superproject/+/master:system/core/init/)
- [Init Language Documentation](https://source.android.com/docs/core/architecture/init)
- [Init Script Examples](https://cs.android.com/android/platform/superproject/+/master:system/core/rootdir/)
- [Service Management](https://source.android.com/docs/core/architecture/init#services)

## Quiz

### Question 1
In what order are init scripts loaded?

**A)** Alphabetically across all directories  
**B)** Ramdisk first, then system, vendor, odm in that order  
**C)** All scripts load simultaneously  
**D)** Random order

**Answer: B** - Init loads scripts from ramdisk first, then processes directories in order: system, vendor, odm, product, system_ext. Within each directory, scripts load alphabetically.

### Question 2
What happens if two scripts define a service with the same name?

**A)** Both services start  
**B)** The first definition is used  
**C)** The last definition overrides the earlier one  
**D)** An error occurs and boot fails

**Answer: C** - When multiple scripts define a service with the same name, the last definition loaded takes precedence and overrides earlier definitions.

### Question 3
Where is the main init script (`/init.rc`) typically located?

**A)** `/system/etc/init/`  
**B)** In the ramdisk  
**C)** `/vendor/etc/init/`  
**D)** `/data/local/`

**Answer: B** - The main `/init.rc` script is located in the ramdisk, which is loaded into memory during boot before the system partition is mounted.

### Question 4
What is the purpose of the `import` statement in init scripts?

**A)** To include code from other scripts  
**B)** To load additional init scripts  
**C)** To reference external libraries  
**D)** To import system properties

**Answer: B** - The `import` statement loads and parses additional init script files, allowing modular organization of init configuration.

### Question 5
Which directory contains vendor-specific init scripts?

**A)** `/system/etc/init/`  
**B)** `/vendor/etc/init/`  
**C)** `/odm/etc/init/`  
**D)** Both B and C

**Answer: D** - Vendor-specific scripts can be in `/vendor/etc/init/` (vendor partition) or `/odm/etc/init/` (ODM partition), depending on the device manufacturer's organization.

## Related Topics

- [Init System in Android](./04.%20Init%20System%20in%20Android.md)
- [Init Language Syntax](./16.%20Init%20Language%20Syntax.md)
- [Boot Process Overview](./03.%20Boot%20Process%20Overview.md)
- [System Properties](./05.%20System%20Properties.md)

