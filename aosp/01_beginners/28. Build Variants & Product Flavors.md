---
number: 28
title: Build Variants & Product Flavors
slug: build-variants-product-flavors
level: beginner
tags:
  - aosp
  - build
  - variants
  - product
  - eng
  - user
  - userdebug
  - flavors
prerequisites:
  - build-system-structure
  - soong-build-system
estimated_minutes: 80
contributors: []
diagrams: []
examples: []
canonical_id: aosp-beginner-28
---

# Build Variants & Product Flavors

## Overview

Android supports different build variants (eng, user, userdebug) and product flavors that customize how the system is built for different purposes. Understanding build variants and product flavors is essential for AOSP development, as they determine what features are enabled, what debugging capabilities are available, and how the system is optimized. This guide provides a comprehensive overview of build variants, product configurations, and how to customize builds for different use cases.

Think of build variants and product flavors like different car models from the same manufacturer: the base platform (AOSP) is the same, but you can choose different trim levels (variants) and optional packages (product flavors) to customize the final product. An "engineering" variant might have all debugging tools and extra features, while a "user" variant is optimized for production with minimal overhead.

## Deep Explanation

### What are Build Variants?

Build variants are different configurations of Android that are optimized for different use cases. They control what features are enabled, what debugging capabilities are available, and how the system is optimized.

**Key Characteristics:**
- **Three Main Variants:** eng, userdebug, user
- **Purpose-Specific:** Each variant serves a specific purpose
- **Feature Control:** Variants control what's included
- **Optimization Level:** Different optimization for each

**Why Variants?**
- **Development:** Need debugging tools and features
- **Testing:** Need some debugging but closer to production
- **Production:** Need optimized, secure system
- **Flexibility:** One codebase, multiple configurations

### Build Variants Overview

#### eng (Engineering)

**Purpose:**
Development and engineering builds with full debugging capabilities.

**Characteristics:**
- **Root Access:** Enabled by default
- **Debugging:** Full debugging tools included
- **Logging:** Verbose logging enabled
- **Features:** All development features enabled
- **Performance:** Not optimized (debugging priority)

**Use Cases:**
- Development
- Internal testing
- Debugging
- Feature development

**Features Enabled:**
- ADB root access
- Debugging tools
- Additional logging
- Development apps
- Test frameworks

**Security:**
- Less secure (development focus)
- Root access available
- Debugging enabled
- Not for end users

#### userdebug

**Purpose:**
User builds with debugging capabilities for testing.

**Characteristics:**
- **Root Access:** Available via ADB
- **Debugging:** Some debugging tools
- **Logging:** Moderate logging
- **Features:** Most user features
- **Performance:** Partially optimized

**Use Cases:**
- Beta testing
- QA testing
- Internal releases
- Pre-production testing

**Features Enabled:**
- ADB available
- Some debugging
- User features
- Testing capabilities

**Security:**
- Moderate security
- Root via ADB only
- Some debugging
- Closer to production

#### user

**Purpose:**
Production user builds optimized for end users.

**Characteristics:**
- **Root Access:** Not available
- **Debugging:** Minimal debugging
- **Logging:** Minimal logging
- **Features:** User features only
- **Performance:** Fully optimized

**Use Cases:**
- Production releases
- End-user devices
- Commercial releases
- Public releases

**Features Enabled:**
- User apps
- System features
- Optimized performance
- Security features

**Security:**
- Maximum security
- No root access
- Minimal debugging
- Production-ready

### Variant Comparison

#### Feature Matrix

| Feature | eng | userdebug | user |
|---------|-----|----------|------|
| Root Access | Yes | ADB only | No |
| ADB | Yes | Yes | Limited |
| Debugging | Full | Partial | Minimal |
| Logging | Verbose | Moderate | Minimal |
| Performance | Not optimized | Partially optimized | Fully optimized |
| Security | Low | Medium | High |
| Use Case | Development | Testing | Production |

#### When to Use Each Variant

**Use eng when:**
- Developing new features
- Debugging issues
- Internal development
- Need full access

**Use userdebug when:**
- Testing before release
- QA validation
- Beta releases
- Need some debugging

**Use user when:**
- Production releases
- End-user devices
- Commercial products
- Public releases

### Product Flavors

#### What are Product Flavors?

Product flavors are different configurations of Android for different devices, markets, or use cases. They allow customization of the build for specific hardware, regions, or requirements.

**Key Characteristics:**
- **Device-Specific:** Customized for specific devices
- **Market-Specific:** Customized for regions/markets
- **Feature-Specific:** Customized feature sets
- **Flexible:** Highly configurable

**Why Product Flavors?**
- **Hardware Differences:** Different devices need different configs
- **Market Requirements:** Different regions have different needs
- **OEM Customization:** Vendors customize for their devices
- **Feature Sets:** Different feature combinations

#### Product Configuration

**Product Files:**
- `device/<vendor>/<device>/<product>.mk` - Product definition
- `build/target/product/` - Generic product configs
- `vendor/<vendor>/products/` - Vendor products

**Product Properties:**
- Device name
- Features enabled
- Apps included
- System properties
- Build configuration

#### Product Selection

**Lunch Command:**
```bash
lunch aosp_arm-eng      # Generic ARM eng build
lunch aosp_arm-user     # Generic ARM user build
lunch <vendor>_<device>-<variant>  # Device-specific
```

**Product Format:**
- `<product>-<variant>`
- Product name
- Build variant
- Combined in lunch

### Build Configuration

#### Setting Build Variant

**Environment Setup:**
```bash
source build/envsetup.sh
lunch <product>-<variant>
```

**Variant Selection:**
- Choose during lunch
- Sets `TARGET_BUILD_VARIANT`
- Configures build system
- Affects all modules

#### Build Variables

**Key Variables:**
- `TARGET_BUILD_VARIANT` - Build variant (eng/userdebug/user)
- `TARGET_PRODUCT` - Product name
- `TARGET_ARCH` - Target architecture
- `TARGET_BUILD_TYPE` - Build type (release/debug)

**Usage:**
- Control build behavior
- Configure features
- Set optimization level
- Customize build

### Variant-Specific Configuration

#### In Android.bp Files

**Variant-Specific Properties:**
```blueprint
cc_library {
    name: "mylib",
    srcs: ["common.c"],
    variant: {
        eng: {
            cflags: ["-DDEBUG", "-g"],
            srcs: ["debug.c"],
        },
        user: {
            cflags: ["-DRELEASE", "-O3"],
        },
    },
}
```

**Variant Conditions:**
- `eng` - Engineering variant
- `userdebug` - Userdebug variant
- `user` - User variant

#### In Android.mk Files

**Variant Checks:**
```makefile
ifeq ($(TARGET_BUILD_VARIANT),eng)
    LOCAL_CFLAGS += -DDEBUG
endif
```

**Conditional Compilation:**
- Check `TARGET_BUILD_VARIANT`
- Add variant-specific flags
- Include variant-specific sources
- Configure features

### Product-Specific Configuration

#### Product Makefiles

**Product Definition:**
```makefile
# device/vendor/device/device.mk
PRODUCT_NAME := mydevice
PRODUCT_DEVICE := mydevice
PRODUCT_BRAND := vendor
PRODUCT_MODEL := My Device
```

**Product Features:**
```makefile
PRODUCT_PACKAGES += \
    MyApp \
    MyService

PRODUCT_PROPERTY_OVERRIDES += \
    ro.config.feature=true
```

#### Product Inheritance

**Inheritance:**
```makefile
$(call inherit-product, device/vendor/common/common.mk)
$(call inherit-product, frameworks/base/product.mk)
```

**Benefits:**
- Reuse common configuration
- Inherit base features
- Customize as needed
- Maintain consistency

### Build Variant Features

#### eng Variant Features

**Development Tools:**
- Full ADB access
- Root shell
- Debugging tools
- Development apps

**System Properties:**
```bash
ro.debuggable=1
ro.secure=0
ro.adb.secure=0
```

**Apps Included:**
- Development tools
- Testing frameworks
- Debugging apps
- Development utilities

#### userdebug Variant Features

**Testing Tools:**
- ADB available
- Some debugging
- Testing frameworks
- Beta features

**System Properties:**
```bash
ro.debuggable=1
ro.secure=1
ro.adb.secure=0
```

**Apps Included:**
- User apps
- Some testing tools
- Beta features
- Testing utilities

#### user Variant Features

**Production Features:**
- User apps only
- Optimized performance
- Security features
- Production configuration

**System Properties:**
```bash
ro.debuggable=0
ro.secure=1
ro.adb.secure=1
```

**Apps Included:**
- System apps
- User apps
- No development tools
- Production apps only

### Customizing Builds

#### Adding Variant-Specific Code

**In Source Code:**
```c
#ifdef USER_BUILD
    // Production code
#else
    // Debug code
#endif
```

**Build Flags:**
- `USER_BUILD` - User variant
- `ENG_BUILD` - Engineering variant
- `DEBUG_BUILD` - Debug builds

#### Custom Product Flavors

**Creating Product:**
1. Create product directory
2. Define product makefile
3. Configure features
4. Add to lunch menu

**Product Structure:**
```
device/vendor/mydevice/
├── device.mk          # Product definition
├── BoardConfig.mk       # Board configuration
└── AndroidProducts.mk  # Product registration
```

### Build Commands

#### Building Specific Variants

**Build Commands:**
```bash
# Build eng variant
lunch aosp_arm-eng
m

# Build user variant
lunch aosp_arm-user
m

# Build userdebug variant
lunch aosp_arm-userdebug
m
```

#### Switching Variants

**Change Variant:**
```bash
# Re-run lunch to change variant
lunch aosp_arm-user  # Switch to user
```

**Clean Build:**
```bash
# Clean before switching variants
m clean
lunch <product>-<new-variant>
m
```

### Build Output Differences

#### eng Build Outputs

**Characteristics:**
- Larger system images
- More apps included
- Debugging symbols
- Development tools

**File Sizes:**
- Larger system.img
- More packages
- Debug info included
- Not optimized

#### user Build Outputs

**Characteristics:**
- Smaller system images
- Optimized binaries
- Minimal apps
- Production-ready

**File Sizes:**
- Smaller system.img
- Fewer packages
- Optimized
- Stripped symbols

### Best Practices

#### Choosing Variants

**Development:**
- Use eng for development
- Full debugging access
- All tools available
- Fast iteration

**Testing:**
- Use userdebug for testing
- Closer to production
- Some debugging
- Realistic testing

**Production:**
- Use user for production
- Optimized and secure
- No debugging
- Production-ready

#### Product Configuration

**Best Practices:**
- Use clear product names
- Document product features
- Inherit common configs
- Customize as needed

**Organization:**
- Group related products
- Use consistent naming
- Maintain product files
- Document configurations

## Key Takeaways

1. **Build variants** (eng, userdebug, user) provide different configurations optimized for development, testing, and production.

2. **eng variant** is for development with full debugging capabilities, root access, and all development tools.

3. **userdebug variant** is for testing with some debugging capabilities, closer to production but still testable.

4. **user variant** is for production with maximum security, optimization, and no debugging capabilities.

5. **Product flavors** allow customization for specific devices, markets, or use cases beyond the base variants.

6. **Variant selection** is done via the `lunch` command and affects all modules in the build.

7. **Variant-specific configuration** can be done in Android.bp and Android.mk files to customize builds per variant.

8. **Understanding build variants and product flavors** is essential for AOSP development, testing, and production releases.

## Related Topics

- **Build System Structure:** The overall build system that supports variants
- **Soong Build System:** The build system that processes variant configurations
- **Understanding Android.bp Files:** How to configure variants in Android.bp files
- **AOSP Repo Structure:** How products are organized in the AOSP source tree

