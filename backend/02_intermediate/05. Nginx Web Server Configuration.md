---
number: 5
title: "Nginx Web Server Configuration"
slug: "nginx-web-server-configuration"
level: "intermediate"
tags: ["backend", "nginx", "web-server", "reverse-proxy", "load-balancing"]
prerequisites: ["api-design-principles"]
estimated_minutes: 110
contributors: []
diagrams: []
examples: []
canonical_id: "backend-intermediate-05"
---

# Nginx Web Server Configuration

## Overview

Nginx is a high-performance web server and reverse proxy. This guide covers Nginx configuration, reverse proxying, load balancing, SSL/TLS termination, caching, rate limiting, and optimization for production environments.

## Deep Explanation

### Basic Configuration

**nginx.conf Structure**:
```nginx
events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    server {
        listen 80;
        server_name example.com;
        
        location / {
            root /var/www/html;
            index index.html;
        }
    }
}
```

### Reverse Proxy

```nginx
server {
    listen 80;
    server_name api.example.com;
    
    location / {
        proxy_pass http://backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### Load Balancing

```nginx
upstream backend {
    least_conn;  # Load balancing method
    server backend1:8080;
    server backend2:8080;
    server backend3:8080;
}

server {
    location / {
        proxy_pass http://backend;
    }
}
```

**Load Balancing Methods**:
- `round_robin` (default)
- `least_conn`
- `ip_hash`
- `weight`

### SSL/TLS Configuration

```nginx
server {
    listen 443 ssl http2;
    server_name example.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
}
```

### Caching

```nginx
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m max_size=1g;

server {
    location / {
        proxy_pass http://backend;
        proxy_cache my_cache;
        proxy_cache_valid 200 60m;
        proxy_cache_use_stale error timeout updating;
    }
}
```

### Rate Limiting

```nginx
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

server {
    location /api/ {
        limit_req zone=api_limit burst=20 nodelay;
        proxy_pass http://backend;
    }
}
```

## Real Code Examples

### Example: API Gateway Configuration

```nginx
upstream api_servers {
    server api1:8080;
    server api2:8080;
}

server {
    listen 80;
    server_name api.example.com;
    
    # Rate limiting
    limit_req_zone $binary_remote_addr zone=api:10m rate=100r/m;
    
    location /api/v1/ {
        limit_req zone=api burst=20;
        
        proxy_pass http://api_servers;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # Caching
        proxy_cache api_cache;
        proxy_cache_valid 200 5m;
    }
    
    # Health check endpoint
    location /health {
        access_log off;
        return 200 "healthy\n";
    }
}
```

## Hard Use-Case: High-Performance API Gateway

### Problem Statement

Configure Nginx as an API gateway handling 10,000+ requests per second with caching and rate limiting.

### Solution

```nginx
# Optimize worker processes
worker_processes auto;
worker_connections 4096;

# Enable keepalive
keepalive_timeout 65;
keepalive_requests 100;

# Gzip compression
gzip on;
gzip_types text/plain application/json application/javascript;

# Cache configuration
proxy_cache_path /var/cache/nginx/api 
    levels=1:2 
    keys_zone=api_cache:100m 
    max_size=10g 
    inactive=60m;

# Rate limiting zones
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=100r/s;
limit_req_zone $binary_remote_addr zone=strict_limit:10m rate=10r/s;

upstream api {
    least_conn;
    server api1:8080 max_fails=3 fail_timeout=30s;
    server api2:8080 max_fails=3 fail_timeout=30s;
    server api3:8080 max_fails=3 fail_timeout=30s;
}

server {
    listen 443 ssl http2;
    
    # SSL optimization
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    location /api/ {
        # Rate limiting
        limit_req zone=api_limit burst=50;
        
        # Caching
        proxy_cache api_cache;
        proxy_cache_valid 200 5m;
        proxy_cache_key "$scheme$request_method$host$request_uri";
        
        # Proxy
        proxy_pass http://api;
        proxy_connect_timeout 5s;
        proxy_send_timeout 10s;
        proxy_read_timeout 10s;
    }
}
```

## Edge Cases and Pitfalls

### Common Mistakes

1. **Not Setting Proper Headers**
   - Always set X-Real-IP, X-Forwarded-For
   - Preserve original Host header

2. **Ignoring Timeouts**
   - Set appropriate timeouts
   - Handle slow backends

3. **Cache Invalidation**
   - Implement cache purging
   - Use cache keys properly

## References and Further Reading

- Nginx Official Documentation
- Nginx Performance Tuning

## Quiz

### Question 1
What is the default load balancing method in Nginx?

**A)** least_conn  
**B)** ip_hash  
**C)** round_robin  
**D)** weight

**Answer: C** - Round-robin is the default load balancing method.

## Related Topics

- [API Design Principles](../01_beginners/02.%20API%20Design%20Principles.md)
- [Traefik Reverse Proxy](./07.%20Traefik%20Reverse%20Proxy.md)
- [Load Balancing Strategies](../03_advanced/02.%20Load%20Balancing%20Strategies.md)

