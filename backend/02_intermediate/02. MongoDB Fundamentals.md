---
number: 2
title: "MongoDB Fundamentals"
slug: "mongodb-fundamentals"
level: "intermediate"
tags: ["backend", "mongodb", "nosql", "document-database"]
prerequisites: ["database-fundamentals"]
estimated_minutes: 115
contributors: []
diagrams: []
examples: []
canonical_id: "backend-intermediate-02"
---

# MongoDB Fundamentals

## Overview

MongoDB is a popular NoSQL document database. This guide covers MongoDB architecture, document model, queries, indexing, aggregation pipeline, replication, sharding, and best practices for building scalable applications.

## Deep Explanation

### Document Model

**Structure**:
```json
{
  "_id": ObjectId("..."),
  "name": "John Doe",
  "email": "john@example.com",
  "address": {
    "street": "123 Main St",
    "city": "New York",
    "zip": "10001"
  },
  "tags": ["developer", "backend"],
  "created_at": ISODate("2024-01-01T00:00:00Z")
}
```

### CRUD Operations

**Create**:
```javascript
db.users.insertOne({
  name: "John Doe",
  email: "john@example.com"
});

db.users.insertMany([
  {name: "Alice", email: "alice@example.com"},
  {name: "Bob", email: "bob@example.com"}
]);
```

**Read**:
```javascript
// Find one
db.users.findOne({email: "john@example.com"});

// Find many
db.users.find({status: "active"});

// With projection
db.users.find({}, {name: 1, email: 1});
```

**Update**:
```javascript
// Update one
db.users.updateOne(
  {email: "john@example.com"},
  {$set: {name: "John Updated"}}
);

// Update many
db.users.updateMany(
  {status: "inactive"},
  {$set: {status: "active"}}
);
```

**Delete**:
```javascript
db.users.deleteOne({email: "john@example.com"});
db.users.deleteMany({status: "inactive"});
```

### Indexing

**Single Field Index**:
```javascript
db.users.createIndex({email: 1});
```

**Compound Index**:
```javascript
db.users.createIndex({status: 1, created_at: -1});
```

**Text Index**:
```javascript
db.posts.createIndex({title: "text", content: "text"});
db.posts.find({$text: {$search: "search term"}});
```

### Aggregation Pipeline

```javascript
db.orders.aggregate([
  {$match: {status: "completed"}},
  {$group: {
    _id: "$user_id",
    total: {$sum: "$amount"},
    count: {$sum: 1}
  }},
  {$sort: {total: -1}},
  {$limit: 10}
]);
```

## Real Code Examples

### Example: User Posts with Aggregation

```javascript
db.users.aggregate([
  {
    $lookup: {
      from: "posts",
      localField: "_id",
      foreignField: "user_id",
      as: "posts"
    }
  },
  {
    $project: {
      name: 1,
      email: 1,
      post_count: {$size: "$posts"},
      latest_post: {$max: "$posts.created_at"}
    }
  }
]);
```

## Hard Use-Case: Sharding Strategy

### Problem Statement

Design a sharding strategy for a large user collection.

### Solution

**Shard Key Selection**:
```javascript
// Shard by user_id (good distribution)
sh.shardCollection("mydb.users", {user_id: 1});

// Compound shard key
sh.shardCollection("mydb.orders", {user_id: 1, order_date: 1});
```

**Considerations**:
- Choose high cardinality fields
- Avoid hot spots
- Consider query patterns
- Balance distribution

## Edge Cases and Pitfalls

### Common Mistakes

1. **Embedding vs Referencing**
   - Embed: Small, frequently accessed together
   - Reference: Large, accessed independently

2. **Missing Indexes**
   - Index frequently queried fields
   - Index sort fields

3. **Large Documents**
   - Keep documents under 16MB
   - Consider referencing large data

## References and Further Reading

- MongoDB Official Documentation
- MongoDB University Courses

## Quiz

### Question 1
What is the maximum document size in MongoDB?

**A)** 1MB  
**B)** 16MB  
**C)** 100MB  
**D)** Unlimited

**Answer: B** - MongoDB documents have a 16MB size limit.

## Related Topics

- [Database Fundamentals](../01_beginners/03.%20Database%20Fundamentals.md)
- [PostgreSQL Deep Dive](./01.%20PostgreSQL%20Deep%20Dive.md)
- [Redis Caching Strategies](./03.%20Redis%20Caching%20Strategies.md)

