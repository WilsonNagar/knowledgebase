---
number: 7
title: "Advanced Testing and Observability"
slug: "advanced-testing-and-observability"
level: "advanced"
tags: ["go", "testing", "observability", "logging", "tracing", "metrics"]
prerequisites: ["systems-programming-in-go"]
estimated_minutes: 120
contributors: []
diagrams: []
examples: []
canonical_id: "golang-advanced-07"
---

# Advanced Testing and Observability

## Overview

This guide covers advanced testing techniques including property-based testing, fuzzing, integration testing, structured logging, distributed tracing, and metrics collection for production systems.

## Deep Explanation

### Fuzzing

```go
func FuzzReverse(f *testing.F) {
    f.Add("hello")
    f.Fuzz(func(t *testing.T, s string) {
        reversed := Reverse(s)
        if Reverse(reversed) != s {
            t.Errorf("Reverse(Reverse(%q)) != %q", s, s)
        }
    })
}

// Run: go test -fuzz=FuzzReverse
```

### Structured Logging

```go
import "log/slog"

logger := slog.New(slog.NewJSONHandler(os.Stdout, nil))
logger.Info("user logged in",
    "user_id", 123,
    "ip", "192.168.1.1",
)
```

### Metrics

```go
import "github.com/prometheus/client_golang/prometheus"

var requestCount = prometheus.NewCounterVec(
    prometheus.CounterOpts{
        Name: "http_requests_total",
    },
    []string{"method", "endpoint"},
)

func init() {
    prometheus.MustRegister(requestCount)
}
```

## Real Code Examples

### Example: Integration Test

```go
package main

import (
    "net/http"
    "net/http/httptest"
    "testing"
)

func TestIntegration(t *testing.T) {
    server := httptest.NewServer(setupRouter())
    defer server.Close()
    
    resp, err := http.Get(server.URL + "/api/users")
    if err != nil {
        t.Fatal(err)
    }
    
    if resp.StatusCode != http.StatusOK {
        t.Errorf("Expected 200, got %d", resp.StatusCode)
    }
}
```

## Hard Use-Case: Distributed Tracing

### Problem Statement

Implement distributed tracing across microservices using OpenTelemetry.

### Solution

```go
package main

import (
    "go.opentelemetry.io/otel"
    "go.opentelemetry.io/otel/trace"
)

func handleRequest(ctx context.Context) {
    tracer := otel.Tracer("my-service")
    ctx, span := tracer.Start(ctx, "handleRequest")
    defer span.End()
    
    // Process request...
    span.SetAttributes(attribute.String("user.id", "123"))
}
```

## References and Further Reading

- [Go Fuzzing](https://go.dev/doc/fuzz/)
- [OpenTelemetry Go](https://opentelemetry.io/docs/instrumentation/go/)

## Quiz

### Question 1
What is fuzzing in Go?

**A)** Random testing  
**B)** Property-based testing with random inputs  
**C)** Unit testing  
**D)** Integration testing

**Answer: B** - Fuzzing automatically generates test inputs to find bugs.

## Related Topics

- [Systems Programming in Go](./06.%20Systems%20Programming%20in%20Go.md)
- [Building Frameworks and Libraries in Go](../04_overachiever/01.%20Building%20Frameworks%20and%20Libraries%20in%20Go.md)

