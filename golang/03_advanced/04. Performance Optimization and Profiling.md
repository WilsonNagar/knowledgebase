---
number: 4
title: "Performance Optimization and Profiling"
slug: "performance-optimization-and-profiling"
level: "advanced"
tags: ["go", "performance", "profiling", "pprof", "optimization", "gc"]
prerequisites: ["advanced-networking-in-go"]
estimated_minutes: 135
contributors: []
diagrams: []
examples: []
canonical_id: "golang-advanced-04"
---

# Performance Optimization and Profiling

## Overview

This guide covers performance profiling with pprof, CPU and memory optimization, garbage collection tuning, benchmarking strategies, and identifying and fixing performance bottlenecks.

## Deep Explanation

### Profiling

```go
import (
    _ "net/http/pprof"
    "net/http"
)

func main() {
    go func() {
        log.Println(http.ListenAndServe("localhost:6060", nil))
    }()
    // Your application...
}

// Run: go tool pprof http://localhost:6060/debug/pprof/profile
```

### CPU Profiling

```bash
go test -cpuprofile=cpu.prof
go tool pprof cpu.prof
```

### Memory Profiling

```bash
go test -memprofile=mem.prof
go tool pprof mem.prof
```

### GC Tuning

```go
// Set GC percentage
debug.SetGCPercent(100)

// Force GC
runtime.GC()
```

## Real Code Examples

### Example: Memory Pool

```go
package main

import (
    "sync"
)

var bufferPool = sync.Pool{
    New: func() interface{} {
        return make([]byte, 0, 1024)
    },
}

func getBuffer() []byte {
    return bufferPool.Get().([]byte)
}

func putBuffer(buf []byte) {
    buf = buf[:0]
    bufferPool.Put(buf)
}
```

## Hard Use-Case: Optimizing Hot Path

### Problem Statement

Optimize a frequently called function that's identified as a bottleneck through profiling.

### Solution

```go
// Before: Allocating on each call
func process(data []byte) string {
    result := make([]byte, 0, len(data)*2)
    // Process...
    return string(result)
}

// After: Reuse buffers
var bufferPool = sync.Pool{
    New: func() interface{} {
        return make([]byte, 0, 1024)
    },
}

func processOptimized(data []byte) string {
    buf := bufferPool.Get().([]byte)
    defer bufferPool.Put(buf[:0])
    
    buf = buf[:0]
    // Process into buf...
    return string(buf)
}
```

## References and Further Reading

- [Go pprof](https://go.dev/blog/pprof)
- [Go Performance Tips](https://go.dev/doc/diagnostics)

## Quiz

### Question 1
What tool is used for profiling Go programs?

**A)** gdb  
**B)** pprof  
**C)** valgrind  
**D)** perf

**Answer: B** - Go provides pprof for profiling CPU, memory, and other metrics.

## Related Topics

- [Go Runtime and Compiler Internals](./05.%20Go%20Runtime%20and%20Compiler%20Internals.md)
- [Advanced Concurrency in Go](./01.%20Advanced%20Concurrency%20in%20Go.md)

