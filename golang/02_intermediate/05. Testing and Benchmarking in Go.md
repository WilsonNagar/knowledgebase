---
number: 5
title: "Testing and Benchmarking in Go"
slug: "testing-and-benchmarking-in-go"
level: "intermediate"
tags: ["go", "testing", "benchmarking", "mocks", "test-coverage"]
prerequisites: ["building-http-servers-and-rest-apis"]
estimated_minutes: 90
contributors: []
diagrams: []
examples: []
canonical_id: "golang-intermediate-05"
---

# Testing and Benchmarking in Go

## Overview

Go has built-in testing support through the testing package. This guide covers writing unit tests, table-driven tests, benchmarks, test coverage, mocking strategies, and best practices for testing Go code.

## Deep Explanation

### Unit Tests

```go
// math.go
package math

func Add(a, b int) int {
    return a + b
}

// math_test.go
package math

import "testing"

func TestAdd(t *testing.T) {
    result := Add(2, 3)
    if result != 5 {
        t.Errorf("Add(2, 3) = %d; want 5", result)
    }
}

// Table-driven tests
func TestAddTable(t *testing.T) {
    tests := []struct {
        name     string
        a        int
        b        int
        expected int
    }{
        {"positive", 2, 3, 5},
        {"negative", -1, -2, -3},
        {"zero", 0, 5, 5},
    }
    
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            result := Add(tt.a, tt.b)
            if result != tt.expected {
                t.Errorf("Add(%d, %d) = %d; want %d", tt.a, tt.b, result, tt.expected)
            }
        })
    }
}
```

### Benchmarks

```go
func BenchmarkAdd(b *testing.B) {
    for i := 0; i < b.N; i++ {
        Add(2, 3)
    }
}

// Run: go test -bench=.
```

### Test Coverage

```bash
go test -cover
go test -coverprofile=coverage.out
go tool cover -html=coverage.out
```

## Real Code Examples

### Example: HTTP Handler Testing

```go
package main

import (
    "net/http"
    "net/http/httptest"
    "testing"
)

func TestHandler(t *testing.T) {
    req := httptest.NewRequest("GET", "/", nil)
    w := httptest.NewRecorder()
    
    handler(w, req)
    
    if w.Code != http.StatusOK {
        t.Errorf("Expected status 200, got %d", w.Code)
    }
}
```

## Hard Use-Case: Mock Testing

### Problem Statement

Create a service with dependencies that need to be mocked for testing.

### Solution

```go
package main

import (
    "errors"
    "testing"
)

type UserRepository interface {
    GetUser(id int) (*User, error)
}

type UserService struct {
    repo UserRepository
}

func (s *UserService) GetUser(id int) (*User, error) {
    return s.repo.GetUser(id)
}

// Mock implementation
type MockUserRepository struct {
    users map[int]*User
    err   error
}

func (m *MockUserRepository) GetUser(id int) (*User, error) {
    if m.err != nil {
        return nil, m.err
    }
    return m.users[id], nil
}

func TestUserService(t *testing.T) {
    mockRepo := &MockUserRepository{
        users: map[int]*User{1: {ID: 1, Name: "Alice"}},
    }
    
    service := &UserService{repo: mockRepo}
    user, err := service.GetUser(1)
    if err != nil {
        t.Fatalf("Unexpected error: %v", err)
    }
    if user.Name != "Alice" {
        t.Errorf("Expected Alice, got %s", user.Name)
    }
}
```

## References and Further Reading

- [Go Testing Package](https://pkg.go.dev/testing)
- [Testify](https://github.com/stretchr/testify)

## Quiz

### Question 1
What is the naming convention for test files in Go?

**A)** test.go  
**B)** *_test.go  
**C)** test_*.go  
**D)** *.test.go

**Answer: B** - Test files must end with `_test.go`.

## Related Topics

- [Building HTTP Servers and REST APIs](./04.%20Building%20HTTP%20Servers%20and%20REST%20APIs.md)
- [Working with Databases in Go](./06.%20Working%20with%20Databases%20in%20Go.md)

