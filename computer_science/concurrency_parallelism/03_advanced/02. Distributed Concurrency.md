---
number: 2
title: "Distributed Concurrency"
slug: "distributed-concurrency"
level: "advanced"
tags: ["concurrency", "distributed", "consensus", "coordination", "synchronization"]
prerequisites: ["gpu-parallel-programming"]
estimated_minutes: 135
contributors: []
diagrams: []
examples: []
canonical_id: "cs-conc-adv-02"
---

# Distributed Concurrency

## Overview

Distributed concurrency extends concurrency concepts to distributed systems where nodes communicate over networks. Understanding distributed locks, distributed transactions, consensus algorithms, and coordination in distributed systems is essential for building reliable distributed applications.

## Table of Contents

1. [Distributed Concurrency Challenges](#challenges)
2. [Distributed Locks](#distributed-locks)
3. [Distributed Transactions](#distributed-transactions)
4. [Consensus Algorithms](#consensus)
5. [Vector Clocks](#vector-clocks)
6. [Lamport Clocks](#lamport-clocks)
7. [Coordination Services](#coordination)
8. [Applications](#applications)

## Distributed Concurrency Challenges

### Challenges

**1. Network Delays**:
```
Messages take time
Unpredictable latency
```

**2. Partial Failures**:
```
Some nodes fail, others continue
Hard to detect failures
```

**3. No Global Clock**:
```
No synchronized time
Ordering is difficult
```

**4. Message Loss**:
```
Messages may be lost
Need retries, acknowledgments
```

## Distributed Locks

### What are Distributed Locks?

**Distributed Lock**: Lock across multiple nodes

**Purpose**: Coordinate access to shared resource

**Challenge**: Network partitions, failures

### Distributed Lock Implementation

**Redis Distributed Lock**:
```
SET key value NX EX timeout
```

**Properties**:
- **NX**: Only if not exists
- **EX**: Expiration time

**Release**: Delete key

**Problem**: May release wrong lock if expired

### Redlock Algorithm

**Method**: 
```
1. Acquire lock on majority of nodes
2. If majority: Lock acquired
3. If not: Release all locks
```

**Benefit**: More reliable

**Use**: When need strong guarantees

## Distributed Transactions

### What are Distributed Transactions?

**Distributed Transaction**: Transaction across multiple nodes

**Challenge**: ACID properties across network

**Solutions**: 
- **2PC**: Two-Phase Commit
- **3PC**: Three-Phase Commit
- **Saga**: Long-running transactions

### Two-Phase Commit (2PC)

**Phase 1 (Prepare)**:
```
1. Coordinator sends prepare to all
2. Participants vote (yes/no)
3. Coordinator collects votes
```

**Phase 2 (Commit/Abort)**:
```
1. If all yes: Send commit
2. If any no: Send abort
3. Participants commit/abort
```

**Problem**: Blocking if coordinator fails

## Consensus Algorithms

### What is Consensus?

**Consensus**: Agreement on value

**Properties**:
- **Agreement**: All agree on same value
- **Validity**: Value proposed by some node
- **Termination**: Eventually decide

**Algorithms**: Paxos, Raft

### Raft Consensus

**Raft**: Understandable consensus algorithm

**Roles**:
- **Leader**: Handles all requests
- **Follower**: Replicates log
- **Candidate**: Campaigning for leadership

**Process**: Leader election + log replication

## Vector Clocks

### What are Vector Clocks?

**Vector Clock**: Track causality in distributed system

**Purpose**: Order events across nodes

**Use**: Detect causal relationships

### Vector Clock Example

**3 Nodes**: A, B, C

**Events**:
```
A: E1([1,0,0])
B: E2([0,1,0])
A sends to B: E3([2,0,0])
B receives: E4([2,2,0])
```

**Comparison**: Can determine ordering

## Lamport Clocks

### What are Lamport Clocks?

**Lamport Clock**: Logical clock

**Purpose**: Order events

**Property**: If a â†’ b, then L(a) < L(b)

**Use**: Simpler than vector clocks

## Coordination Services

### ZooKeeper

**ZooKeeper**: Distributed coordination service

**Features**:
- **Locks**: Distributed locks
- **Configuration**: Shared configuration
- **Leader Election**: Elect leader
- **Service Discovery**: Find services

**Use**: Coordination in distributed systems

### etcd

**etcd**: Distributed key-value store

**Features**: 
- **Consensus**: Raft consensus
- **Watch**: Watch for changes
- **TTL**: Time-to-live keys

**Use**: Configuration, service discovery

## Applications

### Application 1: Distributed Databases

**Use**: Coordinate transactions

**Methods**: 2PC, consensus

**Benefit**: Consistency

### Application 2: Microservices

**Use**: Coordinate services

**Methods**: Distributed locks, transactions

**Benefit**: Coordination

### Application 3: Leader Election

**Use**: Elect single leader

**Methods**: Consensus algorithms

**Benefit**: Single point of coordination

## Real-World Examples

### Example 1: Distributed Lock Service

**Use**: Coordinate access to resources

**Implementation**: ZooKeeper, etcd

**Benefit**: Reliable coordination

### Example 2: Distributed Transaction Manager

**Use**: Coordinate transactions

**Implementation**: 2PC, Saga

**Benefit**: ACID properties

## Common Pitfalls

### Problem: Assuming Synchronous Network

```c
// BAD: Assume instant messages
// Network has delays!

// GOOD: Handle network delays
// Use timeouts, retries
```

### Problem: Not Handling Failures

```c
// BAD: Assume nodes don't fail
// Nodes can fail!

// GOOD: Handle failures
// Use consensus, replication
```

## Quiz

1. What is distributed concurrency?
   - **A)** Local concurrency
   - **B)** Concurrency across distributed nodes communicating over network
   - **C)** Single-node concurrency
   - **D)** Thread concurrency

2. What is a distributed lock?
   - **A)** Local lock
   - **B)** Lock coordinating access across multiple nodes
   - **C)** Thread lock
   - **D)** Process lock

3. What is 2PC?
   - **A)** Two processors
   - **B)** Two-Phase Commit - protocol for distributed transactions
   - **C)** Two-phase lock
   - **D)** Two-phase algorithm

**Answers:**
1. **B** - Distributed concurrency extends concurrency concepts to systems where nodes communicate over networks, facing challenges like network delays, partial failures, and lack of global clock
2. **B** - A distributed lock coordinates access to shared resources across multiple nodes in a distributed system, requiring coordination protocols to handle network issues and failures
3. **B** - 2PC (Two-Phase Commit) is a protocol for ensuring atomicity in distributed transactions through prepare and commit/abort phases

## Next Steps

- [Transactional Memory](../concurrency_parallelism/03.%20Transactional%20Memory.md) - Hardware transactions
- [Concurrent Data Structures Advanced](../concurrency_parallelism/04.%20Concurrent%20Data%20Structures%20Advanced.md) - Advanced structures

