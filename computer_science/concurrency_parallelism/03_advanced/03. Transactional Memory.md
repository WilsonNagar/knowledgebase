---
number: 3
title: "Transactional Memory"
slug: "transactional-memory"
level: "advanced"
tags: ["concurrency", "transactional-memory", "hardware", "software", "tm"]
prerequisites: ["distributed-concurrency"]
estimated_minutes: 125
contributors: []
diagrams: []
examples: []
canonical_id: "cs-conc-adv-03"
---

# Transactional Memory

## Overview

Transactional Memory (TM) provides atomic, isolated blocks of code similar to database transactions. Understanding hardware transactional memory (HTM), software transactional memory (STM), and their trade-offs is essential for understanding modern concurrency primitives and future parallel programming models.

## Table of Contents

1. [What is Transactional Memory?](#what-is-tm)
2. [Transaction Properties](#properties)
3. [Hardware Transactional Memory (HTM)](#htm)
4. [Software Transactional Memory (STM)](#stm)
5. [HTM vs STM](#htm-vs-stm)
6. [Conflict Detection](#conflict-detection)
7. [Abort Handling](#abort-handling)
8. [Applications](#applications)

## What is Transactional Memory?

### Definition

**Transactional Memory**: Programming abstraction

**Purpose**: Simplify concurrent programming

**Model**: Atomic, isolated code blocks

**Analogy**: Database transactions for memory

### Transaction Properties

**ACID-like**:
- **Atomicity**: All or nothing
- **Consistency**: Valid state transitions
- **Isolation**: Transactions don't interfere
- **Durability**: Not applicable (memory)

## Transaction Properties

### Atomicity

**Atomic**: Transaction executes completely or not at all

**Abort**: If conflict, transaction aborts

**Retry**: Can retry transaction

### Isolation

**Isolated**: Transactions don't see each other's changes

**Serializable**: Equivalent to serial execution

**Benefit**: No explicit locking needed

## Hardware Transactional Memory (HTM)

### What is HTM?

**HTM**: Hardware support for transactions

**Features**: 
- **Cache Coherence**: Used for conflict detection
- **Hardware**: Special CPU instructions
- **Performance**: Very fast

**Examples**: Intel TSX, IBM Power8

### Intel TSX

**TSX**: Transactional Synchronization Extensions

**Instructions**:
- **XBEGIN**: Start transaction
- **XEND**: End transaction
- **XABORT**: Abort transaction

**Use**: Optimistic locking

### HTM Limitations

**1. Capacity**:
```
Limited by cache size
Large transactions may abort
```

**2. Conflicts**:
```
Cache conflicts cause aborts
```

**3. Compatibility**:
```
Not all CPUs support
```

## Software Transactional Memory (STM)

### What is STM?

**STM**: Software implementation

**Method**: 
- **Versioning**: Track versions
- **Conflict Detection**: Software-based
- **Rollback**: Software rollback

**Benefit**: Works on any hardware

**Trade-off**: Higher overhead

### STM Implementation

**Process**:
```
1. Start transaction
2. Track reads/writes
3. Check for conflicts
4. If conflict: Abort and retry
5. If no conflict: Commit
```

**Overhead**: Versioning, conflict detection

## HTM vs STM

### Comparison

| Aspect | HTM | STM |
|--------|-----|-----|
| **Speed** | Very fast | Slower |
| **Capacity** | Limited | Unlimited |
| **Compatibility** | Hardware-specific | Any hardware |
| **Overhead** | Low | Higher |

### Hybrid Approach

**Method**: Try HTM first, fall back to STM

**Benefit**: Best of both worlds

**Use**: When available

## Conflict Detection

### Conflict Types

**1. Write-Write**:
```
Two transactions write same location
```

**2. Read-Write**:
```
One reads, other writes
```

**3. Write-Read**:
```
One writes, other reads
```

### Detection Methods

**1. Eager**:
```
Detect conflicts immediately
```

**2. Lazy**:
```
Detect conflicts at commit
```

**Trade-off**: Eager detects early, lazy allows more parallelism

## Abort Handling

### What Happens on Abort?

**Abort**: Transaction fails

**Process**:
```
1. Rollback changes
2. Retry transaction
3. Or fall back to lock
```

### Retry Strategies

**1. Immediate Retry**:
```
Retry immediately
```

**2. Exponential Backoff**:
```
Wait before retry
```

**3. Fallback**:
```
Use lock if retries fail
```

## Applications

### Application 1: Concurrent Data Structures

**Use**: Implement lock-free structures

**Benefit**: Simpler than manual lock-free code

### Application 2: Parallel Algorithms

**Use**: Parallel algorithms

**Benefit**: Easier parallelization

### Application 3: Legacy Code

**Use**: Make legacy code thread-safe

**Benefit**: Minimal changes

## Real-World Examples

### Example 1: Intel TSX

**Use**: Optimize lock contention

**Benefit**: Faster critical sections

### Example 2: GCC Transactional Memory

**Use**: Software TM in GCC

**Benefit**: Portable TM

## Common Pitfalls

### Problem: Too Large Transactions

```c
// BAD: Very large transaction
// May exceed HTM capacity

// GOOD: Keep transactions small
// Or use STM for large transactions
```

### Problem: Abort Loops

```c
// BAD: Transactions always conflict
// Infinite retry loop

// GOOD: Design to minimize conflicts
// Or use fallback locks
```

## Quiz

1. What is Transactional Memory?
   - **A)** Memory type
   - **B)** Programming abstraction providing atomic, isolated code blocks
   - **C)** Database memory
   - **D)** Cache memory

2. What is HTM?
   - **A)** High-throughput memory
   - **B)** Hardware Transactional Memory - hardware support for transactions
   - **C)** High-speed memory
   - **D)** Hardware thread memory

3. What is the main advantage of STM over HTM?
   - **A)** Faster
   - **B)** Works on any hardware, unlimited capacity
   - **C)** Lower overhead
   - **D)** Simpler

**Answers:**
1. **B** - Transactional Memory is a programming abstraction that provides atomic, isolated blocks of code (transactions) similar to database transactions, simplifying concurrent programming
2. **B** - HTM (Hardware Transactional Memory) uses hardware support (like cache coherence) to implement transactions, providing very fast performance but limited capacity
3. **B** - STM (Software Transactional Memory) works on any hardware without special CPU support and can handle transactions of unlimited size, though with higher overhead than HTM

## Next Steps

- [Concurrent Data Structures Advanced](./04.%20Concurrent%20Data%20Structures%20Advanced.md) - Advanced structures
- [Advanced Concurrency Patterns](../concurrency_parallelism/05.%20Advanced%20Concurrency%20Patterns.md) - Concurrency patterns
