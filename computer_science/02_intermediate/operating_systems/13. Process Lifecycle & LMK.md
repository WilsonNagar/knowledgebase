---
number: 13
title: "Process Lifecycle & LMK"
slug: "process-lifecycle-lmk"
level: "intermediate"
tags: ["operating-systems", "processes", "lifecycle", "lmk", "android", "memory"]
prerequisites: ["process-vs-threads-internals"]
estimated_minutes: 110
contributors: []
diagrams: []
examples: []
canonical_id: "cs-os-13"
---

# Process Lifecycle & LMK

## Overview

Understanding process lifecycle and Low Memory Killer (LMK) is essential for mobile and embedded systems. This guide covers process states, lifecycle management, Android's Low Memory Killer, OOM scoring, and how systems manage memory under pressure.

## Table of Contents

1. [Process Lifecycle](#process-lifecycle)
2. [Process States](#process-states)
3. [Process Creation](#process-creation)
4. [Process Termination](#process-termination)
5. [Low Memory Killer (LMK)](#lmk)
6. [OOM Scoring](#oom-scoring)
7. [Memory Pressure](#memory-pressure)
8. [Android Process Management](#android)

## Process Lifecycle

### Lifecycle Stages

**1. Creation**:
```
Fork/exec new process
Initialize address space
Load program
```

**2. Execution**:
```
Process runs
Executes instructions
Uses resources
```

**3. Termination**:
```
Process exits
Cleanup resources
Release memory
```

## Process States

### State Transitions

**1. New**:
```
Process created
Not yet scheduled
```

**2. Ready**:
```
Ready to run
Waiting for CPU
```

**3. Running**:
```
Executing on CPU
```

**4. Blocked/Waiting**:
```
Waiting for I/O or event
Not using CPU
```

**5. Terminated**:
```
Process finished
Resources being cleaned up
```

### State Diagram

```
New → Ready → Running → Terminated
         ↑        ↓
         └── Blocked ──┘
```

## Process Creation

### Fork System Call

**fork()**: Create child process

**Process**:
```
1. Create new process (copy of parent)
2. Copy address space
3. Return PID to parent, 0 to child
```

**Example**:
```c
pid_t pid = fork();
if (pid == 0) {
    // Child process
} else {
    // Parent process
}
```

### Exec System Call

**exec()**: Replace process image

**Process**:
```
1. Load new program
2. Replace address space
3. Start execution
```

**Example**:
```c
execve("/bin/ls", argv, envp);
// Process now runs ls
```

### Fork + Exec Pattern

**Common Pattern**:
```
fork() → Create child
exec() → Run new program
```

**Example**: Shell executing command
```
Shell: fork() → Child
Child: execve("ls") → Runs ls
Parent: wait() → Waits for child
```

## Process Termination

### Exit System Call

**exit()**: Terminate process

**Process**:
```
1. Cleanup resources
2. Send signal to parent
3. Enter zombie state
4. Parent reaps (wait())
```

### Zombie Processes

**Zombie**: Terminated but not reaped

**Cause**: Parent hasn't called wait()

**Problem**: Process entry remains

**Solution**: Parent must wait() or ignore SIGCHLD

## Low Memory Killer (LMK)

### What is LMK?

**LMK**: Low Memory Killer

**Purpose**: Kill processes when memory low

**Use**: Mobile systems (Android)

**Goal**: Free memory before OOM

### LMK Process

**Trigger**: Low memory condition

**Process**:
```
1. Check memory pressure
2. Score processes (OOM score)
3. Kill highest scored process
4. Free memory
```

**Benefit**: Controlled killing vs random OOM

## OOM Scoring

### OOM Score

**OOM Score**: Out-of-Of-Memory score

**Purpose**: Rank processes for killing

**Factors**:
- **Memory usage**: More memory = higher score
- **Process importance**: Less important = higher score
- **Time running**: Longer running = lower score

### OOM Score Calculation

**Formula** (simplified):
```
oom_score = memory_usage × importance_factor
```

**Higher score**: More likely to be killed

### Process Importance

**Foreground**: Low score (user interacting)

**Background**: Higher score (can be killed)

**System**: Very low score (critical)

## Memory Pressure

### Memory Levels

**Normal**: Sufficient memory

**Low**: Memory getting low

**Critical**: Very low memory

**Action**: LMK activates

### LMK Thresholds

**Thresholds**: Different memory levels

**Actions**: Kill processes at each level

**Example**:
```
Level 1: Kill background apps
Level 2: Kill cached apps
Level 3: Kill system services (non-critical)
```

## Android Process Management

### Android Process States

**1. Foreground**:
```
User interacting
Highest priority
```

**2. Visible**:
```
Visible but not foreground
High priority
```

**3. Service**:
```
Background service
Medium priority
```

**4. Background**:
```
Not visible
Low priority
```

**5. Empty**:
```
No components
Lowest priority
```

### Android LMK

**Implementation**: Kernel-level LMK

**Scoring**: Based on process state, memory usage

**Killing**: Kills processes to free memory

**User Experience**: Kills background apps first

## Real-World Examples

### Example 1: Android App Lifecycle

**States**: Created → Started → Resumed → Paused → Stopped → Destroyed

**LMK**: May kill when in background

**Recovery**: Restore state when resumed

### Example 2: Linux OOM Killer

**Trigger**: Out of memory

**Process**: Selects process to kill

**Scoring**: Based on memory usage, importance

## Common Pitfalls

### Problem: Not Handling Process Death

```java
// BAD: Assume process always alive
// May be killed by LMK

// GOOD: Save state, restore on restart
@Override
protected void onSaveInstanceState(Bundle outState) {
    super.onSaveInstanceState(outState);
    // Save state
}
```

### Problem: Holding Memory

```java
// BAD: Hold large objects
// High OOM score, likely to be killed

// GOOD: Release memory when not needed
// Lower memory usage
```

## Quiz

1. What is the Low Memory Killer?
   - **A)** Memory allocator
   - **B)** System that kills processes when memory is low to free memory
   - **C)** Memory compressor
   - **D)** Garbage collector

2. What is OOM score?
   - **A)** Memory size
   - **B)** Score ranking processes for killing based on memory usage and importance
   - **C)** Process priority
   - **D)** CPU usage

3. What happens to a process when it's killed by LMK?
   - **A)** Nothing
   - **B)** Process terminated, memory freed, may be restarted later
   - **C)** Process paused
   - **D)** Process slowed down

**Answers:**
1. **B** - Low Memory Killer is a system component that kills processes when memory is low, scoring processes and killing the least important ones to free memory before the system runs out
2. **B** - OOM (Out-Of-Memory) score ranks processes for potential killing based on factors like memory usage and process importance (foreground vs background)
3. **B** - When LMK kills a process, it terminates the process, frees its memory, and the process may be restarted later when the user returns to it (on Android)

## Next Steps

- [Power Management](./14.%20Power%20Management.md) - System power optimization
- [cgroups & Namespaces](./15.%20cgroups%20%26%20Namespaces.md) - Resource isolation

