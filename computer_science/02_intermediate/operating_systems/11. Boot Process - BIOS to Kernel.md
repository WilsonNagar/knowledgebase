---
number: 11
title: "Boot Process - BIOS to Kernel"
slug: "boot-process-bios-kernel"
level: "intermediate"
tags: ["operating-systems", "boot", "bios", "uefi", "kernel", "startup"]
prerequisites: ["file-system-internals"]
estimated_minutes: 100
contributors: []
diagrams: []
examples: []
canonical_id: "cs-os-11"
---

# Boot Process - BIOS to Kernel

## Overview

Understanding the boot process from power-on to running operating system is fundamental to system administration and low-level programming. This guide covers BIOS/UEFI, bootloaders, kernel loading, and the complete startup sequence.

## Table of Contents

1. [Boot Process Overview](#overview)
2. [BIOS Boot](#bios)
3. [UEFI Boot](#uefi)
4. [Bootloader](#bootloader)
5. [Kernel Loading](#kernel-loading)
6. [Init Process](#init)
7. [Boot Optimization](#optimization)

## Boot Process Overview

### Boot Sequence

**High-Level Flow**:
```
Power On
    ↓
BIOS/UEFI
    ↓
Bootloader (GRUB, etc.)
    ↓
Kernel Loading
    ↓
Init Process
    ↓
System Ready
```

**Goal**: Get from hardware to running OS

## BIOS Boot

### What is BIOS?

**BIOS**: Basic Input/Output System

**Location**: Firmware on motherboard

**Purpose**: Initialize hardware, load bootloader

### BIOS Boot Process

**Step 1: POST** (Power-On Self-Test):
```
1. Check hardware (CPU, RAM, etc.)
2. Initialize hardware
3. Display BIOS screen
4. Beep codes if errors
```

**Step 2: Boot Device Selection**:
```
1. Check boot order (BIOS settings)
2. Try first device (usually hard drive)
3. Read MBR (Master Boot Record)
```

**Step 3: MBR Loading**:
```
1. Read MBR (first 512 bytes of disk)
2. MBR contains:
   - Boot code (446 bytes)
   - Partition table (64 bytes)
   - Magic number (0xAA55)
3. Execute boot code
```

### MBR Structure

**MBR Layout**:
```
Offset  Size    Content
0       446     Boot code
446     64      Partition table (4 entries × 16 bytes)
510     2       Magic number (0xAA55)
```

**Limitations**:
- **2TB limit**: 32-bit addressing
- **4 partitions**: Only 4 primary partitions
- **Legacy**: Old standard

## UEFI Boot

### What is UEFI?

**UEFI**: Unified Extensible Firmware Interface

**Successor**: To BIOS

**Advantages**:
- **64-bit**: 64-bit addressing
- **GPT**: GUID Partition Table (no 2TB limit)
- **Secure Boot**: Verify bootloader signatures
- **Faster**: Faster boot times

### UEFI Boot Process

**Step 1: UEFI Initialization**:
```
1. Initialize hardware
2. Load UEFI drivers
3. Initialize UEFI services
```

**Step 2: Boot Manager**:
```
1. Check boot entries (EFI variables)
2. Select boot entry
3. Load bootloader from EFI System Partition
```

**Step 3: Bootloader Execution**:
```
1. Load bootloader (GRUB, systemd-boot, etc.)
2. Bootloader loads kernel
3. Transfer control to kernel
```

### EFI System Partition (ESP)

**Purpose**: Store bootloaders and EFI files

**Format**: FAT32

**Location**: Usually first partition

**Contents**:
```
/EFI/
  /BOOT/
    bootx64.efi
  /ubuntu/
    grubx64.efi
    shimx64.efi
```

## Bootloader

### What is a Bootloader?

**Bootloader**: Program that loads kernel

**Responsibilities**:
- **Load kernel**: From disk to memory
- **Load initramfs**: Initial RAM filesystem
- **Pass parameters**: Kernel command line
- **Transfer control**: Jump to kernel

### GRUB (Grand Unified Bootloader)

**GRUB**: Common Linux bootloader

**Features**:
- **Multi-boot**: Boot multiple OSes
- **Menu**: Boot menu for selection
- **Rescue**: Rescue mode
- **Scripting**: GRUB scripting

### GRUB Boot Process

**Step 1: GRUB Stage 1** (MBR):
```
1. Loaded from MBR
2. Very small (fits in MBR)
3. Loads Stage 1.5 or Stage 2
```

**Step 2: GRUB Stage 1.5** (optional):
```
1. File system driver
2. Allows reading files
3. Loads Stage 2
```

**Step 3: GRUB Stage 2**:
```
1. Full GRUB
2. Shows menu
3. Loads kernel and initramfs
4. Transfers to kernel
```

### Kernel Loading

**Process**:
```
1. Read kernel image from disk
2. Load into memory
3. Read initramfs (initial RAM filesystem)
4. Load into memory
5. Set up kernel parameters
6. Jump to kernel entry point
```

## Kernel Loading

### Kernel Image

**Types**:
- **bzImage**: Compressed kernel (x86)
- **vmlinux**: Uncompressed kernel
- **vmlinuz**: Compressed kernel

**Structure**:
```
┌──────────┬──────────┬──────────┐
│ Header   │ Setup    │ Kernel   │
│          │ Code     │ Code     │
└──────────┴──────────┴──────────┘
```

### Kernel Initialization

**Early Boot**:
```
1. Real mode setup (x86)
2. Switch to protected mode
3. Initialize memory management
4. Initialize CPU features
```

**Main Initialization**:
```
1. Initialize subsystems:
   - Memory management
   - Process management
   - Device drivers
   - File systems
2. Mount root filesystem
3. Start init process
```

### Initramfs

**Purpose**: Temporary root filesystem

**Contains**:
- **Device drivers**: Needed to access root
- **Tools**: Utilities for mounting root
- **Scripts**: Mount root filesystem

**Why Needed**:
```
Root filesystem may be on:
  - Encrypted disk (needs decryption)
  - Network (needs network drivers)
  - RAID (needs RAID drivers)
  
Initramfs provides drivers/tools before root mounted
```

## Init Process

### What is Init?

**Init**: First user-space process (PID 1)

**Purpose**: Start all other processes

**Responsibilities**:
- **Start services**: System services
- **Manage processes**: Orphan process adoption
- **System initialization**: Complete boot

### Init Systems

**1. SysV Init** (traditional):
- **Scripts**: /etc/init.d/
- **Runlevels**: Different system states
- **Sequential**: Start services sequentially

**2. systemd** (modern):
- **Units**: Service definitions
- **Parallel**: Start services in parallel
- **Dependencies**: Handle dependencies
- **Fast**: Faster boot

### systemd Boot

**Process**:
```
1. Kernel starts systemd (PID 1)
2. systemd:
   a. Mounts file systems
   b. Starts services (in parallel)
   c. Handles dependencies
3. System ready
```

**Units**:
- **Service units**: .service files
- **Target units**: Groups of services
- **Mount units**: File system mounts

## Boot Optimization

### Boot Time Components

**Breakdown**:
```
BIOS/UEFI:     5-15 seconds
Bootloader:    1-3 seconds
Kernel:        2-5 seconds
Init/Systemd:  5-20 seconds
Total:         13-43 seconds
```

### Optimization Techniques

**1. Fast Boot** (UEFI):
```
Skip hardware checks
Faster initialization
```

**2. Kernel Parameters**:
```
quiet: Suppress boot messages
splash: Show splash screen
```

**3. Parallel Service Startup**:
```
systemd: Starts services in parallel
Faster than sequential
```

**4. Lazy Service Start**:
```
Start services on demand
Not all at boot time
```

## Real-World Examples

### Example 1: Linux Boot (BIOS)

**Process**:
```
1. Power on
2. BIOS POST
3. BIOS reads MBR
4. GRUB Stage 1 loads
5. GRUB Stage 2 loads
6. GRUB loads kernel + initramfs
7. Kernel decompresses
8. Kernel initializes
9. Kernel mounts root
10. Kernel starts init/systemd
11. Systemd starts services
12. Login prompt
```

### Example 2: Linux Boot (UEFI)

**Process**:
```
1. Power on
2. UEFI initialization
3. UEFI loads GRUB from ESP
4. GRUB loads kernel + initramfs
5. Kernel initializes
6. Kernel starts systemd
7. Systemd starts services
8. System ready
```

## Common Pitfalls

### Problem: Boot Device Not Found

```c
// Problem: BIOS can't find boot device
// Causes:
//   - Boot order wrong
//   - Disk not connected
//   - MBR corrupted

// Solution: Check BIOS settings, verify disk
```

### Problem: Kernel Panic

```c
// Problem: Kernel crashes during boot
// Causes:
//   - Missing drivers
//   - Corrupted kernel
//   - Hardware issues

// Solution: Check kernel logs, verify hardware
```

## Quiz

1. What is the main difference between BIOS and UEFI?
   - **A)** No difference
   - **B)** UEFI is modern, supports 64-bit, GPT, and Secure Boot
   - **C)** BIOS is faster
   - **D)** UEFI is older

2. What is the purpose of initramfs?
   - **A)** Encrypt disk
   - **B)** Provide temporary root filesystem with drivers needed to mount the real root filesystem
   - **C)** Speed up boot
   - **D)** Store kernel

3. What is the first process started by the kernel?
   - **A)** Kernel itself
   - **B)** Init process (PID 1)
   - **C)** Shell
   - **D)** Bootloader

**Answers:**
1. **B** - UEFI is the modern replacement for BIOS, supporting 64-bit addressing, GPT partitions (no 2TB limit), Secure Boot, and faster initialization
2. **B** - Initramfs provides a temporary root filesystem in RAM containing device drivers and tools needed to access and mount the actual root filesystem (which may be encrypted, on network, RAID, etc.)
3. **B** - The kernel starts the init process (PID 1, typically systemd or SysV init) as the first user-space process, which then starts all other system services

## Next Steps

- [Linux Kernel Debugging Tools](./12.%20Linux%20Kernel%20Debugging%20Tools.md) - perf, ftrace, eBPF
- [Process Lifecycle & LMK](./13.%20Process%20Lifecycle%20%26%20LMK.md) - Process management

