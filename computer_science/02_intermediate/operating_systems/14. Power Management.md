---
number: 14
title: "Power Management"
slug: "power-management"
level: "intermediate"
tags: ["operating-systems", "power-management", "cpu-frequency", "sleep-states", "mobile"]
prerequisites: ["process-lifecycle-lmk"]
estimated_minutes: 105
contributors: []
diagrams: []
examples: []
canonical_id: "cs-os-14"
---

# Power Management

## Overview

Power management is critical for mobile devices, laptops, and embedded systems. Understanding CPU frequency scaling, sleep states, power governors, and battery optimization is essential for building energy-efficient systems and understanding how modern devices conserve power.

## Table of Contents

1. [Power Management Overview](#overview)
2. [CPU Frequency Scaling](#cpu-frequency)
3. [Power Governors](#governors)
4. [Sleep States](#sleep-states)
5. [Wake Locks](#wake-locks)
6. [Battery Optimization](#battery-optimization)
7. [Power Profiling](#power-profiling)
8. [Mobile Power Management](#mobile)

## Power Management Overview

### The Challenge

**Battery Life**: Limited battery capacity

**Power Consumption**: Components consume power

**Goal**: Balance performance and power consumption

**Trade-off**: Performance vs battery life

### Power Consumers

**1. CPU**: Major consumer

**2. Display**: High power consumption

**3. Radio**: WiFi, Bluetooth, Cellular

**4. GPU**: Graphics processing

**5. Sensors**: Various sensors

## CPU Frequency Scaling

### What is Frequency Scaling?

**Frequency Scaling**: Adjust CPU frequency dynamically

**Higher Frequency**: Faster, more power

**Lower Frequency**: Slower, less power

**Goal**: Use minimum frequency needed

### Frequency States

**P-States**: Performance states

**P0**: Maximum frequency (highest performance)

**P1-Pn**: Lower frequencies (lower power)

**Example**: P0=2.4GHz, P1=1.8GHz, P2=1.2GHz

### Dynamic Voltage and Frequency Scaling (DVFS)

**DVFS**: Adjust voltage and frequency together

**Lower Frequency**: Lower voltage possible

**Power**: P ∝ V² × f

**Benefit**: Significant power savings

## Power Governors

### What are Governors?

**Governor**: Policy for frequency scaling

**Decides**: When to change frequency

**Types**: Performance, powersave, ondemand, conservative

### Governor Types

**1. Performance**:
```
Always maximum frequency
Best performance, worst battery
```

**2. Powersave**:
```
Always minimum frequency
Best battery, worst performance
```

**3. Ondemand**:
```
Scale up on load
Scale down when idle
Balanced
```

**4. Conservative**:
```
Similar to ondemand
More gradual changes
Better battery
```

**5. Interactive**:
```
Optimized for responsiveness
Quick scale up
Good for mobile
```

## Sleep States

### ACPI Sleep States

**S0**: Working (fully on)

**S1**: Sleep (CPU stopped, RAM powered)

**S2**: Deeper sleep (CPU off)

**S3**: Suspend to RAM (deep sleep)

**S4**: Hibernate (suspend to disk)

**S5**: Shutdown

### Sleep State Trade-offs

**Deeper Sleep**: More power saved, slower wake

**Shallow Sleep**: Less power saved, faster wake

**Use Case**: Choose based on wake time needs

## Wake Locks

### What are Wake Locks?

**Wake Lock**: Prevent system from sleeping

**Use**: Keep system awake for operations

**Types**: 
- **Partial**: Screen off, CPU on
- **Full**: Screen on, CPU on

### Wake Lock Management

**Acquire**: Request wake lock

**Release**: Release wake lock

**Problem**: Leaked wake locks drain battery

**Solution**: Always release wake locks

## Battery Optimization

### Strategies

**1. CPU Optimization**:
```
Use appropriate frequency
Idle when possible
```

**2. Display Optimization**:
```
Reduce brightness
Shorter timeout
```

**3. Radio Optimization**:
```
Turn off when not needed
Batch network requests
```

**4. Background Tasks**:
```
Limit background activity
Batch operations
```

## Power Profiling

### Power Measurement

**Hardware**: Power meters

**Software**: Power estimation

**Tools**: 
- **PowerTop**: Linux power profiling
- **Battery Historian**: Android battery analysis
- **Instruments**: iOS power profiling

### Power Profiling Process

**1. Baseline**: Measure idle power

**2. Load**: Measure under load

**3. Identify**: Find power consumers

**4. Optimize**: Reduce consumption

## Mobile Power Management

### Android Power Management

**Doze Mode**: Deep sleep when idle

**App Standby**: Reduce background activity

**Battery Saver**: Limit performance

**Background Restrictions**: Limit background apps

### iOS Power Management

**Background Modes**: Limited background execution

**App Nap**: Suspend inactive apps

**Low Power Mode**: Reduce performance

**Background Refresh**: Control refresh frequency

## Real-World Examples

### Example 1: Laptop Power Management

**AC Power**: Performance mode

**Battery**: Balanced or powersave

**Sleep**: Suspend to RAM when lid closed

### Example 2: Mobile App Optimization

**Problem**: App drains battery

**Solutions**:
- Reduce wake locks
- Batch network requests
- Use efficient algorithms
- Limit background activity

## Common Pitfalls

### Problem: Leaked Wake Locks

```java
// BAD: Acquire wake lock, never release
PowerManager.WakeLock wl = pm.newWakeLock(...);
wl.acquire();
// Forget to release!

// GOOD: Always release
try {
    wl.acquire();
    // Do work
} finally {
    wl.release();
}
```

### Problem: Excessive CPU Usage

```java
// BAD: Busy loop
while (true) {
    // Consumes CPU constantly
}

// GOOD: Sleep or wait
while (true) {
    Thread.sleep(1000); // Allow CPU to idle
}
```

## Quiz

1. What is CPU frequency scaling?
   - **A)** Increasing CPU speed
   - **B)** Dynamically adjusting CPU frequency to balance performance and power
   - **C)** Decreasing CPU speed
   - **D)** Fixing CPU speed

2. What is a wake lock?
   - **A)** Lock for threads
   - **B)** Mechanism to prevent system from sleeping
   - **C)** Lock for memory
   - **D)** Lock for files

3. What is Doze mode?
   - **A)** Sleep mode
   - **B)** Android deep sleep mode that reduces power when device idle
   - **C)** Performance mode
   - **D)** Battery mode

**Answers:**
1. **B** - CPU frequency scaling dynamically adjusts CPU frequency (and voltage) based on workload to balance performance needs with power consumption
2. **B** - A wake lock is a mechanism that prevents the system from entering sleep mode, used when operations need the system to stay awake
3. **B** - Doze mode is Android's deep sleep mode that significantly reduces power consumption when the device is idle by deferring background activity and network access

## Next Steps

- [cgroups & Namespaces](./15.%20cgroups%20%26%20Namespaces.md) - Resource isolation
- [File System Internals Advanced](./16.%20File%20System%20Internals%20Advanced.md) - Advanced file systems

