---
number: 6
title: "Web Security - XSS, CSRF, SQL Injection Advanced"
slug: "web-security-xss-csrf-sql-injection-advanced"
level: "intermediate"
tags: ["security", "web-security", "xss", "csrf", "sql-injection", "owasp"]
prerequisites: ["secure-coding-practices"]
estimated_minutes: 140
contributors: []
diagrams: []
examples: []
canonical_id: "cs-sec-06"
---

# Web Security - XSS, CSRF, SQL Injection Advanced

## Overview

Web security vulnerabilities like XSS (Cross-Site Scripting), CSRF (Cross-Site Request Forgery), and SQL Injection are among the most common and dangerous web vulnerabilities. Understanding these attacks in depth, advanced exploitation techniques, and comprehensive defense strategies is essential for building secure web applications.

## Table of Contents

1. [Cross-Site Scripting (XSS)](#xss)
2. [Cross-Site Request Forgery (CSRF)](#csrf)
3. [SQL Injection Advanced](#sql-injection)
4. [Other OWASP Top 10](#owasp)
5. [Advanced Attack Techniques](#advanced-attacks)
6. [Defense Strategies](#defense)
7. [Security Testing](#security-testing)
8. [Real-World Examples](#examples)

## Cross-Site Scripting (XSS)

### What is XSS?

**XSS**: Cross-Site Scripting

**Attack**: Inject malicious scripts

**Target**: Other users' browsers

**Impact**: 
- **Session Hijacking**: Steal sessions
- **Defacement**: Modify pages
- **Phishing**: Steal credentials

### XSS Types

**1. Stored XSS**:
```
Script stored in database
Executed when page viewed
```

**2. Reflected XSS**:
```
Script in URL/input
Reflected in response
```

**3. DOM-Based XSS**:
```
Script in DOM manipulation
Client-side only
```

### XSS Examples

**Stored XSS**:
```html
<!-- User input stored in database -->
<script>alert(document.cookie)</script>

<!-- Rendered without escaping -->
<div><?php echo $user_input; ?></div>
```

**Reflected XSS**:
```html
<!-- URL: ?search=<script>alert(1)</script> -->
<!-- Response -->
<div>Search results for: <script>alert(1)</script></div>
```

**DOM-Based XSS**:
```javascript
// URL: #name=<img src=x onerror=alert(1)>
document.getElementById('name').innerHTML = location.hash.substring(6);
```

## Cross-Site Request Forgery (CSRF)

### What is CSRF?

**CSRF**: Cross-Site Request Forgery

**Attack**: Forge requests from user's browser

**Method**: Trick user into making request

**Impact**: 
- **Unauthorized Actions**: Perform actions as user
- **Data Modification**: Change data
- **Account Takeover**: Compromise account

### CSRF Attack Flow

**Process**:
```
1. User logged into vulnerable site
2. User visits attacker's site
3. Attacker's site makes request to vulnerable site
4. Browser sends cookies automatically
5. Request executed as user
```

### CSRF Example

**Vulnerable Form**:
```html
<form action="/transfer" method="POST">
    <input name="to" value="account">
    <input name="amount" value="1000">
    <button>Transfer</button>
</form>
```

**Attack**:
```html
<!-- Attacker's site -->
<img src="https://bank.com/transfer?to=attacker&amount=1000">
<!-- Browser makes GET request with cookies -->
```

## SQL Injection Advanced

### What is SQL Injection?

**SQL Injection**: Inject SQL code

**Attack**: Manipulate SQL queries

**Impact**: 
- **Data Breach**: Access unauthorized data
- **Data Modification**: Modify data
- **Authentication Bypass**: Bypass authentication
- **Database Takeover**: Control database

### SQL Injection Types

**1. Union-Based**:
```
Use UNION to extract data
```

**2. Error-Based**:
```
Extract data from errors
```

**3. Boolean-Based Blind**:
```
Extract data using boolean conditions
```

**4. Time-Based Blind**:
```
Extract data using delays
```

### SQL Injection Examples

**Basic Injection**:
```sql
-- Input: ' OR '1'='1
SELECT * FROM users WHERE username = '' OR '1'='1' AND password = ''
-- Bypasses authentication
```

**Union-Based**:
```sql
-- Input: ' UNION SELECT username, password FROM users--
SELECT * FROM products WHERE id = '' UNION SELECT username, password FROM users--
-- Extracts credentials
```

**Time-Based Blind**:
```sql
-- Input: '; WAITFOR DELAY '00:00:05'--
SELECT * FROM users WHERE id = ''; WAITFOR DELAY '00:00:05'--
-- Confirms injection if delay occurs
```

## Other OWASP Top 10

### OWASP Top 10 Overview

**OWASP**: Open Web Application Security Project

**Top 10**: Most critical web vulnerabilities

**Categories**:
1. Injection
2. Broken Authentication
3. Sensitive Data Exposure
4. XML External Entities (XXE)
5. Broken Access Control
6. Security Misconfiguration
7. XSS
8. Insecure Deserialization
9. Using Components with Known Vulnerabilities
10. Insufficient Logging & Monitoring

### XXE (XML External Entities)

**XXE**: XML External Entity injection

**Attack**: Include external entities

**Impact**: 
- **File Disclosure**: Read files
- **SSRF**: Server-side request forgery
- **DoS**: Denial of service

**Example**:
```xml
<?xml version="1.0"?>
<!DOCTYPE foo [
  <!ENTITY xxe SYSTEM "file:///etc/passwd">
]>
<foo>&xxe;</foo>
```

## Advanced Attack Techniques

### Advanced XSS

**1. Bypassing Filters**:
```
Use encoding, obfuscation
```

**2. Context-Aware**:
```
Adapt to output context
```

**3. Polyglots**:
```
Work in multiple contexts
```

### Advanced SQL Injection

**1. Second-Order Injection**:
```
Stored input injected later
```

**2. NoSQL Injection**:
```
MongoDB, etc. injection
```

**3. Command Injection**:
```
OS command injection
```

## Defense Strategies

### XSS Defense

**1. Output Encoding**:
```
Encode output based on context
HTML, JavaScript, CSS, URL
```

**2. Content Security Policy (CSP)**:
```
Restrict script sources
```

**3. Input Validation**:
```
Validate and sanitize input
```

**4. HttpOnly Cookies**:
```
Prevent JavaScript access
```

### CSRF Defense

**1. CSRF Tokens**:
```
Unique token per request
```

**2. SameSite Cookies**:
```
Restrict cookie sending
```

**3. Referer Checking**:
```
Check Referer header
```

**4. Double Submit Cookie**:
```
Cookie + form token
```

### SQL Injection Defense

**1. Prepared Statements**:
```
Use parameterized queries
```

**2. Input Validation**:
```
Validate input types
```

**3. Least Privilege**:
```
Minimal database permissions
```

**4. Input Encoding**:
```
Encode special characters
```

## Security Testing

### Testing Methods

**1. Manual Testing**:
```
Manual vulnerability testing
```

**2. Automated Scanning**:
```
Use security scanners
```

**3. Code Review**:
```
Review code for vulnerabilities
```

**4. Penetration Testing**:
```
Professional security testing
```

### Testing Tools

**1. OWASP ZAP**:
```
Web application scanner
```

**2. Burp Suite**:
```
Web security testing
```

**3. SQLMap**:
```
SQL injection testing
```

**4. XSSer**:
```
XSS testing tool
```

## Real-World Examples

### Example 1: XSS Attack

**Vulnerability**: Stored XSS in comment

**Attack**: Inject script stealing cookies

**Impact**: Session hijacking

**Fix**: Output encoding, CSP

### Example 2: SQL Injection

**Vulnerability**: SQL injection in login

**Attack**: Bypass authentication

**Impact**: Unauthorized access

**Fix**: Prepared statements

### Example 3: CSRF Attack

**Vulnerability**: No CSRF protection

**Attack**: Forge password change

**Impact**: Account compromise

**Fix**: CSRF tokens

## Common Pitfalls

### Problem: Incomplete Encoding

```php
// BAD: Only HTML encoding
htmlspecialchars($input);  // May not be enough

// GOOD: Context-aware encoding
// HTML context: htmlspecialchars
// JavaScript context: json_encode
// URL context: urlencode
```

### Problem: Weak CSRF Protection

```php
// BAD: Predictable token
$token = md5($session_id);  // Predictable

// GOOD: Cryptographically random token
$token = bin2hex(random_bytes(32));
```

## Quiz

1. What is XSS?
   - **A)** Cross-Site Scripting - injecting malicious scripts executed in users' browsers
   - **B)** Cross-Site Security
   - **C)** Cross-Site Service
   - **D)** Cross-Site System

2. What is CSRF?
   - **A)** Cross-Site Request Forgery - forging requests from user's browser
   - **B)** Cross-Site Request Forwarding
   - **C)** Cross-Site Request Filtering
   - **D)** Cross-Site Request Formatting

3. What is the best defense against SQL injection?
   - **A)** Input validation
   - **B)** Prepared statements with parameterized queries
   - **C)** Output encoding
   - **D)** Input filtering

**Answers:**
1. **A** - XSS (Cross-Site Scripting) allows attackers to inject malicious scripts that execute in other users' browsers, potentially stealing sessions, modifying pages, or stealing credentials
2. **A** - CSRF (Cross-Site Request Forgery) tricks users into making unauthorized requests to sites they're authenticated with, using their browser's automatic cookie sending
3. **B** - Prepared statements with parameterized queries are the best defense, separating code from data and preventing SQL injection regardless of input content

## Next Steps

- [Security Monitoring & Incident Response](../security/07.%20Security%20Monitoring%20%26%20Incident%20Response.md) - Security operations
- [Penetration Testing Fundamentals](../security/08.%20Penetration%20Testing%20Fundamentals.md) - Security testing

