---
number: 11
title: "Leader Election Algorithms"
slug: "leader-election-algorithms"
level: "intermediate"
tags: ["distributed-systems", "leader-election", "consensus", "coordination"]
prerequisites: ["distributed-locking"]
estimated_minutes: 140
contributors: []
diagrams: []
examples: []
canonical_id: "cs-dist-11"
---

# Leader Election Algorithms

## Overview

Leader election algorithms select a single leader from multiple nodes in distributed systems. Understanding leader election algorithms, their implementations, and use cases is essential for building fault-tolerant distributed systems.

## Table of Contents

1. [What is Leader Election?](#what-is-leader-election)
2. [Leader Election Requirements](#requirements)
3. [Bully Algorithm](#bully)
4. [Ring Algorithm](#ring)
5. [ZooKeeper Leader Election](#zookeeper)
6. [Raft Leader Election](#raft)
7. [Leader Election Use Cases](#use-cases)
8. [Best Practices](#best-practices)

## What is Leader Election?

### Definition

**Leader Election**: Select single leader

**Purpose**: 
- **Coordination**: Coordinate operations
- **Single Point**: Single point of coordination
- **Fault Tolerance**: Handle leader failures

**Use Cases**: 
- **Master-Slave**: Master-slave replication
- **Coordination**: Distributed coordination
- **Scheduling**: Task scheduling
- **Configuration**: Configuration management

### Leader Election Properties

**1. Safety**:
```
At most one leader
```

**2. Liveness**:
```
Eventually have leader
```

**3. Fault Tolerance**:
```
Handle failures
```

**4. Performance**:
```
Fast election
```

## Leader Election Requirements

### Requirements

**1. Uniqueness**:
```
At most one leader
```

**2. Liveness**:
```
Eventually have leader
```

**3. Fault Tolerance**:
```
Handle node failures
```

**4. Performance**:
```
Fast election
```

**5. Stability**:
```
Stable leadership
```

## Bully Algorithm

### What is Bully Algorithm?

**Bully Algorithm**: Highest ID wins

**Process**:
```
1. Node detects leader failure
2. Node sends election message to higher IDs
3. If no response: Node becomes leader
4. If response: Wait for new leader
```

**Assumption**: Total ordering of nodes

### Bully Algorithm Example

**Nodes**: A(1), B(2), C(3)

**Process**:
```
1. Leader C fails
2. B detects failure
3. B sends election to C (no response)
4. B sends election to A
5. A responds (B > A)
6. B becomes leader
```

**Complexity**: O(n²) messages

## Ring Algorithm

### What is Ring Algorithm?

**Ring Algorithm**: Election in ring

**Process**:
```
1. Node detects leader failure
2. Send election message around ring
3. Each node adds its ID
4. Originator receives message
5. Highest ID becomes leader
```

**Assumption**: Ring topology

### Ring Algorithm Example

**Ring**: A → B → C → A

**Process**:
```
1. Leader C fails
2. A detects failure
3. A sends election(A) to B
4. B sends election(A,B) to C (fails)
5. A receives election(A,B)
6. A becomes leader (highest)
```

**Complexity**: O(n) messages

## ZooKeeper Leader Election

### ZooKeeper Implementation

**Ephemeral Sequential Nodes**:
```python
def elect_leader(zk, election_path):
    # Create ephemeral sequential node
    node = zk.create(
        election_path + "/node-",
        ephemeral=True,
        sequence=True
    )
    
    # Get all nodes
    children = zk.get_children(election_path)
    children.sort()
    
    # If smallest, become leader
    if node.endswith(children[0]):
        return "leader"
    
    # Otherwise, watch previous node
    prev_index = children.index(node.split('/')[-1]) - 1
    prev_node = children[prev_index]
    zk.exists(election_path + "/" + prev_node, watch=True)
    return "follower"
```

### ZooKeeper Features

**1. Ephemeral Nodes**:
```
Auto-delete on failure
```

**2. Sequential Nodes**:
```
Ordered nodes
```

**3. Watches**:
```
Watch for leader changes
```

**4. Fairness**:
```
Fair election
```

## Raft Leader Election

### Raft Election Process

**Raft**: Consensus algorithm

**Election**:
```
1. Follower timeout
2. Become candidate
3. Request votes
4. If majority: Become leader
5. If not: Wait for new election
```

**Terms**: Election terms

**Votes**: Majority votes required

### Raft Election Example

**Nodes**: A, B, C

**Process**:
```
1. Leader fails
2. A times out, becomes candidate
3. A requests votes from B, C
4. B votes for A
5. A receives majority (2/3)
6. A becomes leader
```

**Complexity**: O(n) messages

## Leader Election Use Cases

### Use Case 1: Master-Slave Replication

**Use**: Database replication

**Leader**: Master database

**Followers**: Slave databases

**Benefit**: Single write point

### Use Case 2: Distributed Coordination

**Use**: Distributed coordination

**Leader**: Coordinator

**Followers**: Workers

**Benefit**: Centralized coordination

### Use Case 3: Task Scheduling

**Use**: Distributed task scheduling

**Leader**: Scheduler

**Followers**: Workers

**Benefit**: Avoid duplicate scheduling

## Best Practices

### Practice 1: Handle Leader Failures

**Failures**: 
```
Detect leader failures quickly
Elect new leader
```

**Benefit**: High availability

### Practice 2: Prevent Split-Brain

**Split-Brain**: 
```
Multiple leaders
Use quorum
```

**Benefit**: Correctness

### Practice 3: Stable Leadership

**Stability**: 
```
Prevent frequent elections
Use heartbeats
```

**Benefit**: Stability

## Real-World Examples

### Example 1: Kafka

**Use**: Kafka broker coordination

**Algorithm**: ZooKeeper leader election

**Leader**: Controller broker

**Result**: Single controller

### Example 2: etcd

**Use**: etcd cluster

**Algorithm**: Raft leader election

**Leader**: Leader node

**Result**: Cluster coordination

## Common Pitfalls

### Problem: Split-Brain

```c
// BAD: No quorum
// Multiple leaders

// GOOD: Use quorum
// Majority required
```

### Problem: Frequent Elections

```c
// BAD: Too frequent elections
// Instability

// GOOD: Stable leadership
// Appropriate timeouts
```

## Quiz

1. What is leader election?
   - **A)** Selecting multiple leaders
   - **B)** Selecting single leader from multiple nodes
   - **C)** No leader
   - **D)** Random selection

2. What is the Bully algorithm?
   - **A)** Ring algorithm
   - **B)** Leader election where highest ID wins
   - **C)** Raft algorithm
   - **D)** ZooKeeper algorithm

3. What is Raft?
   - **A)** Lock algorithm
   - **B)** Consensus algorithm with leader election
   - **C)** Cache algorithm
   - **D)** Hash algorithm

**Answers:**
1. **B** - Leader election selects a single leader from multiple nodes to coordinate operations
2. **B** - Bully algorithm elects the node with highest ID as leader by sending election messages
3. **B** - Raft is a consensus algorithm that includes leader election, requiring majority votes to become leader

## Next Steps

- [Distributed Transactions](../03_advanced/01.%20Distributed%20Transactions%20-%202PC%2C%203PC%2C%20Saga.md) - Distributed transactions
- [Event Sourcing & CQRS](../03_advanced/02.%20Event%20Sourcing%20%26%20CQRS.md) - Event sourcing

