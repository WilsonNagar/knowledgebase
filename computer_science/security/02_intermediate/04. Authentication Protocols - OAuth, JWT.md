---
number: 4
title: "Authentication Protocols - OAuth, JWT"
slug: "authentication-protocols-oauth-jwt"
level: "intermediate"
tags: ["security", "authentication", "oauth", "jwt", "authorization"]
prerequisites: ["secure-coding-practices"]
estimated_minutes: 120
contributors: []
diagrams: []
examples: []
canonical_id: "cs-sec-04"
---

# Authentication Protocols - OAuth, JWT

## Overview

Authentication protocols like OAuth and JWT are fundamental to modern web security. Understanding how OAuth enables delegated authorization, how JWT provides stateless authentication, and their security properties is essential for building secure applications and APIs.

## Table of Contents

1. [Authentication vs Authorization](#auth-vs-authz)
2. [OAuth Overview](#oauth-overview)
3. [OAuth 2.0 Flow](#oauth-flow)
4. [OAuth Grant Types](#grant-types)
5. [JWT Overview](#jwt-overview)
6. [JWT Structure](#jwt-structure)
7. [JWT Security](#jwt-security)
8. [OAuth + JWT](#oauth-jwt)

## Authentication vs Authorization

### Authentication

**Authentication**: Verify identity

**Question**: "Who are you?"

**Methods**: 
- **Passwords**: Something you know
- **Tokens**: Something you have
- **Biometrics**: Something you are

### Authorization

**Authorization**: Control access

**Question**: "What can you do?"

**Methods**:
- **Roles**: User roles
- **Permissions**: Specific permissions
- **OAuth**: Delegated authorization

## OAuth Overview

### What is OAuth?

**OAuth**: Open Authorization protocol

**Purpose**: Allow third-party access without sharing password

**Use Case**: "Sign in with Google"

### OAuth Roles

**1. Resource Owner**: User

**2. Client**: Application requesting access

**3. Authorization Server**: Issues tokens

**4. Resource Server**: Hosts protected resources

## OAuth 2.0 Flow

### Authorization Code Flow

**Steps**:
```
1. Client redirects user to authorization server
2. User authenticates and authorizes
3. Authorization server redirects with code
4. Client exchanges code for access token
5. Client uses access token to access resources
```

### Detailed Flow

**Step 1: Authorization Request**:
```
GET /authorize?
  response_type=code&
  client_id=CLIENT_ID&
  redirect_uri=CALLBACK_URL&
  scope=read write
```

**Step 2: User Authorization**:
```
User logs in and authorizes
Authorization server shows consent screen
```

**Step 3: Authorization Code**:
```
Redirect: CALLBACK_URL?code=AUTHORIZATION_CODE
```

**Step 4: Token Exchange**:
```
POST /token
  grant_type=authorization_code&
  code=AUTHORIZATION_CODE&
  client_id=CLIENT_ID&
  client_secret=CLIENT_SECRET
```

**Step 5: Access Token**:
```
Response: {
  "access_token": "ACCESS_TOKEN",
  "token_type": "Bearer",
  "expires_in": 3600
}
```

## OAuth Grant Types

### Authorization Code

**Use**: Web applications

**Flow**: Code exchange (as above)

**Security**: Most secure (code not exposed to browser)

### Implicit

**Use**: Single-page applications

**Flow**: Token returned directly

**Security**: Less secure (token in URL)

### Client Credentials

**Use**: Server-to-server

**Flow**: Client authenticates with credentials

**Security**: No user involved

### Resource Owner Password

**Use**: Trusted applications

**Flow**: Username/password â†’ Token

**Security**: Least secure (requires password)

## JWT Overview

### What is JWT?

**JWT**: JSON Web Token

**Purpose**: Stateless authentication

**Structure**: Header.Payload.Signature

**Properties**: Self-contained, signed

## JWT Structure

### JWT Components

**1. Header**:
```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

**2. Payload**:
```json
{
  "sub": "user123",
  "name": "John Doe",
  "iat": 1516239022,
  "exp": 1516242622
}
```

**3. Signature**:
```
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret
)
```

### JWT Format

**Complete Token**:
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJzdWIiOiJ1c2VyMTIzIiwibmFtZSI6IkpvaG4gRG9lIn0.
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

**Parts**: Header.Payload.Signature (base64url encoded)

## JWT Security

### JWT Signing

**HMAC** (Symmetric):
```
Signature: HMAC(header.payload, secret)
Verify: Recompute, compare
```

**RSA** (Asymmetric):
```
Signature: RSA(header.payload, private_key)
Verify: RSA_verify(signature, public_key)
```

### JWT Claims

**Standard Claims**:
- **sub**: Subject (user ID)
- **iat**: Issued at
- **exp**: Expiration time
- **iss**: Issuer
- **aud**: Audience

**Custom Claims**: Application-specific

### JWT Validation

**Steps**:
```
1. Verify signature
2. Check expiration (exp)
3. Check issuer (iss)
4. Check audience (aud)
5. Validate claims
```

## OAuth + JWT

### Using JWT with OAuth

**Access Token**: Can be JWT

**Benefits**:
- **Stateless**: No need to check database
- **Self-contained**: All info in token
- **Scalable**: Works across servers

**ID Token** (OpenID Connect):
```
JWT containing user identity
```

## Real-World Examples

### Example 1: "Sign in with Google"

**Flow**:
```
1. User clicks "Sign in with Google"
2. Redirect to Google OAuth
3. User authorizes
4. Google returns JWT
5. Application verifies JWT
6. User logged in
```

### Example 2: API Authentication

**Flow**:
```
1. Client authenticates
2. Server issues JWT
3. Client includes JWT in requests
4. Server validates JWT
5. Server processes request
```

## Common Pitfalls

### Problem: Not Validating JWT

```python
# BAD: Trust JWT without validation
user_id = jwt.decode(token)['sub']  # May be tampered!

# GOOD: Validate signature and claims
payload = jwt.decode(token, secret, algorithms=['HS256'])
if payload['exp'] < time.time():
    raise ExpiredTokenError()
```

### Problem: Storing Secrets in Code

```python
# BAD: Hardcoded secret
SECRET = "my-secret-key"  # In code!

# GOOD: Use environment variables
SECRET = os.environ['JWT_SECRET']
```

## Quiz

1. What is OAuth used for?
   - **A)** Encryption
   - **B)** Delegated authorization - allowing third-party access without sharing passwords
   - **C)** Compression
   - **D)** Hashing

2. What is JWT?
   - **A)** Encryption algorithm
   - **B)** JSON Web Token - self-contained, signed token for stateless authentication
   - **C)** Hash function
   - **D)** Compression format

3. What is the main advantage of JWT?
   - **A)** Smaller size
   - **B)** Stateless authentication - no need to check database
   - **C)** Faster encryption
   - **D)** Simpler code

**Answers:**
1. **B** - OAuth enables delegated authorization, allowing users to grant third-party applications access to their resources without sharing passwords
2. **B** - JWT (JSON Web Token) is a self-contained, signed token format used for stateless authentication and authorization
3. **B** - JWT's main advantage is stateless authentication - the token contains all necessary information, eliminating the need to check a database on each request

## Next Steps

- [Network Security](../security/05.%20Network%20Security.md) - Network-level security
- [Web Security - XSS, CSRF](../security/06.%20Web%20Security.md) - Web vulnerabilities

