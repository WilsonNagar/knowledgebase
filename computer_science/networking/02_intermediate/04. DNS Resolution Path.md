---
number: 4
title: "DNS Resolution Path"
slug: "dns-resolution-path"
level: "intermediate"
tags: ["networking", "dns", "resolution", "queries", "hierarchy"]
prerequisites: ["tcp-ip-internals-deep-dive"]
estimated_minutes: 90
contributors: []
diagrams: []
examples: []
canonical_id: "cs-net-04"
---

# DNS Resolution Path

## Overview

DNS (Domain Name System) is the phone book of the internet, translating human-readable domain names to IP addresses. Understanding how DNS resolution works, the query process, caching, and DNS hierarchy is essential for network programming, system administration, and web development.

## Table of Contents

1. [What is DNS?](#what-is-dns)
2. [DNS Hierarchy](#hierarchy)
3. [DNS Record Types](#record-types)
4. [DNS Resolution Process](#resolution)
5. [Recursive vs Iterative Queries](#query-types)
6. [DNS Caching](#caching)
7. [DNS Security](#security)
8. [Performance Optimization](#performance)

## What is DNS?

### The Problem

**IP Addresses**: Hard to remember
```
192.0.2.1
2001:db8::1
```

**Domain Names**: Easy to remember
```
example.com
www.google.com
```

**Solution**: DNS translates names to addresses

### DNS Purpose

**Functions**:
- **Name Resolution**: Domain → IP address
- **Reverse Lookup**: IP → Domain name
- **Mail Routing**: MX records for email
- **Service Discovery**: SRV records

## DNS Hierarchy

### Domain Name Structure

**Hierarchy**: Right to left (most specific to least)

**Example**: `www.example.com.`
```
. (root)
 └── com (top-level domain)
      └── example (second-level domain)
           └── www (subdomain)
```

### DNS Hierarchy Levels

**1. Root Domain** (`.`):
- **Servers**: Root name servers (a.root-servers.net, etc.)
- **Function**: Point to TLD servers
- **Number**: 13 root server clusters

**2. Top-Level Domains (TLD)**:
- **Generic**: .com, .org, .net, .edu
- **Country**: .us, .uk, .jp, .in
- **Function**: Point to authoritative servers

**3. Second-Level Domains**:
- **Examples**: example.com, google.com
- **Function**: Owned by organizations
- **Authoritative**: Have authoritative name servers

**4. Subdomains**:
- **Examples**: www.example.com, mail.example.com
- **Function**: Further organization
- **Managed**: By domain owner

## DNS Record Types

### Common Record Types

**A Record**:
- **Purpose**: IPv4 address
- **Example**: `example.com A 192.0.2.1`

**AAAA Record**:
- **Purpose**: IPv6 address
- **Example**: `example.com AAAA 2001:db8::1`

**CNAME Record**:
- **Purpose**: Alias (canonical name)
- **Example**: `www.example.com CNAME example.com`

**MX Record**:
- **Purpose**: Mail exchange server
- **Example**: `example.com MX 10 mail.example.com`

**NS Record**:
- **Purpose**: Name server
- **Example**: `example.com NS ns1.example.com`

**TXT Record**:
- **Purpose**: Text data (SPF, DKIM, etc.)
- **Example**: `example.com TXT "v=spf1 ..."`

**PTR Record**:
- **Purpose**: Reverse lookup (IP → name)
- **Example**: `1.2.0.192.in-addr.arpa PTR example.com`

## DNS Resolution Process

### Basic Resolution Flow

**Query**: `www.example.com`

**Steps**:
```
1. Query root server: "Where is .com?"
2. Root server: "Ask .com TLD server"
3. Query .com TLD server: "Where is example.com?"
4. TLD server: "Ask example.com name server"
5. Query example.com name server: "What is www.example.com?"
6. Name server: "www.example.com A 192.0.2.1"
7. Return IP address
```

### Detailed Resolution

**Step 1: Local Cache**:
```
Check local DNS cache
If found: Return cached result
If not: Continue
```

**Step 2: Recursive Resolver**:
```
Query recursive resolver (ISP DNS, 8.8.8.8, etc.)
Resolver handles full resolution
Returns final answer
```

**Step 3: Root Server Query**:
```
Resolver queries root server
Root server returns TLD server address
```

**Step 4: TLD Server Query**:
```
Resolver queries TLD server (.com)
TLD server returns authoritative name server
```

**Step 5: Authoritative Server Query**:
```
Resolver queries authoritative name server
Name server returns A record
```

**Step 6: Return Result**:
```
Resolver returns IP to client
Caches result for TTL
```

## Recursive vs Iterative Queries

### Recursive Query

**Definition**: Resolver does all work

**Process**:
```
Client → Resolver: "www.example.com?"
Resolver → Root: "www.example.com?"
Root → Resolver: "Ask .com server"
Resolver → TLD: "www.example.com?"
TLD → Resolver: "Ask example.com server"
Resolver → Auth: "www.example.com?"
Auth → Resolver: "192.0.2.1"
Resolver → Client: "192.0.2.1"
```

**Characteristics**:
- **Client**: Sends one query, gets answer
- **Resolver**: Does all queries
- **Use**: Client to resolver

### Iterative Query

**Definition**: Each server gives next step

**Process**:
```
Client → Root: "www.example.com?"
Root → Client: "Ask .com server (IP)"
Client → TLD: "www.example.com?"
TLD → Client: "Ask example.com server (IP)"
Client → Auth: "www.example.com?"
Auth → Client: "192.0.2.1"
```

**Characteristics**:
- **Client**: Does all queries
- **Servers**: Give referrals
- **Use**: Resolver to authoritative servers

## DNS Caching

### Why Cache?

**Problem**: DNS queries are slow (multiple round trips)

**Solution**: Cache results

**Benefits**:
- **Faster**: Subsequent queries instant
- **Less load**: Fewer queries to servers
- **Efficiency**: Reduce network traffic

### TTL (Time To Live)

**TTL**: How long to cache record

**Example**: `example.com A 192.0.2.1 TTL 3600`

**Meaning**: Cache for 3600 seconds (1 hour)

**After TTL**: Query again

### Caching Hierarchy

**1. Browser Cache**:
- **Location**: Browser
- **TTL**: Respects DNS TTL
- **Scope**: Per browser

**2. OS Cache**:
- **Location**: Operating system
- **TTL**: Respects DNS TTL
- **Scope**: All applications

**3. Resolver Cache**:
- **Location**: DNS resolver
- **TTL**: Respects DNS TTL
- **Scope**: All clients using resolver

## DNS Security

### DNS Spoofing

**Attack**: Return fake DNS responses

**Impact**: Redirect traffic to malicious servers

**Mitigation**: DNSSEC (DNS Security Extensions)

### DNSSEC

**Purpose**: Cryptographically sign DNS records

**How**:
```
1. Zone signs records with private key
2. Public key published in DNS
3. Resolver verifies signatures
4. If invalid: Reject response
```

**Benefits**: Prevents spoofing

**Limitations**: Not widely deployed

### DNS over HTTPS (DoH)

**Purpose**: Encrypt DNS queries

**How**: DNS queries over HTTPS

**Benefits**: Privacy, prevents tampering

**Controversy**: Bypasses network-level DNS filtering

## Performance Optimization

### DNS Prefetching

**Idea**: Resolve domains before needed

**Example**:
```html
<link rel="dns-prefetch" href="//cdn.example.com">
```

**Benefit**: Faster when domain actually accessed

### Caching Strategy

**1. Long TTL**:
- **Benefit**: Fewer queries
- **Trade-off**: Slower updates

**2. Short TTL**:
- **Benefit**: Faster updates
- **Trade-off**: More queries

**3. Balance**: Appropriate TTL for use case

## Real-World Examples

### Example 1: Web Browser Resolution

**Process**:
```
1. User types: example.com
2. Browser checks cache
3. If not cached: Query OS resolver
4. OS resolver queries recursive resolver
5. Recursive resolver resolves (multiple queries)
6. Returns IP to browser
7. Browser caches result
8. Browser connects to IP
```

### Example 2: Email Delivery

**Process**:
```
1. Send email to user@example.com
2. Mail server queries: example.com MX
3. DNS returns: mail.example.com (priority 10)
4. Mail server queries: mail.example.com A
5. DNS returns: 192.0.2.1
6. Mail server connects to 192.0.2.1:25
```

## Common Pitfalls

### Problem: Ignoring TTL

```c
// BAD: Cache forever
cache_dns_forever(domain, ip);
// May serve stale IP if domain changes

// GOOD: Respect TTL
cache_dns(domain, ip, ttl);
expire_after_ttl();
```

### Problem: Not Handling Failures

```c
// BAD: Assume DNS always works
ip = resolve_dns(domain); // May fail!

// GOOD: Handle errors
ip = resolve_dns(domain);
if (ip == NULL) {
    // Handle DNS failure
    use_fallback();
}
```

## Quiz

1. What is the main purpose of DNS?
   - **A)** Encrypt data
   - **B)** Translate domain names to IP addresses
   - **C)** Route packets
   - **D)** Compress data

2. What is the difference between recursive and iterative DNS queries?
   - **A)** No difference
   - **B)** Recursive: resolver does all work; Iterative: client/server does step-by-step
   - **C)** Recursive is faster
   - **D)** Iterative is more secure

3. What is TTL in DNS?
   - **A)** Time to live - how long to cache the DNS record
   - **B)** Total time limit
   - **C)** Transfer time limit
   - **D)** Time to load

**Answers:**
1. **B** - DNS translates human-readable domain names (like example.com) to IP addresses (like 192.0.2.1)
2. **B** - In recursive queries, the resolver handles all queries and returns the final answer; in iterative queries, each server provides the next step and the client/resolver makes multiple queries
3. **A** - TTL (Time To Live) specifies how long a DNS record should be cached before querying again

## Next Steps

- [TLS Handshake & PKI](../networking/05.%20TLS%20Handshake%20%26%20PKI.md) - TLS internals
- [Socket Programming](../networking/06.%20Socket%20Programming.md) - Network programming

