---
number: 9
title: "Database Backup & Recovery"
slug: "database-backup-recovery"
level: "intermediate"
tags: ["databases", "backup", "recovery", "disaster-recovery", "point-in-time"]
prerequisites: ["sharding-partitioning"]
estimated_minutes: 110
contributors: []
diagrams: []
examples: []
canonical_id: "cs-db-09"
---

# Database Backup & Recovery

## Overview

Database backup and recovery are critical for data protection and business continuity. Understanding backup types, recovery strategies, point-in-time recovery, and disaster recovery planning is essential for ensuring data safety and system availability.

## Table of Contents

1. [Why Backup?](#why-backup)
2. [Backup Types](#backup-types)
3. [Backup Strategies](#backup-strategies)
4. [Recovery Types](#recovery-types)
5. [Point-in-Time Recovery](#pitr)
6. [Disaster Recovery](#disaster-recovery)
7. [Backup Testing](#backup-testing)
8. [Best Practices](#best-practices)

## Why Backup?

### Risks

**1. Hardware Failure**:
```
Disk crashes
Server failures
```

**2. Human Error**:
```
Accidental deletion
Wrong updates
```

**3. Software Bugs**:
```
Corruption
Data loss
```

**4. Disasters**:
```
Fire, flood, earthquake
```

**5. Security Breaches**:
```
Ransomware
Data theft
```

### Recovery Objectives

**RPO** (Recovery Point Objective): Maximum acceptable data loss

**RTO** (Recovery Time Objective): Maximum acceptable downtime

**Goal**: Minimize both

## Backup Types

### Full Backup

**Definition**: Complete copy of database

**Contents**: All data, schema, indexes

**Time**: Longest to create

**Size**: Largest

**Use**: Base for other backups

### Incremental Backup

**Definition**: Only changed data since last backup

**Contents**: Changes since last backup

**Time**: Faster than full

**Size**: Smaller

**Use**: Frequent backups

### Differential Backup

**Definition**: Changes since last full backup

**Contents**: All changes since full backup

**Time**: Moderate

**Size**: Moderate

**Use**: Balance between full and incremental

### Snapshot

**Definition**: Point-in-time copy

**Method**: Copy-on-write

**Time**: Very fast

**Use**: Quick backups

## Backup Strategies

### Strategy 1: Full + Incremental

**Schedule**:
```
Sunday: Full backup
Mon-Sat: Incremental backups
```

**Recovery**:
```
1. Restore full backup
2. Apply all incrementals in order
```

**Trade-off**: Faster backups, slower recovery

### Strategy 2: Full + Differential

**Schedule**:
```
Sunday: Full backup
Mon-Sat: Differential backups
```

**Recovery**:
```
1. Restore full backup
2. Apply latest differential
```

**Trade-off**: Slower backups, faster recovery

### Strategy 3: Continuous Backup

**Method**: Continuous archiving

**Process**: Archive WAL (Write-Ahead Log) continuously

**Recovery**: Restore to any point in time

**Use**: Critical systems

## Recovery Types

### Full Recovery

**Process**:
```
1. Restore full backup
2. Apply transaction logs
3. Recover to point in time
```

**Use**: Complete recovery

### Partial Recovery

**Process**:
```
1. Restore specific tables/databases
2. Apply logs for those objects
```

**Use**: Recover specific data

### Point-in-Time Recovery

**Process**:
```
1. Restore backup
2. Apply logs up to specific time
```

**Use**: Recover to specific moment

## Point-in-Time Recovery

### What is PITR?

**PITR**: Point-In-Time Recovery

**Purpose**: Recover to specific timestamp

**Requirement**: Transaction logs (WAL)

**Process**: 
```
1. Restore base backup
2. Apply WAL segments up to target time
3. Database at target time
```

### PITR Example

**Scenario**: Database corrupted at 2:00 PM

**Backup**: Full backup at midnight

**WAL**: Archived continuously

**Recovery**:
```
1. Restore midnight backup
2. Apply WAL from midnight to 1:59 PM
3. Database recovered to 1:59 PM
```

## Disaster Recovery

### Disaster Recovery Plan

**1. Backup Strategy**:
```
What to backup
How often
Where to store
```

**2. Recovery Procedures**:
```
Step-by-step recovery
Who does what
```

**3. Testing**:
```
Regular recovery tests
Validate procedures
```

**4. Documentation**:
```
Document everything
Keep updated
```

### Backup Storage

**1. On-Site**:
```
Local storage
Fast access
Vulnerable to disasters
```

**2. Off-Site**:
```
Remote storage
Protected from local disasters
Slower access
```

**3. Cloud**:
```
Cloud storage
Scalable
Geographically distributed
```

**Best Practice**: Multiple locations

## Backup Testing

### Why Test Backups?

**Problem**: Backups may not work

**Reasons**:
- **Corruption**: Backup corrupted
- **Incomplete**: Missing data
- **Wrong Version**: Wrong backup
- **Procedures**: Recovery procedures wrong

### Testing Process

**1. Regular Tests**:
```
Test backups regularly
Monthly or quarterly
```

**2. Full Recovery Test**:
```
Restore to test environment
Verify data integrity
```

**3. Document Results**:
```
Record test results
Fix issues found
```

## Best Practices

### Backup Best Practices

**1. Automate**:
```
Automated backups
No manual errors
```

**2. Verify**:
```
Verify backups
Check integrity
```

**3. Encrypt**:
```
Encrypt backups
Protect sensitive data
```

**4. Multiple Copies**:
```
Multiple backup copies
Different locations
```

**5. Retention**:
```
Keep backups for required time
Comply with regulations
```

### Recovery Best Practices

**1. Document Procedures**:
```
Step-by-step procedures
Keep updated
```

**2. Train Staff**:
```
Train recovery procedures
Regular drills
```

**3. Test Regularly**:
```
Test recovery regularly
Validate procedures
```

**4. Monitor**:
```
Monitor backup success
Alert on failures
```

## Real-World Examples

### Example 1: PostgreSQL Backup

**Method**: pg_dump + WAL archiving

**Process**:
```
1. pg_dump: Full backup
2. archive_mode: Archive WAL
3. PITR: Restore + apply WAL
```

### Example 2: MySQL Backup

**Method**: mysqldump + binary logs

**Process**:
```
1. mysqldump: Full backup
2. Binary logs: Continuous logging
3. Recovery: Restore + apply logs
```

### Example 3: MongoDB Backup

**Method**: mongodump + oplog

**Process**:
```
1. mongodump: Full backup
2. Oplog: Continuous logging
3. Recovery: Restore + apply oplog
```

## Common Pitfalls

### Problem: Not Testing Backups

```bash
# BAD: Never test backups
# May not work when needed!

# GOOD: Test regularly
# Restore to test environment monthly
```

### Problem: Storing Backups On-Site Only

```bash
# BAD: Only on-site backups
# Lost in disaster!

# GOOD: Off-site backups
# Multiple locations
```

### Problem: Not Encrypting Backups

```bash
# BAD: Unencrypted backups
# Security risk!

# GOOD: Encrypt backups
# Protect sensitive data
```

## Quiz

1. What is the difference between full and incremental backup?
   - **A)** No difference
   - **B)** Full backup copies everything, incremental only copies changes since last backup
   - **C)** Full is faster
   - **D)** Incremental is larger

2. What is point-in-time recovery?
   - **A)** Recover to current time
   - **B)** Recover to specific timestamp using backups and transaction logs
   - **C)** Recover all data
   - **D)** Recover some data

3. What is RPO?
   - **A)** Recovery Process Objective
   - **B)** Recovery Point Objective - maximum acceptable data loss
   - **C)** Recovery Performance Objective
   - **D)** Recovery Protocol Objective

**Answers:**
1. **B** - Full backup creates a complete copy of the database, while incremental backup only copies data that has changed since the last backup, making it faster but requiring the full backup plus all incrementals for recovery
2. **B** - Point-in-time recovery restores a database to a specific timestamp by restoring a base backup and then applying transaction logs (WAL) up to the target time
3. **B** - RPO (Recovery Point Objective) is the maximum acceptable amount of data loss, determining how frequently backups need to be taken

## Next Steps

- [Storage Engines - InnoDB & RocksDB](../databases/10.%20Storage%20Engines.md) - Engine internals
- [Database Indexing Strategies](../databases/11.%20Database%20Indexing.md) - Index optimization

