---
number: 10
title: "Storage Engines - InnoDB & RocksDB"
slug: "storage-engines-innodb-rocksdb"
level: "intermediate"
tags: ["databases", "storage-engines", "innodb", "rocksdb", "lsm", "b-tree"]
prerequisites: ["database-backup-recovery"]
estimated_minutes: 140
contributors: []
diagrams: []
examples: []
canonical_id: "cs-db-10"
---

# Storage Engines - InnoDB & RocksDB

## Overview

Storage engines are the core components that determine how databases store, retrieve, and manage data. Understanding InnoDB (B-tree based) and RocksDB (LSM-tree based) storage engines, their architectures, trade-offs, and use cases is essential for database design and optimization.

## Table of Contents

1. [What are Storage Engines?](#what-are-storage-engines)
2. [InnoDB Architecture](#innodb-architecture)
3. [RocksDB Architecture](#rocksdb-architecture)
4. [B-Tree vs LSM-Tree](#b-tree-vs-lsm)
5. [InnoDB Features](#innodb-features)
6. [RocksDB Features](#rocksdb-features)
7. [Performance Comparison](#performance)
8. [Use Cases](#use-cases)

## What are Storage Engines?

### Definition

**Storage Engine**: Database component for data storage

**Responsibilities**:
- **Storage**: How data stored
- **Retrieval**: How data retrieved
- **Indexing**: How indexes maintained
- **Transactions**: Transaction support
- **Concurrency**: Concurrency control

**Examples**: InnoDB, MyISAM, RocksDB, LevelDB

### Storage Engine Types

**1. B-Tree Based**:
```
InnoDB, PostgreSQL
```

**2. LSM-Tree Based**:
```
RocksDB, LevelDB, Cassandra
```

**3. Hash Based**:
```
Memory storage engines
```

**4. Columnar**:
```
Columnar storage engines
```

## InnoDB Architecture

### What is InnoDB?

**InnoDB**: MySQL storage engine

**Architecture**: B-tree based

**Features**:
- **ACID**: Full ACID compliance
- **Transactions**: Transaction support
- **Row-Level Locking**: Row-level locks
- **Foreign Keys**: Foreign key constraints
- **Crash Recovery**: Crash recovery

**Use**: General-purpose database

### InnoDB Components

**1. Buffer Pool**:
```
Cache pages in memory
```

**2. Log Files**:
```
Redo log, undo log
```

**3. Tablespaces**:
```
Data storage
```

**4. Indexes**:
```
B-tree indexes
```

### InnoDB Storage Structure

**Tablespace**:
```
Tablespace
├── Segments
│   ├── Extents
│   │   └── Pages (16 KB)
```

**Page**: 16 KB page size

**B-Tree**: Clustered index structure

## RocksDB Architecture

### What is RocksDB?

**RocksDB**: LSM-tree storage engine

**Architecture**: LSM-tree based

**Features**:
- **High Write Throughput**: High write performance
- **Compaction**: Automatic compaction
- **Configurable**: Highly configurable
- **Embeddable**: Embeddable library

**Use**: High-write workloads, embedded systems

### RocksDB Components

**1. Memtable**:
```
In-memory write buffer
```

**2. SSTables**:
```
Sorted string tables
```

**3. Compaction**:
```
Background compaction
```

**4. Bloom Filters**:
```
Bloom filters for lookups
```

### RocksDB Storage Structure

**LSM-Tree**:
```
Memtable (memory)
├── L0 (SSTables)
├── L1 (SSTables)
├── L2 (SSTables)
└── ...
```

**Compaction**: Merge SSTables

## B-Tree vs LSM-Tree

### B-Tree (InnoDB)

**Structure**: Balanced tree

**Operations**:
- **Read**: O(log n)
- **Write**: O(log n)
- **Update**: O(log n)

**Characteristics**:
- **Read-Optimized**: Good read performance
- **Write Amplification**: Write amplification
- **Random Writes**: Good random writes

### LSM-Tree (RocksDB)

**Structure**: Log-structured merge tree

**Operations**:
- **Read**: O(log n) average
- **Write**: O(1) amortized
- **Update**: O(1) amortized

**Characteristics**:
- **Write-Optimized**: Excellent write performance
- **Read Amplification**: Read amplification
- **Sequential Writes**: Sequential writes

### Comparison

| Aspect | B-Tree (InnoDB) | LSM-Tree (RocksDB) |
|--------|-----------------|-------------------|
| **Read Performance** | Excellent | Good |
| **Write Performance** | Good | Excellent |
| **Write Amplification** | Low | Higher |
| **Read Amplification** | Low | Higher |
| **Space Efficiency** | Good | Better (compaction) |
| **Complexity** | Lower | Higher |

## InnoDB Features

### Feature 1: ACID Compliance

**ACID**: Full ACID support

**Transactions**: 
- **Isolation**: Multiple isolation levels
- **Durability**: Redo log
- **Atomicity**: Undo log
- **Consistency**: Constraints

**Benefit**: Data integrity

### Feature 2: Row-Level Locking

**Row-Level Locks**: Lock individual rows

**Benefit**: 
- **Concurrency**: Better concurrency
- **Granularity**: Fine-grained locking

**Use**: High-concurrency applications

### Feature 3: Foreign Keys

**Foreign Keys**: Referential integrity

**Benefit**: 
- **Integrity**: Data integrity
- **Constraints**: Enforce constraints

**Use**: Relational data

### Feature 4: Crash Recovery

**Crash Recovery**: Automatic recovery

**Method**: 
- **Redo Log**: Redo log replay
- **Undo Log**: Undo log rollback

**Benefit**: Data durability

## RocksDB Features

### Feature 1: High Write Throughput

**Write Performance**: Excellent write performance

**Method**: 
- **Append-Only**: Append-only writes
- **Batching**: Batch writes
- **Sequential**: Sequential writes

**Benefit**: High write throughput

### Feature 2: Compaction

**Compaction**: Background compaction

**Purpose**: 
- **Merge**: Merge SSTables
- **Clean**: Remove duplicates
- **Optimize**: Optimize structure

**Benefit**: Maintain performance

### Feature 3: Bloom Filters

**Bloom Filters**: Probabilistic data structures

**Purpose**: 
- **Fast Lookups**: Fast negative lookups
- **Reduce I/O**: Reduce I/O operations

**Benefit**: Better read performance

### Feature 4: Configurability

**Configurable**: Highly configurable

**Parameters**: 
- **Compaction**: Compaction strategies
- **Bloom Filters**: Bloom filter settings
- **Memtable**: Memtable size

**Benefit**: Tune for workload

## Performance Comparison

### Read Performance

**InnoDB**: 
- **Excellent**: Excellent read performance
- **B-Tree**: B-tree structure
- **Cache**: Buffer pool caching

**RocksDB**: 
- **Good**: Good read performance
- **LSM-Tree**: LSM-tree structure
- **Bloom Filters**: Bloom filters help

### Write Performance

**InnoDB**: 
- **Good**: Good write performance
- **Random Writes**: Random writes
- **Write Amplification**: Some write amplification

**RocksDB**: 
- **Excellent**: Excellent write performance
- **Sequential Writes**: Sequential writes
- **Batching**: Write batching

## Use Cases

### InnoDB Use Cases

**1. General-Purpose Database**:
```
OLTP applications
```

**2. Relational Data**:
```
Relational databases
```

**3. ACID Requirements**:
```
Need ACID compliance
```

**4. Mixed Workloads**:
```
Mixed read/write workloads
```

### RocksDB Use Cases

**1. High-Write Workloads**:
```
High write throughput
```

**2. Embedded Systems**:
```
Embedded databases
```

**3. Time-Series Data**:
```
Time-series databases
```

**4. Key-Value Stores**:
```
Key-value stores
```

## Real-World Examples

### Example 1: MySQL with InnoDB

**Use**: General-purpose database

**Features**: 
- **ACID**: Full ACID
- **Transactions**: Transactions
- **Performance**: Good performance

**Benefit**: Reliable, performant

### Example 2: Facebook with RocksDB

**Use**: High-write workloads

**Features**: 
- **Write Throughput**: High write throughput
- **Scalability**: Scalable
- **Performance**: Excellent performance

**Benefit**: High performance

## Common Pitfalls

### Problem: Wrong Storage Engine

```c
// BAD: Use wrong storage engine
// Poor performance

// GOOD: Choose based on workload
// InnoDB for general-purpose
// RocksDB for high-write
```

### Problem: Not Tuning

```c
// BAD: Use default settings
// May not be optimal

// GOOD: Tune for workload
// Optimize parameters
```

## Quiz

1. What is InnoDB?
   - **A)** LSM-tree storage engine
   - **B)** B-tree based MySQL storage engine with ACID compliance
   - **C)** Hash-based storage engine
   - **D)** Columnar storage engine

2. What is RocksDB?
   - **A)** B-tree storage engine
   - **B)** LSM-tree based storage engine optimized for high write throughput
   - **C)** Hash-based storage engine
   - **D)** Columnar storage engine

3. What is the main difference between B-tree and LSM-tree?
   - **A)** No difference
   - **B)** B-tree optimized for reads; LSM-tree optimized for writes
   - **C)** B-tree is faster
   - **D)** LSM-tree is simpler

**Answers:**
1. **B** - InnoDB is a B-tree based MySQL storage engine providing ACID compliance, transactions, row-level locking, and crash recovery
2. **B** - RocksDB is an LSM-tree based storage engine optimized for high write throughput, using memtables, SSTables, and compaction
3. **B** - B-trees provide excellent read performance with good writes; LSM-trees provide excellent write performance (sequential writes) with good reads

## Next Steps

- [Database Indexing Strategies](../databases/11.%20Database%20Indexing%20Strategies.md) - Indexing
- [Query Execution Plans Deep Dive](../databases/12.%20Query%20Execution%20Plans%20Deep%20Dive.md) - Execution plans

